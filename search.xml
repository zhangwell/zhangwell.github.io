<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>ShareBike Project</title>
      <link href="/2019/11/25/ShareBike-Project/"/>
      <url>/2019/11/25/ShareBike-Project/</url>
      
        <content type="html"><![CDATA[<p>å¼•è¨€ï¼š</p><blockquote><p>ã€Šå…±äº«å•è½¦å¯è§†åŒ–é¡¹ç›®ã€‹â€”â€”åŸºäºSpring Bootå¿«é€Ÿæ„å»ºé¡¹ç›®ã€‚åŒ…å«æ ¸å¿ƒçš„SSMæ¡†æ¶å³ï¼šSpringMVCï¼ŒSpringï¼ŒMybatisï¼ŒåŸºäºMavené¡¹ç›®ç®¡ç†å·¥å…·ã€‚</p></blockquote><a id="more"></a><p><strong>æ•´ä¸ªæµç¨‹å¤§è‡´ä¸º</strong>ï¼šåœ°å€æ è¾“å…¥ç½‘å€ï¼Œå‰ç«¯æ§åˆ¶å™¨ï¼ˆControllerï¼‰æ‹¦æˆªè¯·æ±‚è¿›è¡Œå¤„ç†ï¼Œè°ƒç”¨æœåŠ¡å±‚ï¼ˆServiceï¼‰æ–¹æ³•ï¼ŒæœåŠ¡å±‚å†è°ƒç”¨æ•°æ®è®¿é—®å±‚ï¼ˆDao/Mapperï¼‰ä¸æ•°æ®åº“è¿›è¡Œäº¤äº’è·å–æ•°æ®ï¼Œè¿›è¡Œè¿”å›ã€‚</p><h3 id="è¡¨ç»“æ„ï¼š"><a href="#è¡¨ç»“æ„ï¼š" class="headerlink" title="è¡¨ç»“æ„ï¼š"></a>è¡¨ç»“æ„ï¼š</h3><table><thead><tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>é•¿åº¦</th><th>ä¸ºç©º</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>company_id</td><td>string</td><td>6</td><td>å¦</td><td>ä¼ä¸šæ ‡è¯†</td></tr><tr><td>bicycle_id</td><td>string</td><td>14</td><td>å¦</td><td>è½¦è¾†æ ‡è¯†</td></tr><tr><td>longitude</td><td>decimal</td><td>10</td><td>å¦</td><td>è½¦è¾†å®æ—¶åæ ‡-ç»åº¦</td></tr><tr><td>latitude</td><td>decimal</td><td>9</td><td>å¦</td><td>è½¦è¾†å®æ—¶åæ ‡-çº¬åº¦</td></tr><tr><td>lock_status</td><td>number</td><td>1</td><td>å¦</td><td>è½¦é”çŠ¶æ€ï¼šè½¦é”å®æ—¶çŠ¶æ€ 0-å¼€ï¼Œ1-å…³</td></tr><tr><td>update_time</td><td>timestamp</td><td>15</td><td>å¦</td><td>æ›´æ–°æ—¶é—´ï¼šå½“å‰UTCæ—¶é—´æˆ³</td></tr></tbody></table><p>è¡¥å……ï¼šæ•°æ®ä¸ºå•è½¦å½“å¤©é‡‡é›†çš„ä¸€å°æ—¶å†…çš„ä½ç½®ä¿¡æ¯ã€‚</p><h3 id="sqlå»ºè¡¨"><a href="#sqlå»ºè¡¨" class="headerlink" title="sqlå»ºè¡¨"></a>sqlå»ºè¡¨</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`history_bike_status`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`history_bike_status`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`bicycle_id`</span> <span class="built_in">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`longitude`</span> <span class="built_in">decimal</span>(<span class="number">11</span>,<span class="number">6</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`latitude`</span> <span class="built_in">decimal</span>(<span class="number">11</span>,<span class="number">6</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`company_id`</span> <span class="built_in">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`lock_status`</span> <span class="built_in">tinyint</span>(<span class="number">1</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`upload_time`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`update_time`</span> <span class="built_in">timestamp</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">1058621</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br></pre></td></tr></table></figure><h3 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/sharebike?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mybatis/mapper/*.xml</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.sstl.sharebikevisualization.model</span></span><br><span class="line">  <span class="attr">config-location:</span> <span class="string">classpath:mybatis/mybatis-config.xml</span></span><br></pre></td></tr></table></figure><h3 id="entity"><a href="#entity" class="headerlink" title="entity"></a>entity</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogLatObject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Double log;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Double lat;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String bicycleId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String companyId;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Double <span class="title">getLog</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> log;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLog</span><span class="params">(Double log)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.log = log;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Double <span class="title">getLat</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> lat;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLat</span><span class="params">(Double lat)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.lat = lat;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getBicycleId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> bicycleId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBicycleId</span><span class="params">(String bicycleId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.bicycleId = bicycleId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCompanyId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> companyId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCompanyId</span><span class="params">(String companyId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.companyId = companyId;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="mapper"><a href="#mapper" class="headerlink" title="mapper"></a>mapper</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BikeMapper</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–æ•°æ®åº“ä¸­å•è½¦æ•°é‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Select</span>(<span class="string">"SELECT Count(DISTINCT bicycle_id) FROM history_bike_status"</span>)</span><br><span class="line">    <span class="function">Integer <span class="title">getTotalBikeAmount</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 6.13å•è½¦æœ€åä½ç½®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Select</span>(<span class="string">"SELECT longitude lng, latitude lat, bicycle_id "</span>  +</span><br><span class="line">            <span class="string">"FROM "</span> +</span><br><span class="line">            <span class="string">"( SELECT * FROM history_bike_status AS hbs WHERE hbs.company_id = #&#123;companyId&#125; AND "</span>+</span><br><span class="line">            <span class="string">"hbs.upload_time BETWEEN '2018-06-13 00:00:00' AND '2018-06-14 00:00:00' "</span> +</span><br><span class="line">            <span class="string">"    ORDER BY hbs.upload_time DESC "</span> +</span><br><span class="line">            <span class="string">" ) temp "</span>+</span><br><span class="line">            <span class="string">"GROUP BY bicycle_id"</span>)</span><br><span class="line">    <span class="function">List&lt;LngLatObject&gt; <span class="title">getLastPositionByCompanyId</span><span class="params">(String companyId)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">List&lt;LngLatObject&gt; <span class="title">getLastPositionByCompanyIdAndTime</span><span class="params">(String companyId, String searchBeginDate, String searchEndDate)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">List&lt;LngLatObject&gt; <span class="title">getAllPositionByCompanyIdAndTime</span><span class="params">(String companyId, String searchBeginDate, String searchEndDate)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>mybatisè‡ªå®šä¹‰æŸ¥è¯¢</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id="getLastPositionByCompanyIdAndTime" resultMap="BaseResultMap"&gt;</span><br><span class="line">    <span class="keyword">SELECT</span></span><br><span class="line">    longitude <span class="keyword">log</span>,</span><br><span class="line">    latitude lat,</span><br><span class="line">    bicycle_id</span><br><span class="line">    <span class="keyword">FROM</span></span><br><span class="line">    (</span><br><span class="line">        <span class="keyword">SELECT</span> *</span><br><span class="line">        <span class="keyword">FROM</span></span><br><span class="line">        history_bike_status <span class="keyword">AS</span> hbs</span><br><span class="line">        <span class="keyword">WHERE</span></span><br><span class="line">        hbs.company_id = <span class="comment">#&#123;arg0&#125; AND hbs.upload_time BETWEEN #&#123;arg1&#125;</span></span><br><span class="line">        <span class="keyword">AND</span> <span class="comment">#&#123;arg2&#125;</span></span><br><span class="line">        <span class="keyword">ORDER</span> <span class="keyword">BY</span> hbs.upload_time <span class="keyword">DESC</span></span><br><span class="line">    ) temp</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> bicycle_id</span><br><span class="line">&lt;/<span class="keyword">select</span>&gt;</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id="getAllPositionByCompanyIdAndTime" resultMap="BaseResultMap"&gt;</span><br><span class="line">    <span class="keyword">SELECT</span></span><br><span class="line">    longitude <span class="keyword">log</span>,</span><br><span class="line">    latitude lat,</span><br><span class="line">    bicycle_id</span><br><span class="line">    <span class="keyword">FROM</span></span><br><span class="line">    history_bike_status <span class="keyword">AS</span> hbs</span><br><span class="line">    <span class="keyword">WHERE</span></span><br><span class="line">    hbs.company_id = <span class="comment">#&#123;arg0&#125;</span></span><br><span class="line">    <span class="keyword">AND</span> hbs.upload_time <span class="keyword">BETWEEN</span> <span class="comment">#&#123;arg1&#125;</span></span><br><span class="line">    <span class="keyword">AND</span> <span class="comment">#&#123;arg2&#125;</span></span><br><span class="line">&lt;/<span class="keyword">select</span>&gt;</span><br></pre></td></tr></table></figure><h3 id="service"><a href="#service" class="headerlink" title="service"></a>service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BikeServiceImpl</span> <span class="keyword">implements</span> <span class="title">BikeService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BikeMapper bikeMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getTotalBikeAmount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> bikeMapper.getTotalBikeAmount();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;LngLatObject&gt; <span class="title">getLastPositionByCompanyId</span><span class="params">(String companyId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> bikeMapper.getLastPositionByCompanyId(companyId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;LngLatObject&gt; <span class="title">getLastPositionByCompanyIdAndTime</span><span class="params">(String companyId, String searchDate)</span> </span>&#123;</span><br><span class="line">        String searchBeginDate = searchDate+<span class="string">" 00:00:00"</span>;</span><br><span class="line">        String searchEndDate = searchDate+<span class="string">" 23:59:59"</span>;</span><br><span class="line">        <span class="keyword">return</span> bikeMapper.getLastPositionByCompanyIdAndTime(companyId,searchBeginDate,searchEndDate);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;LngLatObject&gt; <span class="title">getAllPositionByCompanyIdAndTime</span><span class="params">(String companyId, String searchDate)</span> </span>&#123;</span><br><span class="line">        String searchBeginDate = searchDate+<span class="string">" 00:00:00"</span>;</span><br><span class="line">        String searchEndDate = searchDate+<span class="string">" 23:59:59"</span>;</span><br><span class="line">        <span class="keyword">return</span> bikeMapper.getAllPositionByCompanyIdAndTime(companyId,searchBeginDate,searchEndDate);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="controller"><a href="#controller" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IndexController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BikeService bikeService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String SEARCH_DATE = <span class="string">"2018-06-13"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/getOfoLastPositionData"</span>, method = RequestMethod.GET)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseEntity&lt;JsonResult&gt; <span class="title">getOfoData</span><span class="params">()</span></span>&#123;</span><br><span class="line">        JsonResult r = <span class="keyword">new</span> JsonResult();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            List&lt;LngLatObject&gt; lngLatOfoObjects = bikeService.getLastPositionByCompanyIdAndTime(<span class="string">"05ofo"</span>,SEARCH_DATE);</span><br><span class="line">            System.out.println(SEARCH_DATE);</span><br><span class="line">            r.setResult(lngLatOfoObjects);</span><br><span class="line">            r.setStatus(<span class="string">"ok"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            r.setResult(e.getClass().getName() + <span class="string">":"</span> + e.getMessage());</span><br><span class="line">            r.setStatus(<span class="string">"error"</span>);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(r);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/getMobikeLastPositionData"</span>, method = RequestMethod.GET)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseEntity&lt;JsonResult&gt; <span class="title">getMobikeData</span><span class="params">()</span></span>&#123;</span><br><span class="line">        JsonResult r = <span class="keyword">new</span> JsonResult();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            List&lt;LngLatObject&gt; lngLatMobikeObjects = bikeService.getLastPositionByCompanyIdAndTime(<span class="string">"07mobike"</span>,SEARCH_DATE);</span><br><span class="line">            r.setResult(lngLatMobikeObjects);</span><br><span class="line">            r.setStatus(<span class="string">"ok"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            r.setResult(e.getClass().getName() + <span class="string">":"</span> + e.getMessage());</span><br><span class="line">            r.setStatus(<span class="string">"error"</span>);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(r);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/getXqLastPositionData"</span>, method = RequestMethod.GET)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseEntity&lt;JsonResult&gt; <span class="title">getXqData</span><span class="params">()</span></span>&#123;</span><br><span class="line">        JsonResult r = <span class="keyword">new</span> JsonResult();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            List&lt;LngLatObject&gt; lngLatXqObjects = bikeService.getLastPositionByCompanyIdAndTime(<span class="string">"01xqcx"</span>,SEARCH_DATE);</span><br><span class="line">            r.setResult(lngLatXqObjects);</span><br><span class="line">            r.setStatus(<span class="string">"ok"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            r.setResult(e.getClass().getName() + <span class="string">":"</span> + e.getMessage());</span><br><span class="line">            r.setStatus(<span class="string">"error"</span>);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(r);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/getOfoAllPositionByTime"</span>, method = RequestMethod.GET)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseEntity&lt;JsonResult&gt; <span class="title">getOfoAllPositionByTime</span><span class="params">()</span></span>&#123;</span><br><span class="line">        JsonResult r = <span class="keyword">new</span> JsonResult();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            List&lt;LngLatObject&gt; lngLatOfoObjects = bikeService.getAllPositionByCompanyIdAndTime(<span class="string">"05ofo"</span>,SEARCH_DATE);</span><br><span class="line">            r.setResult(lngLatOfoObjects);</span><br><span class="line">            r.setStatus(<span class="string">"ok"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            r.setResult(e.getClass().getName() + <span class="string">":"</span> + e.getMessage());</span><br><span class="line">            r.setStatus(<span class="string">"error"</span>);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(r);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/getMobikeAllPositionByTime"</span>, method = RequestMethod.GET)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseEntity&lt;JsonResult&gt; <span class="title">getMobikeAllPositionByTime</span><span class="params">()</span></span>&#123;</span><br><span class="line">        JsonResult r = <span class="keyword">new</span> JsonResult();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            List&lt;LngLatObject&gt; lngLatOfoObjects = bikeService.getAllPositionByCompanyIdAndTime(<span class="string">"07mobike"</span>,SEARCH_DATE);</span><br><span class="line">            r.setResult(lngLatOfoObjects);</span><br><span class="line">            r.setStatus(<span class="string">"ok"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            r.setResult(e.getClass().getName() + <span class="string">":"</span> + e.getMessage());</span><br><span class="line">            r.setStatus(<span class="string">"error"</span>);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(r);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/getXqAllPositionByTime"</span>, method = RequestMethod.GET)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseEntity&lt;JsonResult&gt; <span class="title">getXqAllPositionByTime</span><span class="params">()</span></span>&#123;</span><br><span class="line">        JsonResult r = <span class="keyword">new</span> JsonResult();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            List&lt;LngLatObject&gt; lngLatOfoObjects = bikeService.getAllPositionByCompanyIdAndTime(<span class="string">"01xqcx"</span>,SEARCH_DATE);</span><br><span class="line">            r.setResult(lngLatOfoObjects);</span><br><span class="line">            r.setStatus(<span class="string">"ok"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            r.setResult(e.getClass().getName() + <span class="string">":"</span> + e.getMessage());</span><br><span class="line">            r.setStatus(<span class="string">"error"</span>);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(r);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¡µé¢å±•ç¤ºåŸºäºhtmlå®ç°ï¼Œå±•ç¤ºï¼Œåˆ†åŒºåŸŸï¼Œå¼¹çª—ç­‰åŸºæœ¬å±•ç¤ºåŠŸèƒ½å°±å®Œç»“ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªåŸºäºç¼©æ”¾çš„ç‚¹èšåˆä¼˜åŒ–ï¼›</p><h3 id="ç‚¹èšåˆä¼˜åŒ–"><a href="#ç‚¹èšåˆä¼˜åŒ–" class="headerlink" title="ç‚¹èšåˆä¼˜åŒ–"></a>ç‚¹èšåˆä¼˜åŒ–</h3><p>é—®é¢˜ï¼šåŠ è½½å¤§é‡ç‚¹æ—¶å€™å¡é¡¿</p><p>ç¼˜ç”±ï¼š ç‚¹æ˜¯å¦èšåˆçš„åˆ¤æ–­æ˜¯è®¡ç®—å…¶æ˜¯å¦åœ¨èšåˆç‚¹çš„èŒƒå›´å†…ï¼›ç™¾åº¦åœ°å›¾å¼€å‘æ–‡æ¡£çš„æ“ä½œæ˜¯ï¼Œæ˜¯åœ¨åŠ ç‚¹è¿‡ç¨‹ä¸­è¿›è¡ŒDOMæ“ä½œ</p><blockquote><p> documentæ–‡æ¡£ object å¯¹è±¡ modelæ¨¡å‹ï¼ŒDomç¿»è¯‘ä¸­æ–‡ï¼šæ–‡æ¡£å¯¹è±¡æ¨¡å‹ </p><p> domæ“ä½œå°±æ˜¯å…ƒç´ èŠ‚ç‚¹æ“ä½œ,æŒ‡çš„æ˜¯æ”¹å˜htmlçš„æ ‡ç­¾ç»“æ„ï¼Œå®ƒæœ‰ä¸¤ç§æƒ…å†µï¼š </p><ol><li>ç§»åŠ¨ç°æœ‰æ ‡ç­¾çš„ä½ç½®ï¼›</li><li>å°†æ–°åˆ›å»ºçš„æ ‡ç­¾æ’å…¥åˆ°ç°æœ‰çš„æ ‡ç­¾ä¸­ ã€‚</li></ol></blockquote><p>è§£å†³ï¼š addMarker() æ–¹æ³•å†…ä¸åœçš„å»è¿›è¡Œdomæ“ä½œæ˜¯æœ€ä¸»è¦çš„å¼Šç«¯ï¼Œæ‰€ä»¥åœ¨åªè¦æ‰¹é‡åŠ ç‚¹æ—¶ï¼Œå±è”½DOMæ“ä½œï¼Œè®¡ç®—å®Œæˆåï¼Œå†ä¸€æ¬¡éå†DOMæ˜¾ç¤ºï¼Œé€Ÿåº¦å°±æå¤§æå‡ã€‚ </p><p>å‚è€ƒé“¾æ¥ï¼š<a href="https://www.zhihu.com/question/24023333" target="_blank" rel="noopener"> çŸ¥ä¹ </a>ï¼Œ<a href="https://www.cnblogs.com/hss-blog/p/9040666.html" target="_blank" rel="noopener">åšå®¢å›­</a>ï¼Œ<a href="https://www.cnblogs.com/lightnull/p/6184867.html" target="_blank" rel="noopener">åšä¸»</a></p><ul><li><input disabled type="checkbox"> åç»­çš„å„ç§å¯è§†åŒ–åŠŸèƒ½ä¹Ÿæ²¡å¼€å‘å‡ºæ¥</li></ul>]]></content>
      
      
      <categories>
          
          <category> Project Learning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> spring boot </tag>
            
            <tag> ssm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SecKill Project</title>
      <link href="/2019/11/25/SecKill-Project/"/>
      <url>/2019/11/25/SecKill-Project/</url>
      
        <content type="html"><![CDATA[<p>å¼•è¨€ï¼š</p><blockquote><p>åŸºäºSpringBootæ¡†æ¶æ„å»ºçƒ­ç‚¹å•†å“ç§’æ€é¡¹ç›®ï¼Œäº®ç‚¹ï¼š Rediså®ç°åˆ†å¸ƒå¼Sessionï¼Œ é¡µé¢ç¼“å­˜ï¼ŒRabbitMQ+æ¥å£ä¼˜åŒ–ï¼Œ çº¿ä¸Šéƒ¨ç½²</p></blockquote><a id="more"></a><p><a href="https://www.acfun.cn/v/ac10759479" target="_blank" rel="noopener">Aç«™å­¦ä¹ è§†é¢‘</a></p>]]></content>
      
      
      <categories>
          
          <category> Project Learning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> spring boot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java-Algorithm</title>
      <link href="/2019/11/25/Java-Algorithm/"/>
      <url>/2019/11/25/Java-Algorithm/</url>
      
        <content type="html"><![CDATA[<p>å¼•è¨€ï¼š</p><blockquote><p>å…³äºJavaç®—æ³•ä¸æ•°æ®ç»“æ„çš„æ±‡æ€»æ </p></blockquote><a id="more"></a><ul><li><input disabled type="checkbox"> é€’å½’&amp;åˆ†æ²»</li><li><input disabled type="checkbox"> è´ªå¿ƒ</li><li><input disabled type="checkbox"> æ’åº<ul><li><input disabled type="checkbox"> å…«å¤§æ’åº</li></ul></li><li><input disabled type="checkbox"> äºŒåˆ†</li><li><input disabled type="checkbox"> æŸ¥æ‰¾<ul><li><input disabled type="checkbox"> DFS</li><li><input disabled type="checkbox"> BFS</li><li><input disabled type="checkbox"> å›æº¯</li></ul></li><li><input disabled type="checkbox"> åŠ¨æ€è§„åˆ’</li><li><input disabled type="checkbox"> å­—ç¬¦ä¸²</li><li><input disabled type="checkbox"> æ•°æ®ç»“æ„<ul><li><input disabled type="checkbox"> æ•°ç»„</li><li><input disabled type="checkbox"> æ ˆ</li><li><input disabled type="checkbox"> é˜Ÿåˆ—</li><li><input disabled type="checkbox"> æ ‘</li></ul></li><li><input disabled type="checkbox"> å®è·µ<ul><li><input disabled type="checkbox"> <a href="https://zhangwell.github.io/2019/11/25/LeetCode-Top100/" target="_blank" rel="noopener">LeetCode-Top100</a></li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> Algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> summary </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LeetCode Top100</title>
      <link href="/2019/11/25/LeetCode-Top100/"/>
      <url>/2019/11/25/LeetCode-Top100/</url>
      
        <content type="html"><![CDATA[<p>å¼•è¨€ï¼š</p><blockquote><p>LeetCode Top100 tagsé¢˜è§£</p></blockquote><a id="more"></a><p>å­¦ä¹ è§‚çœ‹ï¼š</p><p><a href="https://www.bilibili.com/video/av51692387" target="_blank" rel="noopener">Bç«™è§†é¢‘é¢˜è§£</a></p>]]></content>
      
      
      <categories>
          
          <category> Algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> leetcode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redis</title>
      <link href="/2019/11/25/Redis/"/>
      <url>/2019/11/25/Redis/</url>
      
        <content type="html"><![CDATA[<p>å¼•è¨€ï¼š</p><blockquote><p>é’ˆå¯¹é¢è¯•ä¸­redisé—®ç­”å½¢å¼çš„æ€»ç»“</p><ul><li><input disabled type="checkbox"> æ•°æ®åº“ä¸redisæ•°æ®ä¸€è‡´æ€§é—®é¢˜</li></ul></blockquote><a id="more"></a><h2 id="ä»€ä¹ˆæ˜¯-Redis-ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-Redis-ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ Redis ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ Redis ï¼Ÿ</h2><p>Redisï¼Œå…¨ç§° Remote Dictionary Serverï¼Œæ˜¯ä¸€ä¸ªåŸºäºå†…å­˜çš„é«˜æ€§èƒ½ Key-Value æ•°æ®åº“ã€‚</p><p><strong>1ã€é€Ÿåº¦å¿«</strong></p><p>å› ä¸ºæ•°æ®å­˜åœ¨å†…å­˜ä¸­ï¼Œç±»ä¼¼äº HashMap ï¼ŒHashMap çš„ä¼˜åŠ¿å°±æ˜¯æŸ¥æ‰¾å’Œæ“ä½œçš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O (1) ã€‚</p><blockquote><p>Redis æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª Key-Value ç±»å‹çš„å†…å­˜æ•°æ®åº“ï¼Œå¾ˆåƒMemcached ï¼Œæ•´ä¸ªæ•°æ®åº“ç»Ÿç»ŸåŠ è½½åœ¨å†…å­˜å½“ä¸­è¿›è¡Œæ“ä½œï¼Œå®šæœŸé€šè¿‡å¼‚æ­¥æ“ä½œæŠŠæ•°æ®åº“æ•°æ® flush åˆ°ç¡¬ç›˜ä¸Šè¿›è¡Œä¿å­˜ã€‚</p><p>å› ä¸ºæ˜¯çº¯å†…å­˜æ“ä½œï¼ŒRedis çš„æ€§èƒ½éå¸¸å‡ºè‰²ï¼Œæ¯ç§’å¯ä»¥å¤„ç†è¶…è¿‡ 10 ä¸‡æ¬¡è¯»å†™æ“ä½œï¼Œæ˜¯å·²çŸ¥æ€§èƒ½æœ€å¿«çš„ Key-Value æ•°æ®åº“ã€‚</p></blockquote><p><strong>2ã€æ”¯æŒä¸°å¯Œæ•°æ®ç±»å‹</strong></p><p>æ”¯æŒ String ï¼ŒListï¼ŒSetï¼ŒSorted Setï¼ŒHash ã€‚</p><blockquote><ul><li>ç”¨ä»–çš„ List æ¥åš FIFO åŒå‘é“¾è¡¨ï¼Œå®ç°ä¸€ä¸ªè½»é‡çº§çš„é«˜æ€§èƒ½æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡ã€‚</li><li>ç”¨ä»–çš„ Set å¯ä»¥åšé«˜æ€§èƒ½çš„ tag ç³»ç»Ÿç­‰ç­‰ã€‚</li></ul></blockquote><p><strong>3ã€æŒä¹…åŒ–å­˜å‚¨</strong></p><p>Redis æä¾› RDB å’Œ AOF ä¸¤ç§æ•°æ®çš„æŒä¹…åŒ–å­˜å‚¨æ–¹æ¡ˆï¼Œè§£å†³å†…å­˜æ•°æ®åº“æœ€æ‹…å¿ƒçš„ä¸‡ä¸€ Redis æŒ‚æ‰ï¼Œæ•°æ®ä¼šæ¶ˆå¤±æ‰ã€‚</p><h3 id="Redis-æœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Ÿ"><a href="#Redis-æœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Ÿ" class="headerlink" title="Redis æœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Ÿ"></a>Redis æœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Ÿ</h3><ul><li>ç”±äº Redis æ˜¯å†…å­˜æ•°æ®åº“ï¼Œæ‰€ä»¥ï¼Œå•å°æœºå™¨ï¼Œå­˜å‚¨çš„æ•°æ®é‡ï¼Œè·Ÿæœºå™¨æœ¬èº«çš„å†…å­˜å¤§å°ã€‚è™½ç„¶ Redis æœ¬èº«æœ‰ Key è¿‡æœŸç­–ç•¥ï¼Œä½†æ˜¯è¿˜æ˜¯éœ€è¦æå‰é¢„ä¼°å’ŒèŠ‚çº¦å†…å­˜ã€‚å¦‚æœå†…å­˜å¢é•¿è¿‡å¿«ï¼Œéœ€è¦å®šæœŸåˆ é™¤æ•°æ®ã€‚</li><li>å¦‚æœè¿›è¡Œå®Œæ•´é‡åŒæ­¥ï¼Œç”±äºéœ€è¦ç”Ÿæˆ RDB æ–‡ä»¶ï¼Œå¹¶è¿›è¡Œä¼ è¾“ï¼Œä¼šå ç”¨ä¸»æœºçš„ CPU ï¼Œå¹¶ä¼šæ¶ˆè€—ç°ç½‘çš„å¸¦å®½ã€‚ä¸è¿‡ Redis2.8 ç‰ˆæœ¬ï¼Œå·²ç»æœ‰éƒ¨åˆ†é‡åŒæ­¥çš„åŠŸèƒ½ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰å¯èƒ½æœ‰å®Œæ•´é‡åŒæ­¥çš„ã€‚æ¯”å¦‚ï¼Œæ–°ä¸Šçº¿çš„å¤‡æœºã€‚</li><li>ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œè¿›è¡Œé‡å¯ï¼Œå°†ç¡¬ç›˜ä¸­çš„æ•°æ®åŠ è½½è¿›å†…å­˜ï¼Œæ—¶é—´æ¯”è¾ƒä¹…ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒRedis ä¸èƒ½æä¾›æœåŠ¡ã€‚</li></ul><p><strong>TODOç½‘ç»œ IO æ¨¡å‹</strong></p><ul><li>Memcached æ˜¯å¤šçº¿ç¨‹ï¼Œéé˜»å¡ IO å¤ç”¨çš„ç½‘ç»œæ¨¡å‹ï¼ŒåŸå‹ä¸Šæ¥è¿‘ Nignx ã€‚</li><li>Redis ä½¿ç”¨å•çº¿ç¨‹çš„ IO å¤ç”¨æ¨¡å‹ï¼Œè‡ªå·±å°è£…äº†ä¸€ä¸ªç®€å•çš„ AeEvent äº‹ä»¶å¤„ç†æ¡†æ¶ï¼Œä¸»è¦å®ç°äº† epoll, kqueue å’Œ select ï¼Œæ›´æ¥è¿‘ Apache æ—©æœŸçš„æ¨¡å¼ã€‚</li></ul><p>TODO æœ‰ç‚¹çœ‹ä¸æ‡‚ï¼Œæ‰¾äºšæ™®è¡¨å¼Ÿç¡®è®¤ä¸­ã€‚</p><h2 id="è¯·è¯´è¯´-Redis-çš„çº¿ç¨‹æ¨¡å‹ï¼Ÿ"><a href="#è¯·è¯´è¯´-Redis-çš„çº¿ç¨‹æ¨¡å‹ï¼Ÿ" class="headerlink" title="è¯·è¯´è¯´ Redis çš„çº¿ç¨‹æ¨¡å‹ï¼Ÿ"></a>è¯·è¯´è¯´ Redis çš„çº¿ç¨‹æ¨¡å‹ï¼Ÿ</h2><p>redis å†…éƒ¨ä½¿ç”¨æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ <code>file event handler</code>ï¼Œè¿™ä¸ªæ–‡ä»¶äº‹ä»¶å¤„ç†å™¨æ˜¯å•çº¿ç¨‹çš„ï¼Œæ‰€ä»¥ redis æ‰å«åšå•çº¿ç¨‹çš„æ¨¡å‹ã€‚å®ƒé‡‡ç”¨ IO å¤šè·¯å¤ç”¨æœºåˆ¶åŒæ—¶ç›‘å¬å¤šä¸ª socketï¼Œæ ¹æ® socket ä¸Šçš„äº‹ä»¶æ¥é€‰æ‹©å¯¹åº”çš„äº‹ä»¶å¤„ç†å™¨è¿›è¡Œå¤„ç†ã€‚</p><p>æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨çš„ç»“æ„åŒ…å« 4 ä¸ªéƒ¨åˆ†ï¼š</p><ul><li>å¤šä¸ª socket</li><li>IO å¤šè·¯å¤ç”¨ç¨‹åº</li><li>æ–‡ä»¶äº‹ä»¶åˆ†æ´¾å™¨</li><li>äº‹ä»¶å¤„ç†å™¨ï¼ˆè¿æ¥åº”ç­”å¤„ç†å™¨ã€å‘½ä»¤è¯·æ±‚å¤„ç†å™¨ã€å‘½ä»¤å›å¤å¤„ç†å™¨ï¼‰</li></ul><p><img src="/2019/11/25/Redis/image-20191125110950740.png" alt="image-20191125110950740"></p><p>å¤šä¸ª socket å¯èƒ½ä¼šå¹¶å‘äº§ç”Ÿä¸åŒçš„æ“ä½œï¼Œæ¯ä¸ªæ“ä½œå¯¹åº”ä¸åŒçš„æ–‡ä»¶äº‹ä»¶ï¼Œä½†æ˜¯ IO å¤šè·¯å¤ç”¨ç¨‹åºä¼šç›‘å¬å¤šä¸ª socketï¼Œä¼šå°† socket äº§ç”Ÿçš„äº‹ä»¶æ”¾å…¥é˜Ÿåˆ—ä¸­æ’é˜Ÿï¼Œäº‹ä»¶åˆ†æ´¾å™¨æ¯æ¬¡ä»é˜Ÿåˆ—ä¸­å–å‡ºä¸€ä¸ªäº‹ä»¶ï¼ŒæŠŠè¯¥äº‹ä»¶äº¤ç»™å¯¹åº”çš„äº‹ä»¶å¤„ç†å™¨è¿›è¡Œå¤„ç†ã€‚</p><p>æ¥çœ‹å®¢æˆ·ç«¯ä¸ redis çš„ä¸€æ¬¡é€šä¿¡è¿‡ç¨‹ï¼š</p><p><img src="/2019/11/25/Redis/image-20191125111306113.png" alt="image-20191125111306113"></p><ul><li>å®¢æˆ·ç«¯ socket01 å‘ redis çš„ server socket è¯·æ±‚å»ºç«‹è¿æ¥ï¼Œæ­¤æ—¶ server socket ä¼šäº§ç”Ÿä¸€ä¸ª <code>AE_READABLE</code> äº‹ä»¶ï¼ŒIO å¤šè·¯å¤ç”¨ç¨‹åºç›‘å¬åˆ° server socket äº§ç”Ÿçš„äº‹ä»¶åï¼Œå°†è¯¥äº‹ä»¶å‹å…¥é˜Ÿåˆ—ä¸­ã€‚æ–‡ä»¶äº‹ä»¶åˆ†æ´¾å™¨ä»é˜Ÿåˆ—ä¸­è·å–è¯¥äº‹ä»¶ï¼Œäº¤ç»™<strong>è¿æ¥åº”ç­”å¤„ç†å™¨</strong>ã€‚è¿æ¥åº”ç­”å¤„ç†å™¨ä¼šåˆ›å»ºä¸€ä¸ªèƒ½ä¸å®¢æˆ·ç«¯é€šä¿¡çš„ socket01ï¼Œå¹¶å°†è¯¥ socket01 çš„ <code>AE_READABLE</code> äº‹ä»¶ä¸å‘½ä»¤è¯·æ±‚å¤„ç†å™¨å…³è”ã€‚</li><li>å‡è®¾æ­¤æ—¶å®¢æˆ·ç«¯å‘é€äº†ä¸€ä¸ª <code>set key value</code> è¯·æ±‚ï¼Œæ­¤æ—¶ redis ä¸­çš„ socket01 ä¼šäº§ç”Ÿ <code>AE_READABLE</code> äº‹ä»¶ï¼ŒIO å¤šè·¯å¤ç”¨ç¨‹åºå°†äº‹ä»¶å‹å…¥é˜Ÿåˆ—ï¼Œæ­¤æ—¶äº‹ä»¶åˆ†æ´¾å™¨ä»é˜Ÿåˆ—ä¸­è·å–åˆ°è¯¥äº‹ä»¶ï¼Œç”±äºå‰é¢ socket01 çš„ <code>AE_READABLE</code> äº‹ä»¶å·²ç»ä¸å‘½ä»¤è¯·æ±‚å¤„ç†å™¨å…³è”ï¼Œå› æ­¤äº‹ä»¶åˆ†æ´¾å™¨å°†äº‹ä»¶äº¤ç»™å‘½ä»¤è¯·æ±‚å¤„ç†å™¨æ¥å¤„ç†ã€‚å‘½ä»¤è¯·æ±‚å¤„ç†å™¨è¯»å– socket01 çš„ <code>key value</code> å¹¶åœ¨è‡ªå·±å†…å­˜ä¸­å®Œæˆ <code>key value</code> çš„è®¾ç½®ã€‚æ“ä½œå®Œæˆåï¼Œå®ƒä¼šå°† socket01 çš„ <code>AE_WRITABLE</code> äº‹ä»¶ä¸ä»¤å›å¤å¤„ç†å™¨å…³è”ã€‚</li><li>å¦‚æœæ­¤æ—¶å®¢æˆ·ç«¯å‡†å¤‡å¥½æ¥æ”¶è¿”å›ç»“æœäº†ï¼Œé‚£ä¹ˆ redis ä¸­çš„ socket01 ä¼šäº§ç”Ÿä¸€ä¸ª <code>AE_WRITABLE</code> äº‹ä»¶ï¼ŒåŒæ ·å‹å…¥é˜Ÿåˆ—ä¸­ï¼Œäº‹ä»¶åˆ†æ´¾å™¨æ‰¾åˆ°ç›¸å…³è”çš„å‘½ä»¤å›å¤å¤„ç†å™¨ï¼Œç”±å‘½ä»¤å›å¤å¤„ç†å™¨å¯¹ socket01 è¾“å…¥æœ¬æ¬¡æ“ä½œçš„ä¸€ä¸ªç»“æœï¼Œæ¯”å¦‚ <code>ok</code>ï¼Œä¹‹åè§£é™¤ socket01 çš„ <code>AE_WRITABLE</code> äº‹ä»¶ä¸å‘½ä»¤å›å¤å¤„ç†å™¨çš„å…³è”ã€‚</li></ul><p>è¿™æ ·ä¾¿å®Œæˆäº†ä¸€æ¬¡é€šä¿¡ã€‚ğŸ˜ˆ è€å¿ƒç†è§£ä¸€ä¸‹ï¼Œç°å¸¸é‡è¦ã€‚</p><h2 id="ä¸ºä»€ä¹ˆ-Redis-å•çº¿ç¨‹æ¨¡å‹ä¹Ÿèƒ½æ•ˆç‡è¿™ä¹ˆé«˜ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆ-Redis-å•çº¿ç¨‹æ¨¡å‹ä¹Ÿèƒ½æ•ˆç‡è¿™ä¹ˆé«˜ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆ Redis å•çº¿ç¨‹æ¨¡å‹ä¹Ÿèƒ½æ•ˆç‡è¿™ä¹ˆé«˜ï¼Ÿ"></a>ä¸ºä»€ä¹ˆ Redis å•çº¿ç¨‹æ¨¡å‹ä¹Ÿèƒ½æ•ˆç‡è¿™ä¹ˆé«˜ï¼Ÿ</h2><ul><li>å®Œå…¨åŸºäºå†…å­˜æ“ä½œï¼Œç»å¤§å¤šæ•°è¯·æ±‚æ˜¯çº¯å†…å­˜æ“ä½œï¼Œæ‰§è¡Œæ•ˆç‡é«˜ï¼›</li><li>æ•°æ®ç»“æ„ç®€å•ï¼Œæ“ä½œä¹Ÿå°±ç®€å•ï¼›å…¨ç¨‹ä½¿ç”¨ hash ç»“æ„ï¼Œè¯»å–é€Ÿåº¦å¿«ï¼›</li><li>ä½¿ç”¨å•çº¿ç¨‹ï¼Œæ˜¯æŒ‡ä¸»çº¿ç¨‹æ˜¯å•çº¿ç¨‹çš„ï¼Œè¿™é‡Œä¸»çº¿ç¨‹åŒ…æ‹¬I/Oäº‹ä»¶å¤„ç†ã€è¿‡æœŸé”®å¤„ç†ã€å¤åˆ¶åè°ƒã€é›†ç¾¤åè°ƒï¼Œè¿™äº›å¤„ç†IOäº‹ä»¶çš„é€»è¾‘ä¼šè¢«å°è£…æˆå‘¨æœŸæ€§çš„ä»»åŠ¡ç”±ä¸»çº¿ç¨‹å‘¨æœŸæ€§å¤„ç†ã€‚å•çº¿ç¨‹è®¾è®¡ï¼Œå¯¹äºå®¢æˆ·ç«¯çš„æ‰€æœ‰è¯»å†™è¯·æ±‚ï¼Œéƒ½ç”±ä¸€ä¸ªä¸»çº¿ç¨‹ä¸²è¡Œå¤„ç†ï¼Œå› æ­¤å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶å¯¹ä¸€ä¸ªé”®è¿›è¡Œå†™æ“ä½œæ—¶å€™å°±ä¸ä¼šæœ‰å¹¶å‘çš„é—®é¢˜ï¼Œé¿å…é¢‘ç¹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ã€é”ç«äº‰é—®é¢˜ï¼›</li><li>rediså•çº¿ä¹Ÿå¯ä»¥å¤„ç†é«˜å¹¶å‘è¯·æ±‚ï¼Œå¹¶å‘æ€§IOæµæŒ‡è®©ä¸€ä¸ªè®¡ç®—å•å…ƒå¤„ç†æ¥è‡ªå¤šä¸ªå®¢æˆ·ç«¯çš„æµè¯·æ±‚ï¼Œredisä½¿ç”¨å•çº¿ç¨‹é…åˆä¸ŠIOå¤šè·¯å¤ç”¨å¯å¤§å¹…åº¦æå‡æ€§èƒ½ï¼Œè¿™é‡Œçš„å•çº¿ç¨‹æ˜¯æŒ‡å¤„ç†ç½‘ç»œè¯·æ±‚åªæœ‰ä¸€ä¸ªå•çº¿ç¨‹æ¥å¤„ç†ï¼›ä¸€ä¸ªæ­£å¼çš„redis servletè‚¯å®šæ˜¯ä¸æ­¢ä¸€ä¸ªè¿›ç¨‹çš„ã€‚</li><li>å¤šè·¯I/Oå¤ç”¨æ¨¡å‹ï¼Œå³éé˜»å¡I/Oï¼›redisæ˜¯å•çº¿ç¨‹çš„ï¼Œæ‰€æœ‰çš„æ“ä½œæ˜¯æŒ‰ç…§é¡ºåºçº¿æ€§æ‰§è¡Œçš„ï¼Œä½†æ˜¯ç”±äºè¯»å†™æ“ä½œï¼Œç­‰å¾…ç”¨æˆ·è¾“å…¥æˆ–è€…è¾“å‡ºéƒ½æ˜¯é˜»å¡çš„ï¼Œæ‰€ä»¥IOæ“ä½œå¾€å¾€ä¸èƒ½ç›´æ¥è¿”å›å°±ä¼šå¯¼è‡´æŸä¸€æ–‡ä»¶çš„IOé˜»å¡ï¼Œè¿›è€Œè¿›ç¨‹æ— æ³•å¯¹å…¶ä»–å®¢æˆ·ç«¯æä¾›æœåŠ¡ï¼›IOå¤šè·¯å¤ç”¨å°±æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜ï¼</li></ul><h2 id="Redis-æœ‰å‡ ç§æŒä¹…åŒ–æ–¹å¼ï¼Ÿ"><a href="#Redis-æœ‰å‡ ç§æŒä¹…åŒ–æ–¹å¼ï¼Ÿ" class="headerlink" title="Redis æœ‰å‡ ç§æŒä¹…åŒ–æ–¹å¼ï¼Ÿ"></a>Redis æœ‰å‡ ç§æŒä¹…åŒ–æ–¹å¼ï¼Ÿ</h2><h3 id="æŒä¹…åŒ–æ–¹å¼"><a href="#æŒä¹…åŒ–æ–¹å¼" class="headerlink" title="æŒä¹…åŒ–æ–¹å¼"></a>æŒä¹…åŒ–æ–¹å¼</h3><p>Redis æä¾›äº†ä¸¤ç§æ–¹å¼ï¼Œå®ç°æ•°æ®çš„æŒä¹…åŒ–åˆ°ç¡¬ç›˜ã€‚</p><ul><li>ã€å…¨é‡ã€‘RDB æŒä¹…åŒ–ï¼Œæ˜¯æŒ‡åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…å°†å†…å­˜ä¸­çš„<strong>æ•°æ®é›†å¿«ç…§</strong>å†™å…¥ç£ç›˜ã€‚å®é™…æ“ä½œè¿‡ç¨‹æ˜¯ï¼Œfork ä¸€ä¸ªå­è¿›ç¨‹ï¼Œå…ˆå°†æ•°æ®é›†å†™å…¥ä¸´æ—¶æ–‡ä»¶ï¼Œå†™å…¥æˆåŠŸåï¼Œå†æ›¿æ¢ä¹‹å‰çš„æ–‡ä»¶ï¼Œç”¨äºŒè¿›åˆ¶å‹ç¼©å­˜å‚¨ã€‚</li><li>ã€å¢é‡ã€‘AOFæŒä¹…åŒ–ï¼Œä»¥æ—¥å¿—çš„å½¢å¼è®°å½•æœåŠ¡å™¨æ‰€å¤„ç†çš„æ¯ä¸€ä¸ª<strong>å†™ã€åˆ é™¤æ“ä½œ</strong>ï¼ŒæŸ¥è¯¢æ“ä½œä¸ä¼šè®°å½•ï¼Œä»¥æ–‡æœ¬çš„æ–¹å¼è®°å½•ï¼Œå¯ä»¥æ‰“å¼€æ–‡ä»¶çœ‹åˆ°è¯¦ç»†çš„æ“ä½œè®°å½•ã€‚</li></ul><h3 id="äºŒè€…çš„åŒºåˆ«"><a href="#äºŒè€…çš„åŒºåˆ«" class="headerlink" title="äºŒè€…çš„åŒºåˆ«"></a>äºŒè€…çš„åŒºåˆ«</h3><p>RDBæŒä¹…åŒ–æ˜¯æŒ‡åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…å°†å†…å­˜ä¸­çš„æ•°æ®é›†å¿«ç…§å†™å…¥ç£ç›˜ï¼Œå®é™…æ“ä½œè¿‡ç¨‹æ˜¯forkä¸€ä¸ªå­è¿›ç¨‹ï¼Œå…ˆå°†æ•°æ®é›†å†™å…¥ä¸´æ—¶æ–‡ä»¶ï¼Œå†™å…¥æˆåŠŸåï¼Œå†æ›¿æ¢ä¹‹å‰çš„æ–‡ä»¶ï¼Œç”¨äºŒè¿›åˆ¶å‹ç¼©å­˜å‚¨ã€‚</p><p>AOFæŒä¹…åŒ–ä»¥æ—¥å¿—çš„å½¢å¼è®°å½•æœåŠ¡å™¨æ‰€å¤„ç†çš„æ¯ä¸€ä¸ªå†™ã€åˆ é™¤æ“ä½œï¼ŒæŸ¥è¯¢æ“ä½œä¸ä¼šè®°å½•ï¼Œä»¥æ–‡æœ¬çš„æ–¹å¼è®°å½•ï¼Œå¯ä»¥æ‰“å¼€æ–‡ä»¶çœ‹åˆ°è¯¦ç»†çš„æ“ä½œè®°å½•ã€‚</p><h3 id="äºŒè€…ä¼˜ç¼ºç‚¹"><a href="#äºŒè€…ä¼˜ç¼ºç‚¹" class="headerlink" title="äºŒè€…ä¼˜ç¼ºç‚¹"></a>äºŒè€…ä¼˜ç¼ºç‚¹</h3><p><strong>RDBå­˜åœ¨å“ªäº›ä¼˜åŠ¿å‘¢ï¼Ÿ</strong></p><ul><li>ä¸€æ—¦é‡‡ç”¨è¯¥æ–¹å¼ï¼Œé‚£ä¹ˆä½ çš„æ•´ä¸ªRedisæ•°æ®åº“å°†åªåŒ…å«ä¸€ä¸ªæ–‡ä»¶ï¼Œè¿™å¯¹äºæ–‡ä»¶å¤‡ä»½è€Œè¨€æ˜¯éå¸¸å®Œç¾çš„ã€‚æ¯”å¦‚ï¼Œä½ å¯èƒ½æ‰“ç®—æ¯ä¸ªå°æ—¶å½’æ¡£ä¸€æ¬¡æœ€è¿‘24å°æ—¶çš„æ•°æ®ï¼ŒåŒæ—¶è¿˜è¦æ¯å¤©å½’æ¡£ä¸€æ¬¡æœ€è¿‘30å¤©çš„æ•°æ®ã€‚é€šè¿‡è¿™æ ·çš„å¤‡ä»½ç­–ç•¥ï¼Œä¸€æ—¦ç³»ç»Ÿå‡ºç°ç¾éš¾æ€§æ•…éšœï¼Œæˆ‘ä»¬å¯ä»¥éå¸¸å®¹æ˜“çš„è¿›è¡Œæ¢å¤ã€‚</li><li>å¯¹äºç¾éš¾æ¢å¤è€Œè¨€ï¼ŒRDBæ˜¯éå¸¸ä¸é”™çš„é€‰æ‹©ã€‚å› ä¸ºæˆ‘ä»¬å¯ä»¥éå¸¸è½»æ¾çš„å°†ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶å‹ç¼©åå†è½¬ç§»åˆ°å…¶å®ƒå­˜å‚¨ä»‹è´¨ä¸Šã€‚</li><li>æ€§èƒ½æœ€å¤§åŒ–ã€‚å¯¹äºRedisçš„æœåŠ¡è¿›ç¨‹è€Œè¨€ï¼Œåœ¨å¼€å§‹æŒä¹…åŒ–æ—¶ï¼Œå®ƒå”¯ä¸€éœ€è¦åšçš„åªæ˜¯forkå‡ºå­è¿›ç¨‹ï¼Œä¹‹åå†ç”±å­è¿›ç¨‹å®Œæˆè¿™äº›æŒä¹…åŒ–çš„å·¥ä½œï¼Œè¿™æ ·å°±å¯ä»¥æå¤§çš„é¿å…æœåŠ¡è¿›ç¨‹æ‰§è¡ŒIOæ“ä½œäº†ã€‚</li><li>ç›¸æ¯”äºAOFæœºåˆ¶ï¼Œå¦‚æœæ•°æ®é›†å¾ˆå¤§ï¼ŒRDBçš„å¯åŠ¨æ•ˆç‡ä¼šæ›´é«˜ã€‚</li></ul><p><strong>RDBåˆå­˜åœ¨å“ªäº›åŠ£åŠ¿å‘¢ï¼Ÿ</strong></p><ul><li>.å¦‚æœä½ æƒ³ä¿è¯æ•°æ®çš„é«˜å¯ç”¨æ€§ï¼Œå³æœ€å¤§é™åº¦çš„é¿å…æ•°æ®ä¸¢å¤±ï¼Œé‚£ä¹ˆRDBå°†ä¸æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚å› ä¸ºç³»ç»Ÿä¸€æ—¦åœ¨å®šæ—¶æŒä¹…åŒ–ä¹‹å‰å‡ºç°å®•æœºç°è±¡ï¼Œæ­¤å‰æ²¡æœ‰æ¥å¾—åŠå†™å…¥ç£ç›˜çš„æ•°æ®éƒ½å°†ä¸¢å¤±ã€‚</li><li>ç”±äºRDBæ˜¯é€šè¿‡forkå­è¿›ç¨‹æ¥ååŠ©å®Œæˆæ•°æ®æŒä¹…åŒ–å·¥ä½œçš„ï¼Œå› æ­¤ï¼Œå¦‚æœå½“æ•°æ®é›†è¾ƒå¤§æ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•´ä¸ªæœåŠ¡å™¨åœæ­¢æœåŠ¡å‡ ç™¾æ¯«ç§’ï¼Œç”šè‡³æ˜¯1ç§’é’Ÿã€‚</li></ul><p><strong>AOFçš„ä¼˜åŠ¿æœ‰å“ªäº›å‘¢ï¼Ÿ</strong></p><ul><li>è¯¥æœºåˆ¶å¯ä»¥å¸¦æ¥æ›´é«˜çš„æ•°æ®å®‰å…¨æ€§ï¼Œå³æ•°æ®æŒä¹…æ€§ã€‚Redisä¸­æä¾›äº†3ä¸­åŒæ­¥ç­–ç•¥ï¼Œå³æ¯ç§’åŒæ­¥ã€æ¯ä¿®æ”¹åŒæ­¥å’Œä¸åŒæ­¥ã€‚äº‹å®ä¸Šï¼Œæ¯ç§’åŒæ­¥ä¹Ÿæ˜¯å¼‚æ­¥å®Œæˆçš„ï¼Œå…¶æ•ˆç‡ä¹Ÿæ˜¯éå¸¸é«˜çš„ï¼Œæ‰€å·®çš„æ˜¯ä¸€æ—¦ç³»ç»Ÿå‡ºç°å®•æœºç°è±¡ï¼Œé‚£ä¹ˆè¿™ä¸€ç§’é’Ÿä¹‹å†…ä¿®æ”¹çš„æ•°æ®å°†ä¼šä¸¢å¤±ã€‚è€Œæ¯ä¿®æ”¹åŒæ­¥ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶è§†ä¸ºåŒæ­¥æŒä¹…åŒ–ï¼Œå³æ¯æ¬¡å‘ç”Ÿçš„æ•°æ®å˜åŒ–éƒ½ä¼šè¢«ç«‹å³è®°å½•åˆ°ç£ç›˜ä¸­ã€‚å¯ä»¥é¢„è§ï¼Œè¿™ç§æ–¹å¼åœ¨æ•ˆç‡ä¸Šæ˜¯æœ€ä½çš„ã€‚è‡³äºæ— åŒæ­¥ï¼Œæ— éœ€å¤šè¨€ï¼Œæˆ‘æƒ³å¤§å®¶éƒ½èƒ½æ­£ç¡®çš„ç†è§£å®ƒã€‚</li><li>ç”±äºè¯¥æœºåˆ¶å¯¹æ—¥å¿—æ–‡ä»¶çš„å†™å…¥æ“ä½œé‡‡ç”¨çš„æ˜¯appendæ¨¡å¼ï¼Œå› æ­¤åœ¨å†™å…¥è¿‡ç¨‹ä¸­å³ä½¿å‡ºç°å®•æœºç°è±¡ï¼Œä¹Ÿä¸ä¼šç ´åæ—¥å¿—æ–‡ä»¶ä¸­å·²ç»å­˜åœ¨çš„å†…å®¹ã€‚ç„¶è€Œå¦‚æœæˆ‘ä»¬æœ¬æ¬¡æ“ä½œåªæ˜¯å†™å…¥äº†ä¸€åŠæ•°æ®å°±å‡ºç°äº†ç³»ç»Ÿå´©æºƒé—®é¢˜ï¼Œä¸ç”¨æ‹…å¿ƒï¼Œåœ¨Redisä¸‹ä¸€æ¬¡å¯åŠ¨ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡redis-check-aofå·¥å…·æ¥å¸®åŠ©æˆ‘ä»¬è§£å†³æ•°æ®ä¸€è‡´æ€§çš„é—®é¢˜ã€‚</li><li>å¦‚æœæ—¥å¿—è¿‡å¤§ï¼ŒRediså¯ä»¥è‡ªåŠ¨å¯ç”¨rewriteæœºåˆ¶ã€‚å³Redisä»¥appendæ¨¡å¼ä¸æ–­çš„å°†ä¿®æ”¹æ•°æ®å†™å…¥åˆ°è€çš„ç£ç›˜æ–‡ä»¶ä¸­ï¼ŒåŒæ—¶Redisè¿˜ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ç”¨äºè®°å½•æ­¤æœŸé—´æœ‰å“ªäº›ä¿®æ”¹å‘½ä»¤è¢«æ‰§è¡Œã€‚å› æ­¤åœ¨è¿›è¡Œrewriteåˆ‡æ¢æ—¶å¯ä»¥æ›´å¥½çš„ä¿è¯æ•°æ®å®‰å…¨æ€§ã€‚</li><li>AOFåŒ…å«ä¸€ä¸ªæ ¼å¼æ¸…æ™°ã€æ˜“äºç†è§£çš„æ—¥å¿—æ–‡ä»¶ç”¨äºè®°å½•æ‰€æœ‰çš„ä¿®æ”¹æ“ä½œã€‚äº‹å®ä¸Šï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡è¯¥æ–‡ä»¶å®Œæˆæ•°æ®çš„é‡å»ºã€‚</li></ul><p><strong>AOFçš„åŠ£åŠ¿æœ‰å“ªäº›å‘¢ï¼Ÿ</strong></p><ul><li>å¯¹äºç›¸åŒæ•°é‡çš„æ•°æ®é›†è€Œè¨€ï¼ŒAOFæ–‡ä»¶é€šå¸¸è¦å¤§äºRDBæ–‡ä»¶ã€‚RDB åœ¨æ¢å¤å¤§æ•°æ®é›†æ—¶çš„é€Ÿåº¦æ¯” AOF çš„æ¢å¤é€Ÿåº¦è¦å¿«ã€‚</li><li>æ ¹æ®åŒæ­¥ç­–ç•¥çš„ä¸åŒï¼ŒAOFåœ¨è¿è¡Œæ•ˆç‡ä¸Šå¾€å¾€ä¼šæ…¢äºRDBã€‚æ€»ä¹‹ï¼Œæ¯ç§’åŒæ­¥ç­–ç•¥çš„æ•ˆç‡æ˜¯æ¯”è¾ƒé«˜çš„ï¼ŒåŒæ­¥ç¦ç”¨ç­–ç•¥çš„æ•ˆç‡å’ŒRDBä¸€æ ·é«˜æ•ˆã€‚</li></ul><p>äºŒè€…é€‰æ‹©çš„æ ‡å‡†ï¼Œå°±æ˜¯çœ‹ç³»ç»Ÿæ˜¯æ„¿æ„ç‰ºç‰²ä¸€äº›æ€§èƒ½ï¼Œæ¢å–æ›´é«˜çš„ç¼“å­˜ä¸€è‡´æ€§ï¼ˆaofï¼‰ï¼Œè¿˜æ˜¯æ„¿æ„å†™æ“ä½œé¢‘ç¹çš„æ—¶å€™ï¼Œä¸å¯ç”¨å¤‡ä»½æ¥æ¢å–æ›´é«˜çš„æ€§èƒ½ï¼Œå¾…æ‰‹åŠ¨è¿è¡Œsaveçš„æ—¶å€™ï¼Œå†åšå¤‡ä»½ï¼ˆrdbï¼‰ã€‚rdbè¿™ä¸ªå°±æ›´æœ‰äº› eventually consistent çš„æ„æ€äº†ã€‚</p><h3 id="å¸¸ç”¨é…ç½®"><a href="#å¸¸ç”¨é…ç½®" class="headerlink" title="å¸¸ç”¨é…ç½®"></a>å¸¸ç”¨é…ç½®</h3><p><strong>RDBæŒä¹…åŒ–é…ç½®</strong></p><p>Redisä¼šå°†æ•°æ®é›†çš„å¿«ç…§dumpåˆ°dump.rdbæ–‡ä»¶ä¸­ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶æ¥ä¿®æ”¹RedisæœåŠ¡å™¨dumpå¿«ç…§çš„é¢‘ç‡ï¼Œåœ¨æ‰“å¼€6379.confæ–‡ä»¶ä¹‹åï¼Œæˆ‘ä»¬æœç´¢saveï¼Œå¯ä»¥çœ‹åˆ°ä¸‹é¢çš„é…ç½®ä¿¡æ¯ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">save 900 1         # åœ¨900ç§’(15åˆ†é’Ÿ)ä¹‹åï¼Œå¦‚æœè‡³å°‘æœ‰1ä¸ªkeyå‘ç”Ÿå˜åŒ–ï¼Œåˆ™dumpå†…å­˜å¿«ç…§ã€‚save 300 10        # åœ¨300ç§’(5åˆ†é’Ÿ)ä¹‹åï¼Œå¦‚æœè‡³å°‘æœ‰10ä¸ªkeyå‘ç”Ÿå˜åŒ–ï¼Œåˆ™dumpå†…å­˜å¿«ç…§ã€‚save 60 10000      # åœ¨60ç§’(1åˆ†é’Ÿ)ä¹‹åï¼Œå¦‚æœè‡³å°‘æœ‰10000ä¸ªkeyå‘ç”Ÿå˜åŒ–ï¼Œåˆ™dumpå†…å­˜å¿«ç…§ã€‚</span><br></pre></td></tr></table></figure><p><strong>AOFæŒä¹…åŒ–é…ç½®</strong></p><p>åœ¨Redisçš„é…ç½®æ–‡ä»¶ä¸­å­˜åœ¨ä¸‰ç§åŒæ­¥æ–¹å¼ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">appendfsync always     # æ¯æ¬¡æœ‰æ•°æ®ä¿®æ”¹å‘ç”Ÿæ—¶éƒ½ä¼šå†™å…¥AOFæ–‡ä»¶ã€‚</span><br><span class="line">appendfsync everysec   # æ¯ç§’é’ŸåŒæ­¥ä¸€æ¬¡ï¼Œè¯¥ç­–ç•¥ä¸ºAOFçš„ç¼ºçœç­–ç•¥ã€‚</span><br><span class="line">appendfsync no         # ä»ä¸åŒæ­¥ã€‚é«˜æ•ˆä½†æ˜¯æ•°æ®ä¸ä¼šè¢«æŒä¹…åŒ–ã€‚</span><br></pre></td></tr></table></figure><h3 id="å¦‚ä½•é€‰æ‹©"><a href="#å¦‚ä½•é€‰æ‹©" class="headerlink" title="å¦‚ä½•é€‰æ‹©"></a>å¦‚ä½•é€‰æ‹©</h3><ul><li><p>ä¸è¦ä»…ä»…ä½¿ç”¨ RDBï¼Œå› ä¸ºé‚£æ ·ä¼šå¯¼è‡´ä½ ä¸¢å¤±å¾ˆå¤šæ•°æ®</p></li><li><p>ä¹Ÿä¸è¦ä»…ä»…ä½¿ç”¨ AOFï¼Œå› ä¸ºé‚£æ ·æœ‰ä¸¤ä¸ªé—®é¢˜ï¼Œç¬¬ä¸€ï¼Œä½ é€šè¿‡ AOF åšå†·å¤‡ï¼Œæ²¡æœ‰ RDB åšå†·å¤‡ï¼Œæ¥çš„æ¢å¤é€Ÿåº¦æ›´å¿«; ç¬¬äºŒï¼ŒRDB æ¯æ¬¡ç®€å•ç²—æš´ç”Ÿæˆæ•°æ®å¿«ç…§ï¼Œæ›´åŠ å¥å£®ï¼Œå¯ä»¥é¿å… AOF è¿™ç§å¤æ‚çš„å¤‡ä»½å’Œæ¢å¤æœºåˆ¶çš„ bug ã€‚</p></li><li><p>Redis æ”¯æŒåŒæ—¶å¼€å¯å¼€å¯ä¸¤ç§æŒä¹…åŒ–æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥ç»¼åˆä½¿ç”¨ AOF å’Œ RDB ä¸¤ç§æŒä¹…åŒ–æœºåˆ¶ï¼Œç”¨ AOF æ¥ä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼Œä½œä¸ºæ•°æ®æ¢å¤çš„ç¬¬ä¸€é€‰æ‹©; ç”¨ RDB æ¥åšä¸åŒç¨‹åº¦çš„å†·å¤‡ï¼Œåœ¨ AOF æ–‡ä»¶éƒ½ä¸¢å¤±æˆ–æŸåä¸å¯ç”¨çš„æ—¶å€™ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ RDB æ¥è¿›è¡Œå¿«é€Ÿçš„æ•°æ®æ¢å¤ã€‚</p><ul><li><p>å¦‚æœåŒæ—¶ä½¿ç”¨ RDB å’Œ AOF ä¸¤ç§æŒä¹…åŒ–æœºåˆ¶ï¼Œé‚£ä¹ˆåœ¨ Redis é‡å¯çš„æ—¶å€™ï¼Œä¼šä½¿ç”¨ <strong>AOF</strong> æ¥é‡æ–°æ„å»ºæ•°æ®ï¼Œå› ä¸º AOF ä¸­çš„<strong>æ•°æ®æ›´åŠ å®Œæ•´</strong>ã€‚</p><blockquote><p>ä¸€èˆ¬æ¥è¯´ï¼Œ å¦‚æœæƒ³è¾¾åˆ°è¶³ä»¥åª²ç¾ PostgreSQL çš„æ•°æ®å®‰å…¨æ€§ï¼Œ ä½ åº”è¯¥åŒæ—¶ä½¿ç”¨ä¸¤ç§æŒä¹…åŒ–åŠŸèƒ½ã€‚å¦‚æœä½ éå¸¸å…³å¿ƒä½ çš„æ•°æ®ï¼Œ ä½†ä»ç„¶å¯ä»¥æ‰¿å—æ•°åˆ†é’Ÿä»¥å†…çš„æ•°æ®ä¸¢å¤±ï¼Œé‚£ä¹ˆä½ å¯ä»¥åªä½¿ç”¨ RDB æŒä¹…åŒ–ã€‚</p><p>æœ‰å¾ˆå¤šç”¨æˆ·éƒ½åªä½¿ç”¨ AOF æŒä¹…åŒ–ï¼Œä½†å¹¶ä¸æ¨èè¿™ç§æ–¹å¼ï¼šå› ä¸ºå®šæ—¶ç”Ÿæˆ RDB å¿«ç…§ï¼ˆsnapshotï¼‰éå¸¸ä¾¿äºè¿›è¡Œæ•°æ®åº“å¤‡ä»½ï¼Œ å¹¶ä¸” RDB æ¢å¤æ•°æ®é›†çš„é€Ÿåº¦ä¹Ÿè¦æ¯”AOFæ¢å¤çš„é€Ÿåº¦è¦å¿«ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œä½¿ç”¨ RDB è¿˜å¯ä»¥é¿å…ä¹‹å‰æåˆ°çš„ AOF ç¨‹åºçš„ bugã€‚</p></blockquote></li></ul></li></ul><p>åœ¨ Redis4.0 ç‰ˆæœ¬å¼€å§‹ï¼Œå½“ä½¿ç”¨ RDB-AOF æ··åˆæŒä¹…åŒ–æ–¹å¼ï¼Œè¯¦ç»†å¯è§ <a href="https://yq.aliyun.com/articles/193034" target="_blank" rel="noopener">ã€ŠRedis4.0 ä¹‹ RDB-AOF æ··åˆæŒä¹…åŒ–ã€‹</a> ã€‚</p><h3 id="è‡ªåŠ¨åŒ–è§¦å‘-RDB-æŒä¹…åŒ–çš„æ–¹å¼"><a href="#è‡ªåŠ¨åŒ–è§¦å‘-RDB-æŒä¹…åŒ–çš„æ–¹å¼" class="headerlink" title="è‡ªåŠ¨åŒ–è§¦å‘ RDB æŒä¹…åŒ–çš„æ–¹å¼"></a>è‡ªåŠ¨åŒ–è§¦å‘ RDB æŒä¹…åŒ–çš„æ–¹å¼</h3><ul><li>æ ¹æ® redis.conf é…ç½®ä¸­ SAVE m n å®šæ—¶è§¦å‘ï¼ˆä½¿ç”¨çš„BGSAVEï¼‰</li><li>ä¸»ä»å¤åˆ¶æ—¶ï¼Œä¸»èŠ‚ç‚¹è‡ªåŠ¨è§¦å‘</li><li>æ‰§è¡Œ Debug Reload</li><li>æ‰§è¡Œ Shutdown ä¸”æ²¡æœ‰å¼€å¯ AOF æŒä¹…åŒ–</li></ul><p><strong>é‡è¦çŸ¥è¯†ï¼š</strong></p><ul><li>bgsave åšé•œåƒå…¨é‡æŒä¹…åŒ–ï¼ŒAOF åšå¢é‡æŒä¹…åŒ–ã€‚å› ä¸º bgsave ä¼šè€—è´¹è¾ƒé•¿æ—¶é—´ï¼Œä¸å¤Ÿå®æ—¶ï¼Œåœ¨åœæœºçš„æ—¶å€™ä¼šå¯¼è‡´å¤§é‡ä¸¢å¤±æ•°æ®ï¼Œæ‰€ä»¥éœ€è¦ AOF æ¥é…åˆä½¿ç”¨ã€‚åœ¨ Redis å®ä¾‹é‡å¯æ—¶ï¼Œä¼šä½¿ç”¨ bgsave æŒä¹…åŒ–æ–‡ä»¶é‡æ–°æ„å»ºå†…å­˜ï¼Œå†ä½¿ç”¨ AOF é‡æ”¾è¿‘æœŸçš„æ“ä½œæŒ‡ä»¤æ¥å®ç°å®Œæ•´æ¢å¤é‡å¯ä¹‹å‰çš„çŠ¶æ€ã€‚</li><li>å¯¹æ–¹è¿½é—®é‚£å¦‚æœçªç„¶æœºå™¨æ‰ç”µä¼šæ€æ ·ï¼Ÿå–å†³äº AOF æ—¥å¿— sync å±æ€§çš„é…ç½®ï¼Œå¦‚æœä¸è¦æ±‚æ€§èƒ½ï¼Œåœ¨æ¯æ¡å†™æŒ‡ä»¤æ—¶éƒ½ sync ä¸€ä¸‹ç£ç›˜ï¼Œå°±ä¸ä¼šä¸¢å¤±æ•°æ®ã€‚ä½†æ˜¯åœ¨é«˜æ€§èƒ½çš„è¦æ±‚ä¸‹æ¯æ¬¡éƒ½ sync æ˜¯ä¸ç°å®çš„ï¼Œä¸€èˆ¬éƒ½ä½¿ç”¨å®šæ—¶ sync ï¼Œæ¯”å¦‚ 1 ç§’ 1 æ¬¡ï¼Œè¿™ä¸ªæ—¶å€™æœ€å¤šå°±ä¼šä¸¢å¤± 1 ç§’çš„æ•°æ®ã€‚</li><li>å¯¹æ–¹è¿½é—® bgsave çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿä½ ç»™å‡ºä¸¤ä¸ªè¯æ±‡å°±å¯ä»¥äº†ï¼Œfork å’Œ cow ã€‚fork æ˜¯æŒ‡ Redis é€šè¿‡åˆ›å»ºå­è¿›ç¨‹æ¥è¿›è¡Œ bgsave æ“ä½œã€‚cow æŒ‡çš„æ˜¯ copy on write ï¼Œå­è¿›ç¨‹åˆ›å»ºåï¼Œçˆ¶å­è¿›ç¨‹å…±äº«æ•°æ®æ®µï¼Œçˆ¶è¿›ç¨‹ç»§ç»­æä¾›è¯»å†™æœåŠ¡ï¼Œå†™è„çš„é¡µé¢æ•°æ®ä¼šé€æ¸å’Œå­è¿›ç¨‹åˆ†ç¦»å¼€æ¥ã€‚</li></ul><p>BGSAVEåº•å±‚å®ç°æ–¹å¼ï¼š</p><p><img src="/2019/11/25/Redis/1566521057383.png" alt="1566521057383"></p><ol><li>æŸ¥è¯¢å­è¿›ç¨‹æ˜¯å¦æœ‰å†²çª</li><li>ç³»ç»Ÿè°ƒç”¨fork()å‡½æ•°ï¼šåˆ›å»ºè¿›ç¨‹ï¼Œå®ç°copy-on-writeï¼ˆå†™æ—¶å¤åˆ¶ï¼‰ï¼Œä¼ ç»Ÿæ–¹å¼ä¸‹forkåœ¨åˆ›å»ºå­è¿›ç¨‹æ—¶ä¼šå°†èµ„æºå…¨éƒ¨å¤åˆ¶ç»™å­è¿›ç¨‹ï¼Œç®€å•ä½†æ˜¯æ•ˆç‡ä½ã€‚Linuxç¯å¢ƒä¸‹è¯¥è¿›forkæ–¹å¼ï¼Œå½“çˆ¶è¿›ç¨‹åˆ›å»ºå­è¿›ç¨‹æ—¶ï¼Œå†…æ ¸åªä¸ºå­è¿›ç¨‹åˆ›å»ºè™šæ‹Ÿç©ºé—´ï¼Œçˆ¶å­è¿›ç¨‹ä½¿ç”¨çš„æ˜¯ç›¸åŒçš„ç‰©ç†ç©ºé—´ï¼Œåªæœ‰çˆ¶å­è¿›ç¨‹å‘ç”Ÿæ›´æ”¹æ—¶ï¼Œæ‰ä¼šä¸ºå­è¿›ç¨‹åˆ†é…ç‹¬ç«‹çš„ç‰©ç†ç©ºé—´</li></ol><p><img src="/2019/11/25/Redis/1566521457362.png" alt="1566521457362"></p><p>ä¼˜ç‚¹åœ¨äºï¼šå¦‚æœè°ƒç”¨è€…æ²¡æœ‰ä¿®æ”¹èµ„æºï¼Œåˆ™ä¸ä¼šå‘ç”Ÿå¤åˆ¶æ“ä½œï¼Œå› æ­¤å¤šä¸ªè°ƒç”¨è€…åªæ˜¯è¯»å–æ“ä½œæ—¶å¯ä»¥å…±äº«èµ„æºã€‚COWè°ƒç”¨æ—¶ä¼šç»´æŒä¸€ä¸ªä¸ºè¯»æ“ä½œè¯·æ±‚çš„æŒ‡é’ˆï¼Œå¹¶åœ¨è¯»å®Œåæ›´æ–°è¿™ä¸ªæŒ‡é’ˆï¼Œä»¥æå‡è¯»å†™å¹¶å‘èƒ½åŠ›ã€‚å› æ­¤COWä¹Ÿæä¾›äº†æ•°æ®æ›´æ–°è¿‡ç¨‹ä¸­çš„åŸå­æ€§ï¼Œæå‡äº†è¯»å†™æ•ˆç‡ã€‚å½“redisæ‰§è¡ŒæŒä¹…åŒ–æ—¶ï¼Œredisä¼šforkä¸€ä¸ªå­è¿›ç¨‹ï¼Œå­è¿›ç¨‹å°†æ•°æ®æŒä¹…åŒ–åˆ°ä¸€ä¸ªä¸´æ—¶çš„RDBæ–‡ä»¶ä¸­ï¼Œå½“å®Œæˆå†™æ“ä½œåï¼Œå°†åŸæ¥çš„rdbæ›¿æ¢æ‰ï¼Œè¿™æ ·åšçš„å¥½å¤„å°±æ˜¯å¯ä»¥å®ç°COWæ“ä½œã€‚</p><p>æŒä¹…åŒ–æ—¶ï¼Œå­çˆ¶è¿›ç¨‹éƒ½å­˜åœ¨ï¼Œçˆ¶è¿›ç¨‹ç»§ç»­å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ï¼Œå­è¿›ç¨‹è´Ÿè´£å°†å†…å­˜å†…å®¹å†™å…¥ä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œç”±äºOSçš„COWæ“ä½œï¼Œçˆ¶å­è¿›ç¨‹ä¼šå…±äº«ç›¸åŒçš„ç‰©ç†é¡µé¢ï¼Œå½“çˆ¶è¿›ç¨‹å¤„ç†å†™è¯·æ±‚çš„æ—¶å€™ï¼ŒOSä¼šä¸ºçˆ¶è¿›ç¨‹è°ƒä¿®æ”¹çš„é¡µé¢åˆ›å»ºå‰¯æœ¬ï¼Œè€Œä¸æ˜¯å†™å…±äº«çš„é¡µé¢ï¼Œæ‰€ä»¥å­è¿›ç¨‹çš„åœ°å€ç©ºé—´å†…çš„æ•°æ®æ˜¯forkæ—¶åˆ»çš„æ•´ä¸ªæ•°æ®åº“çš„å¿«ç…§ï¼Œå­è¿›ç¨‹å®Œæˆå†™æ“ä½œæ—¶ï¼Œåªè¦æ›¿ä»£åŸå¿«ç…§ï¼Œç„¶åé€€å‡ºï¼Œè¿™æ ·å°±å®Œæˆä¸€æ¬¡å¤‡ä»½æ“ä½œã€‚</p><h2 id="Redis-æœ‰å‡ ç§æ•°æ®â€œè¿‡æœŸâ€ç­–ç•¥ï¼Ÿ"><a href="#Redis-æœ‰å‡ ç§æ•°æ®â€œè¿‡æœŸâ€ç­–ç•¥ï¼Ÿ" class="headerlink" title="Redis æœ‰å‡ ç§æ•°æ®â€œè¿‡æœŸâ€ç­–ç•¥ï¼Ÿ"></a>Redis æœ‰å‡ ç§æ•°æ®â€œè¿‡æœŸâ€ç­–ç•¥ï¼Ÿ</h2><p>Redis çš„è¿‡æœŸç­–ç•¥ï¼Œå°±æ˜¯æŒ‡å½“ Redis ä¸­ç¼“å­˜çš„ key è¿‡æœŸäº†ï¼ŒRedis å¦‚ä½•å¤„ç†ã€‚</p><p>Redis æä¾›äº† 3 ç§æ•°æ®è¿‡æœŸç­–ç•¥ï¼š</p><ul><li>è¢«åŠ¨åˆ é™¤ï¼šå½“è¯»/å†™ä¸€ä¸ªå·²ç»è¿‡æœŸçš„ key æ—¶ï¼Œä¼šè§¦å‘æƒ°æ€§åˆ é™¤ç­–ç•¥ï¼Œç›´æ¥åˆ é™¤æ‰è¿™ä¸ªè¿‡æœŸ key ã€‚</li><li>ä¸»åŠ¨åˆ é™¤ï¼šç”±äºæƒ°æ€§åˆ é™¤ç­–ç•¥æ— æ³•ä¿è¯å†·æ•°æ®è¢«åŠæ—¶åˆ æ‰ï¼Œæ‰€ä»¥ Redis ä¼šå®šæœŸä¸»åŠ¨æ·˜æ±°ä¸€æ‰¹å·²è¿‡æœŸçš„ key ã€‚</li><li>ä¸»åŠ¨åˆ é™¤ï¼šå½“å‰å·²ç”¨å†…å­˜è¶…è¿‡ maxmemory é™å®šæ—¶ï¼Œè§¦å‘ä¸»åŠ¨æ¸…ç†ç­–ç•¥ï¼Œå³ <a href="http://svip.iocoder.cn/Redis/Interview/#" target="_blank" rel="noopener">ã€Œæ•°æ®â€œæ·˜æ±°â€ç­–ç•¥ã€</a> ã€‚</li></ul><p>æƒ³è¦è¿›ä¸€æ­¥äº†è§£ï¼Œå¯ä»¥çœ‹çœ‹ <a href="https://www.cnblogs.com/chenpingzhao/p/5022467.html" target="_blank" rel="noopener">ã€Šå…³äº Redis æ•°æ®è¿‡æœŸç­–ç•¥ã€‹</a> æ–‡ç« ã€‚</p><h2 id="Redis-æœ‰å“ªå‡ ç§æ•°æ®â€œæ·˜æ±°â€ç­–ç•¥ï¼Ÿ"><a href="#Redis-æœ‰å“ªå‡ ç§æ•°æ®â€œæ·˜æ±°â€ç­–ç•¥ï¼Ÿ" class="headerlink" title="Redis æœ‰å“ªå‡ ç§æ•°æ®â€œæ·˜æ±°â€ç­–ç•¥ï¼Ÿ"></a>Redis æœ‰å“ªå‡ ç§æ•°æ®â€œæ·˜æ±°â€ç­–ç•¥ï¼Ÿ</h2><p>Redis å†…å­˜æ•°æ®é›†å¤§å°ä¸Šå‡åˆ°ä¸€å®šå¤§å°çš„æ—¶å€™ï¼Œå°±ä¼šè¿›è¡Œæ•°æ®æ·˜æ±°ç­–ç•¥ã€‚</p><p>Redis æä¾›äº† 6 ç§æ•°æ®æ·˜æ±°ç­–ç•¥ï¼š</p><ol><li>volatile-lru</li><li>volatile-ttl</li><li>volatile-random</li><li>allkeys-lru</li><li>allkeys-random</li><li>no-enviction</li></ol><p><img src="/2019/11/25/Redis/image-20191125135302360.png" alt="image-20191125135302360"></p><p>å…·ä½“çš„ <strong>æ¯ç§æ•°æ®æ·˜æ±°ç­–ç•¥çš„å®šä¹‰</strong>ï¼Œå’Œ <strong>å¦‚ä½•é€‰æ‹©è®¨è®ºç­–ç•¥</strong>ï¼Œå¯è§ <a href="http://blog.720ui.com/2016/redis_action_02_maxmemory_policy/" target="_blank" rel="noopener">ã€ŠRediså®æˆ˜ï¼ˆäºŒï¼‰ å†…å­˜æ·˜æ±°æœºåˆ¶ã€‹</a> ã€‚</p><p><strong>Redis LRU ç®—æ³•</strong></p><p>å¦å¤–ï¼ŒRedis çš„ LRU ç®—æ³•ï¼Œ<strong>å¹¶ä¸æ˜¯ä¸€ä¸ªä¸¥æ ¼çš„ LRU å®ç°</strong>ã€‚è¿™æ„å‘³ç€ Redis ä¸èƒ½é€‰æ‹©æœ€ä½³å€™é€‰é”®æ¥å›æ”¶ï¼Œä¹Ÿå°±æ˜¯æœ€ä¹…æœªè¢«è®¿é—®çš„é‚£äº›é”®ã€‚ç›¸åï¼ŒRedis ä¼šå°è¯•æ‰§è¡Œä¸€ä¸ªè¿‘ä¼¼çš„ LRU ç®—æ³•ï¼Œé€šè¿‡é‡‡æ ·ä¸€å°éƒ¨åˆ†é”®ï¼Œç„¶ååœ¨é‡‡æ ·é”®ä¸­å›æ”¶æœ€é€‚åˆ(æ‹¥æœ‰æœ€ä¹…æœªè¢«è®¿é—®æ—¶é—´)çš„é‚£ä¸ªã€‚</p><ul><li><p>å…·ä½“çš„å¯ä»¥çœ‹çœ‹ <a href="http://ifeve.com/lru-cache/" target="_blank" rel="noopener">ã€Šä½¿ç”¨ Redis ä½œä¸ºä¸€ä¸ª LRU ç¼“å­˜ã€‹</a> æ–‡ç« ã€‚</p><p><strong>MySQL é‡Œæœ‰ 2000w æ•°æ®ï¼ŒRedis ä¸­åªå­˜ 20w çš„æ•°æ®ï¼Œå¦‚ä½•ä¿è¯ Redis ä¸­çš„æ•°æ®éƒ½æ˜¯çƒ­ç‚¹æ•°æ®ï¼Ÿ</strong></p></li></ul><blockquote><p>è¿™ä¸ªé—®é¢˜çš„ç›®çš„æ˜¯ï¼Œå¦‚ä½•ä¿è¯çƒ­ç‚¹æ•°æ®ä¸è¦è¢«æ·˜æ±°ã€‚</p></blockquote><p>åœ¨ <a href="http://svip.iocoder.cn/Redis/Interview/#" target="_blank" rel="noopener">ã€ŒRedis æœ‰å“ªå‡ ç§æ•°æ®â€œæ·˜æ±°â€ç­–ç•¥ï¼Ÿã€</a> é—®é¢˜ä¸­ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°ï¼Œâ€œRedis å†…å­˜æ•°æ®é›†å¤§å°ä¸Šå‡åˆ°ä¸€å®šå¤§å°çš„æ—¶å€™ï¼Œå°±ä¼šè¿›è¡Œæ•°æ®æ·˜æ±°ç­–ç•¥ã€‚â€ ã€‚</p><p>é‚£ä¹ˆï¼Œå¦‚æœæˆ‘ä»¬æ­¤æ—¶è¦ä¿è¯çƒ­ç‚¹æ•°æ®ä¸è¢«æ·˜æ±°ï¼Œé‚£ä¹ˆéœ€è¦é€‰æ‹© volatile-lru æˆ– allkeys-lru è¿™ä¸¤ä¸ªåŸºäº LRU ç®—æ³•çš„æ·˜æ±°ç­–ç•¥ã€‚</p><p>ç›¸æ¯”è¾ƒæ¥è¯´ï¼Œæœ€ç»ˆä¼šé€‰æ‹© allkeys-lru æ·˜æ±°ç­–ç•¥ã€‚åŸå› æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬çš„åº”ç”¨å¯¹ç¼“å­˜çš„è®¿é—®ç¬¦åˆå¹‚å¾‹åˆ†å¸ƒï¼Œä¹Ÿå°±æ˜¯å­˜åœ¨ç›¸å¯¹çƒ­ç‚¹æ•°æ®ï¼Œæˆ–è€…æˆ‘ä»¬ä¸å¤ªæ¸…æ¥šæˆ‘ä»¬åº”ç”¨çš„ç¼“å­˜è®¿é—®åˆ†å¸ƒçŠ¶å†µï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹© allkeys-lru ç­–ç•¥ã€‚</p><h2 id="å¦‚æœæœ‰å¤§é‡çš„-key-éœ€è¦è®¾ç½®åŒä¸€æ—¶é—´è¿‡æœŸï¼Œä¸€èˆ¬éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ"><a href="#å¦‚æœæœ‰å¤§é‡çš„-key-éœ€è¦è®¾ç½®åŒä¸€æ—¶é—´è¿‡æœŸï¼Œä¸€èˆ¬éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ" class="headerlink" title="å¦‚æœæœ‰å¤§é‡çš„ key éœ€è¦è®¾ç½®åŒä¸€æ—¶é—´è¿‡æœŸï¼Œä¸€èˆ¬éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ"></a>å¦‚æœæœ‰å¤§é‡çš„ key éœ€è¦è®¾ç½®åŒä¸€æ—¶é—´è¿‡æœŸï¼Œä¸€èˆ¬éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ</h2><p>å¦‚æœå¤§é‡çš„ key è¿‡æœŸæ—¶é—´è®¾ç½®çš„è¿‡äºé›†ä¸­ï¼Œåˆ°è¿‡æœŸçš„é‚£ä¸ªæ—¶é—´ç‚¹ï¼ŒRediså¯èƒ½ä¼šå‡ºç°çŸ­æš‚çš„å¡é¡¿ç°è±¡ã€‚</p><p>ä¸€èˆ¬éœ€è¦åœ¨æ—¶é—´ä¸ŠåŠ ä¸€ä¸ªéšæœºå€¼ï¼Œä½¿å¾—è¿‡æœŸæ—¶é—´åˆ†æ•£ä¸€äº›ã€‚</p><h2 id="Redis-ä½¿ç”¨åœºæ™¯"><a href="#Redis-ä½¿ç”¨åœºæ™¯" class="headerlink" title="Redis ä½¿ç”¨åœºæ™¯"></a>Redis ä½¿ç”¨åœºæ™¯</h2><ul><li>æ•°æ®ç¼“å­˜</li><li>ä¼šè¯ç¼“å­˜</li><li>æ—¶æ•ˆæ€§æ•°æ®</li><li>è®¿é—®é¢‘ç‡</li><li>è®¡æ•°å™¨</li><li>ç¤¾äº¤åˆ—è¡¨</li><li>è®°å½•ç”¨æˆ·åˆ¤å®šä¿¡æ¯</li><li>äº¤é›†ã€å¹¶é›†å’Œå·®é›†</li><li>çƒ­é—¨åˆ—è¡¨ä¸æ’è¡Œæ¦œ</li><li>æœ€æ–°åŠ¨æ€</li><li>æ¶ˆæ¯é˜Ÿåˆ—</li><li>åˆ†å¸ƒå¼é”</li></ul><p>è¯¦ç»†çš„ä»‹ç»ï¼Œå¯ä»¥çœ‹çœ‹å¦‚ä¸‹æ–‡ç« ï¼š</p><ul><li><a href="http://blog.720ui.com/2017/redis_core_use/" target="_blank" rel="noopener">ã€ŠèŠèŠ Redis ä½¿ç”¨åœºæ™¯ã€‹</a></li><li><a href="https://www.jianshu.com/p/af277c77b1c9" target="_blank" rel="noopener">ã€ŠRedis åº”ç”¨åœºæ™¯åŠå®ä¾‹ã€‹</a></li><li><a href="https://zhuanlan.zhihu.com/p/29665317" target="_blank" rel="noopener">ã€ŠRedis å¸¸è§çš„åº”ç”¨åœºæ™¯è§£æã€‹</a></li><li><a href="https://www.zhihu.com/question/19829601" target="_blank" rel="noopener">ã€ŠRedis å’Œ Memcached å„æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Œä¸»è¦çš„åº”ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿã€‹</a></li></ul><p><strong>è¯·ç”¨ Redis å’Œä»»æ„è¯­è¨€å®ç°ä¸€æ®µæ¶æ„ç™»å½•ä¿æŠ¤çš„ä»£ç ï¼Œé™åˆ¶ 1 å°æ—¶å†…æ¯ç”¨æˆ· Id æœ€å¤šåªèƒ½ç™»å½• 5 æ¬¡ã€‚</strong></p><p>ç”¨åˆ—è¡¨å®ç°ï¼Œåˆ—è¡¨ä¸­æ¯ä¸ªå…ƒç´ ä»£è¡¨ç™»é™†æ—¶é—´ï¼Œåªè¦æœ€åçš„ç¬¬ 5 æ¬¡ç™»é™†æ—¶é—´å’Œç°åœ¨æ—¶é—´å·®ä¸è¶…è¿‡ 1 å°æ—¶å°±ç¦æ­¢ç™»é™†ã€‚</p><p>å…·ä½“çš„ä»£ç å®ç°ï¼Œå¯ä»¥çœ‹çœ‹ <a href="https://www.jianshu.com/p/e3abbfc59d77" target="_blank" rel="noopener">ã€Šä¸€é“ Redis é¢è¯•é¢˜ã€‹</a> ã€‚</p><h2 id="Redis-æ”¯æŒçš„-Java-å®¢æˆ·ç«¯éƒ½æœ‰å“ªäº›ï¼Ÿ"><a href="#Redis-æ”¯æŒçš„-Java-å®¢æˆ·ç«¯éƒ½æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="Redis æ”¯æŒçš„ Java å®¢æˆ·ç«¯éƒ½æœ‰å“ªäº›ï¼Ÿ"></a>Redis æ”¯æŒçš„ Java å®¢æˆ·ç«¯éƒ½æœ‰å“ªäº›ï¼Ÿ</h2><p>ä½¿ç”¨æ¯”è¾ƒå¹¿æ³›çš„æœ‰ä¸‰ä¸ª Java å®¢æˆ·ç«¯ï¼š</p><ul><li><p>Redisson</p><blockquote><p>Redisson ï¼Œæ˜¯ä¸€ä¸ªé«˜çº§çš„åˆ†å¸ƒå¼åè°ƒ Redis å®¢æœç«¯ï¼Œèƒ½å¸®åŠ©ç”¨æˆ·åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­è½»æ¾å®ç°ä¸€äº› Java çš„å¯¹è±¡ (Bloom filter, BitSet, Set, SetMultimap, ScoredSortedSet, SortedSet, Map, ConcurrentMap, List, ListMultimap, Queue, BlockingQueue, Deque, BlockingDeque, Semaphore, Lock, ReadWriteLock, AtomicLong, CountDownLatch, Publish / Subscribe, HyperLogLog)ã€‚</p></blockquote></li><li><p>Jedis</p><blockquote><p>Jedis æ˜¯ Redis çš„ Java å®ç°çš„å®¢æˆ·ç«¯ï¼Œå…¶ API æä¾›äº†æ¯”è¾ƒå…¨é¢çš„ Redis å‘½ä»¤çš„æ”¯æŒã€‚</p><p>Redisson å®ç°äº†åˆ†å¸ƒå¼å’Œå¯æ‰©å±•çš„ Java æ•°æ®ç»“æ„ï¼Œå’Œ Jedis ç›¸æ¯”ï¼ŒJedis åŠŸèƒ½è¾ƒä¸ºç®€å•ï¼Œä¸æ”¯æŒå­—ç¬¦ä¸²æ“ä½œï¼Œä¸æ”¯æŒæ’åºã€äº‹åŠ¡ã€ç®¡é“ã€åˆ†åŒºç­‰ Redis ç‰¹æ€§ã€‚</p><p>Redisson çš„å®—æ—¨æ˜¯ä¿ƒè¿›ä½¿ç”¨è€…å¯¹ Redis çš„å…³æ³¨åˆ†ç¦»ï¼Œä»è€Œè®©ä½¿ç”¨è€…èƒ½å¤Ÿå°†ç²¾åŠ›æ›´é›†ä¸­åœ°æ”¾åœ¨å¤„ç†ä¸šåŠ¡é€»è¾‘ä¸Šã€‚</p></blockquote></li><li><p>Lettuce</p><blockquote><p>Lettuce æ˜¯ä¸€ä¸ªå¯ä¼¸ç¼©çº¿ç¨‹å®‰å…¨çš„ Redis å®¢æˆ·ç«¯ã€‚å¤šä¸ªçº¿ç¨‹å¯ä»¥å…±äº«åŒä¸€ä¸ª RedisConnection ã€‚å®ƒåˆ©ç”¨ä¼˜ç§€ Netty NIO æ¡†æ¶æ¥é«˜æ•ˆåœ°ç®¡ç†å¤šä¸ªè¿æ¥ã€‚</p></blockquote></li></ul><p>Spring Boot 2.x å†…ç½®ä½¿ç”¨ Lettuce ã€‚</p><h2 id="å¦‚ä½•ä½¿ç”¨-Redis-å®ç°åˆ†å¸ƒå¼é”ï¼Ÿ"><a href="#å¦‚ä½•ä½¿ç”¨-Redis-å®ç°åˆ†å¸ƒå¼é”ï¼Ÿ" class="headerlink" title="å¦‚ä½•ä½¿ç”¨ Redis å®ç°åˆ†å¸ƒå¼é”ï¼Ÿ"></a>å¦‚ä½•ä½¿ç”¨ Redis å®ç°åˆ†å¸ƒå¼é”ï¼Ÿ</h2><p>åˆ†å¸ƒå¼é”æ˜¯æ§åˆ¶åˆ†å¸ƒå¼ç³»ç»Ÿæˆ–ä¸åŒç³»ç»Ÿä¹‹é—´å…±åŒè®¿é—®å…±åŒèµ„æºçš„ä¸€ç§é”çš„å®ç°ã€‚å¦‚æœä¸åŒç³»ç»Ÿæˆ–è€…åŒä¸€ç³»ç»Ÿä¸åŒä¸»æœºé—´å…±äº«äº†æŸä¸ªèµ„æºæ—¶ï¼Œå¾€å¾€éœ€è¦äº’æ–¥æ¥é˜²æ­¢å½¼æ­¤å¹²æ‰°ï¼Œè¿›è€Œä¿è¯ä¸€è‡´æ€§ã€‚åˆ†å¸ƒå¼é”éœ€è¦è§£å†³çš„é—®é¢˜æœ‰ï¼š</p><ul><li>äº’æ–¥æ€§ï¼šä»»æ„æ—¶åˆ»ï¼Œåªèƒ½æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯è·å–é”ï¼›</li><li>å®‰å…¨æ€§ï¼šé”åªèƒ½ç”±è·å–è¯¥é”çš„å®¢æˆ·ç«¯åˆ é™¤ï¼Œä¸èƒ½ç”±å…¶ä»–å®¢æˆ·ç«¯åˆ é™¤</li><li>æ­»é”ï¼šé¿å…è·å–é”çš„å®¢æˆ·ç«¯å› ä¸ºå®•æœºè€Œæœªèƒ½é‡Šæ”¾é”</li><li>å®¹é”™ï¼šå½“éƒ¨åˆ†èŠ‚ç‚¹ï¼ˆä¾‹å¦‚redisï¼‰å®•æœºæ—¶ï¼Œå®¢æˆ·ç«¯ä»èƒ½æ­£å¸¸è·å–é”ï¼Œé‡Šæ”¾é”</li></ul><p><strong>æ–¹æ¡ˆä¸€ï¼šset æŒ‡ä»¤</strong></p><p>å…ˆæ‹¿ setnx æ¥äº‰æŠ¢é”ï¼ŒæŠ¢åˆ°ä¹‹åï¼Œå†ç”¨ expire ç»™é”åŠ ä¸€ä¸ªè¿‡æœŸæ—¶é—´é˜²æ­¢é”å¿˜è®°äº†é‡Šæ”¾ã€‚</p><ul><li>è¿™æ—¶å€™å¯¹æ–¹ä¼šå‘Šè¯‰ä½ è¯´ä½ å›ç­”å¾—ä¸é”™ï¼Œç„¶åæ¥ç€é—®å¦‚æœåœ¨ setnx ä¹‹åæ‰§è¡Œ expire ä¹‹å‰è¿›ç¨‹æ„å¤– crash æˆ–è€…è¦é‡å¯ç»´æŠ¤äº†ï¼Œé‚£ä¼šæ€ä¹ˆæ ·ï¼Ÿ</li><li>è¿™æ—¶å€™ä½ è¦ç»™äºˆæƒŠè®¶çš„åé¦ˆï¼šå”‰ï¼Œæ˜¯å–”ï¼Œè¿™ä¸ªé”å°±æ°¸è¿œå¾—ä¸åˆ°é‡Šæ”¾äº†ã€‚ç´§æ¥ç€ä½ éœ€è¦æŠ“ä¸€æŠ“è‡ªå·±å¾—è„‘è¢‹ï¼Œæ•…ä½œæ€è€ƒç‰‡åˆ»ï¼Œå¥½åƒæ¥ä¸‹æ¥çš„ç»“æœæ˜¯ä½ ä¸»åŠ¨æ€è€ƒå‡ºæ¥çš„ï¼Œç„¶åå›ç­”ï¼šæˆ‘è®°å¾— set æŒ‡ä»¤æœ‰éå¸¸å¤æ‚çš„å‚æ•°ï¼Œè¿™ä¸ªåº”è¯¥æ˜¯å¯ä»¥åŒæ—¶æŠŠ setnx å’Œ expire åˆæˆä¸€æ¡æŒ‡ä»¤æ¥ç”¨çš„ï¼å¯¹æ–¹è¿™æ—¶ä¼šæ˜¾éœ²ç¬‘å®¹ï¼Œå¿ƒé‡Œå¼€å§‹é»˜å¿µï¼šæ‘ï¼Œè¿™å°å­è¿˜ä¸é”™ã€‚</li></ul><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <strong>set</strong> æŒ‡ä»¤ï¼Œå®ç°åˆ†å¸ƒå¼é”ã€‚æŒ‡ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">key</span> <span class="keyword">value</span> [EX <span class="keyword">seconds</span>] [PX milliseconds] [NX|XX]</span><br></pre></td></tr></table></figure><p><img src="/2019/11/25/Redis/%E5%89%91%E6%8C%87Java%5C1566518903284.png" alt="1566518903284"></p><ul><li>å¯ä»¥ä½¿ç”¨ <code>SET key value EX seconds NX</code> å‘½ä»¤ï¼Œå°è¯•è·å¾—é”ã€‚</li><li>å…·ä½“çš„å®ç°ï¼Œå¯ä»¥å‚è€ƒ <a href="https://wudashan.cn/2017/10/23/Redis-Distributed-Lock-Implement/" target="_blank" rel="noopener">ã€ŠRedis åˆ†å¸ƒå¼é”çš„æ­£ç¡®å®ç°æ–¹å¼ï¼ˆJavaç‰ˆï¼‰ã€‹</a> æ–‡ç« ã€‚</li></ul><p><strong>æ–¹æ¡ˆäºŒï¼šredlock</strong></p><p>set æŒ‡ä»¤çš„æ–¹æ¡ˆï¼Œé€‚åˆç”¨äºåœ¨å•æœº Redis èŠ‚ç‚¹çš„åœºæ™¯ä¸‹ï¼Œåœ¨å¤š Redis èŠ‚ç‚¹çš„åœºæ™¯ä¸‹ï¼Œä¼šå­˜åœ¨åˆ†å¸ƒå¼é”ä¸¢å¤±çš„é—®é¢˜ã€‚æ‰€ä»¥ï¼ŒRedis ä½œè€… Antirez åŸºäºåˆ†å¸ƒå¼ç¯å¢ƒä¸‹æå‡ºäº†ä¸€ç§æ›´é«˜çº§çš„åˆ†å¸ƒå¼é”çš„å®ç°æ–¹å¼ï¼šRedlock ã€‚</p><p>å…·ä½“çš„æ–¹æ¡ˆï¼Œèƒ–å‹å¯ä»¥çœ‹çœ‹è€å‹é£å“¥çš„ä¸¤ç¯‡åšå®¢ï¼š</p><ul><li><a href="https://mp.weixin.qq.com/s/JLEzNqQsx-Lec03eAsXFOQ" target="_blank" rel="noopener">ã€ŠRedlockï¼šRedisåˆ†å¸ƒå¼é”æœ€ç‰›é€¼çš„å®ç°ã€‹</a></li><li><a href="https://www.jianshu.com/p/f302aa345ca8" target="_blank" rel="noopener">ã€ŠRedisson å®ç° Redis åˆ†å¸ƒå¼é”çš„ N ç§å§¿åŠ¿ã€‹</a></li></ul><p><strong>å¯¹æ¯” Zookeeper åˆ†å¸ƒå¼é”</strong></p><ul><li>ä»å¯é æ€§ä¸Šæ¥è¯´ï¼ŒZookeeper åˆ†å¸ƒå¼é”å¥½äº Redis åˆ†å¸ƒå¼é”ã€‚</li><li>ä»æ€§èƒ½ä¸Šæ¥è¯´ï¼ŒRedis åˆ†å¸ƒå¼é”å¥½äº Zookeeper åˆ†å¸ƒå¼é”ã€‚</li></ul><p>æ‰€ä»¥ï¼Œæ²¡æœ‰ç»å¯¹çš„å¥½åï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡æ¥å…·ä½“é€‰æ‹©ã€‚</p><h2 id="Rediså¹¶å‘ç«äº‰key"><a href="#Rediså¹¶å‘ç«äº‰key" class="headerlink" title="Rediså¹¶å‘ç«äº‰key"></a>Rediså¹¶å‘ç«äº‰key</h2><p>å³ï¼šå¤šä¸ªç³»ç»ŸåŒæ—¶å¯¹ä¸€ä¸ª key è¿›è¡Œæ“ä½œ</p><p>åŸºäºzookeeperä¸´æ—¶æœ‰åºèŠ‚ç‚¹å¯ä»¥å®ç°çš„åˆ†å¸ƒå¼é”ã€‚å¤§è‡´æ€æƒ³ä¸ºï¼šæ¯ä¸ªå®¢æˆ·ç«¯å¯¹æŸä¸ªæ–¹æ³•åŠ é”æ—¶ï¼Œåœ¨zookeeperä¸Šçš„ä¸è¯¥æ–¹æ³•å¯¹åº”çš„æŒ‡å®šèŠ‚ç‚¹çš„ç›®å½•ä¸‹ï¼Œç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„ç¬æ—¶æœ‰åºèŠ‚ç‚¹ã€‚ åˆ¤æ–­æ˜¯å¦è·å–é”çš„æ–¹å¼å¾ˆç®€å•ï¼Œåªéœ€è¦åˆ¤æ–­æœ‰åºèŠ‚ç‚¹ä¸­åºå·æœ€å°çš„ä¸€ä¸ªã€‚ å½“é‡Šæ”¾é”çš„æ—¶å€™ï¼Œåªéœ€å°†è¿™ä¸ªç¬æ—¶èŠ‚ç‚¹åˆ é™¤å³å¯ã€‚åŒæ—¶ï¼Œå…¶å¯ä»¥é¿å…æœåŠ¡å®•æœºå¯¼è‡´çš„é”æ— æ³•é‡Šæ”¾ï¼Œè€Œäº§ç”Ÿçš„æ­»é”é—®é¢˜ã€‚å®Œæˆä¸šåŠ¡æµç¨‹åï¼Œåˆ é™¤å¯¹åº”çš„å­èŠ‚ç‚¹é‡Šæ”¾é”ã€‚</p><h2 id="å¦‚ä½•ä½¿ç”¨-Redis-å®ç°æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ"><a href="#å¦‚ä½•ä½¿ç”¨-Redis-å®ç°æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ" class="headerlink" title="å¦‚ä½•ä½¿ç”¨ Redis å®ç°æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ"></a>å¦‚ä½•ä½¿ç”¨ Redis å®ç°æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ</h2><p>ä¸€èˆ¬ä½¿ç”¨ list ç»“æ„ä½œä¸ºé˜Ÿåˆ—ï¼Œrpush ç”Ÿäº§æ¶ˆæ¯ï¼Œlpop æ¶ˆè´¹æ¶ˆæ¯ã€‚å½“ lpop æ²¡æœ‰æ¶ˆæ¯çš„æ—¶å€™ï¼Œè¦é€‚å½“ sleep ä¸€ä¼šå†é‡è¯•ã€‚</p><ul><li>å¦‚æœå¯¹æ–¹è¿½é—®å¯ä¸å¯ä»¥ä¸ç”¨ sleep å‘¢ï¼Ÿlist è¿˜æœ‰ä¸ªæŒ‡ä»¤å« blpop ï¼Œåœ¨æ²¡æœ‰æ¶ˆæ¯çš„æ—¶å€™ï¼Œå®ƒä¼šé˜»å¡ä½ç›´åˆ°æ¶ˆæ¯åˆ°æ¥ã€‚</li><li>å¦‚æœå¯¹æ–¹è¿½é—®èƒ½ä¸èƒ½ç”Ÿäº§ä¸€æ¬¡æ¶ˆè´¹å¤šæ¬¡å‘¢ï¼Ÿä½¿ç”¨ pub / sub ä¸»é¢˜è®¢é˜…è€…æ¨¡å¼ï¼Œå¯ä»¥å®ç° 1:N çš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚</li><li>å¦‚æœå¯¹æ–¹è¿½é—® pub / sub æœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Ÿåœ¨æ¶ˆè´¹è€…ä¸‹çº¿çš„æƒ…å†µä¸‹ï¼Œç”Ÿäº§çš„æ¶ˆæ¯ä¼šä¸¢å¤±ï¼Œå¾—ä½¿ç”¨ä¸“ä¸šçš„æ¶ˆæ¯é˜Ÿåˆ—å¦‚ rabbitmq ç­‰ã€‚</li><li>å¦‚æœå¯¹æ–¹è¿½é—® redis å¦‚ä½•å®ç°å»¶æ—¶é˜Ÿåˆ—ï¼Ÿæˆ‘ä¼°è®¡ç°åœ¨ä½ å¾ˆæƒ³æŠŠé¢è¯•å®˜ä¸€æ£’æ‰“æ­»å¦‚æœä½ æ‰‹ä¸Šæœ‰ä¸€æ ¹æ£’çƒæ£çš„è¯ï¼Œæ€ä¹ˆé—®çš„è¿™ä¹ˆè¯¦ç»†ã€‚ä½†æ˜¯ä½ å¾ˆå…‹åˆ¶ï¼Œç„¶åç¥æ€è‡ªè‹¥çš„å›ç­”é“ï¼šä½¿ç”¨ sortedset ï¼Œæ‹¿æ—¶é—´æˆ³ä½œä¸º score ï¼Œæ¶ˆæ¯å†…å®¹ä½œä¸º key è°ƒç”¨ zadd æ¥ç”Ÿäº§æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…ç”¨ zrangebyscore æŒ‡ä»¤è·å– N ç§’ä¹‹å‰çš„æ•°æ®è½®è¯¢è¿›è¡Œå¤„ç†ã€‚</li></ul><p>åˆ°è¿™é‡Œï¼Œé¢è¯•å®˜æš—åœ°é‡Œå·²ç»å¯¹ä½ ç«–èµ·äº†å¤§æ‹‡æŒ‡ã€‚ä½†æ˜¯ä»–ä¸çŸ¥é“çš„æ˜¯æ­¤åˆ»ä½ å´ç«–èµ·äº†ä¸­æŒ‡ï¼Œåœ¨æ¤…å­èƒŒåã€‚</p><p>å½“ç„¶ï¼Œå®é™…ä¸Š Redis çœŸçš„çœŸçš„çœŸçš„ä¸æ¨èä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—ä½¿ç”¨ï¼Œå®ƒæœ€å¤šåªæ˜¯æ¶ˆæ¯é˜Ÿåˆ—çš„å­˜å‚¨å±‚ï¼Œä¸Šå±‚çš„é€»è¾‘ï¼Œè¿˜éœ€è¦åšå¤§é‡çš„å°è£…å’Œæ”¯æŒã€‚</p><p>å¦å¤–ï¼Œåœ¨ Redis 5.0 å¢åŠ äº† Stream åŠŸèƒ½ï¼Œä¸€ä¸ªæ–°çš„å¼ºå¤§çš„æ”¯æŒå¤šæ’­çš„å¯æŒä¹…åŒ–çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæä¾›ç±»ä¼¼ Kafka çš„åŠŸèƒ½ã€‚</p><h2 id="ä»€ä¹ˆæ˜¯-Redis-Pipelining-ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-Redis-Pipelining-ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ Redis Pipelining ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ Redis Pipelining ï¼Ÿ</h2><p>ä¸€æ¬¡è¯·æ±‚/å“åº”æœåŠ¡å™¨èƒ½å®ç°å¤„ç†æ–°çš„è¯·æ±‚å³ä½¿æ—§çš„è¯·æ±‚è¿˜æœªè¢«å“åº”ã€‚è¿™æ ·å°±å¯ä»¥å°†å¤šä¸ªå‘½ä»¤å‘é€åˆ°æœåŠ¡å™¨ï¼Œè€Œä¸ç”¨ç­‰å¾…å›å¤ï¼Œæœ€ååœ¨ä¸€ä¸ªæ­¥éª¤ä¸­è¯»å–è¯¥ç­”å¤ã€‚</p><p>è¿™å°±æ˜¯ç®¡é“ï¼ˆpipeliningï¼‰ï¼Œæ˜¯ä¸€ç§å‡ åå¹´æ¥å¹¿æ³›ä½¿ç”¨çš„æŠ€æœ¯ã€‚ä¾‹å¦‚è®¸å¤š POP3 åè®®å·²ç»å®ç°æ”¯æŒè¿™ä¸ªåŠŸèƒ½ï¼Œå¤§å¤§åŠ å¿«äº†ä»æœåŠ¡å™¨ä¸‹è½½æ–°é‚®ä»¶çš„è¿‡ç¨‹ã€‚</p><p>Redis å¾ˆæ—©å°±æ”¯æŒç®¡é“ï¼ˆ<a href="http://redis.cn/topics/pipelining.html" target="_blank" rel="noopener">pipelining</a>ï¼‰æŠ€æœ¯ï¼Œå› æ­¤æ— è®ºä½ è¿è¡Œçš„æ˜¯ä»€ä¹ˆç‰ˆæœ¬ï¼Œä½ éƒ½å¯ä»¥ä½¿ç”¨ç®¡é“ï¼ˆpipeliningï¼‰æ“ä½œ Redisã€‚</p><p><strong>Redis å¦‚ä½•åšå¤§é‡æ•°æ®æ’å…¥ï¼Ÿ</strong></p><p>Redis2.6 å¼€å§‹ï¼ŒRedis-cli æ”¯æŒä¸€ç§æ–°çš„è¢«ç§°ä¹‹ä¸º pipe mode çš„æ–°æ¨¡å¼ç”¨äºæ‰§è¡Œå¤§é‡æ•°æ®æ’å…¥å·¥ä½œã€‚</p><p>å…·ä½“å¯è§ <a href="http://www.redis.cn/topics/mass-insert.html" target="_blank" rel="noopener">ã€ŠRedis å¤§é‡æ•°æ®æ’å…¥ã€‹</a> æ–‡ç« ã€‚</p><h2 id="ä»€ä¹ˆæ˜¯-Redis-äº‹åŠ¡ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-Redis-äº‹åŠ¡ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ Redis äº‹åŠ¡ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ Redis äº‹åŠ¡ï¼Ÿ</h2><p>å’Œä¼—å¤šå…¶å®ƒæ•°æ®åº“ä¸€æ ·ï¼ŒRedis ä½œä¸º NoSQL æ•°æ®åº“ä¹ŸåŒæ ·æä¾›äº†äº‹åŠ¡æœºåˆ¶ã€‚åœ¨Redisä¸­ï¼ŒMULTI / EXEC / DISCARD / WATCH è¿™å››ä¸ªå‘½ä»¤æ˜¯æˆ‘ä»¬å®ç°äº‹åŠ¡çš„åŸºçŸ³ã€‚ç›¸ä¿¡å¯¹æœ‰å…³ç³»å‹æ•°æ®åº“å¼€å‘ç»éªŒçš„å¼€å‘è€…è€Œè¨€è¿™ä¸€æ¦‚å¿µå¹¶ä¸é™Œç”Ÿï¼Œå³ä¾¿å¦‚æ­¤ï¼Œæˆ‘ä»¬è¿˜æ˜¯ä¼šç®€è¦çš„åˆ—å‡º Redis ä¸­äº‹åŠ¡çš„å®ç°ç‰¹å¾ï¼š</p><ul><li><p>1ã€åœ¨äº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½å°†ä¼šè¢«ä¸²è¡ŒåŒ–çš„é¡ºåºæ‰§è¡Œï¼Œäº‹åŠ¡æ‰§è¡ŒæœŸé—´ï¼ŒRedis ä¸ä¼šå†ä¸ºå…¶å®ƒå®¢æˆ·ç«¯çš„è¯·æ±‚æä¾›ä»»ä½•æœåŠ¡ï¼Œä»è€Œä¿è¯äº†äº‹ç‰©ä¸­çš„æ‰€æœ‰å‘½ä»¤è¢«åŸå­çš„æ‰§è¡Œã€‚</p></li><li><p>2ã€å’Œå…³ç³»å‹æ•°æ®åº“ä¸­çš„äº‹åŠ¡ç›¸æ¯”ï¼Œåœ¨ Redis äº‹åŠ¡ä¸­å¦‚æœæœ‰æŸä¸€æ¡å‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼Œå…¶åçš„å‘½ä»¤ä»ç„¶ä¼šè¢«ç»§ç»­æ‰§è¡Œã€‚</p></li><li><p>3ã€æˆ‘ä»¬å¯ä»¥é€šè¿‡ MULTI å‘½ä»¤å¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œæœ‰å…³ç³»å‹æ•°æ®åº“å¼€å‘ç»éªŒçš„äººå¯ä»¥å°†å…¶ç†è§£ä¸º <code>&quot;BEGIN TRANSACTION&quot;</code> è¯­å¥ã€‚åœ¨è¯¥è¯­å¥ä¹‹åæ‰§è¡Œçš„å‘½ä»¤éƒ½ï¼Œå°†è¢«è§†ä¸ºäº‹åŠ¡ä¹‹å†…çš„æ“ä½œï¼Œæœ€åæˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰§è¡Œ EXEC / DISCARD å‘½ä»¤æ¥æäº¤ / å›æ»šè¯¥äº‹åŠ¡å†…çš„æ‰€æœ‰æ“ä½œã€‚è¿™ä¸¤ä¸ª Redis å‘½ä»¤ï¼Œå¯è¢«è§†ä¸ºç­‰åŒäºå…³ç³»å‹æ•°æ®åº“ä¸­çš„ COMMIT / ROLLBACK è¯­å¥ã€‚</p></li><li><p>4ã€åœ¨äº‹åŠ¡å¼€å¯ä¹‹å‰ï¼Œå¦‚æœå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´å‡ºç°é€šè®¯æ•…éšœå¹¶å¯¼è‡´ç½‘ç»œæ–­å¼€ï¼Œå…¶åæ‰€æœ‰å¾…æ‰§è¡Œçš„è¯­å¥éƒ½å°†ä¸ä¼šè¢«æœåŠ¡å™¨æ‰§è¡Œã€‚ç„¶è€Œå¦‚æœç½‘ç»œä¸­æ–­äº‹ä»¶æ˜¯å‘ç”Ÿåœ¨å®¢æˆ·ç«¯æ‰§è¡Œ EXEC å‘½ä»¤ä¹‹åï¼Œé‚£ä¹ˆè¯¥äº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šè¢«æœåŠ¡å™¨æ‰§è¡Œã€‚</p></li><li><p>5ã€å½“ä½¿ç”¨ Append-Only æ¨¡å¼æ—¶ï¼ŒRedis ä¼šé€šè¿‡è°ƒç”¨ç³»ç»Ÿå‡½æ•° write å°†è¯¥äº‹åŠ¡å†…çš„æ‰€æœ‰å†™æ“ä½œåœ¨æœ¬æ¬¡è°ƒç”¨ä¸­å…¨éƒ¨å†™å…¥ç£ç›˜ã€‚ç„¶è€Œå¦‚æœåœ¨å†™å…¥çš„è¿‡ç¨‹ä¸­å‡ºç°ç³»ç»Ÿå´©æºƒï¼Œå¦‚ç”µæºæ•…éšœå¯¼è‡´çš„å®•æœºï¼Œé‚£ä¹ˆæ­¤æ—¶ä¹Ÿè®¸åªæœ‰éƒ¨åˆ†æ•°æ®è¢«å†™å…¥åˆ°ç£ç›˜ï¼Œè€Œå¦å¤–ä¸€éƒ¨åˆ†æ•°æ®å´å·²ç»ä¸¢å¤±ã€‚</p><blockquote><p>Redis æœåŠ¡å™¨ä¼šåœ¨é‡æ–°å¯åŠ¨æ—¶æ‰§è¡Œä¸€ç³»åˆ—å¿…è¦çš„ä¸€è‡´æ€§æ£€æµ‹ï¼Œä¸€æ—¦å‘ç°ç±»ä¼¼é—®é¢˜ï¼Œå°±ä¼šç«‹å³é€€å‡ºå¹¶ç»™å‡ºç›¸åº”çš„é”™è¯¯æç¤ºã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬å°±è¦å……åˆ†åˆ©ç”¨ Redis å·¥å…·åŒ…ä¸­æä¾›çš„ redis-check-aof å·¥å…·ï¼Œè¯¥å·¥å…·å¯ä»¥å¸®åŠ©æˆ‘ä»¬å®šä½åˆ°æ•°æ®ä¸ä¸€è‡´çš„é”™è¯¯ï¼Œå¹¶å°†å·²ç»å†™å…¥çš„éƒ¨åˆ†æ•°æ®è¿›è¡Œå›æ»šã€‚ä¿®å¤ä¹‹åæˆ‘ä»¬å°±å¯ä»¥å†æ¬¡é‡æ–°å¯åŠ¨RedisæœåŠ¡å™¨äº†ã€‚</p></blockquote></li></ul><p><strong>å¦‚ä½•å®ç° Redis CAS æ“ä½œï¼Ÿ</strong></p><p>åœ¨ Redis çš„äº‹åŠ¡ä¸­ï¼ŒWATCH å‘½ä»¤å¯ç”¨äºæä¾›CAS(check-and-set)åŠŸèƒ½ã€‚</p><p>å‡è®¾æˆ‘ä»¬é€šè¿‡ WATCH å‘½ä»¤åœ¨äº‹åŠ¡æ‰§è¡Œä¹‹å‰ç›‘æ§äº†å¤šä¸ª keys ï¼Œå€˜è‹¥åœ¨ WATCH ä¹‹åæœ‰ä»»ä½• Key çš„å€¼å‘ç”Ÿäº†å˜åŒ–ï¼ŒEXEC å‘½ä»¤æ‰§è¡Œçš„äº‹åŠ¡éƒ½å°†è¢«æ”¾å¼ƒï¼ŒåŒæ—¶è¿”å› <code>nil</code> åº”ç­”ä»¥é€šçŸ¥è°ƒç”¨è€…äº‹åŠ¡æ‰§è¡Œå¤±è´¥ã€‚</p><p>å…·ä½“çš„ç¤ºä¾‹ï¼Œå¯ä»¥çœ‹çœ‹ <a href="https://www.jianshu.com/p/0244a875aa26" target="_blank" rel="noopener">ã€ŠRedis äº‹åŠ¡é” CAS å®ç°ä»¥åŠæ·±å…¥è¯¯åŒºã€‹</a> ã€‚</p><h2 id="Redis-é›†ç¾¤éƒ½æœ‰å“ªäº›æ–¹æ¡ˆï¼Ÿ"><a href="#Redis-é›†ç¾¤éƒ½æœ‰å“ªäº›æ–¹æ¡ˆï¼Ÿ" class="headerlink" title="Redis é›†ç¾¤éƒ½æœ‰å“ªäº›æ–¹æ¡ˆï¼Ÿ"></a>Redis é›†ç¾¤éƒ½æœ‰å“ªäº›æ–¹æ¡ˆï¼Ÿ</h2><p>Redis é›†ç¾¤æ–¹æ¡ˆå¦‚ä¸‹ï¼š</p><ul><li>1ã€Redis Sentinel</li><li>2ã€Redis Cluster</li><li>3ã€Twemproxy</li><li>4ã€Codis</li><li>5ã€å®¢æˆ·ç«¯åˆ†ç‰‡</li></ul><p>å…³äºå‰å››ç§ï¼Œå¯ä»¥çœ‹çœ‹ <a href="http://blog.720ui.com/2016/redis_action_04_cluster/" target="_blank" rel="noopener">ã€ŠRedis å®æˆ˜ï¼ˆå››ï¼‰é›†ç¾¤æœºåˆ¶ã€‹</a> è¿™ç¯‡æ–‡ç« ã€‚</p><p>å…³äºæœ€åä¸€ç§ï¼Œå®¢æˆ·ç«¯åˆ†ç‰‡ï¼Œåœ¨ Redis Cluster å‡ºç°ä¹‹å‰ä½¿ç”¨è¾ƒå¤šï¼Œç›®å‰å·²ç»ä½¿ç”¨æ¯”è¾ƒå°‘äº†ã€‚å®ç°æ–¹å¼å¦‚ä¸‹ï¼š</p><blockquote><p>åœ¨ä¸šåŠ¡ä»£ç å±‚å®ç°ï¼Œèµ·å‡ ä¸ªæ¯«æ— å…³è”çš„ Redis å®ä¾‹ï¼Œåœ¨ä»£ç å±‚ï¼Œå¯¹ Key è¿›è¡Œ hash è®¡ç®—ï¼Œç„¶åå»å¯¹åº”çš„ Redis å®ä¾‹æ“ä½œæ•°æ®ã€‚</p><p>è¿™ç§æ–¹å¼å¯¹ hash å±‚ä»£ç è¦æ±‚æ¯”è¾ƒé«˜ï¼Œè€ƒè™‘éƒ¨åˆ†åŒ…æ‹¬ï¼ŒèŠ‚ç‚¹å¤±æ•ˆåçš„æ›¿ä»£ç®—æ³•æ–¹æ¡ˆï¼Œæ•°æ®éœ‡è¡åçš„è‡ªåŠ¨è„šæœ¬æ¢å¤ï¼Œå®ä¾‹çš„ç›‘æ§ï¼Œç­‰ç­‰ã€‚</p></blockquote><p><strong>é€‰æ‹©</strong></p><p>ç›®å‰ä¸€èˆ¬åœ¨é€‰å‹ä¸Šæ¥è¯´ï¼š</p><ul><li><p>ä½“é‡è¾ƒå°æ—¶ï¼Œé€‰æ‹© Redis Sentinel ï¼Œå•ä¸» Redis è¶³ä»¥æ”¯æ’‘ä¸šåŠ¡ã€‚</p></li><li><p>ä½“é‡è¾ƒå¤§æ—¶ï¼Œé€‰æ‹© Redis Cluster ï¼Œé€šè¿‡åˆ†ç‰‡ï¼Œä½¿ç”¨æ›´å¤šå†…å­˜ã€‚</p><p><strong>Redis é›†ç¾¤å¦‚ä½•æ‰©å®¹ï¼Ÿ</strong></p></li></ul><blockquote><p>è¿™ä¸ªé—®é¢˜ï¼Œè‰¿è‰¿äº†è§£çš„ä¹Ÿä¸æ˜¯å¾ˆå¤šï¼Œå»ºè®®åœ¨æœç´¢æœ‰ä»€ä¹ˆæ–¹æ¡ˆã€‚</p></blockquote><ul><li>å¦‚æœ Redis è¢«å½“åš<strong>ç¼“å­˜</strong>ä½¿ç”¨ï¼Œä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œå®ç°åŠ¨æ€æ‰©å®¹ç¼©å®¹ã€‚</li><li>å¦‚æœ Redis è¢«å½“åšä¸€ä¸ª<strong>æŒä¹…åŒ–å­˜</strong>å‚¨ä½¿ç”¨ï¼Œå¿…é¡»ä½¿ç”¨å›ºå®šçš„ keys-to-nodes æ˜ å°„å…³ç³»ï¼ŒèŠ‚ç‚¹çš„æ•°é‡ä¸€æ—¦ç¡®å®šä¸èƒ½å˜åŒ–ã€‚å¦åˆ™çš„è¯(å³Redis èŠ‚ç‚¹éœ€è¦åŠ¨æ€å˜åŒ–çš„æƒ…å†µï¼‰ï¼Œå¿…é¡»ä½¿ç”¨å¯ä»¥åœ¨è¿è¡Œæ—¶è¿›è¡Œæ•°æ®å†å¹³è¡¡çš„ä¸€å¥—ç³»ç»Ÿï¼Œè€Œå½“å‰åªæœ‰ Redis Clusterã€Codis å¯ä»¥åšåˆ°è¿™æ ·ã€‚</li></ul><h2 id="ä»€ä¹ˆæ˜¯-Redis-ä¸»ä»åŒæ­¥ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-Redis-ä¸»ä»åŒæ­¥ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ Redis ä¸»ä»åŒæ­¥ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ Redis ä¸»ä»åŒæ­¥ï¼Ÿ</h2><p><strong>Redis ä¸»ä»åŒæ­¥</strong></p><p>Redis çš„ä¸»ä»åŒæ­¥(replication)æœºåˆ¶ï¼Œå…è®¸ Slave ä» Master é‚£é‡Œï¼Œé€šè¿‡ç½‘ç»œä¼ è¾“æ‹·è´åˆ°å®Œæ•´çš„æ•°æ®å¤‡ä»½ï¼Œä»è€Œè¾¾åˆ°ä¸»ä»æœºåˆ¶ã€‚</p><ul><li>ä¸»æ•°æ®åº“å¯ä»¥è¿›è¡Œè¯»å†™æ“ä½œï¼Œå½“å‘ç”Ÿå†™æ“ä½œçš„æ—¶å€™è‡ªåŠ¨å°†æ•°æ®åŒæ­¥åˆ°ä»æ•°æ®åº“ï¼Œè€Œä»æ•°æ®åº“ä¸€èˆ¬æ˜¯åªè¯»çš„ï¼Œå¹¶æ¥æ”¶ä¸»æ•°æ®åº“åŒæ­¥è¿‡æ¥çš„æ•°æ®ã€‚</li><li>ä¸€ä¸ªä¸»æ•°æ®åº“å¯ä»¥æœ‰å¤šä¸ªä»æ•°æ®åº“ï¼Œè€Œä¸€ä¸ªä»æ•°æ®åº“åªèƒ½æœ‰ä¸€ä¸ªä¸»æ•°æ®åº“ã€‚</li><li>ç¬¬ä¸€æ¬¡åŒæ­¥æ—¶ï¼Œä¸»èŠ‚ç‚¹åšä¸€æ¬¡ bgsave æ“ä½œï¼Œå¹¶åŒæ—¶å°†åç»­ä¿®æ”¹æ“ä½œè®°å½•åˆ°å†…å­˜ buffer ï¼Œå¾…å®Œæˆåå°† RDB æ–‡ä»¶å…¨é‡åŒæ­¥åˆ°å¤åˆ¶èŠ‚ç‚¹ï¼Œå¤åˆ¶èŠ‚ç‚¹æ¥å—å®Œæˆåå°† RDB é•œåƒåŠ è½½åˆ°å†…å­˜ã€‚åŠ è½½å®Œæˆåï¼Œå†é€šçŸ¥ä¸»èŠ‚ç‚¹å°†æœŸé—´ä¿®æ”¹çš„æ“ä½œè®°å½•åŒæ­¥åˆ°å¤åˆ¶èŠ‚ç‚¹è¿›è¡Œé‡æ”¾å°±å®Œæˆäº†åŒæ­¥è¿‡ç¨‹ã€‚</li></ul><p><strong>å¥½å¤„</strong></p><p>é€šè¿‡ Redis çš„å¤åˆ¶åŠŸï¼Œèƒ½å¯ä»¥å¾ˆå¥½çš„å®ç°æ•°æ®åº“çš„è¯»å†™åˆ†ç¦»ï¼Œæé«˜æœåŠ¡å™¨çš„è´Ÿè½½èƒ½åŠ›ã€‚ä¸»æ•°æ®åº“ä¸»è¦è¿›è¡Œå†™æ“ä½œï¼Œè€Œä»æ•°æ®åº“è´Ÿè´£è¯»æ“ä½œã€‚</p><p>Redis ä¸»ä»åŒæ­¥ï¼Œæ˜¯å¾ˆå¤š Redis é›†ç¾¤æ–¹æ¡ˆçš„åŸºç¡€ï¼Œä¾‹å¦‚ Redis Sentinelã€Redis Cluster ç­‰ç­‰ã€‚</p><p>æ›´å¤šè¯¦ç»†ï¼Œå¯ä»¥çœ‹çœ‹ <a href="https://github.com/doocs/advanced-java/blob/master/docs/high-concurrency/redis-master-slave.md" target="_blank" rel="noopener">ã€ŠRedis ä¸»ä»æ¶æ„ã€‹</a> ã€‚</p><h2 id="æ•°æ®ä¸æ•°æ®åº“åŒå†™ä¸€è‡´"><a href="#æ•°æ®ä¸æ•°æ®åº“åŒå†™ä¸€è‡´" class="headerlink" title="æ•°æ®ä¸æ•°æ®åº“åŒå†™ä¸€è‡´"></a>æ•°æ®ä¸æ•°æ®åº“åŒå†™ä¸€è‡´</h2><h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><p>é€šç”¨çš„è¯»æ“ä½œ</p><ul><li>å¦‚æœæˆ‘ä»¬çš„æ•°æ®åœ¨ç¼“å­˜é‡Œè¾¹æœ‰ï¼Œé‚£ä¹ˆå°±ç›´æ¥å–ç¼“å­˜çš„ã€‚</li><li>å¦‚æœç¼“å­˜é‡Œæ²¡æœ‰æˆ‘ä»¬æƒ³è¦çš„æ•°æ®ï¼Œæˆ‘ä»¬ä¼šå…ˆå»æŸ¥è¯¢æ•°æ®åº“ï¼Œç„¶å<strong>å°†æ•°æ®åº“æŸ¥å‡ºæ¥çš„æ•°æ®å†™åˆ°ç¼“å­˜ä¸­</strong>ã€‚</li><li>æœ€åå°†æ•°æ®è¿”å›ç»™è¯·æ±‚</li></ul><h3 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h3><p><strong>å†™æ“ä½œ</strong>å¯èƒ½å°±<strong>é€ æˆæ•°æ®åº“å’Œç¼“å­˜çš„æ•°æ®ä¸ä¸€è‡´</strong>äº†ã€‚</p><h3 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h3><ol><li><p>è®¾ç½®<strong>é”®çš„è¿‡æœŸæ—¶é—´</strong>ï¼Œå¯ä»¥ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“çš„æ•°æ®<strong>æœ€ç»ˆæ˜¯ä¸€è‡´</strong>çš„ã€‚å› ä¸ºåªè¦ç¼“å­˜æ•°æ®è¿‡æœŸäº†ï¼Œå°±ä¼šè¢«åˆ é™¤ã€‚éšåè¯»çš„æ—¶å€™ï¼Œå› ä¸ºç¼“å­˜é‡Œæ²¡æœ‰ï¼Œå°±å¯ä»¥æŸ¥æ•°æ®åº“çš„æ•°æ®ï¼Œç„¶åå°†æ•°æ®åº“æŸ¥å‡ºæ¥çš„æ•°æ®å†™å…¥åˆ°ç¼“å­˜ä¸­ã€‚</p></li><li><p>æ›´æ–°æ“ä½œçš„ç»†åˆ†</p></li></ol><p>æ‰§è¡Œæ›´æ–°æ“ä½œæ—¶ï¼Œæˆ‘ä»¬ä¼šæœ‰ä¸¤ç§é€‰æ‹©ï¼š</p><ul><li>å…ˆæ“ä½œæ•°æ®åº“ï¼Œå†æ“ä½œç¼“å­˜</li><li>å…ˆæ“ä½œç¼“å­˜ï¼Œå†æ“ä½œæ•°æ®åº“</li></ul><blockquote><p>æ³¨ï¼šè¿™é‡Œçš„ç¼“å­˜æ“ä½œä¸€èˆ¬æ˜¯åˆ é™¤æ“ä½œã€‚</p></blockquote><p>å¯¹æ¯”ï¼š</p><ul><li>å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“<ul><li>åœ¨é«˜å¹¶å‘ä¸‹è¡¨ç°ä¸å¦‚æ„ï¼Œåœ¨åŸå­æ€§è¢«ç ´åæ—¶è¡¨ç°ä¼˜å¼‚</li></ul></li><li>å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜(<code>Cache Aside Pattern</code>è®¾è®¡æ¨¡å¼)<ul><li>åœ¨é«˜å¹¶å‘ä¸‹è¡¨ç°ä¼˜å¼‚ï¼Œåœ¨åŸå­æ€§è¢«ç ´åæ—¶è¡¨ç°ä¸å¦‚æ„</li></ul></li></ul><h2 id="å¦‚ä½•ä½¿ç”¨-Redis-Sentinel-å®ç°é«˜å¯ç”¨ï¼Ÿ"><a href="#å¦‚ä½•ä½¿ç”¨-Redis-Sentinel-å®ç°é«˜å¯ç”¨ï¼Ÿ" class="headerlink" title="å¦‚ä½•ä½¿ç”¨ Redis Sentinel å®ç°é«˜å¯ç”¨ï¼Ÿ"></a>å¦‚ä½•ä½¿ç”¨ Redis Sentinel å®ç°é«˜å¯ç”¨ï¼Ÿ</h2><p>å¯ä»¥çœ‹çœ‹ <a href="https://github.com/doocs/advanced-java/blob/master/docs/high-concurrency/redis-sentinel.md" target="_blank" rel="noopener">ã€ŠRedis å“¨å…µé›†ç¾¤å®ç°é«˜å¯ç”¨ã€‹</a> ã€‚</p><h2 id="å¦‚æœä½¿ç”¨-Redis-Cluster-å®ç°é«˜å¯ç”¨ï¼Ÿ"><a href="#å¦‚æœä½¿ç”¨-Redis-Cluster-å®ç°é«˜å¯ç”¨ï¼Ÿ" class="headerlink" title="å¦‚æœä½¿ç”¨ Redis Cluster å®ç°é«˜å¯ç”¨ï¼Ÿ"></a>å¦‚æœä½¿ç”¨ Redis Cluster å®ç°é«˜å¯ç”¨ï¼Ÿ</h2><p>å¯ä»¥çœ‹çœ‹</p><ul><li><a href="http://redis.cn/topics/cluster-tutorial.html" target="_blank" rel="noopener">ã€ŠRedis é›†ç¾¤æ•™ç¨‹ã€‹</a> å®Œæ•´ç‰ˆ</li><li><a href="https://github.com/doocs/advanced-java/blob/master/docs/high-concurrency/redis-cluster.md" target="_blank" rel="noopener">ã€ŠRedis é›†ç¾¤æ¨¡å¼çš„å·¥ä½œåŸç†èƒ½è¯´ä¸€ä¸‹ä¹ˆï¼Ÿã€‹</a> ç²¾ç®€ç‰ˆ</li></ul><p><strong>è¯´è¯´ Redis å“ˆå¸Œæ§½çš„æ¦‚å¿µï¼Ÿ</strong></p><p>Redis Cluster æ²¡æœ‰ä½¿ç”¨ä¸€è‡´æ€§ hash ï¼Œè€Œæ˜¯å¼•å…¥äº†å“ˆå¸Œæ§½çš„æ¦‚å¿µã€‚</p><p>Redis é›†ç¾¤æœ‰ 16384 ä¸ªå“ˆå¸Œæ§½ï¼Œæ¯ä¸ª key é€šè¿‡ CRC16 æ ¡éªŒåå¯¹ 16384 å–æ¨¡æ¥å†³å®šæ”¾ç½®å“ªä¸ªæ§½ï¼Œé›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£ä¸€éƒ¨åˆ† hash æ§½ã€‚</p><p>å› ä¸ºæœ€å¤§æ˜¯ 16384 ä¸ªå“ˆå¸Œæ§½ï¼Œæ‰€ä»¥è€ƒè™‘ Redis é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½èƒ½åˆ†é…åˆ°ä¸€ä¸ªå“ˆå¸Œæ§½ï¼Œæ‰€ä»¥æœ€å¤šæ”¯æŒ 16384 ä¸ª Redis èŠ‚ç‚¹ã€‚</p><p><strong>Redis Cluster çš„ä¸»ä»å¤åˆ¶æ¨¡å‹æ˜¯æ€æ ·çš„ï¼Ÿ</strong></p><p>ä¸ºäº†ä½¿åœ¨éƒ¨åˆ†èŠ‚ç‚¹å¤±è´¥æˆ–è€…å¤§éƒ¨åˆ†èŠ‚ç‚¹æ— æ³•é€šä¿¡çš„æƒ…å†µä¸‹é›†ç¾¤ä»ç„¶å¯ç”¨ï¼Œæ‰€ä»¥é›†ç¾¤ä½¿ç”¨äº†<strong>ä¸»ä»å¤åˆ¶</strong>æ¨¡å‹ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šæœ‰ N-1 ä¸ªå¤åˆ¶èŠ‚ç‚¹ã€‚</p><p>æ‰€ä»¥ï¼ŒRedis Cluster å¯ä»¥è¯´æ˜¯ Redis Sentinel å¸¦åˆ†ç‰‡çš„åŠ å¼ºç‰ˆã€‚ä¹Ÿå¯ä»¥è¯´ï¼š</p><ul><li>Redis Sentinel ç€çœ¼äºé«˜å¯ç”¨ï¼Œåœ¨ master å®•æœºæ—¶ä¼šè‡ªåŠ¨å°† slave æå‡ä¸º master ï¼Œç»§ç»­æä¾›æœåŠ¡ã€‚</li><li>Redis Cluster ç€çœ¼äºæ‰©å±•æ€§ï¼Œåœ¨å•ä¸ª Redis å†…å­˜ä¸è¶³æ—¶ï¼Œä½¿ç”¨Cluster è¿›è¡Œåˆ†ç‰‡å­˜å‚¨ã€‚</li></ul><p><strong>Redis Cluster æ–¹æ¡ˆä»€ä¹ˆæƒ…å†µä¸‹ä¼šå¯¼è‡´æ•´ä¸ªé›†ç¾¤ä¸å¯ç”¨ï¼Ÿ</strong></p><p>æœ‰ Aï¼ŒBï¼ŒC ä¸‰ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤ï¼Œåœ¨æ²¡æœ‰å¤åˆ¶æ¨¡å‹çš„æƒ…å†µä¸‹ï¼Œå¦‚æœèŠ‚ç‚¹ B å®•æœºäº†ï¼Œé‚£ä¹ˆæ•´ä¸ªé›†ç¾¤å°±ä¼šä»¥ä¸ºç¼ºå°‘ 5501-11000 è¿™ä¸ªèŒƒå›´çš„æ§½è€Œä¸å¯ç”¨ã€‚</p><p><strong>Redis Cluster ä¼šæœ‰å†™æ“ä½œä¸¢å¤±å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</strong></p><p>Redis å¹¶ä¸èƒ½ä¿è¯æ•°æ®çš„å¼ºä¸€è‡´æ€§ï¼Œè€Œæ˜¯ã€å¼‚æ­¥å¤åˆ¶ã€‘ï¼Œè¿™æ„å‘³è¿™åœ¨å®é™…ä¸­é›†ç¾¤åœ¨ç‰¹å®šçš„æ¡ä»¶ä¸‹å¯èƒ½ä¼šä¸¢å¤±å†™æ“ä½œã€‚</p><p><strong>Redis é›†ç¾¤å¦‚ä½•é€‰æ‹©æ•°æ®åº“ï¼Ÿ</strong></p><p>Redis é›†ç¾¤ç›®å‰æ— æ³•åšæ•°æ®åº“é€‰æ‹©ï¼Œé»˜è®¤åœ¨ 0 æ•°æ®åº“ã€‚</p><p><strong>è¯·è¯´è¯´ç”Ÿäº§ç¯å¢ƒä¸­çš„ Redis æ˜¯æ€ä¹ˆéƒ¨ç½²çš„ï¼Ÿ</strong></p><blockquote><p>é‡ç‚¹é—®é¢˜ï¼Œä»”ç»†ç†è§£ã€‚</p></blockquote><ul><li>Redis Clusterï¼Œ10 å°æœºå™¨ï¼Œ5 å°æœºå™¨éƒ¨ç½²äº† redis ä¸»å®ä¾‹ï¼Œå¦å¤– 5 å°æœºå™¨éƒ¨ç½²äº† redis çš„ä»å®ä¾‹ï¼Œæ¯ä¸ªä¸»å®ä¾‹æŒ‚äº†ä¸€ä¸ªä»å®ä¾‹ï¼Œ5 ä¸ªèŠ‚ç‚¹å¯¹å¤–æä¾›è¯»å†™æœåŠ¡ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„è¯»å†™é«˜å³° qps å¯èƒ½å¯ä»¥è¾¾åˆ°æ¯ç§’ 5 ä¸‡ï¼Œ5 å°æœºå™¨æœ€å¤šæ˜¯ 25 ä¸‡è¯»å†™è¯·æ±‚æ¯ç§’ã€‚</li><li>æœºå™¨æ˜¯ä»€ä¹ˆé…ç½®ï¼Ÿ32G å†…å­˜ + 8 æ ¸ CPU + 1T ç£ç›˜ï¼Œä½†æ˜¯åˆ†é…ç»™ Redis è¿›ç¨‹çš„æ˜¯ 10g å†…å­˜ï¼Œä¸€èˆ¬çº¿ä¸Šç”Ÿäº§ç¯å¢ƒï¼ŒRedis çš„å†…å­˜å°½é‡ä¸è¦è¶…è¿‡ 10gï¼Œè¶…è¿‡ 10g å¯èƒ½ä¼šæœ‰é—®é¢˜ã€‚é‚£ä¹ˆï¼Œ5 å°æœºå™¨å¯¹å¤–æä¾›è¯»å†™ï¼Œä¸€å…±æœ‰ 50g å†…å­˜ã€‚</li><li>å› ä¸ºæ¯ä¸ªä¸»å®ä¾‹éƒ½æŒ‚äº†ä¸€ä¸ªä»å®ä¾‹ï¼Œæ‰€ä»¥æ˜¯é«˜å¯ç”¨çš„ï¼Œä»»ä½•ä¸€ä¸ªä¸»å®ä¾‹å®•æœºï¼Œéƒ½ä¼šè‡ªåŠ¨æ•…éšœè¿ç§»ï¼ŒRedis ä»å®ä¾‹ä¼šè‡ªåŠ¨å˜æˆä¸»å®ä¾‹ç»§ç»­æä¾›è¯»å†™æœåŠ¡ã€‚</li><li>ä½ å¾€å†…å­˜é‡Œå†™çš„æ˜¯ä»€ä¹ˆæ•°æ®ï¼Ÿæ¯æ¡æ•°æ®çš„å¤§å°æ˜¯å¤šå°‘ï¼Ÿå•†å“æ•°æ®ï¼Œæ¯æ¡æ•°æ®æ˜¯ 10kb ã€‚100 æ¡æ•°æ®æ˜¯ 1mb ï¼Œ10 ä¸‡æ¡æ•°æ®æ˜¯ 1g ã€‚å¸¸é©»å†…å­˜çš„æ˜¯ 200 ä¸‡æ¡å•†å“æ•°æ®ï¼Œå ç”¨å†…å­˜æ˜¯ 20gï¼Œä»…ä»…ä¸åˆ°æ€»å†…å­˜çš„ 50%ã€‚ç›®å‰é«˜å³°æœŸæ¯ç§’å°±æ˜¯ 3500 å·¦å³çš„è¯·æ±‚é‡ã€‚</li><li>å…¶å®å¤§å‹çš„å…¬å¸ï¼Œä¼šæœ‰åŸºç¡€æ¶æ„çš„ team è´Ÿè´£ç¼“å­˜é›†ç¾¤çš„è¿ç»´ã€‚</li></ul><h2 id="ä»€ä¹ˆæ˜¯-Redis-åˆ†åŒºï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-Redis-åˆ†åŒºï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ Redis åˆ†åŒºï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ Redis åˆ†åŒºï¼Ÿ</h2><blockquote><p>è¿™ä¸ªé—®é¢˜ï¼Œå’Œ <a href="http://svip.iocoder.cn/Redis/Interview/#" target="_blank" rel="noopener">ã€ŒRedis é›†ç¾¤éƒ½æœ‰å“ªäº›æ–¹æ¡ˆï¼Ÿã€</a> æ˜¯åŒç±»é—®é¢˜ã€‚</p></blockquote><p>å…³äºå¦‚ä¸‹å››ä¸ªé—®é¢˜ï¼Œç›´æ¥çœ‹ <a href="http://www.runoob.com/redis/redis-partitioning.html" target="_blank" rel="noopener">ã€ŠRedis åˆ†åŒºã€‹</a> æ–‡ç« ã€‚</p><ul><li>Redis åˆ†åŒºæ˜¯ä»€ä¹ˆï¼Ÿ</li><li>åˆ†åŒºçš„ä¼˜åŠ¿ï¼Ÿ</li><li>åˆ†åŒºçš„ä¸è¶³ï¼Ÿ</li><li>åˆ†åŒºç±»å‹ï¼Ÿ</li></ul><p>å¯èƒ½æœ‰èƒ–å‹ä¼šæ‡µé€¼ï¼Œåˆæ˜¯ Redis ä¸»ä»å¤åˆ¶ï¼Œåˆæ˜¯ Redis åˆ†åŒºï¼Œåˆæ˜¯ Redis é›†ç¾¤ã€‚å‚»å‚»åˆ†ä¸æ¸…å•Šï¼</p><ul><li>Redis åˆ†åŒºæ˜¯ä¸€ç§æ¨¡å¼ï¼Œå°†æ•°æ®åˆ†åŒºåˆ°ä¸åŒçš„ Redis èŠ‚ç‚¹ä¸Šï¼Œè€Œ Redis é›†ç¾¤çš„ Redis Clusterã€Twemproxyã€Codisã€å®¢æˆ·ç«¯åˆ†ç‰‡( ä¸åŒ…æ‹¬ Redis Sentinel ) è¿™å››ç§æ–¹æ¡ˆï¼Œæ˜¯ Redis åˆ†åŒºçš„å…·ä½“å®ç°ã€‚</li><li>Redis æ¯ä¸ªåˆ†åŒºï¼Œå¦‚æœæƒ³è¦å®ç°é«˜å¯ç”¨ï¼Œéœ€è¦ä½¿ç”¨åˆ° Redis ä¸»ä»å¤åˆ¶ã€‚</li></ul><p><strong>ä½ çŸ¥é“æœ‰å“ªäº› Redis åˆ†åŒºå®ç°æ–¹æ¡ˆ</strong>ï¼Ÿ</p><p>Redis åˆ†åŒºæ–¹æ¡ˆï¼Œä¸»è¦åˆ†æˆä¸¤ç§ç±»å‹ï¼š</p><ul><li>å®¢æˆ·ç«¯åˆ†åŒºï¼Œå°±æ˜¯åœ¨å®¢æˆ·ç«¯å°±å·²ç»å†³å®šæ•°æ®ä¼šè¢«å­˜å‚¨åˆ°å“ªä¸ª Redis èŠ‚ç‚¹æˆ–è€…ä»å“ªä¸ª Redis èŠ‚ç‚¹è¯»å–ã€‚å¤§å¤šæ•°å®¢æˆ·ç«¯å·²ç»å®ç°äº†å®¢æˆ·ç«¯åˆ†åŒºã€‚<ul><li>æ¡ˆä¾‹ï¼šRedis Cluster å’Œå®¢æˆ·ç«¯åˆ†åŒºã€‚</li></ul></li><li>ä»£ç†åˆ†åŒºï¼Œæ„å‘³ç€å®¢æˆ·ç«¯å°†è¯·æ±‚å‘é€ç»™ä»£ç†ï¼Œç„¶åä»£ç†å†³å®šå»å“ªä¸ªèŠ‚ç‚¹å†™æ•°æ®æˆ–è€…è¯»æ•°æ®ã€‚ä»£ç†æ ¹æ®åˆ†åŒºè§„åˆ™å†³å®šè¯·æ±‚å“ªäº› Redis å®ä¾‹ï¼Œç„¶åæ ¹æ® Redis çš„å“åº”ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚<ul><li>æ¡ˆä¾‹ï¼šTwemproxy å’Œ Codis ã€‚</li></ul></li></ul><p>æŸ¥è¯¢è·¯ç”±(Query routing)çš„æ„æ€ï¼Œæ˜¯å®¢æˆ·ç«¯éšæœºåœ°è¯·æ±‚ä»»æ„ä¸€ä¸ª Redis å®ä¾‹ï¼Œç„¶åç”± Redis å°†è¯·æ±‚è½¬å‘ç»™æ­£ç¡®çš„ Redis èŠ‚ç‚¹ã€‚Redis Cluster å®ç°äº†ä¸€ç§æ··åˆå½¢å¼çš„æŸ¥è¯¢è·¯ç”±ï¼Œä½†å¹¶ä¸æ˜¯ç›´æ¥å°†è¯·æ±‚ä»ä¸€ä¸ªRedis èŠ‚ç‚¹è½¬å‘åˆ°å¦ä¸€ä¸ª Redis èŠ‚ç‚¹ï¼Œè€Œæ˜¯åœ¨å®¢æˆ·ç«¯çš„å¸®åŠ©ä¸‹ç›´æ¥ redirect åˆ°æ­£ç¡®çš„ Redis èŠ‚ç‚¹ã€‚</p><p><strong>åˆ†å¸ƒå¼ Redis æ˜¯å‰æœŸåšè¿˜æ˜¯åæœŸè§„æ¨¡ä¸Šæ¥äº†å†åšå¥½ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿï¼Ÿ</strong></p><p>å¦‚ä¸‹æ˜¯ç½‘ç»œä¸Šçš„ä¸€ä¸ªå¤§ç­”æ¡ˆï¼š</p><blockquote><p>æ—¢ç„¶ Redis æ˜¯å¦‚æ­¤çš„è½»é‡ï¼ˆå•å®ä¾‹åªä½¿ç”¨1Må†…å­˜ï¼‰ï¼Œä¸ºé˜²æ­¢ä»¥åçš„æ‰©å®¹ï¼Œæœ€å¥½çš„åŠæ³•å°±æ˜¯ä¸€å¼€å§‹å°±å¯åŠ¨è¾ƒå¤šå®ä¾‹ã€‚å³ä¾¿ä½ åªæœ‰ä¸€å°æœåŠ¡å™¨ï¼Œä½ ä¹Ÿå¯ä»¥ä¸€å¼€å§‹å°±è®© Redis ä»¥åˆ†å¸ƒå¼çš„æ–¹å¼è¿è¡Œï¼Œä½¿ç”¨åˆ†åŒºï¼Œåœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šå¯åŠ¨å¤šä¸ªå®ä¾‹ã€‚</p><p>ä¸€å¼€å§‹å°±å¤šè®¾ç½®å‡ ä¸ª Redis å®ä¾‹ï¼Œä¾‹å¦‚ 32 æˆ–è€… 64 ä¸ªå®ä¾‹ï¼Œå¯¹å¤§å¤šæ•°ç”¨æˆ·æ¥è¯´è¿™æ“ä½œèµ·æ¥å¯èƒ½æ¯”è¾ƒéº»çƒ¦ï¼Œä½†æ˜¯ä»é•¿ä¹…æ¥çœ‹åšè¿™ç‚¹ç‰ºç‰²æ˜¯å€¼å¾—çš„ã€‚</p><p>è¿™æ ·çš„è¯ï¼Œå½“ä½ çš„æ•°æ®ä¸æ–­å¢é•¿ï¼Œéœ€è¦æ›´å¤šçš„ Redis æœåŠ¡å™¨æ—¶ï¼Œä½ éœ€è¦åšçš„å°±æ˜¯ä»…ä»…å°† Redis å®ä¾‹ä»ä¸€å°æœåŠ¡è¿ç§»åˆ°å¦å¤–ä¸€å°æœåŠ¡å™¨è€Œå·²ï¼ˆè€Œä¸ç”¨è€ƒè™‘é‡æ–°åˆ†åŒºçš„é—®é¢˜ï¼‰ã€‚ä¸€æ—¦ä½ æ·»åŠ äº†å¦ä¸€å°æœåŠ¡å™¨ï¼Œä½ éœ€è¦å°†ä½ ä¸€åŠçš„ Redis å®ä¾‹ä»ç¬¬ä¸€å°æœºå™¨è¿ç§»åˆ°ç¬¬äºŒå°æœºå™¨ã€‚</p></blockquote><ul><li>å’Œé£å“¥æ²Ÿé€šäº†ä¸‹ï¼Œè¿™ä¸ªæ“ä½œä¸æ˜¯å¾ˆåˆç†ã€‚</li><li>æ— è®ºæ€ä¹ˆè¯´ï¼Œå»ºè®®ï¼Œéœ€è¦æ­å»ºä¸‹ Redis Sentinel é«˜å¯ç”¨ï¼Œè‡³äºæ‹“å±•æ€§ï¼Œæ ¹æ®è‡ªå·±çš„æƒ…å†µï¼Œæ˜¯å¦ä½¿ç”¨ Redis Cluster é›†ç¾¤</li></ul><h2 id="Redis-æœ‰å“ªäº›é‡è¦çš„å¥åº·æŒ‡æ ‡ï¼Ÿ"><a href="#Redis-æœ‰å“ªäº›é‡è¦çš„å¥åº·æŒ‡æ ‡ï¼Ÿ" class="headerlink" title="Redis æœ‰å“ªäº›é‡è¦çš„å¥åº·æŒ‡æ ‡ï¼Ÿ"></a>Redis æœ‰å“ªäº›é‡è¦çš„å¥åº·æŒ‡æ ‡ï¼Ÿ</h2><p>æ¨èé˜…è¯» <a href="https://mp.weixin.qq.com/s/D_khsApGkRckEoV75pYpDA" target="_blank" rel="noopener">ã€ŠRedis å‡ ä¸ªé‡è¦çš„å¥åº·æŒ‡æ ‡ã€‹</a></p><ul><li>å­˜æ´»æƒ…å†µ</li><li>è¿æ¥æ•°</li><li>é˜»å¡å®¢æˆ·ç«¯æ•°é‡</li><li>ä½¿ç”¨å†…å­˜å³°å€¼</li><li>å†…å­˜ç¢ç‰‡ç‡</li><li>ç¼“å­˜å‘½ä¸­ç‡</li><li>OPS</li><li>æŒä¹…åŒ–</li><li>å¤±æ•ˆKEY</li><li>æ…¢æ—¥å¿—</li></ul><p><strong>å¦‚ä½•æé«˜ Redis å‘½ä¸­ç‡ï¼Ÿ</strong></p><p>æ¨èé˜…è¯» <a href="http://www.cnblogs.com/shamo89/p/8383915.html" target="_blank" rel="noopener">ã€Šå¦‚ä½•æé«˜ç¼“å­˜å‘½ä¸­ç‡ï¼ˆRedisï¼‰ã€‹</a> ã€‚</p><h2 id="æ€ä¹ˆä¼˜åŒ–-Redis-çš„å†…å­˜å ç”¨"><a href="#æ€ä¹ˆä¼˜åŒ–-Redis-çš„å†…å­˜å ç”¨" class="headerlink" title="æ€ä¹ˆä¼˜åŒ– Redis çš„å†…å­˜å ç”¨"></a>æ€ä¹ˆä¼˜åŒ– Redis çš„å†…å­˜å ç”¨</h2><p>æ¨èé˜…è¯» <a href="https://www.jianshu.com/p/8677603d3865" target="_blank" rel="noopener">ã€ŠRedis çš„å†…å­˜ä¼˜åŒ–ã€‹</a></p><ul><li><p>redisObject å¯¹è±¡</p></li><li><p>ç¼©å‡é”®å€¼å¯¹è±¡</p></li><li><p>å…±äº«å¯¹è±¡æ± </p></li><li><p>å­—ç¬¦ä¸²ä¼˜åŒ–</p></li><li><p>ç¼–ç ä¼˜åŒ–</p></li><li><p>æ§åˆ¶ key çš„æ•°é‡</p><p><strong>ä¸€ä¸ª Redis å®ä¾‹æœ€å¤šèƒ½å­˜æ”¾å¤šå°‘çš„ keysï¼ŸListã€Setã€Sorted Set ä»–ä»¬æœ€å¤šèƒ½å­˜æ”¾å¤šå°‘å…ƒç´ ï¼Ÿ</strong></p></li></ul><p>ä¸€ä¸ª Redis å®ä¾‹ï¼Œæœ€å¤šèƒ½å­˜æ”¾å¤šå°‘çš„ keys ï¼ŒListã€Setã€Sorted Set ä»–ä»¬æœ€å¤šèƒ½å­˜æ”¾å¤šå°‘å…ƒç´ ã€‚</p><p>ç†è®ºä¸Šï¼ŒRedis å¯ä»¥å¤„ç†å¤šè¾¾ 2^32 çš„ keys ï¼Œå¹¶ä¸”åœ¨å®é™…ä¸­è¿›è¡Œäº†æµ‹è¯•ï¼Œæ¯ä¸ªå®ä¾‹è‡³å°‘å­˜æ”¾äº† 2 äº¿ 5 åƒä¸‡çš„ keysã€‚</p><p>ä»»ä½• listã€setã€å’Œ sorted set éƒ½å¯ä»¥æ”¾ 2^32 ä¸ªå…ƒç´ ã€‚</p><p><strong>å‡å¦‚ Redis é‡Œé¢æœ‰ 1 äº¿ä¸ª keyï¼Œå…¶ä¸­æœ‰ 10w ä¸ª key æ˜¯ä»¥æŸä¸ªå›ºå®šçš„å·²çŸ¥çš„å‰ç¼€å¼€å¤´çš„ï¼Œå¦‚æœå°†å®ƒä»¬å…¨éƒ¨æ‰¾å‡ºæ¥ï¼Ÿ</strong></p><p>ä½¿ç”¨ keys æŒ‡ä»¤å¯ä»¥æ‰«å‡ºæŒ‡å®šæ¨¡å¼çš„ key åˆ—è¡¨ã€‚</p><ul><li>å¯¹æ–¹æ¥ç€è¿½é—®ï¼šå¦‚æœè¿™ä¸ª Redis æ­£åœ¨ç»™çº¿ä¸Šçš„ä¸šåŠ¡æä¾›æœåŠ¡ï¼Œé‚£ä½¿ç”¨keysæŒ‡ä»¤ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</li><li>è¿™ä¸ªæ—¶å€™ä½ è¦å›ç­” Redis å…³é”®çš„ä¸€ä¸ªç‰¹æ€§ï¼šRedis çš„å•çº¿ç¨‹çš„ã€‚keys æŒ‡ä»¤ä¼šå¯¼è‡´çº¿ç¨‹é˜»å¡ä¸€æ®µæ—¶é—´ï¼Œçº¿ä¸ŠæœåŠ¡ä¼šåœé¡¿ï¼Œç›´åˆ°æŒ‡ä»¤æ‰§è¡Œå®Œæ¯•ï¼ŒæœåŠ¡æ‰èƒ½æ¢å¤ã€‚è¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨ scan æŒ‡ä»¤ï¼Œscan æŒ‡ä»¤å¯ä»¥æ— é˜»å¡çš„æå–å‡ºæŒ‡å®šæ¨¡å¼çš„ key åˆ—è¡¨ï¼Œä½†æ˜¯ä¼šæœ‰ä¸€å®šçš„é‡å¤æ¦‚ç‡ï¼Œåœ¨å®¢æˆ·ç«¯åšä¸€æ¬¡å»é‡å°±å¯ä»¥äº†ï¼Œä½†æ˜¯æ•´ä½“æ‰€èŠ±è´¹çš„æ—¶é—´ä¼šæ¯”ç›´æ¥ç”¨ keys æŒ‡ä»¤é•¿ã€‚</li></ul><h2 id="Redis-å¸¸è§çš„æ€§èƒ½é—®é¢˜éƒ½æœ‰å“ªäº›ï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ"><a href="#Redis-å¸¸è§çš„æ€§èƒ½é—®é¢˜éƒ½æœ‰å“ªäº›ï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ" class="headerlink" title="Redis å¸¸è§çš„æ€§èƒ½é—®é¢˜éƒ½æœ‰å“ªäº›ï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ"></a>Redis å¸¸è§çš„æ€§èƒ½é—®é¢˜éƒ½æœ‰å“ªäº›ï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ</h2><p><strong>1ã€Master æœ€å¥½ä¸è¦åšä»»ä½•æŒä¹…åŒ–å·¥ä½œï¼Œå¦‚ RDB å†…å­˜å¿«ç…§å’Œ AOF æ—¥å¿—æ–‡ä»¶ã€‚</strong></p><ul><li>Master å†™å†…å­˜å¿«ç…§ï¼Œsave å‘½ä»¤è°ƒåº¦ rdbSave å‡½æ•°ï¼Œä¼šé˜»å¡ä¸»çº¿ç¨‹çš„å·¥ä½œï¼Œå½“å¿«ç…§æ¯”è¾ƒå¤§æ—¶å¯¹æ€§èƒ½å½±å“æ˜¯éå¸¸å¤§çš„ï¼Œä¼šé—´æ–­æ€§æš‚åœæœåŠ¡ï¼Œæ‰€ä»¥ Master æœ€å¥½ä¸è¦å†™å†…å­˜å¿«ç…§ã€‚</li><li>Master AOF æŒä¹…åŒ–ï¼Œå¦‚æœä¸é‡å†™ AOF æ–‡ä»¶ï¼Œè¿™ä¸ªæŒä¹…åŒ–æ–¹å¼å¯¹æ€§èƒ½çš„å½±å“æ˜¯æœ€å°çš„ï¼Œä½†æ˜¯ AOF æ–‡ä»¶ä¼šä¸æ–­å¢å¤§ï¼ŒAOF æ–‡ä»¶è¿‡å¤§ä¼šå½±å“ Master é‡å¯çš„æ¢å¤é€Ÿåº¦ã€‚</li><li>æ‰€ä»¥ï¼ŒMaster æœ€å¥½ä¸è¦åšä»»ä½•æŒä¹…åŒ–å·¥ä½œï¼ŒåŒ…æ‹¬å†…å­˜å¿«ç…§å’Œ AOF æ—¥å¿—æ–‡ä»¶ï¼Œç‰¹åˆ«æ˜¯ä¸è¦å¯ç”¨å†…å­˜å¿«ç…§åšæŒä¹…åŒ–ã€‚å¦‚æœæ•°æ®æ¯”è¾ƒå…³é”®ï¼ŒæŸä¸ª Slave å¼€å¯AOFå¤‡ä»½æ•°æ®ï¼Œç­–ç•¥ä¸ºæ¯ç§’åŒæ­¥ä¸€æ¬¡</li></ul><p><strong>2ã€Master è°ƒç”¨ BGREWRITEAOF é‡å†™ AOF æ–‡ä»¶ï¼ŒAOF åœ¨é‡å†™çš„æ—¶å€™ä¼šå å¤§é‡çš„ CPU å’Œå†…å­˜èµ„æºï¼Œå¯¼è‡´æœåŠ¡ load è¿‡é«˜ï¼Œå‡ºç°çŸ­æš‚æœåŠ¡æš‚åœç°è±¡ã€‚</strong></p><p><strong>3ã€å°½é‡é¿å…åœ¨å‹åŠ›å¾ˆå¤§çš„ä¸»åº“ä¸Šå¢åŠ ä»åº“ã€‚</strong></p><p><strong>4ã€ä¸»ä»å¤åˆ¶ä¸è¦ç”¨å›¾çŠ¶ç»“æ„ï¼Œç”¨å•å‘é“¾è¡¨ç»“æ„æ›´ä¸ºç¨³å®šï¼Œå³ï¼š<code>Master &lt;- Slave1 &lt;- Slave2 &lt;- Slave3...</code> ã€‚</strong></p><ul><li>è¿™æ ·çš„ç»“æ„ï¼Œä¹Ÿæ–¹ä¾¿è§£å†³å•ç‚¹æ•…éšœé—®é¢˜ï¼Œå®ç° Slave å¯¹ Master çš„æ›¿æ¢ã€‚å¦‚æœ MasteræŒ‚äº†ï¼Œå¯ä»¥ç«‹åˆ»å¯ç”¨ Slave1 åš Master ï¼Œå…¶ä»–ä¸å˜ã€‚</li></ul><p><strong>5ã€Redis ä¸»ä»å¤åˆ¶çš„æ€§èƒ½é—®é¢˜ï¼Œä¸ºäº†ä¸»ä»å¤åˆ¶çš„é€Ÿåº¦å’Œè¿æ¥çš„ç¨³å®šæ€§ï¼ŒSlave å’Œ Master æœ€å¥½åœ¨åŒä¸€ä¸ªå±€åŸŸç½‘å†…ã€‚</strong></p>]]></content>
      
      
      <categories>
          
          <category> Interview Summary </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DataBase</title>
      <link href="/2019/11/24/DataBase/"/>
      <url>/2019/11/24/DataBase/</url>
      
        <content type="html"><![CDATA[<p> å¼•è¨€ï¼š</p><blockquote><p>é’ˆå¯¹é¢è¯•çš„mysqlæ•°æ®åº“æ€»ç»“</p></blockquote><a id="more"></a><h2 id="æœ¯è¯­"><a href="#æœ¯è¯­" class="headerlink" title="æœ¯è¯­"></a>æœ¯è¯­</h2><h3 id="å®ä½“-Entity"><a href="#å®ä½“-Entity" class="headerlink" title="å®ä½“(Entity)"></a>å®ä½“(Entity)</h3><p><strong>å®¢è§‚å­˜åœ¨å¹¶å¯ç›¸äº’åŒºåˆ«çš„äº‹ç‰©</strong>ç§°ä¹‹ä¸ºå®ä½“ã€‚å¯ä»¥çœ‹æˆæ˜¯Javaç±»</p><p>ä¾‹å­ï¼š(è¯¾ç¨‹å…³ç³»è¡¨)å°±æ˜¯ä¸€ä¸ªå®ä½“ã€‚</p><h3 id="å±æ€§-Attribute"><a href="#å±æ€§-Attribute" class="headerlink" title="å±æ€§(Attribute)"></a>å±æ€§(Attribute)</h3><p><strong>å®ä½“æ‰€å…·æœ‰çš„æŸä¸€ç‰¹æ€§</strong>ç§°ä¹‹ä¸ºå±æ€§ã€‚å¯ä»¥çœ‹æˆæ˜¯Javaç±»çš„æˆå‘˜å˜é‡ã€‚å±æ€§åœ¨æ•°æ®åº“ä¸­åˆç§°ä¸ºå­—æ®µï¼ˆæˆ–è€…æ˜¯åˆ—ï¼‰</p><p>ä¾‹å­ï¼š(è¯¾ç¨‹å)ï¼Œ(è¯¾ç¨‹å·)ã€(å­¦æ—¶)å°±æ˜¯å±æ€§åã€‚</p><h3 id="å…ƒç»„"><a href="#å…ƒç»„" class="headerlink" title="å…ƒç»„"></a>å…ƒç»„</h3><p><strong>é™¤å«æœ‰å±æ€§åæ‰€åœ¨çš„è¡Œä¹‹å¤–çš„å…¶ä»–è¡Œç§°ä¹‹ä¸ºå…ƒç»„ã€‚</strong></p><p><strong>ä¸‹é¢çš„æ¯ä¸€è¡Œæ•°æ®éƒ½ç§°ä¹‹ä¸ºå…ƒç»„</strong><br>(C401001 æ•°æ®ç»“æ„ 70)<br>(C401002 æ“ä½œç³»ç»Ÿ 80)<br>(C402001 è®¡ç®—æœºåŸç† 60)</p><h3 id="ç -Key"><a href="#ç -Key" class="headerlink" title="ç (Key)"></a>ç (Key)</h3><p><strong>ç ä¹Ÿè¢«ç§°ä½œæ˜¯å…³é”®å­—ã€‚å®ƒå¯ä»¥å”¯ä¸€æ ‡è¯†ä¸€ä¸ªå®ä½“</strong>ã€‚</p><p>å€™é€‰ç å’Œä¸»ç ï¼š</p><ul><li>å€™é€‰ç ï¼šå¦‚æœä¸€ç»„å±æ€§é›†èƒ½å”¯ä¸€åœ°æ ‡è¯†ä¸€ä¸ªå…³ç³»ä¸­çš„å…ƒç»„è€Œåˆä¸å«æœ‰å¤šä½™çš„å±æ€§ï¼Œåˆ™ç§°è¯¥å±æ€§é›†ä¸ºè¯¥å…³ç³»çš„å€™é€‰ç  ã€‚ï¼ˆ<strong>å€™é€‰ç å¯èƒ½ä¸æ­¢æœ‰ä¸€ä¸ª</strong>ï¼‰</li><li>ä¸»ç ï¼šç”¨æˆ·é€‰å®šçš„é‚£ä¸ªå€™é€‰é”®ç§°ä¸ºä¸»é”®</li></ul><p>ä¾‹å­ï¼šé‚®å¯„åœ°å€ï¼ˆåŸå¸‚åï¼Œè¡—é“åï¼Œé‚®æ”¿ç¼–ç ï¼Œå•ä½åï¼Œæ”¶ä»¶äººï¼‰</p><p>å®ƒæœ‰ä¸¤ä¸ªå€™é€‰é”®:{åŸå¸‚åï¼Œè¡—é“å} å’Œ {è¡—é“åï¼Œé‚®æ”¿ç¼–ç }</p><p>å¦‚æœæˆ‘é€‰å–{åŸå¸‚åï¼Œè¡—é“å}ä½œä¸ºå”¯ä¸€æ ‡è¯†å®ä½“çš„å±æ€§ï¼Œé‚£ä¹ˆ{åŸå¸‚åï¼Œè¡—é“å} å°±æ˜¯ä¸»ç </p><h3 id="å…³ç³»æ¨¡å¼"><a href="#å…³ç³»æ¨¡å¼" class="headerlink" title="å…³ç³»æ¨¡å¼"></a>å…³ç³»æ¨¡å¼</h3><p><strong>å…³ç³»åå’Œå…¶å±æ€§é›†åˆçš„ç»„åˆç§°ä¹‹ä¸ºå…³ç³»æ¨¡å¼</strong>ã€‚</p><p>å…³ç³»æ¨¡å¼ä¾‹å­ï¼šè¯¾ç¨‹å…³ç³»è¡¨(è¯¾ç¨‹å·,è¯¾ç¨‹å,å­¦æ—¶)</p><h3 id="åŸŸ"><a href="#åŸŸ" class="headerlink" title="åŸŸ"></a>åŸŸ</h3><p>å…³ç³»æ¨¡å‹è¦æ±‚å…ƒç»„çš„æ¯ä¸€ä¸ªåˆ†é‡éƒ½æ˜¯åŸå­æ€§çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒå¿…é¡»å±äºæŸç§å…ƒç´ ç±»å‹ï¼Œå¦‚Integerã€Stringç­‰ç­‰ï¼Œä¸èƒ½æ˜¯åˆ—ï¼Œé›†åˆï¼Œè®°å½•ï¼Œæ•°ç»„ï¼</p><p><strong>åŸŸå°±ä»£è¡¨ç€è¯¥å…ƒç»„ä¸­æ¯ä¸ªåˆ†é‡çš„ç±»å‹</strong>ï¼Œä¾‹å¦‚ï¼šè¯¾ç¨‹å·:string,è¯¾ç¨‹å:string,å­¦æ—¶:int</p><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p><img src="/2019/11/24/DataBase/1566261820297.png" alt="1566261820297"></p><p>æ•°æ®åº“æœ€ä¸»è¦çš„åŠŸèƒ½æ˜¯å­˜å‚¨æ•°æ®ï¼Œå› æ­¤ä»–æœ‰ä¸€ä¸ªå­˜å‚¨æ¨¡å—ï¼Œå°†æ•°æ®æŒä¹…åŒ–å­˜å…¥ç£ç›˜ä¸­ï¼›</p><p>æˆ‘ä»¬è¿˜éœ€è¦ç»„ç»‡å¹¶ä¸”ç”¨åˆ°è¿™äº›æ•°æ®ï¼Œæ‰€ä»¥éœ€è¦ç¨‹åºå®ä¾‹æ¥æ˜ å°„å‡ºç‰©ç†ç»“æ„ã€‚</p><p>å®é™…ç¨‹åºæ—¶è¦è€ƒè™‘ï¼šå­˜å‚¨ç®¡ç†ï¼ˆå°½é‡ä¼˜åŒ–å‡å°‘IOæ“ä½œï¼‰ï¼Œç¼“å­˜æœºåˆ¶ï¼ˆä¼˜åŒ–è®¿é—®ï¼‰ï¼Œsqlè§£æï¼ˆæ“ä½œæ•°æ®åº“ï¼Œä¼˜åŒ–å¯å°†sqlæ”¾å…¥ç¼“å­˜ï¼Œç¼–è¯‘å¥½çš„sqlå¯ä»¥ç›´æ¥ç”¨ï¼‰ï¼Œæ—¥å¿—ç®¡ç†ï¼ˆè®°å½•æ“ä½œï¼‰ï¼Œæƒé™åˆ’åˆ†ï¼Œå¼‚å¸¸æœºåˆ¶ï¼ˆå®¹ç¾ï¼‰ï¼Œ<strong>ç´¢å¼•ç®¡ç†</strong>ï¼ˆä¼˜åŒ–æŸ¥è¯¢ï¼‰ï¼Œ<strong>é”ç®¡ç†</strong>ï¼ˆå¹¶å‘ï¼‰</p><h2 id="ç´¢å¼•æ¨¡å—"><a href="#ç´¢å¼•æ¨¡å—" class="headerlink" title="ç´¢å¼•æ¨¡å—"></a>ç´¢å¼•æ¨¡å—</h2><h3 id="ä¸ºä»€ä¹ˆä½¿ç”¨ç´¢å¼•ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨ç´¢å¼•ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä½¿ç”¨ç´¢å¼•ï¼Ÿ"></a>ä¸ºä»€ä¹ˆä½¿ç”¨ç´¢å¼•ï¼Ÿ</h3><p>ç›´æ¥åŠ åœ¨åˆ°å†…å­˜ä¸­ï¼Œè¿›è¡Œå…¨è¡¨æ‰«æï¼Œå¾ˆæ…¢ã€‚ä½¿ç”¨ç´¢å¼•é¿å…å…¨è¡¨æŸ¥è¯¢ï¼ŒåŠ é€ŸæŸ¥è¯¢æ•°æ®ï¼›</p><p><strong>ç£ç›˜æ–‡ä»¶å­˜å‚¨</strong></p><p>é¡µæ˜¯è®¡ç®—æœºç®¡ç†å­˜å‚¨å™¨çš„é€»è¾‘å—ï¼Œç¡¬ä»¶åŠæ“ä½œç³»ç»Ÿå¾€å¾€å°†ä¸»å­˜å’Œç£ç›˜å­˜å‚¨åŒºåˆ†å‰²ä¸ºè¿ç»­çš„å¤§å°ç›¸ç­‰çš„å—ï¼Œæ¯ä¸ªå­˜å‚¨å—ç§°ä¸ºä¸€é¡µï¼ˆåœ¨è®¸å¤šæ“ä½œç³»ç»Ÿä¸­ï¼Œé¡µå¾—å¤§å°é€šå¸¸ä¸º4kï¼‰ï¼Œä¸»å­˜å’Œç£ç›˜ä»¥é¡µä¸ºå•ä½äº¤æ¢æ•°æ®ã€‚</p><p>InnoDBå­˜å‚¨å¼•æ“ä¸­æœ‰é¡µï¼ˆPageï¼‰çš„æ¦‚å¿µï¼Œé¡µæ˜¯å…¶ç£ç›˜ç®¡ç†çš„æœ€å°å•ä½ã€‚InnoDB å­˜å‚¨å¼•æ“ä¸­é»˜è®¤æ¯ä¸ªé¡µçš„å¤§å°ä¸º 16 KBï¼Œå› æ­¤ InnoDB æ¯æ¬¡ç”³è¯·ç£ç›˜ç©ºé—´æ—¶éƒ½ä¼šæ˜¯è‹¥å¹²åœ°å€è¿ç»­ç£ç›˜å—æ¥è¾¾åˆ°é¡µçš„å¤§å° 16KB ã€‚InnoDB åœ¨æŠŠç£ç›˜æ•°æ®è¯»å…¥åˆ°ç£ç›˜æ—¶ä¼šä»¥é¡µä¸ºåŸºæœ¬å•ä½ï¼Œåœ¨æŸ¥è¯¢æ•°æ®æ—¶å¦‚æœä¸€ä¸ªé¡µä¸­çš„æ¯æ¡æ•°æ®éƒ½èƒ½æœ‰åŠ©äºå®šä½æ•°æ®è®°å½•çš„ä½ç½®ï¼Œè¿™å°†ä¼šå‡å°‘ç£ç›˜ I/O æ¬¡æ•°ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚</p><p>æ–‡ä»¶ç³»ç»ŸåŠæ•°æ®åº“ç³»ç»Ÿçš„è®¾è®¡è€…åˆ©ç”¨äº†ç£ç›˜é¢„è¯»åŸç†ï¼Œå°†ä¸€ä¸ªèŠ‚ç‚¹çš„å¤§å°è®¾ä¸ºç­‰äºä¸€ä¸ªé¡µï¼Œè¿™æ ·æ¯ä¸ªèŠ‚ç‚¹åªéœ€è¦ä¸€æ¬¡I/Oå°±å¯ä»¥å®Œå…¨è½½å…¥ã€‚</p><h3 id="ä»€ä¹ˆæ ·çš„ä¿¡æ¯èƒ½å¤Ÿç§°ä¸ºç´¢å¼•ï¼Ÿ"><a href="#ä»€ä¹ˆæ ·çš„ä¿¡æ¯èƒ½å¤Ÿç§°ä¸ºç´¢å¼•ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ ·çš„ä¿¡æ¯èƒ½å¤Ÿç§°ä¸ºç´¢å¼•ï¼Ÿ"></a>ä»€ä¹ˆæ ·çš„ä¿¡æ¯èƒ½å¤Ÿç§°ä¸ºç´¢å¼•ï¼Ÿ</h3><p>ä¸»é”®ï¼Œå”¯ä¸€é”®ï¼Œæ™®é€šé”®ï¼Œæœ‰ä¸€å®šåŒºåˆ†æ€§</p><p>ä¸»é”®ï¼šå”¯ä¸€æ ‡è¯†è¡¨ä¸­çš„æ¯ä¸€è¡Œæ•°æ®ï¼Œç‰¹ç‚¹ä¸èƒ½ä¸ºç©ºï¼ï¼ï¼ä¸èƒ½é‡å¤ï¼ï¼ï¼</p><blockquote><p><code>auto_increment</code>çš„å­—æ®µå¿…é¡»æ˜¯ä¸»é”®, ä½†æ˜¯ä¸»é”®ä¸ä¸€å®šæ˜¯<code>auto_increment</code>çš„, åªè¦æ˜¯å”¯ä¸€çš„å°±å¯ä»¥ ä¸€ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®, ä½†æ˜¯ä¸»é”®å¯ä»¥æ˜¯1ä¸ªæˆ–å¤šä¸ªå­—æ®µç»„æˆ</p></blockquote><p>å”¯ä¸€é”®ï¼šå°†è¡¨ä¸­çš„æŸä¸ªå­—æ®µè®¾ç½®ä¸ºä¸å¯é‡å¤å€¼ï¼Œå¯ä»¥å°†å…¶è®¾ä¸ºå”¯ä¸€é”®ï¼ï¼ï¼</p><blockquote><p>å”¯ä¸€é”®ä¸æ˜¯ä¸»é”®ï¼Œä½†ä¸»é”®æœ‰ä¸å¯é‡å¤æ€§</p><p>ä¸€å¼ è¡¨å¯ä»¥æœ‰å¤šä¸ªå”¯ä¸€é”®ï¼Œä½†åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®</p></blockquote><p>æœ‰äº†å…³é”®å­—ç´¢å¼•è¿˜ä¸è¡Œï¼Œè¿˜éœ€è¦ä»¥æŸç§æ•°æ®ç»“æ„å°†å…¶ç»„ç»‡èµ·æ¥æ‰èƒ½å¤Ÿä½¿æ£€ç´¢æ›´é«˜æ•ˆã€‚</p><h3 id="ç´¢å¼•çš„æ•°æ®ç»“æ„ï¼Ÿ"><a href="#ç´¢å¼•çš„æ•°æ®ç»“æ„ï¼Ÿ" class="headerlink" title="ç´¢å¼•çš„æ•°æ®ç»“æ„ï¼Ÿ"></a>ç´¢å¼•çš„æ•°æ®ç»“æ„ï¼Ÿ</h3><p>äºŒå‰æ ‘ï¼šäºŒåˆ†æŸ¥æ‰¾ï¼Œç¼ºç‚¹ï¼šæ¯ä¸ªèŠ‚ç‚¹åªèƒ½å­˜å‚¨ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œæ ‘çš„æ·±åº¦å¾ˆæ·±ï¼ŒIOçš„æ“ä½œå°±ä¼šå¾ˆå¤šï¼Œæ•ˆç‡å°±å¾ˆå·®</p><p>Bæ•°ï¼šæ ‘çš„æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šæœ‰mä¸ªå­©å­ï¼Œå°±æ˜¯mé˜¶Bæ ‘ï¼Œä¸‹å›¾3é˜¶ï¼š</p><p><img src="/2019/11/24/DataBase/1566261830802.png" alt="1566261830802"></p><p>ç‰¹æ€§ï¼š</p><p><img src="/2019/11/24/DataBase/1566261842897.png" alt="1566261842897"></p><p><img src="/2019/11/24/DataBase/1566261850318.png" alt="1566261850318"></p><p>è®©æ¯ä¸ªç´¢å¼•å—å°½å¯èƒ½å­˜å‚¨æ›´å¤šä¿¡æ¯ï¼Œè®©æ ‘çš„é«˜åº¦ä½ï¼Œå‡å°‘IOæ¬¡æ•°ï¼›</p><p>B+æ ‘ï¼š</p><p><img src="/2019/11/24/DataBase/1566261860507.png" alt="1566261860507"></p><p>ç»“è®ºï¼šB+æ ‘æ›´é€‚åˆï¼ŒåŸå› ï¼š</p><ul><li><p><strong>B+æ ‘çš„ç£ç›˜è¯»å†™ä»£ä»·æ›´ä½ï¼Œå†…éƒ¨ï¼ˆéå¶å­èŠ‚ç‚¹ï¼‰å¹¶æ²¡æœ‰æŒ‡å‘å…³é”®å­—å…·ä½“ä¿¡æ¯çš„æŒ‡é’ˆï¼Œä¸å­˜æ”¾æ•°æ®åªå­˜æ”¾ç´¢å¼•ä¿¡æ¯ã€‚</strong></p></li><li><p><strong>æŸ¥è¯¢æ•ˆç‡æ›´ç¨³å®šï¼Œæ¯æ¬¡æŸ¥è¯¢éƒ½æ˜¯æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„è·¯å¾„ï¼ŒæŸ¥è¯¢åŸºæœ¬ä¸€æ ·</strong></p></li><li><p><strong>åªéœ€è¦éå†å¶å­èŠ‚ç‚¹å°±å¯ä»¥å®Œæˆå¯¹å…¨éƒ¨å…³é”®å­—çš„æ‰«æï¼Œæ‰€ä»¥ä»–æ›´æœ‰åˆ©äºå¯¹æ•°æ®åº“çš„æ‰«æã€‚ï¼ˆæ›´é€‚åˆèŒƒå›´æ¡ä»¶æŸ¥è¯¢ï¼‰</strong></p></li></ul><p><strong>Hashç´¢å¼•äº†è§£ä¸€ä¸‹ï¼š</strong></p><p>ç¼ºç‚¹ï¼š</p><ul><li>æ¯”è¾ƒè¿›è¡Œhashè¿ç®—ä¹‹åçš„å€¼ï¼Œä»…æ»¡è¶³ç­‰å€¼æŸ¥è¯¢ï¼Œä¸èƒ½ä½¿ç”¨èŒƒå›´æŸ¥è¯¢ï¼›</li><li>æ— æ³•è¿ç”¨ç´¢å¼•å€¼æ¥æ’åº</li><li>ä¸èƒ½åˆ©ç”¨éƒ¨åˆ†ç´¢å¼•é”®æŸ¥è¯¢</li><li>ä¸èƒ½é¿å…è¡¨æ‰«æï¼Œå“ˆå¸Œå€¼å¯èƒ½é‡å¤ï¼Œéœ€è¦å…¨è¡¨æ‰«æ</li><li>å¤§é‡hashå€¼ç›¸ç­‰æ—¶ï¼Œæ•ˆç‡å¾ˆåº•ã€‚</li></ul><p>å¯†é›†ç´¢å¼•å’Œç¨€ç–ç´¢å¼•</p><p>å¯†é›†ç´¢å¼•ï¼šå¶å­èŠ‚ç‚¹ä¸ä»…ä¿å­˜äº†ç´¢å¼•å€¼ï¼Œè¿˜ä¿å­˜äº†å…¶åŒä¸€è¡Œçš„å…¶ä»–åˆ—ï¼ˆå±æ€§ï¼‰çš„æ•°æ®ã€‚</p><blockquote><p>æ‰€æœ‰å®Œæ•´çš„ç”¨æˆ·è®°å½•éƒ½å­˜æ”¾åœ¨è¿™ä¸ª<code>èšç°‡ç´¢å¼•</code>çš„å¶å­èŠ‚ç‚¹å¤„ã€‚åœ¨<code>InnoDB</code>å­˜å‚¨å¼•æ“ä¸­ï¼Œ<code>èšç°‡ç´¢å¼•</code>å°±æ˜¯æ•°æ®çš„å­˜å‚¨æ–¹å¼</p></blockquote><p>ç¨€ç–ç´¢å¼•ï¼šå¶å­èŠ‚ç‚¹ä»…ä¿å­˜äº†é”®ä½ä¿¡æ¯ï¼ˆç´¢å¼•é”®ä½ï¼‰åŠå…¶ä¸»é”®ã€‚</p><p>InnoDBçš„ç´¢å¼•</p><p><img src="/2019/11/24/DataBase/1566261871063.png" alt="1566261871063"></p><h3 id="å¦‚ä½•å®šä½å¹¶ä¼˜åŒ–sqlï¼Ÿ"><a href="#å¦‚ä½•å®šä½å¹¶ä¼˜åŒ–sqlï¼Ÿ" class="headerlink" title="å¦‚ä½•å®šä½å¹¶ä¼˜åŒ–sqlï¼Ÿ"></a>å¦‚ä½•å®šä½å¹¶ä¼˜åŒ–sqlï¼Ÿ</h3><ul><li><p>æ ¹æ®æ…¢æ—¥å¿—å®šä½æ…¢æŸ¥è¯¢sqlï¼ˆè¾ƒæ…¢sqlæ‰§è¡Œçš„è®°å½•ï¼‰</p><p><img src="/2019/11/24/DataBase/1566262283010.png" alt="1566262283010"></p></li><li><p>ä½¿ç”¨explainç­‰å·¥å…·åˆ†æsql</p><p><img src="/2019/11/24/DataBase/1566262067821.png" alt="1566262067821"></p><ul><li>ä¸€èˆ¬æ”¾åœ¨selectæŸ¥è¯¢è¯­å¥å‰ï¼Œç”¨äºæè¿°MySQLå¦‚ä½•æ‰§è¡ŒæŸ¥è¯¢æ“ä½œï¼Œä»¥åŠMySQLæˆåŠŸè¿”å›ç»“æœé›†éœ€è¦æ‰§è¡Œçš„è¡Œæ•°</li><li>å­—æ®µï¼štypeè¡¨ç¤ºMySQLæ‰¾åˆ°æ•°æ®è¡Œçš„æ–¹å¼ï¼Œæ€§èƒ½æœ€ä¼˜åˆ°æœ€å·®å¦‚å›¾ï¼Œindex/allè¡¨ç¤ºæ˜¯å…¨è¡¨æŸ¥è¯¢ã€‚</li></ul><p><img src="/2019/11/24/DataBase/1566261930304.png" alt="1566261930304"></p><ul><li>å­—æ®µï¼šextraï¼Œå¦‚å›¾</li></ul><p><img src="/2019/11/24/DataBase/1566261963108.png" alt="1566261963108"></p></li><li><p>ä¿®æ”¹sqlæˆ–è€…å°½é‡è®©sqlèµ°ç´¢å¼•</p><ul><li>æ”¹ç”¨ç´¢å¼•æŸ¥</li></ul><p><img src="/2019/11/24/DataBase/1566262116465.png" alt="1566262116465"></p><ul><li>æ·»åŠ ç´¢å¼•</li></ul><p><img src="/2019/11/24/DataBase/1566262137053.png" alt="1566262137053"></p></li><li><p>ä½¿ç”¨fore_index()æµ‹è¯•é‚£ä¸ªç´¢å¼•æ›´å¥½</p></li></ul><h3 id="è”åˆç´¢å¼•çš„æœ€å·¦åŒ¹é…åŸåˆ™"><a href="#è”åˆç´¢å¼•çš„æœ€å·¦åŒ¹é…åŸåˆ™" class="headerlink" title="è”åˆç´¢å¼•çš„æœ€å·¦åŒ¹é…åŸåˆ™"></a>è”åˆç´¢å¼•çš„æœ€å·¦åŒ¹é…åŸåˆ™</h3><p><img src="/2019/11/24/DataBase/1566262151740.png" alt="1566262151740"></p><p>MySQLåˆ›å»ºå¤åˆç´¢å¼•çš„è§„åˆ™æ˜¯é¦–å…ˆä¼šå¯¹æœ€å·¦è¾¹çš„ä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªå­—æ®µè¿›è¡Œæ’åºï¼Œåœ¨ç¬¬ä¸€ä¸ªå­—æ®µæ’åºçš„åŸºç¡€ä¸Šå†å¯¹ç¬¬äºŒä¸ªå­—æ®µæ’åºï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ªå­—æ®µæ˜¯ç»å¯¹æœ‰åºçš„ï¼Œç¬¬äºŒä¸ªå­—æ®µå°±æ˜¯æ— åºçš„äº†ï¼Œå› æ­¤é€šå¸¸æƒ…å†µä¸‹ç›´æ¥ä½¿ç”¨ç¬¬äºŒä¸ªå­—æ®µè¿›è¡Œæ¡ä»¶åˆ¤æ–­æ˜¯ç”¨ä¸åˆ°ç´¢å¼•çš„ã€‚è¿™å°±æ˜¯MySQLè”åˆç´¢å¼•å¼ºè°ƒæœ€å·¦åŒ¹é…çš„åŸå› ã€‚</p><p>ç´¢å¼•å»ºç«‹çš„è¶Šå¤šè¶Šå¥½å—ï¼Ÿ</p><p><img src="/2019/11/24/DataBase/1566262159079.png" alt="1566262159079"></p><h2 id="é”"><a href="#é”" class="headerlink" title="é”"></a>é”</h2><h3 id="å‰è¨€ï¼š"><a href="#å‰è¨€ï¼š" class="headerlink" title="å‰è¨€ï¼š"></a>å‰è¨€ï¼š</h3><p>é¦–å…ˆéœ€è¦äº†è§£ï¼š</p><ul><li>å¯¹äº<code>UPDATEã€DELETEã€INSERT</code>è¯­å¥ï¼Œ<strong>InnoDB</strong>ä¼š<strong>è‡ªåŠ¨</strong>ç»™æ¶‰åŠæ•°æ®é›†åŠ æ’ä»–é”ï¼ˆX)</li><li><strong>MyISAM</strong>åœ¨æ‰§è¡ŒæŸ¥è¯¢è¯­å¥<code>SELECT</code>å‰ï¼Œä¼š<strong>è‡ªåŠ¨</strong>ç»™æ¶‰åŠçš„æ‰€æœ‰è¡¨åŠ <strong>è¯»é”</strong>ï¼Œåœ¨æ‰§è¡Œæ›´æ–°æ“ä½œï¼ˆ<code>UPDATEã€DELETEã€INSERT</code>ç­‰ï¼‰å‰ï¼Œä¼š<strong>è‡ªåŠ¨</strong>ç»™æ¶‰åŠçš„è¡¨åŠ <strong>å†™é”</strong>ï¼Œè¿™ä¸ªè¿‡ç¨‹å¹¶<strong>ä¸éœ€è¦ç”¨æˆ·å¹²é¢„</strong></li></ul><p>å…¶æ¬¡éœ€è¦äº†è§£ï¼š</p><p>InnoDBåªæœ‰é€šè¿‡<strong>ç´¢å¼•æ¡ä»¶</strong>æ£€ç´¢æ•°æ®<strong>æ‰ä½¿ç”¨è¡Œçº§é”</strong>ï¼Œå¦åˆ™ï¼ŒInnoDBå°†ä½¿ç”¨<strong>è¡¨é”</strong></p><ul><li>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>InnoDBçš„è¡Œé”æ˜¯åŸºäºç´¢å¼•çš„</strong>ï¼</li></ul><p>Myisamï¼šè¡¨çº§é”ï¼Œä¸æ”¯æŒè¡Œçº§é”</p><p>InnoDBï¼šé»˜è®¤è¡Œçº§é”ï¼Œæ”¯æŒè¡¨çº§é”ï¼Œ</p><blockquote><p>æ³¨ï¼šå½“SQLè¯­å¥ä¸­ä½¿ç”¨ç´¢å¼•ä½œä¸ºæ¡ä»¶æ—¶ï¼Œä½¿ç”¨çš„æ˜¯è¡Œçº§ç´¢ï¼Œå½“ä¸ç”¨ç´¢å¼•æ—¶ï¼Œæ•´å¼ è¡¨ä¼šè¢«é”ä½ï¼Œä½¿ç”¨çš„æ˜¯è¡¨çº§é”ï¼Œ</p></blockquote><p>æ— è®ºè¡¨é”è¿˜æ˜¯è¡Œé”ï¼Œé»˜è®¤éƒ½åˆ†ä¸ºå…±äº«é”å’Œæ’ä»–é”</p><p><img src="/2019/11/24/DataBase/1566262385992.png" alt="1566262385992"></p><h3 id="åœºæ™¯åˆ†æï¼š"><a href="#åœºæ™¯åˆ†æï¼š" class="headerlink" title="åœºæ™¯åˆ†æï¼š"></a>åœºæ™¯åˆ†æï¼š</h3><p>MyISAM</p><ul><li>é€‚ç”¨é¢‘ç¹æ‰§è¡Œå…¨è¡¨countè¯­å¥ï¼›å› ä¸ºæœ‰ä¸€ä¸ªå˜é‡å€¼å­˜å‚¨äº†è¯¥å€¼</li><li>é€‚ç”¨å¢åˆ æ”¹ä¸é«˜ï¼ŒæŸ¥è¯¢é¢‘ç¹ï¼›å› ä¸ºå¢åˆ æ”¹ä¼šæ¶‰åŠé”è¡¨æ“ä½œï¼Œä¼šäº§ç”Ÿå¾ˆå¤šç¢ç‰‡ï¼Œä½†æ˜¯çº¯æŸ¥è¯¢æ•ˆç‡æ˜¯å¯ä»¥çš„</li><li>é€‚åˆæ²¡æœ‰äº‹åŠ¡çš„</li></ul><p>InnoDB</p><ul><li>é€‚åˆæ•°æ®å¢åˆ æ”¹æŸ¥éƒ½é¢‘ç¹ï¼›å¢åˆ æ”¹æ—¶æŸäº›è¡Œè¢«é”ï¼Œé¿å…äº†è¢«é˜»å¡ï¼Œä¸åƒMyISAMæ¯æ¬¡é”ä½æ•´å¼ è¡¨</li><li>æ”¯æŒäº‹åŠ¡çš„ç³»ç»Ÿ</li></ul><p>æ•°æ®åº“é”åˆ†ç±»ï¼š</p><ul><li>æŒ‰ç²’åº¦åˆ’åˆ†ï¼šè¡¨çº§é”ï¼Œè¡Œçº§é”ï¼Œé¡µçº§é”</li><li>æŒ‰çº§åˆ«åˆ’åˆ†ï¼šå…±äº«é”ï¼Œæ’ä»–é”</li><li>æŒ‰åŠ é”æ–¹å¼ï¼šè‡ªåŠ¨é”ï¼ˆæ„å‘é”ï¼ŒMyISAMè¡¨é”ï¼Œä»¥åŠå¢åˆ æ”¹æ—¶çš„é”ï¼‰ï¼Œæ˜¾ç¤ºé”</li><li>æŒ‰æ“ä½œåˆ’åˆ†ï¼šDMLé”ï¼ˆæ•°æ®æ“ä½œï¼‰ï¼ŒDDLé”ï¼ˆè¡¨ç»“æ„å˜æ›´ï¼‰</li><li><strong>æŒ‰ä½¿ç”¨æ–¹å¼ï¼šä¹è§‚é”ï¼ˆè®¤ä¸ºæ•°æ®å¤„ç†è¿‡ç¨‹ä¸ä¼šå‘ç”Ÿå†²çªï¼Œæäº¤æ›´æ–°æ—¶æ‰ä¼šæ£€æµ‹ï¼Œå®ç°æ–¹å¼æ˜¯è®°å½•æ•°æ®ç‰ˆæœ¬ï¼šç‰ˆæœ¬å·æˆ–è€…æ—¶é—´æˆ³ï¼‰ï¼Œæ‚²è§‚é”ï¼ˆå…¨ç¨‹ä½¿ç”¨æ’ä»–é”ï¼‰</strong></li></ul><h3 id="ä¹è§‚é”å’Œæ‚²è§‚é”ï¼š"><a href="#ä¹è§‚é”å’Œæ‚²è§‚é”ï¼š" class="headerlink" title="ä¹è§‚é”å’Œæ‚²è§‚é”ï¼š"></a>ä¹è§‚é”å’Œæ‚²è§‚é”ï¼š</h3><p>ç¡®ä¿åœ¨å¤šä¸ªäº‹åŠ¡åŒæ—¶å­˜å–æ•°æ®åº“ä¸­åŒä¸€æ•°æ®æ—¶ä¸ç ´åäº‹åŠ¡çš„éš”ç¦»æ€§å’Œç»Ÿä¸€æ€§ä»¥åŠæ•°æ®åº“çš„ç»Ÿä¸€æ€§ï¼Œ<strong>ä¹è§‚é”å’Œæ‚²è§‚é”æ˜¯å¹¶å‘æ§åˆ¶ä¸»è¦é‡‡ç”¨çš„æŠ€æœ¯æ‰‹æ®µã€‚</strong></p><ul><li>æ‚²è§‚é”ï¼šå‡å®šä¼šå‘ç”Ÿå¹¶å‘å†²çªï¼Œå±è”½ä¸€åˆ‡å¯èƒ½è¿åæ•°æ®å®Œæ•´æ€§çš„æ“ä½œ<ul><li><strong>åœ¨æŸ¥è¯¢å®Œæ•°æ®çš„æ—¶å€™å°±æŠŠäº‹åŠ¡é”èµ·æ¥ï¼Œç›´åˆ°æäº¤äº‹åŠ¡</strong></li><li>å®ç°æ–¹å¼ï¼šä½¿ç”¨æ•°æ®åº“ä¸­çš„é”æœºåˆ¶</li></ul></li><li>ä¹è§‚é”ï¼šå‡è®¾ä¸ä¼šå‘ç”Ÿå¹¶å‘å†²çªï¼Œåªåœ¨æäº¤æ“ä½œæ—¶æ£€æŸ¥æ˜¯å¦è¿åæ•°æ®å®Œæ•´æ€§ã€‚<ul><li><strong>åœ¨ä¿®æ”¹æ•°æ®çš„æ—¶å€™æŠŠäº‹åŠ¡é”èµ·æ¥ï¼Œé€šè¿‡versionçš„æ–¹å¼æ¥è¿›è¡Œé”å®š</strong></li><li>å®ç°æ–¹å¼ï¼šä½¿ç”¨versionç‰ˆæœ¬æˆ–è€…æ—¶é—´æˆ³</li></ul></li></ul><h2 id="äº‹åŠ¡éš”ç¦»ä¸é”"><a href="#äº‹åŠ¡éš”ç¦»ä¸é”" class="headerlink" title="äº‹åŠ¡éš”ç¦»ä¸é”"></a>äº‹åŠ¡éš”ç¦»ä¸é”</h2><h3 id="å¹¶å‘äº‹åŠ¡"><a href="#å¹¶å‘äº‹åŠ¡" class="headerlink" title="å¹¶å‘äº‹åŠ¡"></a>å¹¶å‘äº‹åŠ¡</h3><p>ä¸åŒçš„éš”ç¦»çº§åˆ«å¯¹é”çš„ä½¿ç”¨æ˜¯ä¸åŒçš„ï¼Œ<strong>é”çš„åº”ç”¨æœ€ç»ˆå¯¼è‡´ä¸åŒäº‹åŠ¡çš„éš”ç¦»çº§åˆ«</strong></p><p>ACIDï¼šåŸå­æ€§ï¼Œä¸€è‡´æ€§ï¼Œéš”ç¦»æ€§ï¼ŒæŒä¹…æ€§</p><p>äº‹åŠ¡çš„éš”ç¦»æ€§ä»¥åŠå„çº§åˆ«ä¸‹çš„å¹¶å‘é—®é¢˜</p><p>æ›´æ–°ä¸¢å¤±â€”â€”MySQLæ‰€æœ‰äº‹åŠ¡éš”ç¦»çº§åˆ«åœ¨æ•°æ®åº“å±‚é¢ä¸Šå‡å¯é¿å…</p><p>è„è¯»â€”â€”ä¸€ä¸ªäº‹åŠ¡è¯»åˆ°å¦ä¸€ä¸ªäº‹åŠ¡æœªæäº¤çš„æ›´æ–°æ•°æ®ï¼ŒREAD-UNCOMMITTEDäº‹åŠ¡éš”ç¦»çº§åˆ«ä¸èƒ½è§£å†³ï¼Œä½¿ç”¨READ-COMMITTEDï¼ˆè¯»æäº¤ï¼‰çº§åˆ«ï¼Œéš”ç¦»ä¸€ä¸ªäº‹åŠ¡è¯»å–å¦ä¸€ä¸ªäº‹åŠ¡æœªæäº¤æ•°æ®</p><p>ä¸å¯é‡å¤è¯»â€”â€”ä¸€äº‹åŠ¡Aå¤šæ¬¡è¯»å–æ•°æ®ï¼Œå¦ä¸€äº‹åŠ¡Båœ¨æ­¤æœŸé—´ä¿®æ”¹æ•°æ®ï¼Œå¯¼è‡´äº‹åŠ¡Aå¤šæ¬¡è¯»å–æ•°æ®ä¸ä¸€è‡´ï¼Œä½¿ç”¨REPEATABLE-READï¼ˆå¯é‡å¤è¯»ï¼‰çº§åˆ«å¯ä»¥é¿å…ã€‚</p><p>å¹»è¯»â€”â€”äº‹åŠ¡Aè¯»å–åŒ¹é…æ¡ä»¶çš„è¡Œæ•°æ®ï¼Œäº‹åŠ¡Bä»¥æ’å…¥æˆ–åˆ é™¤çš„æ–¹å¼ä¿®æ”¹Açš„ç»“æœé›†ï¼Œå¯¼è‡´äº‹åŠ¡Aäº§ç”Ÿå·®é”™ã€‚è®¾ç½®ä¸ºSERIALIZABLEå¯ä»¥é¿å…ã€‚</p><p><img src="/2019/11/24/DataBase/1566263834174.png" alt="1566263834174"></p><h3 id="InnoDBå¼•æ“çš„éš”ç¦»ä¸é”"><a href="#InnoDBå¼•æ“çš„éš”ç¦»ä¸é”" class="headerlink" title="InnoDBå¼•æ“çš„éš”ç¦»ä¸é”"></a>InnoDBå¼•æ“çš„éš”ç¦»ä¸é”</h3><p>å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMulti-Version Concurrency Control, MVCCï¼‰æ˜¯ MySQL çš„ InnoDB å­˜å‚¨å¼•æ“å®ç°éš”ç¦»çº§åˆ«çš„ä¸€ç§<strong>å…·ä½“æ–¹å¼</strong>ï¼Œç”¨äºå®ç°<strong>æäº¤è¯»</strong>å’Œ<strong>å¯é‡å¤è¯»</strong>è¿™ä¸¤ç§éš”ç¦»çº§åˆ«ã€‚</p><blockquote><p>è€Œæœªæäº¤è¯»éš”ç¦»çº§åˆ«æ€»æ˜¯è¯»å–æœ€æ–°çš„æ•°æ®è¡Œï¼Œæ— éœ€ä½¿ç”¨ MVCCã€‚å¯ä¸²è¡ŒåŒ–éš”ç¦»çº§åˆ«éœ€è¦å¯¹æ‰€æœ‰è¯»å–çš„è¡Œéƒ½åŠ é”ï¼Œå•çº¯ä½¿ç”¨ MVCC æ— æ³•å®ç°ã€‚</p></blockquote><blockquote><p>InnoDB<strong>åŸºäºè¡Œé”</strong>å®ç°äº†MVCCå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ŒMVCCåœ¨éš”ç¦»çº§åˆ«ä¸‹çš„<code>Read committed</code>å’Œ<code>Repeatable read</code>ä¸‹å·¥ä½œã€‚MVCCèƒ½å¤Ÿå®ç°<strong>è¯»å†™ä¸é˜»å¡</strong>ï¼</p></blockquote><h3 id="MVCCå®ç°æ–¹å¼"><a href="#MVCCå®ç°æ–¹å¼" class="headerlink" title="MVCCå®ç°æ–¹å¼"></a>MVCCå®ç°æ–¹å¼</h3><ul><li>é€šè¿‡ä¸€å®šæœºåˆ¶ç”Ÿæˆä¸€ä¸ªæ•°æ®è¯·æ±‚<strong>æ—¶é—´ç‚¹çš„ä¸€è‡´æ€§æ•°æ®å¿«ç…§ï¼ˆSnapshot)</strong>ï¼Œå¹¶ç”¨è¿™ä¸ªå¿«ç…§æ¥æä¾›ä¸€å®šçº§åˆ«ï¼ˆ<strong>è¯­å¥çº§æˆ–äº‹åŠ¡çº§</strong>ï¼‰çš„<strong>ä¸€è‡´æ€§è¯»å–</strong>ã€‚ä»ç”¨æˆ·çš„è§’åº¦æ¥çœ‹ï¼Œå¥½åƒæ˜¯<strong>æ•°æ®åº“å¯ä»¥æä¾›åŒä¸€æ•°æ®çš„å¤šä¸ªç‰ˆæœ¬</strong>ã€‚</li><li>ç‰ˆæœ¬å·<ul><li>ç³»ç»Ÿç‰ˆæœ¬å·ï¼šæ˜¯ä¸€ä¸ªé€’å¢çš„æ•°å­—ï¼Œæ¯å¼€å§‹ä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Œç³»ç»Ÿç‰ˆæœ¬å·å°±ä¼šè‡ªåŠ¨é€’å¢ã€‚</li><li>äº‹åŠ¡ç‰ˆæœ¬å·ï¼šäº‹åŠ¡å¼€å§‹æ—¶çš„ç³»ç»Ÿç‰ˆæœ¬å·ã€‚<ul><li>ç‰ˆæœ¬å·ç”¨æ¥å’ŒæŸ¥è¯¢åˆ°çš„æ¯è¡Œè®°å½•çš„ç‰ˆæœ¬å·è¿›è¡Œæ¯”è¾ƒã€‚</li></ul></li></ul></li><li>MVCC åœ¨æ¯è¡Œè®°å½•åé¢éƒ½ä¿å­˜ç€ä¸¤ä¸ªéšè—çš„åˆ—ï¼Œç”¨æ¥å­˜å‚¨ä¸¤ä¸ªç‰ˆæœ¬å·ï¼š<ul><li>åˆ›å»ºç‰ˆæœ¬å·ï¼šæŒ‡ç¤ºåˆ›å»ºä¸€ä¸ªæ•°æ®è¡Œçš„å¿«ç…§æ—¶çš„ç³»ç»Ÿç‰ˆæœ¬å·ï¼›</li><li>åˆ é™¤ç‰ˆæœ¬å·ï¼šå¦‚æœè¯¥å¿«ç…§çš„åˆ é™¤ç‰ˆæœ¬å·å¤§äºå½“å‰äº‹åŠ¡ç‰ˆæœ¬å·è¡¨ç¤ºè¯¥å¿«ç…§æœ‰æ•ˆï¼Œå¦åˆ™è¡¨ç¤ºè¯¥å¿«ç…§å·²ç»è¢«åˆ é™¤äº†ã€‚</li></ul></li></ul><h4 id="Read-committedå®ç°"><a href="#Read-committedå®ç°" class="headerlink" title="Read committedå®ç°"></a><code>Read committed</code>å®ç°</h4><p>åŸç†ï¼šå¿«ç…§è¯»æœºåˆ¶ï¼Œä½¿ç”¨ MVCC è¯»å–çš„æ˜¯å¿«ç…§ä¸­çš„æ•°æ®ï¼Œè¿™æ ·å¯ä»¥å‡å°‘åŠ é”æ‰€å¸¦æ¥çš„å¼€é”€ã€‚</p><p><code>Read committed</code><strong>é¿å…è„è¯»</strong>çš„åšæ³•å…¶å®å¾ˆç®€å•ï¼š</p><ul><li><strong>åœ¨è¯»å–çš„æ—¶å€™ç”Ÿæˆä¸€ä¸ªç‰ˆæœ¬å·ï¼Œç›´åˆ°äº‹åŠ¡å…¶ä»–commitè¢«ä¿®æ”¹äº†ä¹‹åï¼Œæ‰ä¼šæœ‰æ–°çš„ç‰ˆæœ¬å·</strong>ï¼Œè¯»å–æ—¶ä¼šå¯¹æ¯”ç‰ˆæœ¬å·</li></ul><p>è¿‡ç¨‹ï¼š</p><ul><li>äº‹åŠ¡Aè¯»å–äº†è®°å½•(ç”Ÿæˆç‰ˆæœ¬å·)</li><li>äº‹åŠ¡Bä¿®æ”¹äº†è®°å½•(æ­¤æ—¶åŠ äº†å†™é”)</li><li>äº‹åŠ¡Aå†è¯»å–çš„æ—¶å€™ï¼Œ<strong>æ˜¯ä¾æ®æœ€æ–°çš„ç‰ˆæœ¬å·æ¥è¯»å–çš„</strong>(å½“äº‹åŠ¡Bæ‰§è¡Œcommitäº†ä¹‹åï¼Œä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ç‰ˆæœ¬å·)ï¼Œå¦‚æœäº‹åŠ¡Bè¿˜æ²¡æœ‰commitï¼Œé‚£äº‹åŠ¡Aè¯»å–çš„è¿˜æ˜¯ä¹‹å‰ç‰ˆæœ¬å·çš„æ•°æ®ã€‚</li></ul><h4 id="Repeatable-readå®ç°"><a href="#Repeatable-readå®ç°" class="headerlink" title="Repeatable readå®ç°"></a><code>Repeatable read</code>å®ç°</h4><p><code>Read committed</code>ä¼šå‡ºç°ä¸å¯é‡å¤è¯»ï¼š<strong>ä¸€ä¸ªäº‹åŠ¡å¯ä»¥çœ‹åˆ°å…¶ä»–äº‹åŠ¡æ‰€åšçš„ä¿®æ”¹</strong>ã€‚</p><p>ä¾‹å¦‚ï¼Œ<strong>AæŸ¥è¯¢æ•°æ®åº“å¾—åˆ°æ•°æ®ï¼ŒBå»ä¿®æ”¹æ•°æ®åº“çš„æ•°æ®ï¼Œå¯¼è‡´Aå¤šæ¬¡æŸ¥è¯¢æ•°æ®åº“çš„ç»“æœéƒ½ä¸ä¸€æ ·ï¼ˆå±å®³ï¼šAæ¯æ¬¡æŸ¥è¯¢çš„ç»“æœéƒ½æ˜¯å—Bçš„å½±å“çš„ï¼Œé‚£ä¹ˆAæŸ¥è¯¢å‡ºæ¥çš„ä¿¡æ¯å°±æ²¡æœ‰æ„æ€äº†ï¼‰</strong></p><blockquote><p><code>Read committed</code>æ˜¯<strong>è¯­å¥çº§åˆ«</strong>ï¼ˆæ‰§è¡Œè¯­å¥ï¼‰çš„å¿«ç…§ï¼<strong>æ¯æ¬¡è¯»å–çš„éƒ½æ˜¯å½“å‰æœ€æ–°çš„æ•°æ®è¡Œç‰ˆæœ¬</strong>ï¼</p></blockquote><blockquote><p><code>Repeatable read</code>é¿å…ä¸å¯é‡å¤è¯»æ˜¯<strong>äº‹åŠ¡çº§åˆ«</strong>çš„å¿«ç…§ï¼æ¯æ¬¡è¯»å–çš„éƒ½æ˜¯å½“å‰äº‹åŠ¡çš„ç‰ˆæœ¬ï¼Œå³ä½¿è¢«ä¿®æ”¹äº†ï¼Œä¹Ÿåªä¼šè¯»å–å½“å‰äº‹åŠ¡ç‰ˆæœ¬çš„æ•°æ®ã€‚</p></blockquote><p>æ€»ç»“ï¼šäº‹åŠ¡å¼€å¯æ—¶ä½¿ç”¨ç³»ç»Ÿç‰ˆæœ¬ä½œä¸ºäº‹åŠ¡ç‰ˆæœ¬å·ï¼Œäº‹åŠ¡å¼€å¯æ—¶æ•°æ®è¡Œæ›´æ–°åä½¿ç”¨æœ€æ–°æ•°æ®è¡Œç‰ˆæœ¬å·ï¼Œ<strong>è¯»æäº¤å®ç°</strong>ä½¿ç”¨æ•°æ®è¡Œç‰ˆæœ¬å·çš„æ¯”å¯¹ï¼Œç¡®ä¿æ¯æ¬¡commitè¢«ä¿®æ”¹äº†ä¹‹åï¼Œæ‰ä¼šæœ‰æ–°çš„ç‰ˆæœ¬å·ï¼Œé€šè¿‡ç‰ˆæœ¬å·å®ç°éš”ç¦»ï¼›<strong>é‡å¤è¯»å®ç°</strong>å¯¹æ¯”çš„æ˜¯å¿«ç…§ä¸­çš„äº‹åŠ¡ç‰ˆæœ¬å·ï¼Œå³åœ¨ <strong>tempdb</strong> ä¸­å­˜å‚¨åŸå§‹è¡Œçš„å‰¯æœ¬ï¼Œå’Œä¸ºè¯¥è¡Œæ·»åŠ äº‹åŠ¡ç‰ˆæœ¬å·ï¼Œé€šè¿‡ç‰ˆæœ¬å·å®ç°éš”ç¦»ã€‚</p><h3 id="InnoDBåœ¨å¯é‡å¤åº¦éš”ç¦»çº§åˆ«ä¸‹æ˜¯å¦‚ä½•é¿å…å¹»è¯»ï¼Ÿ"><a href="#InnoDBåœ¨å¯é‡å¤åº¦éš”ç¦»çº§åˆ«ä¸‹æ˜¯å¦‚ä½•é¿å…å¹»è¯»ï¼Ÿ" class="headerlink" title="InnoDBåœ¨å¯é‡å¤åº¦éš”ç¦»çº§åˆ«ä¸‹æ˜¯å¦‚ä½•é¿å…å¹»è¯»ï¼Ÿ"></a>InnoDBåœ¨å¯é‡å¤åº¦éš”ç¦»çº§åˆ«ä¸‹æ˜¯å¦‚ä½•é¿å…å¹»è¯»ï¼Ÿ</h3><h4 id="å¼•è¨€ï¼š"><a href="#å¼•è¨€ï¼š" class="headerlink" title="å¼•è¨€ï¼š"></a>å¼•è¨€ï¼š</h4><p>è¡¨è±¡ï¼šå¿«ç…§åº¦ï¼ˆéé˜»å¡è¯»ï¼‰â€”â€”ä¼ªMVCC</p><p>å†…åœ¨ï¼šnext-keyé”ï¼ˆè¡Œé”+gapé”ï¼‰</p><p><img src="/2019/11/24/DataBase/1566264130165.png" alt="1566264130165"></p><p>å½“å‰è¯»è¡¨ç¤ºï¼šè¯»å–çš„æ˜¯è®°å½•çš„æœ€æ–°ç‰ˆæœ¬ï¼Œå¹¶ä¸”è¯»å–åä¿è¯å…¶ä»–å¹¶å‘äº‹åŠ¡ä¸èƒ½ä¿®æ”¹å½“å‰è®°å½•ï¼Œå¯¹è¯»å–è®°å½•åŠ é”ã€‚</p><p>å¿«ç…§è¯»æ˜¯åŸºäºæå‡å¹¶å‘æ€§èƒ½çš„è€ƒè™‘ï¼ŒåŸºäºå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCCï¼‰ï¼Œä»–æ˜¯è¡Œçº§é”çš„å˜åŠ¨ï¼Œä½†æ˜¯ä»–åœ¨å¾ˆå¤šæƒ…å†µä¸‹é¿å…äº†åŠ é”æ“ä½œï¼Œå¼€é”€æ›´ä½ï¼Œç”±äºæ˜¯åŸºäºå¤šç‰ˆæœ¬å¿«ç…§ï¼Œæ‰€ä»¥è¯»åˆ°çš„æ•°æ®ä¸æ˜¯æœ€æ–°ç‰ˆæœ¬ã€‚</p><p>RCã€RRçº§åˆ«ä¸‹InnoDBçš„éé˜»å¡è¯»ï¼ˆå¿«ç…§è¯»ï¼‰å¦‚ä½•å®ç°ï¼Ÿ</p><ol><li>æ¯è¡Œæ•°æ®çš„é¢å¤–å­—æ®µï¼ŒDB_TRX_IDï¼ˆæœ€è¿‘ä¸€æ¬¡äº‹åŠ¡æ ‡è¯†ç¬¦ï¼‰ï¼ŒDB_ROLL_PTRï¼ˆå›æ»šæŒ‡é’ˆæ®µï¼‰ï¼ŒDB_ROW_IDï¼ˆè¡Œå·ï¼Œéšè—ä¸»é”®ï¼‰</li><li>undoæ—¥å¿—ï¼Œå½“æˆ‘ä»¬å¯¹è®°å½•åšäº†å˜æ›´æ“ä½œæ—¶å°±ä¼šäº§ç”Ÿundoæ—¥å¿—ï¼Œå…¶ä¸­å­˜å‚¨çš„æ˜¯è€ç‰ˆæ•°æ®</li></ol><p>ä¾‹ï¼šæ•°æ®ï¼ˆ11ï¼Œ12ï¼Œ13ï¼‰ä¿®æ”¹ä¸ºï¼ˆ11ï¼Œ32ï¼Œ13ï¼‰æ—¶ï¼Œä¼šå‘ç”Ÿï¼š</p><p><img src="/2019/11/24/DataBase/1566265001814.png" alt="1566265001814"></p><p>å†æ¬¡ä¿®æ”¹ä¸ºï¼ˆ11ï¼Œ32ï¼Œ45ï¼‰æ—¶ä¼šå‘ç”Ÿï¼š</p><p><img src="/2019/11/24/DataBase/1566264973315.png" alt="1566264973315"></p><ol start="3"><li>read viewå¯è§æ€§åˆ¤æ–­ï¼Œå½“ä½¿ç”¨å¿«ç…§è¯»æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªread viewï¼Œå‘ŠçŸ¥æˆ‘ä»¬è¯»çš„æ˜¯å“ªä¸€ä¸ªç‰ˆæœ¬ï¼Œæ ¹æ®å¯è§æ€§ç®—æ³•ï¼Œå°†DB_TRX_IDå–å‡ºä¸ç³»ç»Ÿå…¶ä»–æ´»è·ƒäº‹åŠ¡IDå¯¹æ¯”ï¼Œå¦‚æœå¤§äºæˆ–è€…ç­‰äºï¼Œå°±å–å‡ºundo logä¸­çš„ç‰ˆæœ¬ï¼Œç›´åˆ°å–å‡ºå°äºæ´»è·ƒäº‹åŠ¡IDå·ï¼ˆäº‹åŠ¡IDæ˜¯é€’å¢çŠ¶æ€ï¼Œè¶Šæ–°å¼€å¯çš„äº‹åŠ¡ï¼ŒIDè¶Šå¤§ï¼‰</li></ol><p>å› ä¸º<strong>ç”Ÿæˆæ—¶æœº</strong>ï¼Ÿï¼Ÿï¼Ÿçš„ä¸åŒé€ æˆRC,RRéš”ç¦»çº§åˆ«çš„ä¸åŒå¯è§æ€§ï¼Œåœ¨RRçº§åˆ«ä¸‹ï¼Œäº‹åŠ¡åœ¨å¼€å¯äº‹åŠ¡çš„ç¬¬ä¸€æ¡å¿«ç…§è¯»ä¼šåˆ›å»ºä¸€ä¸ªå¿«ç…§ï¼Œå³read viewï¼Œå°†å½“å‰ç³»ç»Ÿä¸­æ´»è·ƒçš„å…¶ä»–äº‹åŠ¡è®°å½•èµ·æ¥ï¼Œæ­¤ååœ¨è°ƒç”¨å¿«ç…§è¯»æ—¶è¿˜æ˜¯ä½¿ç”¨åŒä¸€ä¸ªread viewï¼›è€Œåœ¨RCçº§åˆ«ä¸‹ï¼Œäº‹åŠ¡ä¸­æ¯æ¬¡è°ƒç”¨å¿«ç…§è¯»æ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å¿«ç…§ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨RCä¸‹èƒ½å¤Ÿçœ‹åˆ°åˆ«çš„äº‹åŠ¡æäº¤çš„å¯¹è¡¨è®°å½•çš„å¢åˆ æ”¹ã€‚è€Œåœ¨RRä¸‹ï¼Œå¦‚æœé¦–æ¬¡ä½¿ç”¨å¿«ç…§è¯»æ˜¯åœ¨åˆ«çš„äº‹ç‰©å¯¹æ•°æ®åšå‡ºå¢åˆ æ”¹å¹¶æäº¤ä¹‹å‰çš„ï¼Œæ­¤åå³ä¾¿åˆ«çš„äº‹ç‰©å¯¹æ•°æ®è¿›è¡Œå¢åˆ æ”¹å¹¶æäº¤è¿˜æ˜¯è¯»ä¸åˆ°æ•°æ®å˜åŠ¨çš„åŸå› ã€‚å¯¹RRæ¥è¯´ï¼Œé¦–æ¬¡äº‹åŠ¡è°ƒç”¨å¿«ç…§è¯»çš„æ—¶æœºå¾ˆé‡è¦ã€‚</p><p><strong>æ­£æ˜¯å› ä¸ºä¸Šé¢ä¸‰ä¸ªåŸå› ï¼Œä½¿å¾—InnoDBåœ¨RRã€RCçº§åˆ«æ”¯æŒéé˜»å¡è¯»ï¼Œè€Œè¯»å–æ•°æ®æ—¶çš„éé˜»å¡å°±æ˜¯MVCCï¼Œè€ŒInnoDBçš„éé˜»å¡è¯»å®ç°äº†MVCCçš„ä»¿ç…§ç‰ˆï¼›MVCCä»£è¡¨å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼Œè¯»ä¸åŠ é”ï¼Œè¯»å†™ä¸å†²çªï¼Œåœ¨è¯»å¤šå†™å°‘çš„åº”ç”¨ä¸­ï¼Œè¯»å†™ä¸å†²çªå¾ˆé‡è¦ã€‚è¿™é‡Œä»…å®ç°ä¼ªMVCCæœºåˆ¶æ˜¯å› ä¸ºå¹¶æ²¡æœ‰å®ç°æ ¸å¿ƒçš„å¤šç‰ˆæœ¬å¹¶å­˜ï¼Œundo logä¸­çš„å†…å®¹æ˜¯ä¸²è¡ŒåŒ–çš„ç»“æœï¼Œè®°å½•äº†å¤šä¸ªäº‹åŠ¡çš„è¿‡ç¨‹ï¼Œä¸å±äºå¤šç‰ˆæœ¬å…±å­˜ã€‚</strong></p><h4 id="åŸç†ï¼š"><a href="#åŸç†ï¼š" class="headerlink" title="åŸç†ï¼š"></a>åŸç†ï¼š</h4><p>next-keyé”ï¼ˆrecordé”+gapé”ï¼‰</p><ul><li><p>recordé”ï¼šå¯¹å•ä¸ªè¡Œè®°å½•ä¸Šé”ï¼Œé”å®šä¸€ä¸ªè®°å½•ä¸Šçš„ç´¢å¼•ï¼Œè€Œä¸æ˜¯è®°å½•æœ¬èº«ã€‚</p></li><li><p>gapé”ï¼šgapè¡¨ç¤ºç´¢å¼•æ ‘ä¸­æ’å…¥æ–°çºªå½•çš„ç©ºéš™ï¼Œgapé”å³é”å®šä¸€ä¸ªèŒƒå›´ä½†ä¸åŒ…æ‹¬è®°å½•æœ¬èº«ï¼Œæ˜¯ä¸ºäº†æ–¹å¼åŒä¸€äº‹ç‰©çš„ä¸¤æ¬¡å½“å‰è¯»å‡ºç°å¹»è¯»çš„æƒ…å†µ</p></li><li><p>next-keyé”ï¼šRecord Locks å’Œ Gap Locks çš„ç»“åˆï¼Œä¸ä»…é”å®šä¸€ä¸ªè®°å½•ä¸Šçš„ç´¢å¼•ï¼Œä¹Ÿé”å®šç´¢å¼•ä¹‹é—´çš„é—´éš™ã€‚ä¾‹å¦‚ä¸€ä¸ªç´¢å¼•åŒ…å«ä»¥ä¸‹å€¼ï¼š10, 11, 13, and 20ï¼Œé‚£ä¹ˆå°±éœ€è¦é”å®šä»¥ä¸‹åŒºé—´ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(-âˆ, 10],(10, 11],(11, 13],(13, 20],(20, +âˆ)</span><br></pre></td></tr></table></figure></li></ul><p>åœ¨RRåŠä»¥ä¸Šçº§åˆ«é»˜è®¤éƒ½æ”¯æŒgapé”ï¼ŒRCåŠä»¥ä¸‹çº§åˆ«éƒ½æ²¡æœ‰gapé”ã€‚</p><p>RRçº§åˆ«ä¸‹gapé”çš„ä½¿ç”¨åœºæ™¯ï¼Œå¯¹ä¸»é”®ç´¢å¼•æˆ–å”¯ä¸€ç´¢å¼•ä¼šä½¿ç”¨gapé”å—ï¼Ÿ</p><ul><li>å¦‚æœwhereæ¡ä»¶å…¨éƒ¨å‘½ä¸­ï¼Œå°±ä¸ä¼šç”¨gapé”ï¼Œåªä¼šåŠ è®°å½•é”ï¼ˆè¡Œé”ï¼‰</li><li>å¦‚æœwhereæ¡ä»¶éƒ¨åˆ†å‘½ä¸­æˆ–è€…æœªå‘½ä¸­ï¼Œå°±ä¼šåŠ ä¸Šgapé”</li></ul><p>gapé”ä¼šå‡ºç°åœ¨éå”¯ä¸€ç´¢å¼•æˆ–è€…ä¸èµ°ç´¢å¼•çš„å½“å‰è¯»ä¸­</p><p>éå”¯ä¸€ç´¢å¼•ï¼š</p><p><img src="/2019/11/24/DataBase/1566268250911.png" alt="1566268250911"></p><p>gapä¼šåœ¨ï¼ˆ6ï¼Œ9]ï¼Œï¼ˆ9ï¼Œ11] è¿™ä¸¤ä¸ªåŒºé—´åŠ ä¸Šgapé”ï¼Œé˜²æ­¢å¹»è¯»ã€‚</p><p>ä¸èµ°ç´¢å¼•</p><p><img src="/2019/11/24/DataBase/1566268427287.png" alt="1566268427287"></p><p>ä¼šå¯¹æ‰€æœ‰gapä¸Šé”ï¼Œç±»ä¼¼è¡¨é”ï¼Œä¹Ÿèƒ½é˜²æ­¢å¹»è¯»ã€‚</p><p>InnoDBåœ¨RRçº§åˆ«ä¸»è¦é€šè¿‡å¼•å…¥next-keyé”æ¥é¿å…å¹»è¯»é—®é¢˜ï¼Œnext-keyç”±è¡Œé”å’Œgapé”ï¼Œgapé”ä¼šç”¨åœ¨éå”¯ä¸€ç´¢å¼•æˆ–è€…ä¸èµ°ç´¢å¼•çš„å½“å‰è¯»ä»¥åŠä»…å‘½ä¸­æ£€ç´¢æ¡ä»¶çš„éƒ¨åˆ†ç»“æœé›†å¹¶ä¸”ç”¨åˆ°ä¸»é”®ç´¢å¼•ä»¥åŠå”¯ä¸€ç´¢å¼•çš„å½“å‰è¯»ä¸­ã€‚</p><h2 id="SQLä¼˜åŒ–"><a href="#SQLä¼˜åŒ–" class="headerlink" title="SQLä¼˜åŒ–"></a>SQLä¼˜åŒ–</h2><p><strong>åœ¨æˆ‘ä»¬ä¹¦å†™SQLè¯­å¥çš„æ—¶å€™ï¼Œå…¶å®ä¹¦å†™çš„é¡ºåºã€ç­–ç•¥ä¼šå½±å“åˆ°SQLçš„æ€§èƒ½ï¼Œè™½ç„¶å®ç°çš„åŠŸèƒ½æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯å®ƒä»¬çš„æ€§èƒ½ä¼šæœ‰äº›è®¸å·®åˆ«ã€‚</strong></p><p>å› æ­¤ï¼Œä¸‹é¢å°±è®²è§£åœ¨ä¹¦å†™SQLçš„æ—¶å€™ï¼Œæ€ä¹ˆå†™æ¯”è¾ƒå¥½ã€‚</p><hr><h3 id="é€‰æ‹©æœ€æœ‰æ•ˆç‡çš„è¡¨åé¡ºåº"><a href="#é€‰æ‹©æœ€æœ‰æ•ˆç‡çš„è¡¨åé¡ºåº" class="headerlink" title="é€‰æ‹©æœ€æœ‰æ•ˆç‡çš„è¡¨åé¡ºåº"></a>é€‰æ‹©æœ€æœ‰æ•ˆç‡çš„è¡¨åé¡ºåº</h3><p>æ•°æ®åº“çš„è§£æå™¨æŒ‰ç…§<strong>ä»å³åˆ°å·¦çš„é¡ºåºå¤„ç†FROMå­å¥ä¸­çš„è¡¨åï¼ŒFROMå­å¥ä¸­å†™åœ¨æœ€åçš„è¡¨å°†è¢«æœ€å…ˆå¤„ç†</strong></p><p>åœ¨FROMå­å¥ä¸­åŒ…å«å¤šä¸ªè¡¨çš„æƒ…å†µä¸‹ï¼š</p><ul><li><strong>å¦‚æœä¸‰ä¸ªè¡¨æ˜¯å®Œå…¨æ— å…³ç³»çš„è¯ï¼Œå°†è®°å½•å’Œåˆ—åæœ€å°‘çš„è¡¨ï¼Œå†™åœ¨æœ€åï¼Œç„¶åä¾æ¬¡ç±»æ¨</strong></li><li><strong>ä¹Ÿå°±æ˜¯è¯´ï¼šé€‰æ‹©è®°å½•æ¡æ•°æœ€å°‘çš„è¡¨æ”¾åœ¨æœ€å</strong></li></ul><p>å¦‚æœæœ‰3ä¸ªä»¥ä¸Šçš„è¡¨è¿æ¥æŸ¥è¯¢ï¼š</p><ul><li><strong>å¦‚æœä¸‰ä¸ªè¡¨æ˜¯æœ‰å…³ç³»çš„è¯ï¼Œå°†å¼•ç”¨æœ€å¤šçš„è¡¨ï¼Œæ”¾åœ¨æœ€åï¼Œç„¶åä¾æ¬¡ç±»æ¨</strong>ã€‚</li><li><strong>ä¹Ÿå°±æ˜¯è¯´ï¼šè¢«å…¶ä»–è¡¨æ‰€å¼•ç”¨çš„è¡¨æ”¾åœ¨æœ€å</strong></li></ul><p>ä¾‹å¦‚ï¼šæŸ¥è¯¢å‘˜å·¥çš„ç¼–å·ï¼Œå§“åï¼Œå·¥èµ„ï¼Œå·¥èµ„ç­‰çº§ï¼Œéƒ¨é—¨å</p><p><strong>empè¡¨è¢«å¼•ç”¨å¾—æœ€å¤šï¼Œè®°å½•æ•°ä¹Ÿæ˜¯æœ€å¤šï¼Œå› æ­¤æ”¾åœ¨formå­—å¥çš„æœ€åé¢</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> emp.empno,emp.ename,emp.sal,salgrade.grade,dept.dname</span><br><span class="line"><span class="keyword">from</span> salgrade,dept,emp</span><br><span class="line"><span class="keyword">where</span> (emp.deptno = dept.deptno) <span class="keyword">and</span> (emp.sal <span class="keyword">between</span> salgrade.losal <span class="keyword">and</span> salgrade.hisal)</span><br></pre></td></tr></table></figure><hr><h3 id="WHEREå­å¥ä¸­çš„è¿æ¥é¡ºåº"><a href="#WHEREå­å¥ä¸­çš„è¿æ¥é¡ºåº" class="headerlink" title="WHEREå­å¥ä¸­çš„è¿æ¥é¡ºåº"></a>WHEREå­å¥ä¸­çš„è¿æ¥é¡ºåº</h3><p>æ•°æ®åº“é‡‡ç”¨è‡ª<strong>å³è€Œå·¦çš„é¡ºåºè§£æWHEREå­å¥</strong>,æ ¹æ®è¿™ä¸ªåŸç†,<strong>è¡¨ä¹‹é—´çš„è¿æ¥å¿…é¡»å†™åœ¨å…¶ä»–WHEREæ¡ä»¶ä¹‹å·¦</strong>,é‚£äº›<strong>å¯ä»¥è¿‡æ»¤æ‰æœ€å¤§æ•°é‡è®°å½•çš„æ¡ä»¶å¿…é¡»å†™åœ¨WHEREå­å¥çš„ä¹‹å³</strong>ã€‚</p><p><strong>emp.salå¯ä»¥è¿‡æ»¤å¤šæ¡è®°å½•ï¼Œå†™åœ¨WHEREå­—å¥çš„æœ€å³è¾¹</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> emp.empno,emp.ename,emp.sal,dept.dname</span><br><span class="line"><span class="keyword">from</span> dept,emp</span><br><span class="line"><span class="keyword">where</span> (emp.deptno = dept.deptno) <span class="keyword">and</span> (emp.sal &gt; <span class="number">1500</span>)</span><br></pre></td></tr></table></figure><hr><h3 id="SELECTå­å¥ä¸­é¿å…ä½¿ç”¨-å·"><a href="#SELECTå­å¥ä¸­é¿å…ä½¿ç”¨-å·" class="headerlink" title="SELECTå­å¥ä¸­é¿å…ä½¿ç”¨*å·"></a>SELECTå­å¥ä¸­é¿å…ä½¿ç”¨*å·</h3><p>æˆ‘ä»¬å½“æ—¶å­¦ä¹ çš„æ—¶å€™ï¼Œæ˜Ÿå·æ˜¯å¯ä»¥è·å–è¡¨ä¸­å…¨éƒ¨çš„å­—æ®µæ•°æ®çš„ã€‚</p><ul><li><strong>ä½†æ˜¯å®ƒè¦é€šè¿‡æŸ¥è¯¢æ•°æ®å­—å…¸å®Œæˆçš„ï¼Œè¿™æ„å‘³ç€å°†è€—è´¹æ›´å¤šçš„æ—¶é—´</strong></li><li>ä½¿ç”¨*å·å†™å‡ºæ¥çš„SQLè¯­å¥ä¹Ÿä¸å¤Ÿç›´è§‚ã€‚</li></ul><hr><h3 id="ç”¨TRUNCATEæ›¿ä»£DELETE"><a href="#ç”¨TRUNCATEæ›¿ä»£DELETE" class="headerlink" title="ç”¨TRUNCATEæ›¿ä»£DELETE"></a>ç”¨TRUNCATEæ›¿ä»£DELETE</h3><p>è¿™é‡Œä»…ä»…æ˜¯ï¼š<strong>åˆ é™¤è¡¨çš„å…¨éƒ¨è®°å½•ï¼Œé™¤äº†è¡¨ç»“æ„æ‰è¿™æ ·åš</strong>ã€‚</p><p><strong>DELETEæ˜¯ä¸€æ¡ä¸€æ¡è®°å½•çš„åˆ é™¤ï¼Œè€ŒTruncateæ˜¯å°†æ•´ä¸ªè¡¨åˆ é™¤ï¼Œä¿ç•™è¡¨ç»“æ„ï¼Œè¿™æ ·æ¯”DELETEå¿«</strong></p><hr><h3 id="å¤šä½¿ç”¨å†…éƒ¨å‡½æ•°æé«˜SQLæ•ˆç‡"><a href="#å¤šä½¿ç”¨å†…éƒ¨å‡½æ•°æé«˜SQLæ•ˆç‡" class="headerlink" title="å¤šä½¿ç”¨å†…éƒ¨å‡½æ•°æé«˜SQLæ•ˆç‡"></a>å¤šä½¿ç”¨å†…éƒ¨å‡½æ•°æé«˜SQLæ•ˆç‡</h3><p><strong>ä¾‹å¦‚ä½¿ç”¨mysqlçš„concat()å‡½æ•°ä¼šæ¯”ä½¿ç”¨||æ¥è¿›è¡Œæ‹¼æ¥å¿«ï¼Œå› ä¸ºconcat()å‡½æ•°å·²ç»è¢«mysqlä¼˜åŒ–è¿‡äº†ã€‚</strong></p><hr><h3 id="ä½¿ç”¨è¡¨æˆ–åˆ—çš„åˆ«å"><a href="#ä½¿ç”¨è¡¨æˆ–åˆ—çš„åˆ«å" class="headerlink" title="ä½¿ç”¨è¡¨æˆ–åˆ—çš„åˆ«å"></a>ä½¿ç”¨è¡¨æˆ–åˆ—çš„åˆ«å</h3><p><strong>å¦‚æœè¡¨æˆ–åˆ—çš„åç§°å¤ªé•¿äº†ï¼Œä½¿ç”¨ä¸€äº›ç®€çŸ­çš„åˆ«åä¹Ÿèƒ½ç¨å¾®æé«˜ä¸€äº›SQLçš„æ€§èƒ½ã€‚æ¯•ç«Ÿè¦æ‰«æçš„å­—ç¬¦é•¿åº¦å°±å˜å°‘äº†ã€‚ã€‚ã€‚</strong></p><hr><h3 id="å¤šä½¿ç”¨commit"><a href="#å¤šä½¿ç”¨commit" class="headerlink" title="å¤šä½¿ç”¨commit"></a>å¤šä½¿ç”¨commit</h3><p>comiitä¼šé‡Šæ”¾å›æ»šç‚¹â€¦</p><hr><h3 id="å–„ç”¨ç´¢å¼•"><a href="#å–„ç”¨ç´¢å¼•" class="headerlink" title="å–„ç”¨ç´¢å¼•"></a>å–„ç”¨ç´¢å¼•</h3><p>ç´¢å¼•å°±æ˜¯ä¸ºäº†æé«˜æˆ‘ä»¬çš„æŸ¥è¯¢æ•°æ®çš„ï¼Œå½“è¡¨çš„è®°å½•é‡éå¸¸å¤§çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ç´¢å¼•äº†ã€‚</p><hr><h3 id="SQLå†™å¤§å†™"><a href="#SQLå†™å¤§å†™" class="headerlink" title="SQLå†™å¤§å†™"></a>SQLå†™å¤§å†™</h3><p>æˆ‘ä»¬åœ¨ç¼–å†™SQL çš„æ—¶å€™ï¼Œå®˜æ–¹æ¨èçš„æ˜¯ä½¿ç”¨å¤§å†™æ¥å†™å…³é”®å­—ï¼Œ<strong>å› ä¸ºOracleæœåŠ¡å™¨æ€»æ˜¯å…ˆå°†å°å†™å­—æ¯è½¬æˆå¤§å†™åï¼Œæ‰æ‰§è¡Œ</strong></p><hr><h3 id="é¿å…åœ¨ç´¢å¼•åˆ—ä¸Šä½¿ç”¨NOT"><a href="#é¿å…åœ¨ç´¢å¼•åˆ—ä¸Šä½¿ç”¨NOT" class="headerlink" title="é¿å…åœ¨ç´¢å¼•åˆ—ä¸Šä½¿ç”¨NOT"></a>é¿å…åœ¨ç´¢å¼•åˆ—ä¸Šä½¿ç”¨NOT</h3><p>å› ä¸ºOracleæœåŠ¡å™¨é‡åˆ°NOTåï¼Œä»–å°±ä¼šåœæ­¢ç›®å‰çš„å·¥ä½œï¼Œè½¬è€Œæ‰§è¡Œå…¨è¡¨æ‰«æ</p><h4 id="é¿å…åœ¨ç´¢å¼•åˆ—ä¸Šä½¿ç”¨è®¡ç®—"><a href="#é¿å…åœ¨ç´¢å¼•åˆ—ä¸Šä½¿ç”¨è®¡ç®—" class="headerlink" title="é¿å…åœ¨ç´¢å¼•åˆ—ä¸Šä½¿ç”¨è®¡ç®—"></a>é¿å…åœ¨ç´¢å¼•åˆ—ä¸Šä½¿ç”¨è®¡ç®—</h4><p>WHEREå­å¥ä¸­ï¼Œ<strong>å¦‚æœç´¢å¼•åˆ—æ˜¯å‡½æ•°çš„ä¸€éƒ¨åˆ†ï¼Œä¼˜åŒ–å™¨å°†ä¸ä½¿ç”¨ç´¢å¼•è€Œä½¿ç”¨å…¨è¡¨æ‰«æï¼Œè¿™æ ·ä¼šå˜å¾—å˜æ…¢</strong></p><h4 id="ç”¨-gt-æ›¿ä»£-gt"><a href="#ç”¨-gt-æ›¿ä»£-gt" class="headerlink" title="ç”¨ &gt;= æ›¿ä»£ &gt;"></a>ç”¨ <code>&gt;=</code> æ›¿ä»£ <code>&gt;</code></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ä½æ•ˆï¼š</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> EMP <span class="keyword">WHERE</span> DEPTNO &gt; <span class="number">3</span>   </span><br><span class="line">é¦–å…ˆå®šä½åˆ°DEPTNO=<span class="number">3</span>çš„è®°å½•å¹¶ä¸”æ‰«æåˆ°ç¬¬ä¸€ä¸ªDEPTå¤§äº<span class="number">3</span>çš„è®°å½•</span><br><span class="line">é«˜æ•ˆï¼š</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> EMP <span class="keyword">WHERE</span> DEPTNO &gt;= <span class="number">4</span>  </span><br><span class="line">ç›´æ¥è·³åˆ°ç¬¬ä¸€ä¸ªDEPTç­‰äº<span class="number">4</span>çš„è®°å½•</span><br></pre></td></tr></table></figure><h4 id="ç”¨INæ›¿ä»£OR"><a href="#ç”¨INæ›¿ä»£OR" class="headerlink" title="ç”¨INæ›¿ä»£OR"></a>ç”¨INæ›¿ä»£OR</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> emp <span class="keyword">where</span> sal = <span class="number">1500</span> <span class="keyword">or</span> sal = <span class="number">3000</span> <span class="keyword">or</span> sal = <span class="number">800</span>;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> emp <span class="keyword">where</span> sal <span class="keyword">in</span> (<span class="number">1500</span>,<span class="number">3000</span>,<span class="number">800</span>);</span><br></pre></td></tr></table></figure><h4 id="æ€»æ˜¯ä½¿ç”¨ç´¢å¼•çš„ç¬¬ä¸€ä¸ªåˆ—"><a href="#æ€»æ˜¯ä½¿ç”¨ç´¢å¼•çš„ç¬¬ä¸€ä¸ªåˆ—" class="headerlink" title="æ€»æ˜¯ä½¿ç”¨ç´¢å¼•çš„ç¬¬ä¸€ä¸ªåˆ—"></a>æ€»æ˜¯ä½¿ç”¨ç´¢å¼•çš„ç¬¬ä¸€ä¸ªåˆ—</h4><p>å¦‚æœç´¢å¼•æ˜¯å»ºç«‹åœ¨å¤šä¸ªåˆ—ä¸Šï¼Œåªæœ‰åœ¨å®ƒçš„ç¬¬ä¸€ä¸ªåˆ—è¢«WHEREå­å¥å¼•ç”¨æ—¶ï¼Œä¼˜åŒ–å™¨æ‰ä¼šé€‰æ‹©ä½¿ç”¨è¯¥ç´¢å¼•ã€‚ å½“åªå¼•ç”¨ç´¢å¼•çš„ç¬¬äºŒä¸ªåˆ—æ—¶ï¼Œä¸å¼•ç”¨ç´¢å¼•çš„ç¬¬ä¸€ä¸ªåˆ—æ—¶ï¼Œä¼˜åŒ–å™¨ä½¿ç”¨äº†å…¨è¡¨æ‰«æè€Œå¿½ç•¥äº†ç´¢å¼•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">index</span> emp_sal_job_idex</span><br><span class="line"><span class="keyword">on</span> emp(sal,job);</span><br><span class="line"><span class="comment">----------------------------------</span></span><br><span class="line"><span class="keyword">select</span> *</span><br><span class="line"><span class="keyword">from</span> emp  </span><br><span class="line"><span class="keyword">where</span> job != <span class="string">'SALES'</span>;    </span><br><span class="line"></span><br><span class="line">ä¸Šè¾¹å°±ä¸ä½¿ç”¨ç´¢å¼•äº†ã€‚</span><br></pre></td></tr></table></figure><h3 id="æ•°æ®åº“ç»“æ„ä¼˜åŒ–"><a href="#æ•°æ®åº“ç»“æ„ä¼˜åŒ–" class="headerlink" title="æ•°æ®åº“ç»“æ„ä¼˜åŒ–"></a>æ•°æ®åº“ç»“æ„ä¼˜åŒ–</h3><ul><li>1ï¼‰èŒƒå¼ä¼˜åŒ–ï¼š æ¯”å¦‚æ¶ˆé™¤å†—ä½™ï¼ˆèŠ‚çœç©ºé—´ã€‚ã€‚ï¼‰</li><li>2ï¼‰åèŒƒå¼ä¼˜åŒ–ï¼šæ¯”å¦‚é€‚å½“åŠ å†—ä½™ç­‰ï¼ˆå‡å°‘joinï¼‰</li><li>3ï¼‰æ‹†åˆ†è¡¨ï¼š å‚ç›´æ‹†åˆ†å’Œæ°´å¹³æ‹†åˆ†</li></ul><h3 id="æœåŠ¡å™¨ç¡¬ä»¶ä¼˜åŒ–"><a href="#æœåŠ¡å™¨ç¡¬ä»¶ä¼˜åŒ–" class="headerlink" title="æœåŠ¡å™¨ç¡¬ä»¶ä¼˜åŒ–"></a>æœåŠ¡å™¨ç¡¬ä»¶ä¼˜åŒ–</h3><p>money</p><h2 id="å…¶ä»–çŸ¥è¯†ç‚¹"><a href="#å…¶ä»–çŸ¥è¯†ç‚¹" class="headerlink" title="å…¶ä»–çŸ¥è¯†ç‚¹"></a>å…¶ä»–çŸ¥è¯†ç‚¹</h2><h3 id="èŒƒå¼"><a href="#èŒƒå¼" class="headerlink" title="èŒƒå¼"></a>èŒƒå¼</h3><blockquote><p>ç¬¬ä¸€èŒƒå¼ï¼ˆ1NFï¼‰ï¼šæ•°æ®åº“è¡¨ä¸­çš„å­—æ®µéƒ½æ˜¯å•ä¸€å±æ€§çš„ï¼Œä¸å¯å†åˆ†ã€‚è¿™ä¸ªå•ä¸€å±æ€§ç”±åŸºæœ¬ç±»å‹æ„æˆï¼ŒåŒ…æ‹¬æ•´å‹ã€å®æ•°ã€å­—ç¬¦å‹ã€é€»è¾‘å‹ã€æ—¥æœŸå‹ç­‰ã€‚<br>ç¬¬äºŒèŒƒå¼ï¼ˆ2NFï¼‰ï¼šæ•°æ®åº“è¡¨ä¸­ä¸å­˜åœ¨éå…³é”®å­—æ®µå¯¹ä»»ä¸€å€™é€‰å…³é”®å­—æ®µçš„éƒ¨åˆ†å‡½æ•°ä¾èµ–ï¼ˆéƒ¨åˆ†å‡½æ•°ä¾èµ–æŒ‡çš„æ˜¯å­˜åœ¨ç»„åˆå…³é”®å­—ä¸­çš„æŸäº›å­—æ®µå†³å®šéå…³é”®å­—æ®µçš„æƒ…å†µï¼‰ï¼Œä¹Ÿå³æ‰€æœ‰éå…³é”®å­—æ®µéƒ½å®Œå…¨ä¾èµ–äºä»»æ„ä¸€ç»„å€™é€‰å…³é”®å­—ã€‚<br>ç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰ï¼šåœ¨ç¬¬äºŒèŒƒå¼çš„åŸºç¡€ä¸Šï¼Œæ•°æ®è¡¨ä¸­å¦‚æœä¸å­˜åœ¨éå…³é”®å­—æ®µå¯¹ä»»ä¸€å€™é€‰å…³é”®å­—æ®µçš„ä¼ é€’å‡½æ•°ä¾èµ–åˆ™ç¬¦åˆç¬¬ä¸‰èŒƒå¼ã€‚æ‰€è°“ä¼ é€’å‡½æ•°ä¾èµ–ï¼ŒæŒ‡çš„æ˜¯å¦‚æœå­˜åœ¨â€A â†’ B â†’ Câ€çš„å†³å®šå…³ç³»ï¼Œåˆ™Cä¼ é€’å‡½æ•°ä¾èµ–äºAã€‚å› æ­¤ï¼Œæ»¡è¶³ç¬¬ä¸‰èŒƒå¼çš„æ•°æ®åº“è¡¨åº”è¯¥ä¸å­˜åœ¨å¦‚ä¸‹ä¾èµ–å…³ç³»ï¼š å…³é”®å­—æ®µ â†’ éå…³é”®å­—æ®µx â†’ éå…³é”®å­—æ®µy</p></blockquote><p>æ€»ç»“ä¸€ä¸‹ï¼š</p><ul><li>é¦–å…ˆè¦æ˜ç¡®çš„æ˜¯ï¼šèŒƒå¼ä¸€åˆ°ä¸‰æ˜¯è¶Šæ¥è¶Šä¸¥æ ¼çš„ã€‚<strong>æ»¡è¶³ç€ç¬¬ä¸‰èŒƒå¼ï¼Œé‚£ä¹ˆå°±ä¸€å®šæ»¡è¶³ç¬¬äºŒèŒƒå¼ã€æ»¡è¶³ç€ç¬¬äºŒèŒƒå¼å°±ä¸€å®šæ»¡è¶³ç¬¬ä¸€èŒƒå¼</strong></li><li>ç¬¬ä¸€èŒƒå¼ï¼š<strong>å­—æ®µæ˜¯æœ€å°çš„çš„å•å…ƒä¸å¯å†åˆ†</strong><ul><li>å­¦ç”Ÿä¿¡æ¯ç»„æˆå­¦ç”Ÿä¿¡æ¯è¡¨ï¼Œæœ‰å¹´é¾„ã€æ€§åˆ«ã€å­¦å·ç­‰ä¿¡æ¯ç»„æˆã€‚è¿™äº›å­—æ®µéƒ½ä¸å¯å†åˆ†ï¼Œæ‰€ä»¥å®ƒæ˜¯æ»¡è¶³ç¬¬ä¸€èŒƒå¼çš„</li></ul></li><li>ç¬¬äºŒèŒƒå¼ï¼šæ»¡è¶³ç¬¬ä¸€èŒƒå¼,<strong>è¡¨ä¸­çš„å­—æ®µå¿…é¡»å®Œå…¨ä¾èµ–äºå…¨éƒ¨ä¸»é”®è€Œééƒ¨åˆ†ä¸»é”®ã€‚</strong><ul><li><strong>å…¶ä»–å­—æ®µç»„æˆçš„è¿™è¡Œè®°å½•å’Œä¸»é”®è¡¨ç¤ºçš„æ˜¯åŒä¸€ä¸ªä¸œè¥¿ï¼Œè€Œä¸»é”®æ˜¯å”¯ä¸€çš„ï¼Œå®ƒä»¬åªéœ€è¦ä¾èµ–äºä¸»é”®ï¼Œä¹Ÿå°±æˆäº†å”¯ä¸€çš„</strong></li><li>å­¦å·ä¸º1024çš„åŒå­¦ï¼Œå§“åä¸ºJava3yï¼Œå¹´é¾„æ˜¯22å²ã€‚å§“åå’Œå¹´é¾„å­—æ®µéƒ½ä¾èµ–ç€å­¦å·ä¸»é”®ã€‚</li></ul></li><li>ç¬¬ä¸‰èŒƒå¼ï¼šæ»¡è¶³ç¬¬äºŒèŒƒå¼ï¼Œ<strong>éä¸»é”®å¤–çš„æ‰€æœ‰å­—æ®µå¿…é¡»äº’ä¸ä¾èµ–</strong><ul><li><strong>å°±æ˜¯æ•°æ®åªåœ¨ä¸€ä¸ªåœ°æ–¹å­˜å‚¨ï¼Œä¸é‡å¤å‡ºç°åœ¨å¤šå¼ è¡¨ä¸­ï¼Œå¯ä»¥è®¤ä¸ºå°±æ˜¯æ¶ˆé™¤ä¼ é€’ä¾èµ–</strong></li><li>æ¯”å¦‚ï¼Œæˆ‘ä»¬å¤§å­¦åˆ†äº†å¾ˆå¤šç³»ï¼ˆä¸­æ–‡ç³»ã€è‹±è¯­ç³»ã€è®¡ç®—æœºç³»â€¦â€¦ï¼‰ï¼Œè¿™ä¸ªç³»åˆ«ç®¡ç†è¡¨ä¿¡æ¯æœ‰ä»¥ä¸‹å­—æ®µç»„æˆï¼šç³»ç¼–å·ï¼Œç³»ä¸»ä»»ï¼Œç³»ç®€ä»‹ï¼Œç³»æ¶æ„ã€‚é‚£æˆ‘ä»¬èƒ½ä¸èƒ½åœ¨å­¦ç”Ÿä¿¡æ¯è¡¨æ·»åŠ ç³»ç¼–å·ï¼Œç³»ä¸»ä»»ï¼Œç³»ç®€ä»‹ï¼Œç³»æ¶æ„å­—æ®µå‘¢ï¼Ÿä¸è¡Œçš„ï¼Œå› ä¸ºè¿™æ ·å°±å†—ä½™äº†ï¼Œéä¸»é”®å¤–çš„å­—æ®µå½¢æˆäº†ä¾èµ–å…³ç³»(ä¾èµ–åˆ°å­¦ç”Ÿä¿¡æ¯è¡¨äº†)ï¼æ­£ç¡®çš„åšæ³•æ˜¯ï¼šå­¦ç”Ÿè¡¨å°±åªèƒ½å¢åŠ ä¸€ä¸ªç³»ç¼–å·å­—æ®µã€‚</li></ul></li></ul><h3 id="è§†å›¾"><a href="#è§†å›¾" class="headerlink" title="è§†å›¾"></a>è§†å›¾</h3><p>è§†å›¾æ˜¯ä¸€ç§åŸºäºæ•°æ®è¡¨çš„ä¸€ç§<strong>è™šè¡¨</strong></p><ul><li>ï¼ˆ1ï¼‰è§†å›¾æ˜¯ä¸€ç§è™šè¡¨</li><li>ï¼ˆ2ï¼‰è§†å›¾å»ºç«‹åœ¨å·²æœ‰è¡¨çš„åŸºç¡€ä¸Š, è§†å›¾èµ–ä»¥å»ºç«‹çš„è¿™äº›è¡¨ç§°ä¸ºåŸºè¡¨</li><li>ï¼ˆ3ï¼‰<strong>å‘è§†å›¾æä¾›æ•°æ®å†…å®¹çš„è¯­å¥ä¸º SELECT è¯­å¥,å¯ä»¥å°†è§†å›¾ç†è§£ä¸ºå­˜å‚¨èµ·æ¥çš„ SELECT è¯­å¥</strong></li><li>ï¼ˆ4ï¼‰è§†å›¾å‘ç”¨æˆ·æä¾›åŸºè¡¨æ•°æ®çš„å¦ä¸€ç§è¡¨ç°å½¢å¼</li><li>ï¼ˆ5ï¼‰è§†å›¾æ²¡æœ‰å­˜å‚¨çœŸæ­£çš„æ•°æ®ï¼ŒçœŸæ­£çš„æ•°æ®è¿˜æ˜¯å­˜å‚¨åœ¨åŸºè¡¨ä¸­</li><li>ï¼ˆ6ï¼‰ç¨‹åºå‘˜è™½ç„¶æ“ä½œçš„æ˜¯è§†å›¾ï¼Œä½†æœ€ç»ˆè§†å›¾è¿˜ä¼šè½¬æˆæ“ä½œåŸºè¡¨</li><li>ï¼ˆ7ï¼‰ä¸€ä¸ªåŸºè¡¨å¯ä»¥æœ‰0ä¸ªæˆ–å¤šä¸ªè§†å›¾</li></ul><p>æœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½åªå…³ç³»ä¸€å¼ æ•°æ®è¡¨ä¸­çš„æŸäº›å­—æ®µï¼Œè€Œå¦å¤–çš„ä¸€äº›äººåªå…³ç³»åŒä¸€å¼ æ•°æ®è¡¨çš„æŸäº›å­—æ®µâ€¦</p><p>é‚£ä¹ˆæŠŠå…¨éƒ¨çš„å­—æ®µéƒ½éƒ½æ˜¾ç¤ºç»™ä»–ä»¬çœ‹ï¼Œè¿™æ˜¯ä¸åˆç†çš„ã€‚</p><p>æˆ‘ä»¬åº”è¯¥åšåˆ°ï¼š<strong>ä»–ä»¬æƒ³çœ‹åˆ°ä»€ä¹ˆæ ·çš„æ•°æ®ï¼Œæˆ‘ä»¬å°±ç»™ä»–ä»¬ä»€ä¹ˆæ ·çš„æ•°æ®â€¦ä¸€æ–¹é¢å°±èƒ½å¤Ÿè®©ä»–ä»¬åªå…³æ³¨è‡ªå·±çš„æ•°æ®ï¼Œå¦ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬ä¹Ÿä¿è¯æ•°æ®è¡¨ä¸€äº›ä¿å¯†çš„æ•°æ®ä¸ä¼šæ³„éœ²å‡ºæ¥â€¦</strong></p><p><strong>è§†å›¾å¯ä»¥å°†æŸ¥è¯¢å‡ºæ¥çš„æ•°æ®è¿›è¡Œå°è£…ã€‚ã€‚ã€‚é‚£ä¹ˆæˆ‘ä»¬åœ¨ä½¿ç”¨çš„æ—¶å€™å°±ä¼šå˜å¾—éå¸¸æ–¹ä¾¿</strong>â€¦</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> myview <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">Concat</span>(col1, col2) <span class="keyword">AS</span> concat_col, col3*col4 <span class="keyword">AS</span> compute_col</span><br><span class="line"><span class="keyword">FROM</span> mytable</span><br><span class="line"><span class="keyword">WHERE</span> col5 = val;</span><br></pre></td></tr></table></figure><h3 id="E-Rå›¾"><a href="#E-Rå›¾" class="headerlink" title="E-Rå›¾"></a>E-Rå›¾</h3><p>Entity-Relationshipï¼Œæœ‰ä¸‰ä¸ªç»„æˆéƒ¨åˆ†ï¼šå®ä½“ã€å±æ€§ã€è”ç³»ã€‚</p><p>ç”¨æ¥è¿›è¡Œå…³ç³»å‹æ•°æ®åº“ç³»ç»Ÿçš„æ¦‚å¿µè®¾è®¡ã€‚</p><h4 id="å®ä½“çš„ä¸‰ç§è”ç³»"><a href="#å®ä½“çš„ä¸‰ç§è”ç³»" class="headerlink" title="å®ä½“çš„ä¸‰ç§è”ç³»"></a>å®ä½“çš„ä¸‰ç§è”ç³»</h4><p>åŒ…å«ä¸€å¯¹ä¸€ï¼Œä¸€å¯¹å¤šï¼Œå¤šå¯¹å¤šä¸‰ç§ã€‚</p><ul><li>å¦‚æœ A åˆ° B æ˜¯ä¸€å¯¹å¤šå…³ç³»ï¼Œé‚£ä¹ˆç”»ä¸ªå¸¦ç®­å¤´çš„çº¿æ®µæŒ‡å‘ Bï¼›</li><li>å¦‚æœæ˜¯ä¸€å¯¹ä¸€ï¼Œç”»ä¸¤ä¸ªå¸¦ç®­å¤´çš„çº¿æ®µï¼›</li><li>å¦‚æœæ˜¯å¤šå¯¹å¤šï¼Œç”»ä¸¤ä¸ªä¸å¸¦ç®­å¤´çš„çº¿æ®µã€‚</li></ul><p>ä¸‹å›¾çš„ Course å’Œ Student æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ã€‚</p><p><img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/1d28ad05-39e5-49a2-a6a1-a6f496adba6a.png" alt="img"></p><h4 id="è¡¨ç¤ºå‡ºç°å¤šæ¬¡çš„å…³ç³»"><a href="#è¡¨ç¤ºå‡ºç°å¤šæ¬¡çš„å…³ç³»" class="headerlink" title="è¡¨ç¤ºå‡ºç°å¤šæ¬¡çš„å…³ç³»"></a>è¡¨ç¤ºå‡ºç°å¤šæ¬¡çš„å…³ç³»</h4><p>ä¸€ä¸ªå®ä½“åœ¨è”ç³»å‡ºç°å‡ æ¬¡ï¼Œå°±è¦ç”¨å‡ æ¡çº¿è¿æ¥ã€‚</p><p>ä¸‹å›¾è¡¨ç¤ºä¸€ä¸ªè¯¾ç¨‹çš„å…ˆä¿®å…³ç³»ï¼Œå…ˆä¿®å…³ç³»å‡ºç°ä¸¤ä¸ª Course å®ä½“ï¼Œç¬¬ä¸€ä¸ªæ˜¯å…ˆä¿®è¯¾ç¨‹ï¼Œåä¸€ä¸ªæ˜¯åä¿®è¯¾ç¨‹ï¼Œå› æ­¤éœ€è¦ç”¨ä¸¤æ¡çº¿æ¥è¡¨ç¤ºè¿™ç§å…³ç³»ã€‚</p><p><img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/ac929ea3-daca-40ec-9e95-4b2fa6678243.png" alt="img"></p><h4 id="è”ç³»çš„å¤šå‘æ€§"><a href="#è”ç³»çš„å¤šå‘æ€§" class="headerlink" title="è”ç³»çš„å¤šå‘æ€§"></a>è”ç³»çš„å¤šå‘æ€§</h4><p>è™½ç„¶è€å¸ˆå¯ä»¥å¼€è®¾å¤šé—¨è¯¾ï¼Œå¹¶ä¸”å¯ä»¥æ•™æˆå¤šåå­¦ç”Ÿï¼Œä½†æ˜¯å¯¹äºç‰¹å®šçš„å­¦ç”Ÿå’Œè¯¾ç¨‹ï¼Œåªæœ‰ä¸€ä¸ªè€å¸ˆæ•™æˆï¼Œè¿™å°±æ„æˆäº†ä¸€ä¸ªä¸‰å…ƒè”ç³»ã€‚</p><p><img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/5bb1b38a-527e-4802-a385-267dadbd30ba.png" alt="img"></p><h4 id="è¡¨ç¤ºå­ç±»"><a href="#è¡¨ç¤ºå­ç±»" class="headerlink" title="è¡¨ç¤ºå­ç±»"></a>è¡¨ç¤ºå­ç±»</h4><p>ç”¨ä¸€ä¸ªä¸‰è§’å½¢å’Œä¸¤æ¡çº¿æ¥è¿æ¥ç±»å’Œå­ç±»ï¼Œä¸å­ç±»æœ‰å…³çš„å±æ€§å’Œè”ç³»éƒ½è¿åˆ°å­ç±»ä¸Šï¼Œè€Œä¸çˆ¶ç±»å’Œå­ç±»éƒ½æœ‰å…³çš„è¿åˆ°çˆ¶ç±»ä¸Šã€‚</p><p><img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/14389ea4-8d96-4e96-9f76-564ca3324c1e.png" alt="img"></p><h2 id="QA"><a href="#QA" class="headerlink" title="QA"></a>QA</h2><h3 id="MySQLè¡¨è®¾è®¡è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ"><a href="#MySQLè¡¨è®¾è®¡è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ" class="headerlink" title="MySQLè¡¨è®¾è®¡è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ"></a>MySQLè¡¨è®¾è®¡è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ</h3><h4 id="ä¸»é”®æ˜¯ç”¨è‡ªå¢è¿˜æ˜¯UUID"><a href="#ä¸»é”®æ˜¯ç”¨è‡ªå¢è¿˜æ˜¯UUID" class="headerlink" title="ä¸»é”®æ˜¯ç”¨è‡ªå¢è¿˜æ˜¯UUID?"></a>ä¸»é”®æ˜¯ç”¨è‡ªå¢è¿˜æ˜¯UUID?</h4><p>è‚¯å®šç­”è‡ªå¢å•Šã€‚innodb ä¸­çš„ä¸»é”®æ˜¯èšç°‡ç´¢å¼•ã€‚å¦‚æœä¸»é”®æ˜¯è‡ªå¢çš„ï¼Œé‚£ä¹ˆæ¯æ¬¡æ’å…¥æ–°çš„è®°å½•ï¼Œè®°å½•å°±ä¼šé¡ºåºæ·»åŠ åˆ°å½“å‰ç´¢å¼•èŠ‚ç‚¹çš„åç»­ä½ç½®ï¼Œå½“ä¸€é¡µå†™æ»¡ï¼Œå°±ä¼šè‡ªåŠ¨å¼€è¾Ÿä¸€ä¸ªæ–°çš„é¡µã€‚å¦‚æœä¸æ˜¯è‡ªå¢ä¸»é”®ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šåœ¨ä¸­é—´æ’å…¥ï¼Œå°±ä¼šå¼•å‘é¡µçš„åˆ†è£‚ï¼Œäº§ç”Ÿå¾ˆå¤šè¡¨ç¢ç‰‡ï¼ã€‚</p><h4 id="ä¸»é”®ä¸ºä»€ä¹ˆä¸æ¨èæœ‰ä¸šåŠ¡å«ä¹‰"><a href="#ä¸»é”®ä¸ºä»€ä¹ˆä¸æ¨èæœ‰ä¸šåŠ¡å«ä¹‰" class="headerlink" title="ä¸»é”®ä¸ºä»€ä¹ˆä¸æ¨èæœ‰ä¸šåŠ¡å«ä¹‰?"></a>ä¸»é”®ä¸ºä»€ä¹ˆä¸æ¨èæœ‰ä¸šåŠ¡å«ä¹‰?</h4><p>æœ‰å¦‚ä¸‹ä¸¤ä¸ªåŸå› </p><ul><li>å› ä¸ºä»»ä½•æœ‰ä¸šåŠ¡å«ä¹‰çš„åˆ—éƒ½æœ‰æ”¹å˜çš„å¯èƒ½æ€§,ä¸»é”®ä¸€æ—¦å¸¦ä¸Šäº†ä¸šåŠ¡å«ä¹‰ï¼Œé‚£ä¹ˆä¸»é”®å°±æœ‰å¯èƒ½å‘ç”Ÿå˜æ›´ã€‚ä¸»é”®ä¸€æ—¦å‘ç”Ÿå˜æ›´ï¼Œè¯¥æ•°æ®åœ¨ç£ç›˜ä¸Šçš„å­˜å‚¨ä½ç½®å°±ä¼šå‘ç”Ÿå˜æ›´ï¼Œæœ‰å¯èƒ½ä¼šå¼•å‘é¡µåˆ†è£‚ï¼Œäº§ç”Ÿç©ºé—´ç¢ç‰‡ã€‚</li><li>å¸¦æœ‰ä¸šåŠ¡å«ä¹‰çš„ä¸»é”®ï¼Œä¸ä¸€å®šæ˜¯é¡ºåºè‡ªå¢çš„ã€‚é‚£ä¹ˆå°±ä¼šå¯¼è‡´æ•°æ®çš„æ’å…¥é¡ºåºï¼Œå¹¶ä¸èƒ½ä¿è¯åé¢æ’å…¥æ•°æ®çš„ä¸»é”®ä¸€å®šæ¯”å‰é¢çš„æ•°æ®å¤§ã€‚å¦‚æœå‡ºç°äº†ï¼Œåé¢æ’å…¥æ•°æ®çš„ä¸»é”®æ¯”å‰é¢çš„å°ï¼Œå°±æœ‰å¯èƒ½å¼•å‘é¡µåˆ†è£‚ï¼Œäº§ç”Ÿç©ºé—´ç¢ç‰‡ã€‚</li></ul><h4 id="æ—¶é—´å­—æ®µç”¨ä»€ä¹ˆç±»å‹"><a href="#æ—¶é—´å­—æ®µç”¨ä»€ä¹ˆç±»å‹" class="headerlink" title="æ—¶é—´å­—æ®µç”¨ä»€ä¹ˆç±»å‹?"></a>æ—¶é—´å­—æ®µç”¨ä»€ä¹ˆç±»å‹?</h4><p>(1)<code>varchar</code>ï¼Œå¦‚æœç”¨varcharç±»å‹æ¥å­˜æ—¶é—´ï¼Œä¼˜ç‚¹åœ¨äºæ˜¾ç¤ºç›´è§‚ã€‚ä½†æ˜¯å‘çš„åœ°æ–¹ä¹Ÿæ˜¯æŒºå¤šçš„ã€‚æ¯”å¦‚ï¼Œæ’å…¥çš„æ•°æ®æ²¡æœ‰æ ¡éªŒï¼Œä½ å¯èƒ½æŸå¤©å°±å‘ç°ä¸€æ¡æ•°æ®ä¸º<code>2013111</code>çš„æ•°æ®ï¼Œè¯·é—®è¿™æ˜¯ä»£è¡¨2013å¹´1æœˆ11æ—¥ï¼Œè¿˜æ˜¯2013å¹´11æœˆ1æ—¥ï¼Ÿ<br>å…¶æ¬¡ï¼Œåšæ—¶é—´æ¯”è¾ƒè¿ç®—ï¼Œä½ éœ€è¦ç”¨<code>STR_TO_DATE</code>ç­‰å‡½æ•°å°†å…¶è½¬åŒ–ä¸ºæ—¶é—´ç±»å‹ï¼Œä½ ä¼šå‘ç°è¿™ä¹ˆå†™æ˜¯æ— æ³•å‘½ä¸­ç´¢å¼•çš„ã€‚æ•°æ®é‡ä¸€å¤§ï¼Œæ˜¯ä¸ªå‘ï¼</p><p>(2)<code>timestamp</code>ï¼Œè¯¥ç±»å‹æ˜¯å››ä¸ªå­—èŠ‚çš„æ•´æ•°ï¼Œå®ƒèƒ½è¡¨ç¤ºçš„æ—¶é—´èŒƒå›´ä¸º1970-01-01 08:00:01åˆ°2038-01-19 11:14:07ã€‚2038å¹´ä»¥åçš„æ—¶é—´ï¼Œæ˜¯æ— æ³•ç”¨<code>timestamp</code>ç±»å‹å­˜å‚¨çš„ã€‚<br>ä½†æ˜¯å®ƒæœ‰ä¸€ä¸ªä¼˜åŠ¿ï¼Œ<code>timestamp</code>ç±»å‹æ˜¯å¸¦æœ‰æ—¶åŒºä¿¡æ¯çš„ã€‚ä¸€æ—¦ä½ ç³»ç»Ÿä¸­çš„æ—¶åŒºå‘ç”Ÿæ”¹å˜ï¼Œä¾‹å¦‚ä½ ä¿®æ”¹äº†æ—¶åŒº</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">TIME_ZONE</span> = <span class="string">"america/new_york"</span>;</span><br></pre></td></tr></table></figure><p>ä½ ä¼šå‘ç°ï¼Œé¡¹ç›®ä¸­çš„è¯¥å­—æ®µçš„å€¼è‡ªå·±ä¼šå‘ç”Ÿå˜æ›´ã€‚è¿™ä¸ªç‰¹æ€§ç”¨æ¥åšä¸€äº›å›½é™…åŒ–å¤§é¡¹ç›®ï¼Œè·¨æ—¶åŒºçš„åº”ç”¨æ—¶ï¼Œç‰¹åˆ«æ³¨æ„ï¼</p><p>(3)<code>datetime</code>ï¼Œdatetimeå‚¨å­˜å ç”¨8ä¸ªå­—èŠ‚ï¼Œå®ƒå­˜å‚¨çš„æ—¶é—´èŒƒå›´ä¸º1000-01-01 00:00:00 ~ 9999-12-31 23:59:59ã€‚æ˜¾ç„¶ï¼Œå­˜å‚¨æ—¶é—´èŒƒå›´æ›´å¤§ã€‚ä½†æ˜¯å®ƒå‘çš„åœ°æ–¹åœ¨äºï¼Œä»–å­˜å‚¨çš„æ˜¯æ—¶é—´ç»å¯¹å€¼ï¼Œä¸å¸¦æœ‰æ—¶åŒºä¿¡æ¯ã€‚å¦‚æœä½ æ”¹å˜æ•°æ®åº“çš„æ—¶åŒºï¼Œè¯¥é¡¹çš„å€¼ä¸ä¼šè‡ªå·±å‘ç”Ÿå˜æ›´ï¼</p><p>(4)<code>bigint</code>ï¼Œä¹Ÿæ˜¯8ä¸ªå­—èŠ‚ï¼Œè‡ªå·±ç»´æŠ¤ä¸€ä¸ªæ—¶é—´æˆ³ï¼Œè¡¨ç¤ºèŒƒå›´æ¯”<code>timestamp</code>å¤§å¤šäº†ï¼Œå°±æ˜¯è¦è‡ªå·±ç»´æŠ¤ï¼Œä¸å¤§æ–¹ä¾¿ã€‚</p><h4 id="ä¸ºä»€ä¹ˆä¸ç›´æ¥å­˜å‚¨å›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘ç­‰å¤§å®¹é‡å†…å®¹"><a href="#ä¸ºä»€ä¹ˆä¸ç›´æ¥å­˜å‚¨å›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘ç­‰å¤§å®¹é‡å†…å®¹" class="headerlink" title="ä¸ºä»€ä¹ˆä¸ç›´æ¥å­˜å‚¨å›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘ç­‰å¤§å®¹é‡å†…å®¹?"></a>ä¸ºä»€ä¹ˆä¸ç›´æ¥å­˜å‚¨å›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘ç­‰å¤§å®¹é‡å†…å®¹?</h4><p>æˆ‘ä»¬åœ¨å®é™…åº”ç”¨ä¸­ï¼Œéƒ½æ˜¯ç”¨<code>HDFS</code>æ¥å­˜å‚¨æ–‡ä»¶ã€‚ç„¶åmysqlä¸­ï¼Œåªå­˜æ–‡ä»¶çš„å­˜æ”¾è·¯å¾„ã€‚mysqlä¸­æœ‰ä¸¤ä¸ªå­—æ®µç±»å‹è¢«ç”¨æ¥è®¾è®¡å­˜æ”¾å¤§å®¹é‡æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯<code>text</code>å’Œ<code>blob</code>ç±»å‹ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬åœ¨ç”Ÿäº§ä¸­ï¼ŒåŸºæœ¬ä¸ç”¨è¿™ä¸¤ä¸ªç±»å‹ï¼<br>ä¸»è¦åŸå› æœ‰å¦‚ä¸‹ä¸¤ç‚¹</p><ul><li>(1)Mysqlå†…å­˜ä¸´æ—¶è¡¨ä¸æ”¯æŒTEXTã€BLOBè¿™æ ·çš„å¤§æ•°æ®ç±»å‹ï¼Œå¦‚æœæŸ¥è¯¢ä¸­åŒ…å«è¿™æ ·çš„æ•°æ®ï¼Œåœ¨æ’åºç­‰æ“ä½œæ—¶ï¼Œå°±ä¸èƒ½ä½¿ç”¨å†…å­˜ä¸´æ—¶è¡¨ï¼Œå¿…é¡»ä½¿ç”¨ç£ç›˜ä¸´æ—¶è¡¨è¿›è¡Œã€‚å¯¼è‡´æŸ¥è¯¢æ•ˆç‡ç¼“æ…¢</li><li>(2)<code>binlog</code>å†…å®¹å¤ªå¤šã€‚å› ä¸ºä½ æ•°æ®å†…å®¹æ¯”è¾ƒå¤§ï¼Œå°±ä¼šé€ æˆ<code>binlog</code>å†…å®¹æ¯”è¾ƒå¤šã€‚å¤§å®¶ä¹ŸçŸ¥é“ï¼Œä¸»ä»åŒæ­¥æ˜¯é <code>binlog</code>è¿›è¡ŒåŒæ­¥ï¼Œ<code>binlog</code>å¤ªå¤§äº†ï¼Œå°±ä¼šå¯¼è‡´ä¸»ä»åŒæ­¥æ•ˆç‡é—®é¢˜ï¼</li></ul><p>å› æ­¤ï¼Œä¸æ¨èä½¿ç”¨<code>text</code>å’Œ<code>blob</code>ç±»å‹ï¼</p><h4 id="å­—æ®µä¸ºä»€ä¹ˆè¦å®šä¹‰ä¸ºNOT-NULL"><a href="#å­—æ®µä¸ºä»€ä¹ˆè¦å®šä¹‰ä¸ºNOT-NULL" class="headerlink" title="å­—æ®µä¸ºä»€ä¹ˆè¦å®šä¹‰ä¸ºNOT NULL?"></a>å­—æ®µä¸ºä»€ä¹ˆè¦å®šä¹‰ä¸ºNOT NULL?</h4><p>(1)ç´¢å¼•æ€§èƒ½ä¸å¥½</p><blockquote><p>Mysqléš¾ä»¥ä¼˜åŒ–å¼•ç”¨å¯ç©ºåˆ—æŸ¥è¯¢ï¼Œå®ƒä¼šä½¿ç´¢å¼•ã€ç´¢å¼•ç»Ÿè®¡å’Œå€¼æ›´åŠ å¤æ‚ã€‚å¯ç©ºåˆ—éœ€è¦æ›´å¤šçš„å­˜å‚¨ç©ºé—´ï¼Œè¿˜éœ€è¦mysqlå†…éƒ¨è¿›è¡Œç‰¹æ®Šå¤„ç†ã€‚å¯ç©ºåˆ—è¢«ç´¢å¼•åï¼Œæ¯æ¡è®°å½•éƒ½éœ€è¦ä¸€ä¸ªé¢å¤–çš„å­—èŠ‚ï¼Œè¿˜èƒ½å¯¼è‡´MYisam ä¸­å›ºå®šå¤§å°çš„ç´¢å¼•å˜æˆå¯å˜å¤§å°çš„ç´¢å¼•ã€‚                                                                              </p></blockquote><p>(2)æŸ¥è¯¢ä¼šå‡ºç°ä¸€äº›ä¸å¯é¢„æ–™çš„ç»“æœ<br>è¿™é‡Œä¸¾ä¸€ä¸ªä¾‹å­ï¼Œå¤§å®¶å°±æ‡‚äº†ã€‚å‡è®¾ï¼Œè¡¨ç»“æ„å¦‚ä¸‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> table_2 (</span><br><span class="line">    <span class="string">`id`</span> <span class="built_in">INT</span> (<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>)</span><br></pre></td></tr></table></figure><p>è¡¨æ•°æ®æ˜¯è¿™æ ·çš„</p><table><thead><tr><th align="center">id</th><th align="center">name</th></tr></thead><tbody><tr><td align="center">1</td><td align="center">å­¤ç‹¬çƒŸ</td></tr><tr><td align="center">3</td><td align="center">null</td></tr><tr><td align="center">5</td><td align="center">è‚¥æœ</td></tr><tr><td align="center">7</td><td align="center">null</td></tr></tbody></table><p>ä½ æ‰§è¡Œè¯­å¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(<span class="keyword">name</span>) <span class="keyword">from</span> table_2;</span><br></pre></td></tr></table></figure><p>ä½ ä¼šå‘ç°ç»“æœä¸º2ï¼Œä½†æ˜¯å®é™…ä¸Šæ˜¯æœ‰å››æ¡æ•°æ®çš„ï¼ç±»ä¼¼çš„æŸ¥è¯¢é—®é¢˜ï¼Œå…¶å®æœ‰å¾ˆå¤šï¼Œä¸ä¸€ä¸€åˆ—ä¸¾ã€‚<br>è®°ä½ï¼Œå› ä¸ºnullåˆ—çš„å­˜åœ¨ï¼Œä¼šå‡ºç°å¾ˆå¤šå‡ºäººæ„æ–™çš„ç»“æœï¼Œä»è€Œæµªè´¹å¼€å‘æ—¶é—´å»æ’æŸ¥Bug.</p><h3 id="ç´¢å¼•çš„ç‰¹ç‚¹"><a href="#ç´¢å¼•çš„ç‰¹ç‚¹" class="headerlink" title="ç´¢å¼•çš„ç‰¹ç‚¹"></a>ç´¢å¼•çš„ç‰¹ç‚¹</h3><ul><li><strong>æ˜¯ä¸€ç§å¿«é€ŸæŸ¥è¯¢è¡¨ä¸­å†…å®¹çš„æœºåˆ¶ï¼Œ</strong></li><li><strong>è¿ç”¨åœ¨è¡¨ä¸­æŸä¸ªäº›å­—æ®µä¸Šï¼Œä½†å­˜å‚¨æ—¶ï¼Œç‹¬ç«‹äºè¡¨ä¹‹å¤–</strong></li></ul><p>ç´¢å¼•çš„ç‰¹ç‚¹</p><ul><li>ç´¢å¼•ä¸€æ—¦å»ºç«‹, <strong>DBç®¡ç†ç³»ç»Ÿä¼šå¯¹å…¶è¿›è¡Œè‡ªåŠ¨ç»´æŠ¤</strong>, è€Œä¸”ç”±DBç®¡ç†ç³»ç»Ÿå†³å®šä½•æ—¶ä½¿ç”¨ç´¢å¼•</li><li>ç”¨æˆ·ä¸ç”¨åœ¨æŸ¥è¯¢è¯­å¥ä¸­æŒ‡å®šä½¿ç”¨å“ªä¸ªç´¢å¼•</li><li><strong>åœ¨å®šä¹‰primary keyæˆ–uniqueçº¦æŸåç³»ç»Ÿè‡ªåŠ¨åœ¨ç›¸åº”çš„åˆ—ä¸Šåˆ›å»ºç´¢å¼•</strong></li><li>ç”¨æˆ·ä¹Ÿèƒ½æŒ‰è‡ªå·±çš„éœ€æ±‚ï¼Œå¯¹æŒ‡å®šå•ä¸ªå­—æ®µæˆ–å¤šä¸ªå­—æ®µï¼Œæ·»åŠ ç´¢å¼•</li></ul><table><thead><tr><th align="center">ä»€ä¹ˆæ—¶å€™ã€è¦ã€‘åˆ›å»ºç´¢å¼•</th><th align="center">ä»€ä¹ˆæ—¶å€™ã€ä¸è¦ã€‘åˆ›å»ºç´¢å¼•</th></tr></thead><tbody><tr><td align="center">è¡¨ç»å¸¸è¿›è¡Œ SELECT æ“ä½œ</td><td align="center">è¡¨ç»å¸¸è¿›è¡Œ INSERT/UPDATE/DELETE æ“ä½œ</td></tr><tr><td align="center">è¡¨å¾ˆå¤§(è®°å½•è¶…å¤š)ï¼Œè®°å½•å†…å®¹åˆ†å¸ƒèŒƒå›´å¾ˆå¹¿</td><td align="center">è¡¨å¾ˆå°(è®°å½•è¶…å°‘)</td></tr><tr><td align="center">åˆ—åç»å¸¸åœ¨ WHERE å­å¥æˆ–è¿æ¥æ¡ä»¶ä¸­å‡ºç°</td><td align="center">åˆ—åä¸ç»å¸¸ä½œä¸ºè¿æ¥æ¡ä»¶æˆ–å‡ºç°åœ¨ WHERE å­å¥ä¸­</td></tr></tbody></table><p><strong>ç´¢å¼•ä¼˜ç¼ºç‚¹ï¼š</strong></p><ul><li>ç´¢å¼•åŠ å¿«æ•°æ®åº“çš„æ£€ç´¢é€Ÿåº¦</li><li>ç´¢å¼•é™ä½äº†æ’å…¥ã€åˆ é™¤ã€ä¿®æ”¹ç­‰ç»´æŠ¤ä»»åŠ¡çš„é€Ÿåº¦(è™½ç„¶ç´¢å¼•å¯ä»¥æé«˜æŸ¥è¯¢é€Ÿåº¦ï¼Œä½†æ˜¯å®ƒä»¬ä¹Ÿä¼šå¯¼è‡´æ•°æ®åº“ç³»ç»Ÿæ›´æ–°æ•°æ®çš„æ€§èƒ½ä¸‹é™ï¼Œ<strong>å› ä¸ºå¤§éƒ¨åˆ†æ•°æ®æ›´æ–°éœ€è¦åŒæ—¶æ›´æ–°ç´¢å¼•</strong>)</li><li>å”¯ä¸€ç´¢å¼•å¯ä»¥ç¡®ä¿æ¯ä¸€è¡Œæ•°æ®çš„å”¯ä¸€æ€§ï¼Œé€šè¿‡ä½¿ç”¨ç´¢å¼•ï¼Œå¯ä»¥åœ¨æŸ¥è¯¢çš„è¿‡ç¨‹ä¸­ä½¿ç”¨ä¼˜åŒ–éšè—å™¨ï¼Œæé«˜ç³»ç»Ÿçš„æ€§èƒ½</li><li>ç´¢å¼•éœ€è¦å ç‰©ç†å’Œæ•°æ®ç©ºé—´</li></ul><p>ç´¢å¼•åˆ†ç±»ï¼š</p><ul><li><strong>å”¯ä¸€ç´¢å¼•</strong>ï¼šå”¯ä¸€ç´¢å¼•ä¸å…è®¸ä¸¤è¡Œå…·æœ‰ç›¸åŒçš„ç´¢å¼•å€¼</li><li><strong>ä¸»é”®ç´¢å¼•</strong>ï¼šä¸ºè¡¨å®šä¹‰ä¸€ä¸ªä¸»é”®å°†è‡ªåŠ¨åˆ›å»ºä¸»é”®ç´¢å¼•ï¼Œä¸»é”®ç´¢å¼•æ˜¯å”¯ä¸€ç´¢å¼•çš„ç‰¹æ®Šç±»å‹ã€‚ä¸»é”®ç´¢å¼•è¦æ±‚ä¸»é”®ä¸­çš„æ¯ä¸ªå€¼æ˜¯å”¯ä¸€çš„ï¼Œå¹¶ä¸”ä¸èƒ½ä¸ºç©º</li><li><strong>èšé›†ç´¢å¼•</strong>(Clustered)ï¼šè¡¨ä¸­å„è¡Œçš„ç‰©ç†é¡ºåºä¸é”®å€¼çš„é€»è¾‘ï¼ˆç´¢å¼•ï¼‰é¡ºåºç›¸åŒï¼Œæ¯ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ª</li><li><strong>äºŒçº§ç´¢å¼•</strong>(Non-clustered)ï¼šäºŒçº§ç´¢å¼•æŒ‡å®šè¡¨çš„é€»è¾‘é¡ºåºã€‚æ•°æ®å­˜å‚¨åœ¨ä¸€ä¸ªä½ç½®ï¼Œç´¢å¼•å­˜å‚¨åœ¨å¦ä¸€ä¸ªä½ç½®ï¼Œç´¢å¼•ä¸­åŒ…å«æŒ‡å‘æ•°æ®å­˜å‚¨ä½ç½®çš„æŒ‡é’ˆã€‚</li></ul><h3 id="SQL-çº¦æŸæœ‰å“ªå‡ ç§ï¼Ÿ"><a href="#SQL-çº¦æŸæœ‰å“ªå‡ ç§ï¼Ÿ" class="headerlink" title="SQL çº¦æŸæœ‰å“ªå‡ ç§ï¼Ÿ"></a>SQL çº¦æŸæœ‰å“ªå‡ ç§ï¼Ÿ</h3><ul><li>NOT NULL: ç”¨äºæ§åˆ¶å­—æ®µçš„å†…å®¹ä¸€å®šä¸èƒ½ä¸ºç©ºï¼ˆNULLï¼‰ã€‚</li><li>UNIQUE: æ§ä»¶å­—æ®µå†…å®¹ä¸èƒ½é‡å¤ï¼Œä¸€ä¸ªè¡¨å…è®¸æœ‰å¤šä¸ª Unique çº¦æŸã€‚</li><li>PRIMARY KEY: ä¹Ÿæ˜¯ç”¨äºæ§ä»¶å­—æ®µå†…å®¹ä¸èƒ½é‡å¤ï¼Œä½†å®ƒåœ¨ä¸€ä¸ªè¡¨åªå…è®¸å‡ºç°ä¸€ä¸ªã€‚</li><li>FOREIGN KEY: ç”¨äºé¢„é˜²ç ´åè¡¨ä¹‹é—´è¿æ¥çš„åŠ¨ä½œï¼Œä¹Ÿèƒ½é˜²æ­¢éæ³•æ•°æ®æ’å…¥å¤–é”®åˆ—ï¼Œå› ä¸ºå®ƒå¿…é¡»æ˜¯å®ƒæŒ‡å‘çš„é‚£ä¸ªè¡¨ä¸­çš„å€¼ä¹‹ä¸€ã€‚</li><li>CHECK: ç”¨äºæ§åˆ¶å­—æ®µçš„å€¼èŒƒå›´ã€‚</li></ul><h3 id="ä¸€ä¸ª-SQL-æ‰§è¡Œçš„å¾ˆæ…¢ï¼Ÿ"><a href="#ä¸€ä¸ª-SQL-æ‰§è¡Œçš„å¾ˆæ…¢ï¼Ÿ" class="headerlink" title="ä¸€ä¸ª SQL æ‰§è¡Œçš„å¾ˆæ…¢ï¼Ÿ"></a>ä¸€ä¸ª SQL æ‰§è¡Œçš„å¾ˆæ…¢ï¼Ÿ</h3><p>1ã€å¤§å¤šæ•°æƒ…å†µä¸‹å¾ˆæ­£å¸¸ï¼Œå¶å°”å¾ˆæ…¢ï¼Œåˆ™æœ‰å¦‚ä¸‹åŸå› </p><p>(1)ã€æ•°æ®åº“åœ¨åˆ·æ–°è„é¡µï¼Œä¾‹å¦‚ redo log ï¼ˆ<strong>é‡åšæ—¥å¿—</strong>ï¼‰å†™æ»¡äº†éœ€è¦åŒæ­¥åˆ°ç£ç›˜ã€‚</p><p>(2)ã€æ‰§è¡Œçš„æ—¶å€™ï¼Œé‡åˆ°é”ï¼Œå¦‚è¡¨é”ã€è¡Œé”ã€‚</p><p>2ã€è¿™æ¡ SQL è¯­å¥ä¸€ç›´æ‰§è¡Œçš„å¾ˆæ…¢ï¼Œåˆ™æœ‰å¦‚ä¸‹åŸå› ã€‚</p><p>(1)ã€æ²¡æœ‰ç”¨ä¸Šç´¢å¼•ï¼šä¾‹å¦‚è¯¥å­—æ®µæ²¡æœ‰ç´¢å¼•ï¼›ç”±äºå¯¹å­—æ®µè¿›è¡Œè¿ç®—ã€å‡½æ•°æ“ä½œå¯¼è‡´æ— æ³•ç”¨ç´¢å¼•ã€‚</p><p>(2)ã€æ•°æ®åº“é€‰é”™äº†ç´¢å¼•ã€‚</p><h3 id="MySQL-åŸºç¡€æ¶æ„åˆ†æ"><a href="#MySQL-åŸºç¡€æ¶æ„åˆ†æ" class="headerlink" title="MySQL åŸºç¡€æ¶æ„åˆ†æ"></a>MySQL åŸºç¡€æ¶æ„åˆ†æ</h3><p>ç®€å•æ¥è¯´ MySQL ä¸»è¦åˆ†ä¸º Server å±‚å’Œå­˜å‚¨å¼•æ“å±‚ï¼š</p><p><strong>Server å±‚</strong>ï¼šä¸»è¦åŒ…æ‹¬è¿æ¥å™¨ã€æŸ¥è¯¢ç¼“å­˜ã€åˆ†æå™¨ã€ä¼˜åŒ–å™¨ã€æ‰§è¡Œå™¨ç­‰ï¼Œæ‰€æœ‰è·¨å­˜å‚¨å¼•æ“çš„åŠŸèƒ½éƒ½åœ¨è¿™ä¸€å±‚å®ç°ï¼Œæ¯”å¦‚å­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨ã€è§†å›¾ï¼Œå‡½æ•°ç­‰ï¼Œè¿˜æœ‰ä¸€ä¸ªé€šç”¨çš„æ—¥å¿—æ¨¡å— binglog æ—¥å¿—æ¨¡å—ã€‚</p><p><strong>å­˜å‚¨å¼•æ“</strong>ï¼š ä¸»è¦è´Ÿè´£æ•°æ®çš„å­˜å‚¨å’Œè¯»å–ï¼Œé‡‡ç”¨å¯ä»¥æ›¿æ¢çš„æ’ä»¶å¼æ¶æ„ï¼Œæ”¯æŒ InnoDBã€MyISAMã€Memory ç­‰å¤šä¸ªå­˜å‚¨å¼•æ“ï¼Œå…¶ä¸­ InnoDB å¼•æ“æœ‰è‡ªæœ‰çš„æ—¥å¿—æ¨¡å— redolog æ¨¡å—ã€‚<strong>ç°åœ¨æœ€å¸¸ç”¨çš„å­˜å‚¨å¼•æ“æ˜¯ InnoDBï¼Œå®ƒä» MySQL 5.5.5 ç‰ˆæœ¬å¼€å§‹å°±è¢«å½“åšé»˜è®¤å­˜å‚¨å¼•æ“äº†ã€‚</strong></p><h3 id="SQLè¯­å¥æ‰§è¡Œè¿‡ç¨‹åˆ†æ"><a href="#SQLè¯­å¥æ‰§è¡Œè¿‡ç¨‹åˆ†æ" class="headerlink" title="SQLè¯­å¥æ‰§è¡Œè¿‡ç¨‹åˆ†æ"></a>SQLè¯­å¥æ‰§è¡Œè¿‡ç¨‹åˆ†æ</h3><p>å¯¹äºæŸ¥è¯¢ç­‰è¿‡ç¨‹å¦‚ä¸‹ï¼šæƒé™æ ¡éªŒâ€”ã€‹æŸ¥è¯¢ç¼“å­˜â€”ã€‹åˆ†æå™¨â€”ã€‹ä¼˜åŒ–å™¨â€”ã€‹æƒé™æ ¡éªŒâ€”ã€‹æ‰§è¡Œå™¨â€”ã€‹å¼•æ“</p><p>å¯¹äºæ›´æ–°ç­‰è¯­å¥æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼šåˆ†æå™¨â€”-ã€‹æƒé™æ ¡éªŒâ€”-ã€‹æ‰§è¡Œå™¨â€”ã€‹å¼•æ“â€”redo log prepareâ€”ã€‹binlogï¼ˆå½’æ¡£æ—¥å¿—ï¼‰â€”ã€‹redo log commit</p><h3 id="å¸¸ç”¨çš„å­˜å‚¨å¼•æ“"><a href="#å¸¸ç”¨çš„å­˜å‚¨å¼•æ“" class="headerlink" title="å¸¸ç”¨çš„å­˜å‚¨å¼•æ“"></a>å¸¸ç”¨çš„å­˜å‚¨å¼•æ“</h3><ul><li><strong>Innodbå¼•æ“</strong>ï¼ŒInnodbå¼•æ“æä¾›äº†å¯¹æ•°æ®åº“ACIDäº‹åŠ¡çš„æ”¯æŒã€‚å¹¶ä¸”è¿˜æä¾›äº†è¡Œçº§é”å’Œå¤–é”®çš„çº¦æŸã€‚å®ƒçš„è®¾è®¡çš„ç›®æ ‡å°±æ˜¯å¤„ç†å¤§æ•°æ®å®¹é‡çš„æ•°æ®åº“ç³»ç»Ÿã€‚</li><li><strong>MyIASMå¼•æ“</strong>(åŸæœ¬Mysqlçš„é»˜è®¤å¼•æ“),ä¸æä¾›äº‹åŠ¡çš„æ”¯æŒï¼Œä¹Ÿä¸æ”¯æŒè¡Œçº§é”å’Œå¤–é”®ã€‚</li><li><strong>MEMORYå¼•æ“</strong>ï¼šæ‰€æœ‰çš„æ•°æ®éƒ½åœ¨å†…å­˜ä¸­ï¼Œæ•°æ®çš„å¤„ç†é€Ÿåº¦å¿«ï¼Œä½†æ˜¯å®‰å…¨æ€§ä¸é«˜ã€‚</li></ul><table><thead><tr><th align="center"></th><th align="center">Innodb</th><th align="center">MyIASM</th></tr></thead><tbody><tr><td align="center">äº‹åŠ¡</td><td align="center">âˆš</td><td align="center">Ã—</td></tr><tr><td align="center">å“ˆå¸Œç´¢å¼•</td><td align="center">âˆš</td><td align="center">Ã—</td></tr><tr><td align="center">å…¨æ–‡ç´¢å¼•</td><td align="center">Ã—</td><td align="center">âˆš</td></tr><tr><td align="center">å­˜å‚¨å®¹é‡</td><td align="center">64TB</td><td align="center">æ— ä¸Šé™</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> Interview Summary </category>
          
      </categories>
      
      
        <tags>
            
            <tag> data base </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ComputerNetworks</title>
      <link href="/2019/11/22/ComputerNetworks/"/>
      <url>/2019/11/22/ComputerNetworks/</url>
      
        <content type="html"><![CDATA[<p>å¼•è¨€</p><blockquote><ol><li>è®°å½•æ…•è¯¾ç½‘ã€Šå‰‘æŒ‡offerã€‹è¯¾ç¨‹ä¸­è®¡ç®—æœºç½‘ç»œéƒ¨åˆ†é¢è¯•çŸ¥è¯†</li><li>é¢è¯•é—®é¢˜è®°å½•ï¼Œæ¶‰åŠçš„è¾ƒå°‘</li></ol></blockquote><a id="more"></a><h2 id="è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„"><a href="#è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„" class="headerlink" title="è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„"></a>è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„</h2><p> <img src="/2019/11/22/ComputerNetworks/image-20191122201138746.png" alt="image-20191122201138746"> </p><h3 id="OSI"><a href="#OSI" class="headerlink" title="OSI"></a>OSI</h3><ul><li><p>ç‰©ç†å±‚ï¼šä¸¤å°ç‰©ç†æœºå™¨ä¹‹é—´ä¼ è¾“æ¯”ç‰¹æµï¼Œå®šä¹‰ç‰©ç†è®¾å¤‡çš„æ ‡å‡†ï¼Œç½‘å¡</p></li><li><p>æ•°æ®é“¾è·¯å±‚ï¼šåœ¨ä¼ è¾“æ¯”ç‰¹æµçš„è¿‡ç¨‹ä¼šäº§ç”Ÿå„ç§é”™è¯¯ï¼Œæ•°æ®é“¾è·¯å±‚åº”è¿è€Œç”Ÿï¼Œè¯¥å±‚å®šä¹‰äº†å¦‚ä½•æ ¼å¼åŒ–æ•°æ®ä»¥è¿›è¡Œä¼ è¾“ä»¥åŠæ§åˆ¶å¯¹ç‰©ç†ä»‹è´¨çš„è®¿é—®ï¼Œè¿˜æä¾›é”™è¯¯æ£€æµ‹å’Œçº æ­£ã€‚è¯¥å±‚å°†æ¯”ç‰¹æ•°æ®ç»„æˆå¸§ï¼Œäº¤æ¢æœºå·¥ä½œåœ¨è¯¥å±‚ï¼Œå¯¹å¸§è§£ç ï¼Œæ ¹æ®å¸§ä¸­çš„æ•°æ®å°†ä¿¡æ¯å‘é€åˆ°æ­£ç¡®çš„æ¥æ”¶æ–¹ã€‚</p></li></ul><blockquote><p>éšç€ç½‘ç»œèŠ‚ç‚¹çš„å¢åŠ ï¼Œç‚¹å¯¹ç‚¹é—´çš„é€šä¿¡æ˜¯éœ€è¦ç»è¿‡å¤šä¸ªèŠ‚ç‚¹çš„ï¼Œå¦‚ä½•æ‰¾åˆ°ç›®æ ‡èŠ‚ç‚¹ï¼Œå¦‚ä½•é€‰æ‹©æœ€ä½³è·¯å¾„æ˜¯é¦–è¦éœ€æ±‚ï¼Œæ­¤æ—¶äº§ç”Ÿç½‘ç»œå±‚</p></blockquote><ul><li>ç½‘ç»œå±‚ï¼šå…¶ä¸»è¦åŠŸèƒ½æ˜¯å°†ç½‘ç»œåœ°å€ç¿»è¯‘æˆå¯¹åº”çš„ç‰©ç†åœ°å€ï¼Œå¹¶å†³å®šå¦‚ä½•å°†æ•°æ®ä»å‘é€æ–¹è·¯ç”±åˆ°æ¥æ”¶æ–¹ã€‚å‘é€æ–¹ç»¼åˆè€ƒè™‘å‘é€ä¼˜å…ˆæƒã€ç½‘ç»œæ‹¥å¡ã€æœåŠ¡è´¨é‡ã€å¯é€‰è·¯ç”±çš„èŠ±è´¹å†³å®šä»ç½‘ç»œä¸­ä¸€ä¸ªèŠ‚ç‚¹Aåˆ°å¦ä¸€ä¸ªç½‘ç»œä¸­Bçš„æœ€ä½³è·¯å¾„ï¼Œç½‘ç»œå±‚å¤„ç†å¹¶æ™ºèƒ½æŒ‡å¯¼æ•°æ®ä¼ é€ï¼Œè·¯ç”±å™¨è¿æ¥ç½‘ç»œå„ç«¯ï¼Œæ‰€ä»¥è·¯ç”±å™¨å±äºç½‘ç»œå±‚ã€‚æ­¤å±‚çš„æ•°æ®ç§°ä¸ºæ•°æ®åŒ…ã€‚æœ¬å±‚å…³æ³¨TCP/IPåè®®ä¸­çš„IPåè®®ã€‚</li></ul><blockquote><p>éšç€ç½‘ç»œé€šä¿¡éœ€æ±‚çš„è¿›ä¸€æ­¥æ‰©å¤§ï¼Œé€šä¿¡è¿‡ç¨‹ä¸­éœ€è¦å‘é€å¤§é‡æ•°æ®ï¼Œå¯èƒ½éœ€è¦å¾ˆé•¿æ—¶é—´ï¼Œç½‘ç»œåœ¨é€šä¿¡è¿‡ç¨‹ä¼šä¸­æ–­å¤šæ¬¡ï¼Œæ­¤æ—¶ä¸ºäº†ä¿è¯ä¼ è¾“æ–‡ä»¶çš„å‡†ç¡®æ€§ï¼Œéœ€è¦å¯¹å‘å‡ºå»çš„æ•°æ®è¿›è¡Œåˆ‡åˆ†ï¼Œåˆ‡ä¸ºæ•°æ®æ®µã€‚å½“å‘ç”Ÿæ•°æ®æ®µç»œä¸¢å¤±ï¼Œå¤±åºç­‰æƒ…å†µæ—¶ï¼Œä¼ è¾“å±‚åº”è¿è€Œç”Ÿã€‚</p></blockquote><ul><li>ä¼ è¾“å±‚ï¼šè§£å†³ä¸»æœºé—´çš„æ•°æ®ä¼ è¾“ï¼Œå’Œä¼ è¾“è´¨é‡é—®é¢˜ã€‚è¯¥å±‚ä¼ è¾“åè®®è¿›è¡Œæµé‡æ§åˆ¶æˆ–æ˜¯åŸºäºæ¥æ”¶æ–¹å¯æ¥å—æ•°æ®çš„å¿«æ…¢ç¨‹åº¦è§„å®šé€‚å½“çš„å‘é€é€Ÿç‡ã€‚åŒæ—¶åˆ†å‰²æ•°æ®åŒ…ä»¥é€‚åº”åœ¨ç½‘ç»œä¸Šä¼ è¾“ï¼ˆä»¥å¤ªç½‘æ— æ³•æ¥å—å¤§äº1500å­—èŠ‚çš„æ•°æ®åŒ…ï¼‰ï¼Œåˆ†å‰²æ•°æ®ä¸ºæ•°æ®ç‰‡ï¼ŒåŒæ—¶åœ¨æ•°æ®ç‰‡ä¸Šç»™å®šåºå·ï¼Œä»¥ä¾¿æ¥å—æ—¶å¯æŒ‰åºæ’ç»„ã€‚éœ€è¦å…³æ³¨TCPå’ŒUDPåè®®ã€‚</li></ul><blockquote><p>ä¸ºäº†ä¸ç”¨ç”¨æˆ·çº§ä¸è¦æ¯æ¬¡è°ƒç”¨TCPæ‰“åŒ…æ•°æ®ï¼ŒIPåè®®å»å¯»æ‰¾è·¯ç”±ï¼Œç°åœ¨éœ€è¦è‡ªåŠ¨æ”¶å‘åŒ…ï¼Œè‡ªåŠ¨å¯»å€çš„åŠŸèƒ½ï¼Œä¼šè¯å±‚åº”è¿è€Œç”Ÿ</p></blockquote><ul><li>ä¼šè¯å±‚ï¼šä½œç”¨æ˜¯å»ºç«‹å’Œç®¡ç†åº”ç”¨ç¨‹åºä¹‹é—´çš„é€šä¿¡ã€‚è‡³æ­¤å¯ä»¥ä¿è¯ç”¨ç”¨ç¨‹åºèƒ½å¤Ÿè‡ªåŠ¨æ”¶å‘åŒ…å’Œå¯»å€ã€‚</li></ul><blockquote><p>è€ƒè™‘å„åº”ç”¨ç¨‹åºçš„ç¯å¢ƒä¸åŒï¼Œå¦‚windowå’ŒLinuxä¹‹é—´çš„å·®å¼‚ï¼Œéœ€è¦è¡¨ç¤ºå±‚æ¥æ¶ˆé™¤</p></blockquote><ul><li>è¡¨ç¤ºå±‚ï¼šè§£å†³ä¸åŒç³»ç»Ÿä¹‹é—´çš„é€šä¿¡è¯­æ³•çš„é—®é¢˜ï¼Œè¯¥å±‚æ•°æ®å°†æŒ‰ç…§ç½‘ç»œèƒ½å¤Ÿç†è§£çš„æ–¹å¼è¿›è¡Œæ ¼å¼åŒ–ã€‚æ­¤æ—¶å®Œæˆæ•°æ®è½¬åŒ–æˆç›¸åº”çš„å­—èŠ‚ã€‚</li></ul><blockquote><p>æ­¤æ—¶å‘é€æ–¹çŸ¥é“å‘é€çš„æ•°æ®æ˜¯ä»€ä¹ˆï¼Œè½¬æ¢æˆå­—èŠ‚æ•°æ®æœ‰å¤šé•¿ï¼Œä½†æ¥æ”¶æ–¹å¹¶ä¸çŸ¥é“ï¼Œä¸ºäº†å‘é€æ–¹å’Œæ¥æ”¶æ–¹èƒ½å¤Ÿç†è§£ä¼ è¾“å­—èŠ‚çš„å«ä¹‰ï¼Œåº”ç”¨å±‚ç½‘ç»œåè®®è¯ç”Ÿ</p></blockquote><ul><li>åº”ç”¨å±‚ï¼šåº”ç”¨å±‚ç½‘ç»œåè®®è§„å®šæ¶ˆæ¯å‘é€æ–¹å’Œæ¥æ”¶æ–¹å¿…é¡»ä½¿ç”¨ä¸€ä¸ªå›ºå®šé•¿åº¦çš„ä¸€ä¸ªæ¶ˆæ¯å¤´ï¼Œæ¶ˆæ¯å¤´å¿…é¡»æ˜¯å›ºå®šç»„æˆï¼Œè®°å½•å„ç§ä¿¡æ¯ä»¥æ–¹ä¾¿æ¥æ”¶æ–¹è§£æã€‚è¯¥å±‚æ—¨åœ¨è®©ä½ èƒ½å¤Ÿæ›´æ–¹ä¾¿çš„ä»ç½‘ç»œä¸­æ¥å—æ•°æ®ï¼Œæ²¡æœ‰è¯¥å±‚ä¹Ÿå¯ä»¥åœ¨ä¸¤å°ä¸»æœºé—´ä¼ é€’ï¼Œä½†æ˜¯æˆ‘ä»¬èƒ½äº†è§£çš„å°±æ˜¯ä¸€å †0101ç¼–ç çš„å­—èŠ‚æ•°ç»„ã€‚éœ€è¦å…³æ³¨TCP/IPåè®®ä¸­çš„HTTPåè®®ã€‚</li></ul><p>è¿™æ˜¯ä¸€ä¸ªæ¡†æ¶æ¥åè°ƒå’Œç»„ç»‡å„å±‚æ‰€æä¾›çš„æœåŠ¡ï¼Œä½†æ˜¯è¯¥æ¨¡å‹ä»…æ˜¯æ¦‚å¿µæ¨¡å‹ï¼Œæ¥åè°ƒè¿›ç¨‹é—´é€šä¿¡æ ‡å‡†çš„åˆ¶å®šã€‚å®é™…çš„å®ç°æ˜¯TCP/IPåè®®ã€‚</p><h3 id="äº”å±‚åè®®"><a href="#äº”å±‚åè®®" class="headerlink" title="äº”å±‚åè®®"></a>äº”å±‚åè®®</h3><ul><li><strong>åº”ç”¨å±‚</strong> ï¼šä¸ºç‰¹å®šåº”ç”¨ç¨‹åºæä¾›æ•°æ®ä¼ è¾“æœåŠ¡ï¼Œä¾‹å¦‚ HTTPã€DNS ç­‰ã€‚æ•°æ®å•ä½ä¸ºæŠ¥æ–‡ã€‚</li><li><strong>ä¼ è¾“å±‚</strong> ï¼šä¸ºè¿›ç¨‹æä¾›é€šç”¨æ•°æ®ä¼ è¾“æœåŠ¡ã€‚ç”±äºåº”ç”¨å±‚åè®®å¾ˆå¤šï¼Œå®šä¹‰é€šç”¨çš„ä¼ è¾“å±‚åè®®å°±å¯ä»¥æ”¯æŒä¸æ–­å¢å¤šçš„åº”ç”¨å±‚åè®®ã€‚è¿è¾“å±‚åŒ…æ‹¬ä¸¤ç§åè®®ï¼šä¼ è¾“æ§åˆ¶åè®® TCPï¼Œæä¾›é¢å‘è¿æ¥ã€å¯é çš„æ•°æ®ä¼ è¾“æœåŠ¡ï¼Œæ•°æ®å•ä½ä¸ºæŠ¥æ–‡æ®µï¼›ç”¨æˆ·æ•°æ®æŠ¥åè®® UDPï¼Œæä¾›æ— è¿æ¥ã€å°½æœ€å¤§åŠªåŠ›çš„æ•°æ®ä¼ è¾“æœåŠ¡ï¼Œæ•°æ®å•ä½ä¸ºç”¨æˆ·æ•°æ®æŠ¥ã€‚TCP ä¸»è¦æä¾›å®Œæ•´æ€§æœåŠ¡ï¼ŒUDP ä¸»è¦æä¾›åŠæ—¶æ€§æœåŠ¡ã€‚</li><li><strong>ç½‘ç»œå±‚</strong> ï¼šä¸ºä¸»æœºæä¾›æ•°æ®ä¼ è¾“æœåŠ¡ã€‚è€Œä¼ è¾“å±‚åè®®æ˜¯ä¸ºä¸»æœºä¸­çš„è¿›ç¨‹æä¾›æ•°æ®ä¼ è¾“æœåŠ¡ã€‚ç½‘ç»œå±‚æŠŠä¼ è¾“å±‚ä¼ é€’ä¸‹æ¥çš„æŠ¥æ–‡æ®µæˆ–è€…ç”¨æˆ·æ•°æ®æŠ¥å°è£…æˆåˆ†ç»„ã€‚</li><li><strong>æ•°æ®é“¾è·¯å±‚</strong> ï¼šç½‘ç»œå±‚é’ˆå¯¹çš„è¿˜æ˜¯ä¸»æœºä¹‹é—´çš„æ•°æ®ä¼ è¾“æœåŠ¡ï¼Œè€Œä¸»æœºä¹‹é—´å¯ä»¥æœ‰å¾ˆå¤šé“¾è·¯ï¼Œé“¾è·¯å±‚åè®®å°±æ˜¯ä¸ºåŒä¸€é“¾è·¯çš„ä¸»æœºæä¾›æ•°æ®ä¼ è¾“æœåŠ¡ã€‚æ•°æ®é“¾è·¯å±‚æŠŠç½‘ç»œå±‚ä¼ ä¸‹æ¥çš„åˆ†ç»„å°è£…æˆå¸§ã€‚</li><li><strong>ç‰©ç†å±‚</strong> ï¼šè€ƒè™‘çš„æ˜¯æ€æ ·åœ¨ä¼ è¾“åª’ä½“ä¸Šä¼ è¾“æ•°æ®æ¯”ç‰¹æµï¼Œè€Œä¸æ˜¯æŒ‡å…·ä½“çš„ä¼ è¾“åª’ä½“ã€‚ç‰©ç†å±‚çš„ä½œç”¨æ˜¯å°½å¯èƒ½å±è”½ä¼ è¾“åª’ä½“å’Œé€šä¿¡æ‰‹æ®µçš„å·®å¼‚ï¼Œä½¿æ•°æ®é“¾è·¯å±‚æ„Ÿè§‰ä¸åˆ°è¿™äº›å·®å¼‚ã€‚</li></ul><h3 id="TCP-IP"><a href="#TCP-IP" class="headerlink" title="TCP/IP"></a>TCP/IP</h3><p>å®ƒåªæœ‰å››å±‚ï¼Œç›¸å½“äºäº”å±‚åè®®ä¸­æ•°æ®é“¾è·¯å±‚å’Œç‰©ç†å±‚åˆå¹¶ä¸ºç½‘ç»œæ¥å£å±‚ã€‚</p><p>TCP/IP ä½“ç³»ç»“æ„ä¸ä¸¥æ ¼éµå¾ª OSI åˆ†å±‚æ¦‚å¿µï¼Œåº”ç”¨å±‚å¯èƒ½ä¼šç›´æ¥ä½¿ç”¨ IP å±‚æˆ–è€…ç½‘ç»œæ¥å£å±‚ã€‚</p><p> TCP/IP æ˜¯ Internetä¸Šçš„æ ‡å‡†é€šä¿¡åè®®é›†ï¼Œè¯¥åè®®é›†ç”±æ•°åä¸ªå…·æœ‰å±‚æ¬¡ç»“æ„çš„åè®®ç»„æˆï¼Œå…¶ä¸­ TCP å’Œ IP æ˜¯è¯¥åè®®é›†ä¸­çš„ä¸¤ä¸ªæœ€é‡è¦çš„æ ¸å¿ƒåè®®ã€‚TCP/IPåè®®æ—æŒ‰å±‚æ¬¡å¯åˆ†ä¸ºä»¥ä¸‹å››å±‚ï¼šåº”ç”¨å±‚ã€ä¼ è¾“å±‚ã€ç½‘ç»œå±‚å’Œç½‘ç»œæ¥å£å±‚ï¼Œå„å±‚å¯¹åº”çš„ PDU æ•°æ®å•å…ƒçš„åç§°å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ </p><p><img src="/2019/11/22/ComputerNetworks/image-20191122201724700.png" alt="image-20191122201724700"></p><h2 id="TCPçš„ä¸‰æ¬¡æ¡æ‰‹"><a href="#TCPçš„ä¸‰æ¬¡æ¡æ‰‹" class="headerlink" title="TCPçš„ä¸‰æ¬¡æ¡æ‰‹"></a>TCPçš„ä¸‰æ¬¡æ¡æ‰‹</h2><h3 id="ä¼ è¾“æ§åˆ¶åè®®-TCP-ç®€ä»‹"><a href="#ä¼ è¾“æ§åˆ¶åè®®-TCP-ç®€ä»‹" class="headerlink" title="ä¼ è¾“æ§åˆ¶åè®® TCP ç®€ä»‹"></a>ä¼ è¾“æ§åˆ¶åè®® TCP ç®€ä»‹</h3><ul><li>é¢å‘è¿æ¥çš„ã€å¯é çš„åŸºäºå­—èŠ‚æµçš„ä¼ è¾“å±‚é€šä¿¡åè®®</li><li>å°†åº”ç”¨å±‚çš„æ•°æ®æµåˆ†å‰²æˆæŠ¥æ–‡æ®µå¹¶å‘é€ç»™ç›®æ ‡èŠ‚ç‚¹çš„ TCP å±‚</li><li>æ•°æ®åŒ…éƒ½æ˜¯ç”±åºå·ï¼Œå¯¹æ–¹æ”¶åˆ°åˆ™å‘é€ ACK ç¡®è®¤ï¼Œæœªæ”¶åˆ°åˆ™é‡ä¼ </li><li>ä½¿ç”¨æ ¡éªŒå’Œæ¥æ£€éªŒæ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ˜¯å¦æœ‰è¯¯</li></ul><p>IPåè®®æ˜¯æ— è¿æ¥çš„åè®®ï¼Œä»–ä¸ä¼šå ç”¨ä¸¤ä¸ªæ­£åœ¨é€šä¿¡çš„è®¡ç®—æœºä¹‹é—´çš„é€šä¿¡çº¿è·¯ï¼Œè¿™æ ·IPå°±é™ä½äº†å¯¹ç½‘ç»œçº¿è·¯çš„éœ€æ±‚æ¯æ¡çº¿å¯ä»¥åŒæ—¶æ»¡è¶³è®¸å¤šä¸åŒè®¡ç®—æœºä¹‹é—´çš„é€šä¿¡éœ€è¦ã€‚é€šè¿‡IPåè®®ï¼Œæ¶ˆæ¯æˆ–è€…å…¶ä»–æ•°æ®ä¼šè¢«åˆ†å‰²ä¸ºè¾ƒå°çš„åŒ…ï¼Œå¹¶é€šè¿‡å› ç‰¹ç½‘åœ¨è®¡ç®—æœºä¹‹é—´ä¼ é€ï¼ŒIPè´Ÿè´£å°†æ¯ä¸ªåŒ…è·¯ç”±è‡³ä»–çš„ç›®çš„åœ°ï¼Œä½†æ˜¯IPåè®®æœªä½œä»»ä½•äº‹æ¥ç¡®è®¤æ•°æ®åŒ…æ˜¯å¦å®‰å…¨åˆ°è¾¾ï¼Œæ‰€ä»¥ä»–æ˜¯ä¸å¯é çš„ï¼Œéœ€è¦ä»–çš„ä¸Šå±‚åè®®æ¥æ§åˆ¶ã€‚ä¼ è¾“æ§åˆ¶åè®®TCPæ˜¯ä¼ è¾“å±‚çš„åè®®ã€‚ï¼ˆç®€ä»‹ï¼‰</p><h3 id="TCP-æŠ¥æ–‡å¤´"><a href="#TCP-æŠ¥æ–‡å¤´" class="headerlink" title="TCP æŠ¥æ–‡å¤´"></a>TCP æŠ¥æ–‡å¤´</h3><p><img src="/2019/11/22/ComputerNetworks/image-20191122204017097.png" alt="image-20191122204017097"></p><ul><li><strong>æºç«¯å£ã€ç›®çš„ç«¯å£</strong> ï¼šå„2ä¸ªå­—èŠ‚ï¼ŒTCP/UDPéƒ½æ˜¯ä¸åŒ…å«IPåœ°å€ä¿¡æ¯çš„ï¼Œä¸¤è€…å¤´éƒ¨éƒ½ä¼šæœ‰ç«¯å£å·ï¼Œè¿™æ˜¯åœ¨ä¼ è¾“å±‚èŒƒç•´çš„çŸ¥è¯†ã€‚ä¸¤ä¸ªè¿›ç¨‹åœ¨è®¡ç®—æœºå†…éƒ¨è¿›è¡Œé€šä¿¡å¯ä»¥æœ‰ï¼šç®¡é“ã€å†…å­˜å…±äº«ã€ä¿¡å·é‡å’Œæ¶ˆæ¯é˜Ÿåˆ—ç­‰æ–¹æ³•ã€‚å…¶ä¸­æœ€å”¯ä¸€è¦æ±‚æ˜¯å”¯ä¸€çš„è¡¨ç¤ºå¯¹æ–¹è¿›ç¨‹ï¼Œåœ¨æœ¬åœ°è¿›ç¨‹ä¸­å¯ä»¥ä½¿ç”¨PIDï¼Œä½†æ˜¯åœ¨ç½‘ç»œä¸­çš„ä¸åŒä¸»æœºä¸­ä½¿ç”¨ä¾¿å¤±æ•ˆäº†ï¼Œè§£å†³æ–¹å¼å°±æ˜¯åœ¨ä¼ è¾“å±‚ä¸­ä½¿ç”¨åè®®ç«¯å£å·ï¼Œå·²çŸ¥åœ¨ç½‘ç»œå±‚ä¸­IPå¯ä»¥å”¯ä¸€æ ‡è¯†ä¸€ä¸ªä¸»æœºï¼Œè€ŒTCPåè®®å’Œç«¯å£å·å¯ä»¥å”¯ä¸€æ ‡è¯†ä¸»æœºä¸­çš„ä¸€ä¸ªè¿›ç¨‹ï¼Œè¿™æ ·å¯ä»¥åˆ©ç”¨IPåœ°å€+åè®®+ç«¯å£å·è¿™æ ·çš„å”¯ä¸€æ ‡è¯†å»è¡¨ç¤ºç½‘ç»œä¸­çš„ä¸€ä¸ªè¿›ç¨‹ï¼Œè¿™ç§æ–¹å¼ä¹Ÿæˆä¸ºå¥—æ¥å­—ã€‚è¿™æ ·ï¼Œè™½ç„¶é€šä¿¡çš„é‡ç‚¹æ˜¯åº”ç”¨è¿›ç¨‹ï¼Œä½†æ˜¯æˆ‘ä»¬åªè¦æŠŠè¦ä¼ é€çš„æŠ¥æ–‡äº¤åˆ°ç›®çš„ä¸»æœºçš„æŸä¸€ä¸ªåˆé€‚ç«¯å£ä¸­ï¼Œå‰©ä¸‹çš„å·¥ä½œå°±ç”±TCPæ¥å®Œæˆäº†ã€‚</li><li><strong>seqåºå·</strong> ï¼šç”¨äºå¯¹å­—èŠ‚æµè¿›è¡Œç¼–å·ï¼Œä¾‹å¦‚åºå·ä¸º 301ï¼Œè¡¨ç¤ºç¬¬ä¸€ä¸ªå­—èŠ‚çš„ç¼–å·ä¸º 301ï¼Œå¦‚æœæºå¸¦çš„æ•°æ®é•¿åº¦ä¸º 100 å­—èŠ‚ï¼Œé‚£ä¹ˆä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µçš„åºå·åº”ä¸º 401ã€‚</li><li><strong>ackç¡®è®¤å·</strong> ï¼šè¡¨ç¤ºæœŸæœ›æ”¶åˆ°å¯¹æ–¹ä¸‹ä¸€ä¸ªæŠ¥æ–‡çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åºå·ã€‚ä¾‹å¦‚Bæ”¶åˆ°Aå‘é€çš„æŠ¥æ–‡seqåºå·æ˜¯301ï¼Œå…¨éƒ¨æ•°æ®æ˜¯200å­—èŠ‚ï¼ŒBæ­£ç¡®æ”¶åˆ°ä»Aå‘é€çš„åºå·åˆ°500ï¼ˆ301+200-1ï¼‰çš„æ•°æ®ï¼Œæ‰€ä»¥BæœŸæœ›æ”¶åˆ°çš„Açš„ä¸‹ä¸€ä¸ªæ•°æ®åºå·æ˜¯501ï¼Œäºæ˜¯ï¼ŒBåœ¨å‘é€ç»™Açš„ç¡®è®¤æŠ¥æ–‡ä¸­ï¼Œä¼šæŠŠackç¡®è®¤å·ç½®ä¸º501ã€‚</li><li><strong>æ•°æ®åç§»</strong> ï¼šæŒ‡çš„æ˜¯æ•°æ®éƒ¨åˆ†è·ç¦»æŠ¥æ–‡æ®µèµ·å§‹å¤„çš„åç§»é‡ï¼Œå®é™…ä¸ŠæŒ‡çš„æ˜¯é¦–éƒ¨çš„é•¿åº¦ã€‚</li><li>è¿æ¥æ ‡å¿—ï¼ˆTCP Flagsï¼‰ï¼šè¡¨ç¤ºæ§åˆ¶åŠŸèƒ½ï¼Œä¸‹é¢æ˜¯å¸¸è§çš„è¿æ¥æ ‡å¿—ã€‚<ul><li><strong>ç¡®è®¤ ACK</strong> ï¼šå½“ ACK=1 æ—¶ç¡®è®¤å·å­—æ®µæœ‰æ•ˆï¼Œå¦åˆ™æ— æ•ˆã€‚TCP è§„å®šï¼Œåœ¨è¿æ¥å»ºç«‹åæ‰€æœ‰ä¼ é€çš„æŠ¥æ–‡æ®µéƒ½å¿…é¡»æŠŠ ACK ç½® 1ã€‚</li><li><strong>åŒæ­¥ SYN</strong> ï¼šåœ¨è¿æ¥å»ºç«‹æ—¶ç”¨æ¥åŒæ­¥åºå·ã€‚å½“ SYN=a1ï¼ŒACK=0 æ—¶è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªè¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µã€‚è‹¥å¯¹æ–¹åŒæ„å»ºç«‹è¿æ¥ï¼Œåˆ™å“åº”æŠ¥æ–‡ä¸­ SYN=1ï¼ŒACK=1ã€‚</li><li><strong>ç»ˆæ­¢ FIN</strong> ï¼šç”¨æ¥é‡Šæ”¾ä¸€ä¸ªè¿æ¥ï¼Œå½“ FIN=1 æ—¶ï¼Œè¡¨ç¤ºæ­¤æŠ¥æ–‡æ®µçš„å‘é€æ–¹çš„æ•°æ®å·²å‘é€å®Œæ¯•ï¼Œå¹¶è¦æ±‚é‡Šæ”¾è¿æ¥ã€‚</li></ul></li><li><strong>çª—å£</strong> ï¼šæ»‘åŠ¨çª—å£å¤§å°ï¼Œå‘ŠçŸ¥å‘é€ç«¯æ¥æ”¶ç«¯çš„ç¼“å­˜å¤§å°ï¼ˆè¿˜æœ‰å¤šå°‘ç©ºé—´å¯ä»¥æ¥æ”¶æ•°æ®ï¼Œå› ä¸ºæ¥æ”¶æ–¹çš„æ•°æ®ç¼“å­˜ç©ºé—´æ˜¯æœ‰é™çš„ï¼‰ï¼Œä»¥æ­¤æ§åˆ¶å‘é€ç«¯å‘é€æ•°æ®é€Ÿç‡ï¼Œä»è€Œè¾¾åˆ°æµé‡æ§åˆ¶ã€‚</li></ul><h3 id="ä¸‰æ¬¡æ¡æ‰‹"><a href="#ä¸‰æ¬¡æ¡æ‰‹" class="headerlink" title="ä¸‰æ¬¡æ¡æ‰‹"></a>ä¸‰æ¬¡æ¡æ‰‹</h3><p>å½“åº”ç”¨ç¨‹åºå¸Œæœ›é€šè¿‡TCPå’Œå¦ä¸€ä¸ªåº”ç”¨ç¨‹åºé€šä¿¡æ—¶ï¼Œä¼šå‘é€ä¸€ä¸ªé€šä¿¡è¯·æ±‚ï¼Œå¿…é¡»æœ‰ä¸€ä¸ªç¡®åˆ‡åœ°å€ï¼Œåœ¨åŒæ–¹æ¡æ‰‹åTCPå°†åœ¨ä¸¤ä¸ªç¨‹åºé—´å»ºç«‹ä¸€ä¸ªå…¨åŒå·¥çš„é€šä¿¡ï¼Œå°†å æ®ä¸¤ä¸ªè®¡ç®—æœºçš„é€šä¿¡çº¿è·¯ï¼Œç›´åˆ°åŒæ–¹å…³é—­ä¸ºæ­¢ã€‚ï¼ˆä¸‰æ¬¡æ¡æ‰‹ï¼‰</p><p><img src="/2019/11/22/ComputerNetworks/1566261217747.png" alt="1566261217747"></p><p>å‡è®¾ A ä¸ºå®¢æˆ·ç«¯ï¼ŒB ä¸ºæœåŠ¡å™¨ç«¯ã€‚</p><ul><li>é¦–å…ˆ B å¤„äº LISTENï¼ˆç›‘å¬ï¼‰çŠ¶æ€ï¼Œç­‰å¾…å®¢æˆ·çš„è¿æ¥è¯·æ±‚ã€‚</li><li>A å‘ B å‘é€è¿æ¥è¯·æ±‚æŠ¥æ–‡ï¼ŒSYN=1ï¼ŒACK=0ï¼Œé€‰æ‹©ä¸€ä¸ªåˆå§‹çš„åºå· xã€‚</li><li>B æ”¶åˆ°è¿æ¥è¯·æ±‚æŠ¥æ–‡ï¼Œå¦‚æœåŒæ„å»ºç«‹è¿æ¥ï¼Œåˆ™å‘ A å‘é€è¿æ¥ç¡®è®¤æŠ¥æ–‡ï¼ŒSYN=1ï¼ŒACK=1ï¼Œç¡®è®¤å·ä¸º x+1ï¼ŒåŒæ—¶ä¹Ÿé€‰æ‹©ä¸€ä¸ªåˆå§‹çš„åºå· yã€‚</li><li>A æ”¶åˆ° B çš„è¿æ¥ç¡®è®¤æŠ¥æ–‡åï¼Œè¿˜è¦å‘ B å‘å‡ºç¡®è®¤ï¼Œç¡®è®¤å·ä¸º y+1ï¼Œåºå·ä¸º x+1ã€‚</li><li>B æ”¶åˆ° A çš„ç¡®è®¤åï¼Œè¿æ¥å»ºç«‹ã€‚</li></ul><p><img src="/2019/11/22/ComputerNetworks/1566261228418-1574427053238.png" alt="1566261228418"></p><h3 id="ä¸ºä»€ä¹ˆè¦ä¸‰æ¬¡è¿æ¥"><a href="#ä¸ºä»€ä¹ˆè¦ä¸‰æ¬¡è¿æ¥" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ä¸‰æ¬¡è¿æ¥"></a>ä¸ºä»€ä¹ˆè¦ä¸‰æ¬¡è¿æ¥</h3><p>ä¸»è¦æ˜¯è¦åˆå§‹åŒ–Sequence Number çš„åˆå§‹å€¼ã€‚é€šä¿¡çš„åŒæ–¹è¦äº’ç›¸é€šçŸ¥å¯¹æ–¹è‡ªå·±çš„åˆå§‹åŒ–çš„ Sequence Numberï¼ˆç¼©å†™ä¸ºISNï¼šInital Sequence Numberï¼‰â€”â€”æ‰€ä»¥å«SYNï¼Œå…¨ç§°Synchronize Sequence Numbersã€‚ä¹Ÿå°±ä¸Šå›¾ä¸­çš„ x å’Œ yã€‚è¿™ä¸ªå·è¦ä½œä¸ºä»¥åçš„æ•°æ®é€šä¿¡çš„åºå·ï¼Œä»¥ä¿è¯åº”ç”¨å±‚æ¥æ”¶åˆ°çš„æ•°æ®ä¸ä¼šå› ä¸ºç½‘ç»œä¸Šçš„ä¼ è¾“çš„é—®é¢˜è€Œä¹±åºï¼ˆTCPä¼šç”¨è¿™ä¸ªåºå·æ¥æ‹¼æ¥æ•°æ®ï¼‰ã€‚</p><h3 id="å…³äºå»ºè¿æ¥æ—¶SYNè¶…æ—¶"><a href="#å…³äºå»ºè¿æ¥æ—¶SYNè¶…æ—¶" class="headerlink" title="å…³äºå»ºè¿æ¥æ—¶SYNè¶…æ—¶"></a>å…³äºå»ºè¿æ¥æ—¶SYNè¶…æ—¶</h3><p>è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœserverç«¯æ¥åˆ°äº† client å‘çš„ SYN åå›äº† SYN-ACK å client æ‰çº¿äº†ï¼Œserver ç«¯æ²¡æœ‰æ”¶åˆ° client å›æ¥çš„ACKï¼Œé‚£ä¹ˆï¼Œè¿™ä¸ªè¿æ¥å¤„äºä¸€ä¸ªä¸­é—´çŠ¶æ€ï¼Œå³æ²¡æˆåŠŸï¼Œä¹Ÿæ²¡å¤±è´¥ã€‚äºæ˜¯ï¼Œserver ç«¯å¦‚æœåœ¨ä¸€å®šæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°çš„TCPä¼šé‡å‘ SYN-ACKã€‚åœ¨Linuxä¸‹ï¼Œé»˜è®¤é‡è¯•æ¬¡æ•°ä¸º5æ¬¡ï¼Œé‡è¯•çš„é—´éš”æ—¶é—´ä» 1s å¼€å§‹æ¯æ¬¡éƒ½ç¿»å”®ï¼Œ5 æ¬¡çš„é‡è¯•æ—¶é—´é—´éš”ä¸º1s, 2s, 4s, 8s, 16sï¼Œæ€»å…±31sï¼Œç¬¬5æ¬¡å‘å‡ºåè¿˜è¦ç­‰32séƒ½çŸ¥é“ç¬¬5æ¬¡ä¹Ÿè¶…æ—¶äº†ï¼Œæ‰€ä»¥ï¼Œæ€»å…±éœ€è¦ 1s + 2s + 4s+ 8s+ 16s + 32s = 2^6 -1 = 63sï¼ŒTCPæ‰ä¼šæŠŠæ–­å¼€è¿™ä¸ªè¿æ¥ã€‚</p><h3 id="å…³äºSYN-Floodæ”»å‡»"><a href="#å…³äºSYN-Floodæ”»å‡»" class="headerlink" title="å…³äºSYN Floodæ”»å‡»"></a>å…³äºSYN Floodæ”»å‡»</h3><p>ä¸€äº›æ¶æ„çš„äººå°±ä¸ºæ­¤åˆ¶é€ äº†SYN Floodæ”»å‡»ï¼Œç»™æœåŠ¡å™¨å‘äº†ä¸€ä¸ªSYNåï¼Œå°±ä¸‹çº¿äº†ï¼Œäºæ˜¯æœåŠ¡å™¨éœ€è¦é»˜è®¤ç­‰ 63s æ‰ä¼šæ–­å¼€è¿æ¥ï¼Œè¿™æ ·ï¼Œæ”»å‡»è€…å°±å¯ä»¥æŠŠæœåŠ¡å™¨çš„ syn è¿æ¥çš„é˜Ÿåˆ—è€—å°½ï¼Œè®©æ­£å¸¸çš„è¿æ¥è¯·æ±‚ä¸èƒ½å¤„ç†ã€‚äºæ˜¯ï¼ŒLinuxä¸‹ç»™äº†ä¸€ä¸ªå« <strong>tcp_syncookies</strong> çš„å‚æ•°æ¥åº”å¯¹è¿™ä¸ªäº‹â€”â€”å½“SYNé˜Ÿåˆ—æ»¡äº†åï¼ŒTCPä¼šé€šè¿‡æºåœ°å€ç«¯å£ã€ç›®æ ‡åœ°å€ç«¯å£å’Œæ—¶é—´æˆ³æ‰“é€ å‡ºä¸€ä¸ªç‰¹åˆ«çš„Sequence Numberå‘å›å»ï¼ˆåˆå«cookieï¼‰ï¼Œå¦‚æœæ˜¯æ”»å‡»è€…åˆ™ä¸ä¼šæœ‰å“åº”ï¼Œå¦‚æœæ˜¯æ­£å¸¸è¿æ¥ï¼Œåˆ™ä¼šæŠŠè¿™ä¸ª SYN Cookieå‘å›æ¥ï¼Œç„¶åæœåŠ¡ç«¯å¯ä»¥é€šè¿‡cookieå»ºè¿æ¥ï¼ˆå³ä½¿ä½ ä¸åœ¨SYNé˜Ÿåˆ—ä¸­ï¼‰ã€‚</p><p>è¯·æ³¨æ„ï¼Œ<strong>è¯·å…ˆåƒä¸‡åˆ«ç”¨ tcp_syncookies æ¥å¤„ç†æ­£å¸¸çš„å¤§è´Ÿè½½çš„è¿æ¥çš„æƒ…å†µ</strong>ã€‚å› ä¸ºï¼Œsynccookies æ˜¯å¦¥åç‰ˆçš„TCPåè®®ï¼Œå¹¶ä¸ä¸¥è°¨ã€‚å¯¹äºæ­£å¸¸çš„è¯·æ±‚ï¼Œä½ åº”è¯¥è°ƒæ•´ä¸‰ä¸ªTCPå‚æ•°å¯ä¾›ä½ é€‰æ‹©ã€‚</p><ul><li>ç¬¬ä¸€ä¸ªæ˜¯ï¼štcp_synack_retries å¯ä»¥ç”¨ä»–æ¥å‡å°‘é‡è¯•æ¬¡æ•°ï¼›</li><li>ç¬¬äºŒä¸ªæ˜¯ï¼štcp_max_syn_backlogï¼Œå¯ä»¥å¢å¤§SYNè¿æ¥æ•°ï¼›</li><li>ç¬¬ä¸‰ä¸ªæ˜¯ï¼štcp_abort_on_overflow å¤„ç†ä¸è¿‡æ¥å¹²è„†å°±ç›´æ¥æ‹’ç»è¿æ¥äº† ï¼›</li></ul><h3 id="ä¿æ´»æœºåˆ¶"><a href="#ä¿æ´»æœºåˆ¶" class="headerlink" title="ä¿æ´»æœºåˆ¶"></a>ä¿æ´»æœºåˆ¶</h3><ul><li>å‘å¯¹æ–¹å‘é€ä¿æ´»æ¢æµ‹æŠ¥æ–‡ï¼Œå¦‚æœæœªæ”¶åˆ°å“åº”åˆ™ç»§ç»­å‘é€</li><li>å°è¯•æ¬¡æ•°è¾¾åˆ°ä¿æ´»æ¢æµ‹æ•°ä»ç„¶æœªæ”¶åˆ°å“åº”åˆ™ä¸­æ–­è¿æ¥</li></ul><h2 id="å››æ¬¡æŒ¥æ‰‹"><a href="#å››æ¬¡æŒ¥æ‰‹" class="headerlink" title="å››æ¬¡æŒ¥æ‰‹"></a>å››æ¬¡æŒ¥æ‰‹</h2><p>å³æ–­å¼€è¿æ¥æ—¶éœ€è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ€»å…±å‘é€4å„æ•°æ®åŒ…æ¥ç¡®è®¤æ–­å¼€è¿æ¥ã€‚</p><p><img src="/2019/11/22/ComputerNetworks/1566261278901.png" alt="1566261278901"></p><p>ä»¥ä¸‹æè¿°ä¸è®¨è®ºåºå·å’Œç¡®è®¤å·ï¼Œå› ä¸ºåºå·å’Œç¡®è®¤å·çš„è§„åˆ™æ¯”è¾ƒç®€å•ã€‚å¹¶ä¸”ä¸è®¨è®º ACKï¼Œå› ä¸º ACK åœ¨è¿æ¥å»ºç«‹ä¹‹åéƒ½ä¸º 1ã€‚</p><ul><li>A å‘é€è¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼ŒFIN=1ã€‚</li><li>B æ”¶åˆ°ä¹‹åå‘å‡ºç¡®è®¤ï¼Œæ­¤æ—¶ TCP å±äºåŠå…³é—­çŠ¶æ€ï¼ŒB èƒ½å‘ A å‘é€æ•°æ®ä½†æ˜¯ A ä¸èƒ½å‘ B å‘é€æ•°æ®ã€‚</li><li>å½“ B ä¸å†éœ€è¦è¿æ¥æ—¶ï¼Œå‘é€è¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼ŒFIN=1ã€‚</li><li>A æ”¶åˆ°åå‘å‡ºç¡®è®¤ï¼Œè¿›å…¥ TIME-WAIT çŠ¶æ€ï¼Œç­‰å¾… 2 MSLï¼ˆæœ€å¤§æŠ¥æ–‡å­˜æ´»æ—¶é—´ï¼‰åé‡Šæ”¾è¿æ¥ã€‚</li><li>B æ”¶åˆ° A çš„ç¡®è®¤åé‡Šæ”¾è¿æ¥ã€‚</li></ul><h3 id="å››æ¬¡æŒ¥æ‰‹çš„åŸå› "><a href="#å››æ¬¡æŒ¥æ‰‹çš„åŸå› " class="headerlink" title="å››æ¬¡æŒ¥æ‰‹çš„åŸå› "></a>å››æ¬¡æŒ¥æ‰‹çš„åŸå› </h3><p>å®¢æˆ·ç«¯å‘é€äº† FIN è¿æ¥é‡Šæ”¾æŠ¥æ–‡ä¹‹åï¼ŒæœåŠ¡å™¨æ”¶åˆ°äº†è¿™ä¸ªæŠ¥æ–‡ï¼Œå°±è¿›å…¥äº† CLOSE-WAIT çŠ¶æ€ã€‚è¿™ä¸ªçŠ¶æ€æ˜¯ä¸ºäº†è®©æœåŠ¡å™¨ç«¯å‘é€è¿˜æœªä¼ é€å®Œæ¯•çš„æ•°æ®ï¼Œä¼ é€å®Œæ¯•ä¹‹åï¼ŒæœåŠ¡å™¨ä¼šå‘é€ FIN è¿æ¥é‡Šæ”¾æŠ¥æ–‡ã€‚</p><p>TCPè¿æ¥æ˜¯å…¨åŒå·¥çš„ï¼ŒæœåŠ¡ç«¯å¯ä»¥å‘é€æ•°æ®åˆ°å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯ä¹Ÿå¯ä»¥å‘é€æ•°æ®åˆ°æœåŠ¡ç«¯ï¼Œå‘é€æ–¹å’Œæ¥æ”¶æ–¹éƒ½éœ€è¦ä¸¤æ¬¡æŒ¥æ‰‹æ‰èƒ½å…³é—­ ã€‚</p><h3 id="TIME-WAIT"><a href="#TIME-WAIT" class="headerlink" title="TIME_WAIT"></a>TIME_WAIT</h3><p>å®¢æˆ·ç«¯æ¥æ”¶åˆ°æœåŠ¡å™¨ç«¯çš„ FIN æŠ¥æ–‡åè¿›å…¥æ­¤çŠ¶æ€ï¼Œæ­¤æ—¶å¹¶ä¸æ˜¯ç›´æ¥è¿›å…¥ CLOSED çŠ¶æ€ï¼Œè¿˜éœ€è¦ç­‰å¾…ä¸€ä¸ªæ—¶é—´è®¡æ—¶å™¨è®¾ç½®çš„æ—¶é—´ 2MSLã€‚è¿™ä¹ˆåšæœ‰ä¸¤ä¸ªç†ç”±ï¼š</p><ul><li>ç¡®ä¿æœ€åä¸€ä¸ªç¡®è®¤æŠ¥æ–‡èƒ½å¤Ÿåˆ°è¾¾ã€‚å¦‚æœ B æ²¡æ”¶åˆ° A å‘é€æ¥çš„ç¡®è®¤æŠ¥æ–‡ï¼Œé‚£ä¹ˆå°±ä¼šé‡æ–°å‘é€è¿æ¥é‡Šæ”¾è¯·æ±‚æŠ¥æ–‡ï¼ŒA ç­‰å¾…ä¸€æ®µæ—¶é—´å°±æ˜¯ä¸ºäº†å¤„ç†è¿™ç§æƒ…å†µçš„å‘ç”Ÿã€‚</li><li>ç­‰å¾…ä¸€æ®µæ—¶é—´æ˜¯ä¸ºäº†è®©æœ¬è¿æ¥æŒç»­æ—¶é—´å†…æ‰€äº§ç”Ÿçš„æ‰€æœ‰æŠ¥æ–‡éƒ½ä»ç½‘ç»œä¸­æ¶ˆå¤±ï¼Œä½¿å¾—ä¸‹ä¸€ä¸ªæ–°çš„è¿æ¥ä¸ä¼šå‡ºç°æ—§çš„è¿æ¥è¯·æ±‚æŠ¥æ–‡ã€‚</li></ul><p><img src="/2019/11/22/ComputerNetworks/1566261373431.png" alt="1566261373431"></p><h2 id="TCP-å’Œ-UDP-çš„åŒºåˆ«"><a href="#TCP-å’Œ-UDP-çš„åŒºåˆ«" class="headerlink" title="TCP å’Œ UDP çš„åŒºåˆ«"></a>TCP å’Œ UDP çš„åŒºåˆ«</h2><p>å‰é¢æˆ‘ä»¬è¯´äº† TCP ç°åœ¨æˆ‘ä»¬æ¥è®¤è¯†ä¸€ä¸‹ UDPã€‚</p><h3 id="UPD-çš„ç‰¹ç‚¹"><a href="#UPD-çš„ç‰¹ç‚¹" class="headerlink" title="UPD çš„ç‰¹ç‚¹"></a>UPD çš„ç‰¹ç‚¹</h3><ul><li>é¢å‘éè¿æ¥çš„</li><li>ä¸ç»´æŠ¤è¿æ¥çŠ¶æ€ï¼Œæ”¯æŒåŒæ—¶å‘å¤šä¸ªå®¢æˆ·ç«¯ä¼ è¾“ç›¸åŒçš„æ¶ˆæ¯</li><li>æ•°æ®åŒ…æŠ¥å¤´åªæœ‰ 8 ä¸ªå­—èŠ‚ï¼Œé¢å¤–å¼€é”€è¾ƒå°</li><li>ååé‡åªå—é™äºæ•°æ®ç”Ÿæˆç‡ã€ä¼ è¾“é€Ÿç‡ä»¥åŠæœºå™¨æ€§èƒ½</li><li>å°½æœ€å¤§åŠªåŠ›äº¤ä»˜ï¼Œä¸ä¿è¯å¯é äº¤ä»˜ï¼Œä¸éœ€è¦ç»´æŒå¤æ‚çš„é“¾æ¥çŠ¶æ€è¡¨</li><li>é¢å‘æŠ¥æ–‡ï¼Œä¸å¯¹åº”ç”¨ç¨‹åºæäº¤çš„æŠ¥æ–‡ä¿¡æ¯è¿›è¡Œæ‹†åˆ†æˆ–åˆ™åˆå¹¶</li></ul><h3 id="å¯¹æ¯”"><a href="#å¯¹æ¯”" class="headerlink" title="å¯¹æ¯”"></a>å¯¹æ¯”</h3><ul><li>TCP æ˜¯é¢å‘è¿æ¥çš„ï¼›UDP æ˜¯æ— è¿æ¥çš„ã€‚</li><li>TCP æ˜¯å¯é çš„ï¼›UDP æ˜¯ä¸å¯é çš„ã€‚</li><li>TCP åªæ”¯æŒç‚¹å¯¹ç‚¹é€šä¿¡ï¼›UDP æ”¯æŒä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šã€å¤šå¯¹ä¸€ã€å¤šå¯¹å¤šçš„é€šä¿¡æ¨¡å¼ã€‚</li><li>TCP æ˜¯é¢å‘å­—èŠ‚æµçš„ï¼›UDP æ˜¯é¢å‘æŠ¥æ–‡çš„ã€‚</li><li>TCP æœ‰æ‹¥å¡æ§åˆ¶æœºåˆ¶ï¼›UDP æ²¡æœ‰æ‹¥å¡æ§åˆ¶ï¼Œé€‚åˆåª’ä½“é€šä¿¡ã€‚</li><li>TCP é¦–éƒ¨å¼€é”€(20 ä¸ªå­—èŠ‚)ï¼Œæ¯” UDP çš„é¦–éƒ¨å¼€é”€(8 ä¸ªå­—èŠ‚)è¦å¤§ã€‚</li></ul><h2 id="TCP-çš„æ»‘åŠ¨çª—å£"><a href="#TCP-çš„æ»‘åŠ¨çª—å£" class="headerlink" title="TCP çš„æ»‘åŠ¨çª—å£"></a>TCP çš„æ»‘åŠ¨çª—å£</h2><p>é¦–å…ˆæ˜ç¡®ï¼š</p><p>TCPæ»‘åŠ¨çª—å£åˆ†ä¸ºæ¥å—çª—å£ï¼Œå‘é€çª—å£ã€‚</p><p>æ»‘åŠ¨çª—å£åè®®æ˜¯<strong>ä¼ è¾“å±‚è¿›è¡Œæµæ§</strong>çš„ä¸€ç§æªæ–½ï¼Œ<strong>æ¥æ”¶æ–¹é€šè¿‡é€šå‘Šå‘é€æ–¹è‡ªå·±çš„çª—å£å¤§å°</strong>ï¼Œä»è€Œæ§åˆ¶å‘é€æ–¹çš„å‘é€é€Ÿåº¦ï¼Œä»è€Œè¾¾åˆ°é˜²æ­¢å‘é€æ–¹å‘é€é€Ÿåº¦è¿‡å¿«è€Œå¯¼è‡´è‡ªå·±è¢«æ·¹æ²¡çš„ç›®çš„ã€‚</p><h3 id="é‡è¦æ¦‚å¿µ"><a href="#é‡è¦æ¦‚å¿µ" class="headerlink" title="é‡è¦æ¦‚å¿µ"></a>é‡è¦æ¦‚å¿µ</h3><p>å¯¹ACKçš„å†è®¤è¯†ï¼Œacké€šå¸¸è¢«ç†è§£ä¸ºæ”¶åˆ°æ•°æ®åç»™å‡ºçš„ä¸€ä¸ªç¡®è®¤ACKï¼ŒACKåŒ…å«ä¸¤ä¸ªéå¸¸é‡è¦çš„ä¿¡æ¯ï¼š</p><ul><li>ä¸€æ˜¯æœŸæœ›æ¥æ”¶åˆ°çš„ä¸‹ä¸€å­—èŠ‚çš„åºå·nï¼Œè¯¥nä»£è¡¨æ¥æ”¶æ–¹å·²ç»æ¥æ”¶åˆ°äº†å‰n-1å­—èŠ‚æ•°æ®ï¼Œæ­¤æ—¶å¦‚æœæ¥æ”¶æ–¹æ”¶åˆ°ç¬¬n+1å­—èŠ‚æ•°æ®è€Œä¸æ˜¯ç¬¬nå­—èŠ‚æ•°æ®ï¼Œæ¥æ”¶æ–¹æ˜¯ä¸ä¼šå‘é€åºå·ä¸ºn+2çš„ACKçš„ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå‡å¦‚æ¥æ”¶ç«¯æ”¶åˆ°1-1024å­—èŠ‚ï¼Œå®ƒä¼šå‘é€ä¸€ä¸ªç¡®è®¤å·ä¸º1025çš„ACK,ä½†æ˜¯æ¥ä¸‹æ¥æ”¶åˆ°çš„æ˜¯2049-3072ï¼Œå®ƒæ˜¯ä¸ä¼šå‘é€ç¡®è®¤å·ä¸º3072çš„ACK,è€Œä¾æ—§å‘é€1025çš„ACKã€‚</li><li>äºŒæ˜¯å½“å‰çš„çª—å£å¤§å°mï¼Œå¦‚æ­¤å‘é€æ–¹åœ¨æ¥æ”¶åˆ°ACKåŒ…å«çš„è¿™ä¸¤ä¸ªæ•°æ®åå°±å¯ä»¥è®¡ç®—å‡ºè¿˜å¯ä»¥å‘é€å¤šå°‘å­—èŠ‚çš„æ•°æ®ç»™å¯¹æ–¹ï¼Œå‡å®šå½“å‰å‘é€æ–¹å·²å‘é€åˆ°ç¬¬xå­—èŠ‚ï¼Œåˆ™å¯ä»¥å‘é€çš„å­—èŠ‚æ•°å°±æ˜¯y=m-(x-n).è¿™å°±æ˜¯æ»‘åŠ¨çª—å£æ§åˆ¶æµé‡çš„åŸºæœ¬åŸç†</li></ul><p><strong>é‡ç‚¹ï¼šå‘é€æ–¹æ ¹æ®æ”¶åˆ°ACKå½“ä¸­çš„æœŸæœ›æ”¶åˆ°çš„ä¸‹ä¸€ä¸ªå­—èŠ‚çš„åºå·nä»¥åŠçª—å£mï¼Œè¿˜æœ‰å½“å‰å·²ç»å‘é€çš„å­—èŠ‚åºå·xï¼Œç®—å‡ºè¿˜å¯ä»¥å‘é€çš„å­—èŠ‚æ•°ã€‚</strong></p><p>å‘é€ç«¯çª—å£çš„ç¬¬ä¸€ä¸ªå­—èŠ‚åºå·ä¸€å®šæ˜¯ACKä¸­æœŸæœ›æ”¶åˆ°çš„ä¸‹ä¸€ä¸ªå­—èŠ‚åºå·ï¼Œæ¯”å¦‚ä¸‹å›¾ï¼š</p><p><img src="/2019/11/22/ComputerNetworks/image-20191122205849513.png" alt="image-20191122205849513"></p><p>ä¸Šå›¾52 53 54 55 å­—èŠ‚éƒ½æ˜¯å¯ä»¥æ–°å‘é€çš„å­—èŠ‚åºã€‚</p><p>æ¥å—ç«¯çª—å£çš„ç¬¬ä¸€ä¸ªå­—èŠ‚åºä¹‹å‰ä¸€å®šæ˜¯å·²ç»å®Œå…¨æ¥æ”¶çš„ï¼Œåé¢çª—å£é‡Œé¢çš„æ•°æ®éƒ½æ˜¯å¸Œæœ›æ¥å—çš„ï¼Œçª—å£åé¢çš„æ•°æ®éƒ½æ˜¯ä¸å¸Œæœ›æ¥å—çš„ã€‚</p><p>TCPçš„æ»‘åŠ¨çª—å£åˆ†ä¸ºæ¥æ”¶çª—å£å’Œå‘é€çª—å£ ä¸åˆ†æè¿™ä¸¤ç§çª—å£å°±è®¨è®ºæ˜¯ä¸å¦¥å½“çš„ã€‚ TCPçš„æ»‘åŠ¨çª—å£ä¸»è¦æœ‰ä¸¤ä¸ªä½œç”¨ï¼Œä¸€æ˜¯æä¾›TCPçš„å¯é æ€§ï¼ŒäºŒæ˜¯æä¾›TCPçš„æµæ§ç‰¹æ€§ã€‚åŒæ—¶æ»‘åŠ¨çª—å£æœºåˆ¶è¿˜ä½“ç°äº†TCPé¢å‘å­—èŠ‚æµçš„è®¾è®¡æ€è·¯ã€‚</p><h2 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h2><p>HTTP åè®®ï¼Œæ˜¯ Hyper Text Transfer Protocolï¼ˆè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰çš„ç¼©å†™ï¼Œæ˜¯ç”¨äºä»ä¸‡ç»´ç½‘ï¼ˆWWW:World Wide Web ï¼‰æœåŠ¡å™¨ä¼ è¾“è¶…æ–‡æœ¬åˆ°æœ¬åœ°æµè§ˆå™¨çš„ä¼ é€åè®®ã€‚</p><p>ä¸»è¦ç‰¹ç‚¹å¦‚ä¸‹ï¼š</p><ul><li>ç®€å•å¿«é€Ÿï¼šå®¢æˆ·å‘æœåŠ¡å™¨è¯·æ±‚æœåŠ¡æ—¶ï¼Œåªéœ€ä¼ é€è¯·æ±‚æ–¹æ³•å’Œè·¯å¾„ã€‚è¯·æ±‚æ–¹æ³•å¸¸ç”¨çš„æœ‰ GETã€HEADã€POST ç­‰ç­‰ã€‚æ¯ç§æ–¹æ³•è§„å®šäº†å®¢æˆ·ä¸æœåŠ¡å™¨è”ç³»çš„ç±»å‹ä¸åŒã€‚ç”±äº HTTP åè®®ç®€å•ï¼Œä½¿å¾— HTTP æœåŠ¡å™¨çš„ç¨‹åºè§„æ¨¡å°ï¼Œå› è€Œé€šä¿¡é€Ÿåº¦å¾ˆå¿«ã€‚</li><li>æ•°æ®æ ¼å¼çµæ´»ï¼šHTTP å…è®¸ä¼ è¾“ä»»æ„ç±»å‹çš„æ•°æ®å¯¹è±¡ã€‚æ­£åœ¨ä¼ è¾“çš„ç±»å‹ç”±Content-Type åŠ ä»¥æ ‡è®°ã€‚</li><li>æ— è¿æ¥ï¼šæ— è¿æ¥çš„å«ä¹‰æ˜¯é™åˆ¶æ¯æ¬¡è¿æ¥åªå¤„ç†ä¸€ä¸ªè¯·æ±‚ã€‚æœåŠ¡å™¨å¤„ç†å®Œå®¢æˆ·çš„è¯·æ±‚ï¼Œå¹¶æ”¶åˆ°å®¢æˆ·çš„åº”ç­”åï¼Œå³æ–­å¼€è¿æ¥ã€‚é‡‡ç”¨è¿™ç§æ–¹å¼å¯ä»¥èŠ‚çœä¼ è¾“æ—¶é—´ã€‚</li><li>æ— çŠ¶æ€ï¼šHTTP åè®®æ˜¯æ— çŠ¶æ€åè®®ã€‚æ— çŠ¶æ€ï¼Œæ˜¯æŒ‡åè®®å¯¹äºäº‹åŠ¡å¤„ç†æ²¡æœ‰è®°å¿†èƒ½åŠ›ã€‚æ— çŠ¶æ€æ„å‘³ç€å¦‚æœåç»­å¤„ç†éœ€è¦å‰é¢çš„ä¿¡æ¯ï¼Œåˆ™å®ƒå¿…é¡»é‡ä¼ ï¼Œè¿™æ ·å¯èƒ½å¯¼è‡´æ¯æ¬¡è¿æ¥ä¼ é€çš„æ•°æ®é‡å¢å¤§ã€‚å¦ä¸€æ–¹é¢ï¼Œåœ¨æœåŠ¡å™¨ä¸éœ€è¦å…ˆå‰ä¿¡æ¯æ—¶å®ƒçš„åº”ç­”å°±è¾ƒå¿«ã€‚</li><li>æ”¯æŒ B/S åŠ C/S æ¨¡å¼ã€‚</li></ul><p>è¯·æ±‚ç»“æ„ï¼š</p><p><img src="/2019/11/22/ComputerNetworks/1566261538473.png" alt="1566261538473"></p><p>å“åº”ç»“æ„ï¼š</p><p><img src="/2019/11/22/ComputerNetworks/1566261644094.png" alt="1566261644094"></p><p>æ€»ç»“ï¼šhttpåè®®å®šä¹‰äº†webå®¢æˆ·ç«¯å¦‚ä½•ä»webæœåŠ¡å™¨è¯·æ±‚webé¡µé¢ï¼Œä»¥åŠæœåŠ¡å™¨å¦‚ä½•æŠŠwebé¡µé¢ä¼ é€ç»™å®¢æˆ·ç«¯ï¼Œhttpåè®®é‡‡ç”¨äº†è¯·æ±‚å“åº”æ¨¡å‹ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªè¯·æ±‚æŠ¥æ–‡ï¼ŒåŒ…å«è¯·æ±‚æ–¹æ³•ï¼Œurlï¼Œåè®®ç‰ˆæœ¬ï¼Œè¯·æ±‚å¤´éƒ¨ï¼Œè¯·æ±‚æ•°æ®ï¼›æœåŠ¡å™¨ä»¥ä¸€ä¸ªçŠ¶æ€è¡Œä½œä¸ºå“åº”ï¼Œå“åº”å†…å®¹åŒ…æ‹¬ï¼Œåè®®ç‰ˆæœ¬ï¼Œé”™è¯¯æˆ–æˆåŠŸä¿¡æ¯ï¼ŒæœåŠ¡å™¨ä¿¡æ¯ï¼Œå“åº”å¤´éƒ¨å’Œå“åº”æ•°æ®ã€‚</p><ul><li>è¿æ¥ï¼šå®¢æˆ·ç«¯ä¸webæœåŠ¡å™¨çš„httpç«¯å£å»ºç«‹ä¸€ä¸ªTCPå¥—æ¥å­—è¿æ¥</li><li>å‘é€è¯·æ±‚ï¼šå³é€šè¿‡å¥—æ¥å­—å®¢æˆ·ç«¯å‘webæœåŠ¡ç«¯å‘é€ä¸€ä¸ªæ–‡æœ¬çš„è¯·æ±‚æŠ¥æ–‡</li><li>å“åº”ï¼šæœåŠ¡å™¨è§£æè¯·æ±‚ï¼Œå®šä½è¯·æ±‚èµ„æºï¼Œå°†èµ„æºå‰¯æœ¬å†™åˆ°TCPå¥—æ¥å­—ï¼Œç”±å®¢æˆ·ç«¯è¯»å–</li><li>é‡Šæ”¾è¿æ¥ï¼škeep-liveé•¿è¿æ¥ä¼šä¿å­˜ä¸€æ®µæ—¶é—´ï¼Œè¯¥æ—¶é—´å†…è¯·æ±‚è¿˜ä¼šå“åº”</li><li>å®¢æˆ·ç«¯è§£æï¼šé¦–å…ˆè§£æçŠ¶æ€è¡Œï¼ŒæŸ¥çœ‹è¡¨æ˜è¯·æ±‚æ˜¯å¦æˆåŠŸçš„çŠ¶æ€ä»£ç ï¼Œè§£æå“åº”å¤´ï¼Œå“åº”å¤´å‘ŠçŸ¥ä»¥ä¸‹è‹¥å¹²æ•°æ®ä¸ºæ•°æ®ä¿¡æ¯ï¼Œå®¢æˆ·ç«¯æŒ‰ç…§æ ¼å¼è§£ææ•°æ®ï¼Œåœ¨æµè§ˆå™¨çª—å£æ˜¾ç¤ºã€‚</li></ul><p>URLè¾“å…¥åçš„æµç¨‹ï¼Ÿï¼Ÿï¼Ÿ</p><ol><li>DNSè§£æï¼šæµè§ˆå™¨ä¼šæ ¹æ®urlé€å±‚æŸ¥è¯¢DNSæœåŠ¡å™¨ç¼“å­˜ï¼Œè§£æurlä¸­çš„åŸŸåæ‰€å¯¹åº”çš„IPåœ°å€ï¼ˆDNSç¼“å­˜ä»è¿‘åˆ°è¿œä¸ºæµè§ˆå™¨ç¼“å­˜ï¼Œç³»ç»Ÿç¼“å­˜ï¼Œè·¯ç”±å™¨ç¼“å­˜ï¼ŒIPSæœåŠ¡å™¨ç¼“å­˜ï¼Œæ ¹åŸŸåæœåŠ¡å™¨ç¼“å­˜ï¼Œé¡¶çº§åŸŸåæœåŠ¡å™¨ç¼“å­˜ï¼‰ï¼Œæ­¤æ—¶æ‰¾åˆ°IPåœ°å€</li><li>TCPè¿æ¥ï¼šæ‰¾åˆ°IPåœ°å€åä¼šæ ¹æ®IPåœ°å€å’Œå¯¹åº”ç«¯å£ä¸æœåŠ¡å™¨å»ºç«‹TCPè¿æ¥ï¼ˆä¸‰æ¬¡æ¡æ‰‹ï¼‰</li><li>å‘é€HTTPè¯·æ±‚ï¼šæµè§ˆå™¨ä¼šå‘èµ·è¯»å–æ–‡ä»¶çš„httpè¯·æ±‚ï¼Œ</li><li>æœåŠ¡å™¨å¤„ç†è¯·æ±‚å¹¶è¿”å›HTTPæŠ¥æ–‡ï¼šæœåŠ¡å™¨å¯¹æµè§ˆå™¨è¯·æ±‚å“åº”ï¼Œå¹¶æŠŠå¯¹åº”çš„å¸¦æœ‰httpæ–‡æœ¬çš„httpå“åº”æŠ¥æ–‡å‘é€ç»™æµè§ˆå™¨</li><li>æµè§ˆå™¨è§£ææ¸²æŸ“é¡µé¢ï¼šæµè§ˆå™¨æ”¶åˆ°æŠ¥æ–‡ï¼Œè§£ææ¸²æŸ“åˆ°æµè§ˆå™¨</li><li>é‡Šæ”¾è¿æ¥</li></ol><p>çŠ¶æ€ç </p><p><img src="/2019/11/22/ComputerNetworks/1566261699701.png" alt="1566261699701"></p><h3 id="GET-å’Œ-POST-åŒºåˆ«"><a href="#GET-å’Œ-POST-åŒºåˆ«" class="headerlink" title="GET å’Œ POST åŒºåˆ«"></a>GET å’Œ POST åŒºåˆ«</h3><p>ä»ä¸‰ä¸ªå±‚é¢æ¥è§£ç­”ï¼š</p><ul><li>Http æŠ¥æ–‡å±‚é¢ï¼šGET å°†è¯·æ±‚ä¿¡æ¯æ”¾åœ¨ URLä¸­ï¼ŒPOST æ–¹æ³•æŠ¥æ–‡ä¸­</li><li>æ•°æ®åº“å±‚é¢ï¼šGET ç¬¦åˆå¹‚ç­‰æ€§å’Œå®‰å…¨æ€§ï¼ŒPOST ä¸ç¬¦åˆ</li><li>å…¶ä»–å±‚é¢ï¼šGET å¯ä»¥è¢«ç¼“å­˜ã€è¢«å­˜å‚¨ï¼ˆä¹¦ç­¾ï¼‰ï¼Œè€Œ POST ä¸è¡Œ</li></ul><h3 id="Cookie-å’Œ-Session-çš„åŒºåˆ«"><a href="#Cookie-å’Œ-Session-çš„åŒºåˆ«" class="headerlink" title="Cookie å’Œ Session çš„åŒºåˆ«"></a>Cookie å’Œ Session çš„åŒºåˆ«</h3><p><strong>Cookie ç®€ä»‹ï¼š</strong></p><ul><li>æ˜¯ç”±æœåŠ¡å™¨å‘ç»™å®¢æˆ·ç«¯çš„ç‰¹æ®Šä¿¡æ¯ï¼Œä»¥æ–‡æœ¬çš„å½¢å¼å­˜æ”¾åœ¨å®¢æˆ·ç«¯</li><li>å®¢æˆ·ç«¯å†æ¬¡è¯·æ±‚çš„æ—¶å€™ï¼Œä¼šæŠŠ Cookie å›å‘ç»™æœåŠ¡ç«¯</li><li>æœåŠ¡å™¨æ¥æ”¶åˆ°åï¼Œä¼šè§£æ Cookie ç”Ÿæˆä¸å®¢æˆ·ç«¯ç›¸å¯¹çš„å†…å®¹</li></ul><p><strong>Cookiet çš„è®¾ç½®ä»¥åŠå‘é€è¿‡ç¨‹ï¼š</strong></p><p><img src="/2019/11/22/ComputerNetworks/image-20191122210015905.png" alt="image-20191122210015905"></p><p><strong>Session ç®€ä»‹ï¼š</strong></p><ul><li>æœåŠ¡ç«¯çš„æœºåˆ¶ï¼Œåœ¨æœåŠ¡ç«¯ä¿å­˜çš„ä¿¡æ¯</li><li>è§£æå®¢æˆ·ç«¯è¯·æ±‚å¹¶æ“ä½œ Session id ï¼ŒæŒ‰éœ€ä¿å­˜çŠ¶æ€ä¿¡æ¯</li></ul><p><strong>Session çš„å®ç°æ–¹å¼ï¼š</strong></p><ul><li>ä½¿ç”¨ Cookie æ¥å®ç°</li><li>ä½¿ç”¨ URL å›å†™æ¥å®ç°ï¼Œæ¯æ¬¡åœ¨ URL æ·»åŠ  Session id ä¿¡æ¯</li></ul><p><strong>åŒºåˆ«</strong>ï¼š</p><ul><li>Cookie æ•°æ®å­˜æ”¾åœ¨å®¢æˆ·ç«¯çš„æµè§ˆå™¨ä¸Šï¼ŒSession æ•°æ®å­˜æ”¾åœ¨æœåŠ¡å™¨ä¸Š</li><li>Session ç›¸å¯¹äº Cookie æ›´å®‰å…¨</li><li>è‹¥è€ƒè™‘å‡è½»æœåŠ¡å™¨è´Ÿæ‹…ï¼Œåº”å½“ä½¿ç”¨ Cookie</li></ul><h3 id="HTTP-å’Œ-HTTPs-çš„åŒºåˆ«"><a href="#HTTP-å’Œ-HTTPs-çš„åŒºåˆ«" class="headerlink" title="HTTP å’Œ HTTPs çš„åŒºåˆ«"></a>HTTP å’Œ HTTPs çš„åŒºåˆ«</h3><p><img src="/2019/11/22/ComputerNetworks/image-20191122210051958.png" alt="image-20191122210051958"></p><h4 id="SSL-Security-Sockets-Layer-å®‰å…¨å¥—æ¥å±‚"><a href="#SSL-Security-Sockets-Layer-å®‰å…¨å¥—æ¥å±‚" class="headerlink" title="SSL (Security Sockets Layer) å®‰å…¨å¥—æ¥å±‚"></a>SSL (Security Sockets Layer) å®‰å…¨å¥—æ¥å±‚</h4><ul><li>ä¸ºç½‘ç»œé€šä¿¡æä¾›å®‰å…¨åŠæ•°æ®å®Œæ•´æ€§çš„ä¸€ç§å®‰å…¨åè®®</li><li>æ˜¯æ“ä½œç³»ç»Ÿå¯¹å¤–çš„ APIï¼ŒSSL 3.0 æ›´åä¸º TLS</li><li>é‡‡ç”¨èº«ä»½éªŒè¯å’Œæ•°æ®åŠ å¯†æ¥ä¿è¯ç½‘ç»œçš„é€šä¿¡çš„å®‰å…¨å’Œæ•°æ®çš„å®Œæ•´æ€§</li></ul><h4 id="åŒºåˆ«"><a href="#åŒºåˆ«" class="headerlink" title="åŒºåˆ«"></a>åŒºåˆ«</h4><ul><li>HTTPS éœ€è¦åˆ° CA ç”³è¯·è¯ä¹¦ï¼ŒHTTP ä¸éœ€è¦</li><li>HTTPS å¯†æ–‡ä¼ è¾“ï¼ŒHTTP æ˜æ–‡ä¼ è¾“</li><li>è¿æ¥æ–¹å¼ä¸åŒï¼ŒHTTPS é»˜è®¤ä½¿ç”¨ 443 ç«¯å£ï¼ŒHTTP ä½¿ç”¨ 80 ç«¯å£</li><li>HTTPS = HTTP + åŠ å¯† + è®¤è¯ + å®Œæ•´æ€§ä¿æŠ¤ï¼Œè¾ƒ HTTP å®‰å…¨</li></ul><h2 id="Socket"><a href="#Socket" class="headerlink" title="Socket"></a>Socket</h2><p>å”¯ä¸€æ ‡è¯†ä¸€ä¸ªè¿›ç¨‹ï¼šæœ¬åœ°ä¸­ä½¿ç”¨PIDï¼›</p><p>ç½‘ç»œä¸­è¿›ç¨‹ï¼šIPåœ°å€+åè®®+ç«¯å£å·æ¥å”¯ä¸€æ ‡è¯†ä¸€ä¸ªç½‘ç»œä¸­çš„ä¸€ä¸ªè¿›ç¨‹ï¼›</p><p><img src="/2019/11/22/ComputerNetworks/1566261798658.png" alt="1566261798658"></p><p>socketé€šä¿¡æµç¨‹</p><p><img src="/2019/11/22/ComputerNetworks/1566261805698.png" alt="1566261805698"></p><ul><li><input disabled type="checkbox"> Socketé€šä¿¡ç¼–ç¨‹</li></ul><h2 id="QA"><a href="#QA" class="headerlink" title="QA"></a>QA</h2><h3 id="OSIä¸TCP-IPçš„åè®®"><a href="#OSIä¸TCP-IPçš„åè®®" class="headerlink" title="OSIä¸TCP/IPçš„åè®®"></a>OSIä¸TCP/IPçš„åè®®</h3><p>å­¦ä¹ è®¡ç®—æœºç½‘ç»œæ—¶æˆ‘ä»¬ä¸€èˆ¬é‡‡ç”¨æŠ˜ä¸­çš„åŠæ³•ï¼Œä¹Ÿå°±æ˜¯ä¸­å’Œ OSI å’Œ TCP/IP çš„ä¼˜ç‚¹ï¼Œé‡‡ç”¨ä¸€ç§åªæœ‰äº”å±‚åè®®çš„ä½“ç³»ç»“æ„ï¼Œè¿™æ ·æ—¢ç®€æ´åˆèƒ½å°†æ¦‚å¿µé˜è¿°æ¸…æ¥šã€‚</p><p><img src="http://m.qpic.cn/psb?/V11tv2Vw2h2WsJ/NwMQ9mez*i97f2u6JhqrOh14XAag318f8TuAngEDQ8w!/b/dL8AAAAAAAAA&bo=eQJYAXkCWAEDKQw!&rf=viewer_4" alt="äº”å±‚ä½“ç³»ç»“æ„"></p><p>ç»“åˆäº’è”ç½‘çš„æƒ…å†µï¼Œè‡ªä¸Šè€Œä¸‹åœ°ï¼Œéå¸¸ç®€è¦çš„ä»‹ç»ä¸€ä¸‹å„å±‚çš„ä½œç”¨ã€‚</p><h4 id="åº”ç”¨å±‚"><a href="#åº”ç”¨å±‚" class="headerlink" title="åº”ç”¨å±‚"></a>åº”ç”¨å±‚</h4><p><strong>åº”ç”¨å±‚(application-layerï¼‰çš„ä»»åŠ¡æ˜¯é€šè¿‡åº”ç”¨è¿›ç¨‹é—´çš„äº¤äº’æ¥å®Œæˆç‰¹å®šç½‘ç»œåº”ç”¨ã€‚</strong>åº”ç”¨å±‚åè®®å®šä¹‰çš„æ˜¯åº”ç”¨è¿›ç¨‹ï¼ˆè¿›ç¨‹ï¼šä¸»æœºä¸­æ­£åœ¨è¿è¡Œçš„ç¨‹åºï¼‰é—´çš„é€šä¿¡å’Œäº¤äº’çš„è§„åˆ™ã€‚å¯¹äºä¸åŒçš„ç½‘ç»œåº”ç”¨éœ€è¦ä¸åŒçš„åº”ç”¨å±‚åè®®ã€‚åœ¨äº’è”ç½‘ä¸­åº”ç”¨å±‚åè®®å¾ˆå¤šï¼Œå¦‚<strong>åŸŸåç³»ç»ŸDNS</strong>ï¼Œæ”¯æŒä¸‡ç»´ç½‘åº”ç”¨çš„ <strong>HTTPåè®®</strong>ï¼Œæ”¯æŒç”µå­é‚®ä»¶çš„ <strong>SMTPåè®®</strong>ç­‰ç­‰ã€‚æˆ‘ä»¬æŠŠåº”ç”¨å±‚äº¤äº’çš„æ•°æ®å•å…ƒç§°ä¸ºæŠ¥æ–‡ã€‚</p><p><strong>åŸŸåç³»ç»Ÿ</strong></p><blockquote><p>åŸŸåç³»ç»Ÿ(Domain Name Systemç¼©å†™ DNSï¼ŒDomain Nameè¢«è¯‘ä¸ºåŸŸå)æ˜¯å› ç‰¹ç½‘çš„ä¸€é¡¹æ ¸å¿ƒæœåŠ¡ï¼Œå®ƒä½œä¸ºå¯ä»¥å°†åŸŸåå’ŒIPåœ°å€ç›¸äº’æ˜ å°„çš„ä¸€ä¸ªåˆ†å¸ƒå¼æ•°æ®åº“ï¼Œèƒ½å¤Ÿä½¿äººæ›´æ–¹ä¾¿çš„è®¿é—®äº’è”ç½‘ï¼Œè€Œä¸ç”¨å»è®°ä½èƒ½å¤Ÿè¢«æœºå™¨ç›´æ¥è¯»å–çš„IPæ•°ä¸²ã€‚ï¼ˆç™¾åº¦ç™¾ç§‘ï¼‰ä¾‹å¦‚ï¼šä¸€ä¸ªå…¬å¸çš„ Web ç½‘ç«™å¯çœ‹ä½œæ˜¯å®ƒåœ¨ç½‘ä¸Šçš„é—¨æˆ·ï¼Œè€ŒåŸŸåå°±ç›¸å½“äºå…¶é—¨ç‰Œåœ°å€ï¼Œé€šå¸¸åŸŸåéƒ½ä½¿ç”¨è¯¥å…¬å¸çš„åç§°æˆ–ç®€ç§°ã€‚ä¾‹å¦‚ä¸Šé¢æåˆ°çš„å¾®è½¯å…¬å¸çš„åŸŸåï¼Œç±»ä¼¼çš„è¿˜æœ‰ï¼šIBM å…¬å¸çš„åŸŸåæ˜¯ <a href="http://www.ibm.xn--comoracle-xj3h/" target="_blank" rel="noopener">www.ibm.comã€Oracle</a> å…¬å¸çš„åŸŸåæ˜¯ <a href="http://www.oracle.xn--comcisco-hm3g8360a63fhh376bwz2c1gzc/" target="_blank" rel="noopener">www.oracle.comã€Ciscoå…¬å¸çš„åŸŸåæ˜¯</a> <a href="http://www.cisco.com/" target="_blank" rel="noopener">www.cisco.com</a> ç­‰ã€‚</p></blockquote><p><strong>HTTPåè®®</strong></p><blockquote><p>è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆHTTPï¼ŒHyperText Transfer Protocol)æ˜¯äº’è”ç½‘ä¸Šåº”ç”¨æœ€ä¸ºå¹¿æ³›çš„ä¸€ç§ç½‘ç»œåè®®ã€‚æ‰€æœ‰çš„ WWWï¼ˆä¸‡ç»´ç½‘ï¼‰ æ–‡ä»¶éƒ½å¿…é¡»éµå®ˆè¿™ä¸ªæ ‡å‡†ã€‚è®¾è®¡ HTTP æœ€åˆçš„ç›®çš„æ˜¯ä¸ºäº†æä¾›ä¸€ç§å‘å¸ƒå’Œæ¥æ”¶ HTML é¡µé¢çš„æ–¹æ³•ã€‚ï¼ˆç™¾åº¦ç™¾ç§‘ï¼‰</p></blockquote><h4 id="è¿è¾“å±‚"><a href="#è¿è¾“å±‚" class="headerlink" title="è¿è¾“å±‚"></a>è¿è¾“å±‚</h4><p><strong>è¿è¾“å±‚(transport layer)çš„ä¸»è¦ä»»åŠ¡å°±æ˜¯è´Ÿè´£å‘ä¸¤å°ä¸»æœºè¿›ç¨‹ä¹‹é—´çš„é€šä¿¡æä¾›é€šç”¨çš„æ•°æ®ä¼ è¾“æœåŠ¡</strong>ã€‚åº”ç”¨è¿›ç¨‹åˆ©ç”¨è¯¥æœåŠ¡ä¼ é€åº”ç”¨å±‚æŠ¥æ–‡ã€‚â€œé€šç”¨çš„â€æ˜¯æŒ‡å¹¶ä¸é’ˆå¯¹æŸä¸€ä¸ªç‰¹å®šçš„ç½‘ç»œåº”ç”¨ï¼Œè€Œæ˜¯å¤šç§åº”ç”¨å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªè¿è¾“å±‚æœåŠ¡ã€‚ç”±äºä¸€å°ä¸»æœºå¯åŒæ—¶è¿è¡Œå¤šä¸ªçº¿ç¨‹ï¼Œå› æ­¤è¿è¾“å±‚æœ‰å¤ç”¨å’Œåˆ†ç”¨çš„åŠŸèƒ½ã€‚æ‰€è°“å¤ç”¨å°±æ˜¯æŒ‡å¤šä¸ªåº”ç”¨å±‚è¿›ç¨‹å¯åŒæ—¶ä½¿ç”¨ä¸‹é¢è¿è¾“å±‚çš„æœåŠ¡ï¼Œåˆ†ç”¨å’Œå¤ç”¨ç›¸åï¼Œæ˜¯è¿è¾“å±‚æŠŠæ”¶åˆ°çš„ä¿¡æ¯åˆ†åˆ«äº¤ä»˜ä¸Šé¢åº”ç”¨å±‚ä¸­çš„ç›¸åº”è¿›ç¨‹ã€‚</p><p><strong>è¿è¾“å±‚ä¸»è¦ä½¿ç”¨ä»¥ä¸‹ä¸¤ç§åè®®:</strong></p><ol><li><strong>ä¼ è¾“æ§åˆ¶åè®® TCP</strong>ï¼ˆTransmission Control Protocolï¼‰â€“æä¾›<strong>é¢å‘è¿æ¥</strong>çš„ï¼Œ<strong>å¯é çš„</strong>æ•°æ®ä¼ è¾“æœåŠ¡ã€‚</li><li><strong>ç”¨æˆ·æ•°æ®åè®® UDP</strong>ï¼ˆUser Datagram Protocolï¼‰â€“æä¾›<strong>æ— è¿æ¥</strong>çš„ï¼Œå°½æœ€å¤§åŠªåŠ›çš„æ•°æ®ä¼ è¾“æœåŠ¡ï¼ˆ<strong>ä¸ä¿è¯æ•°æ®ä¼ è¾“çš„å¯é æ€§</strong>ï¼‰ã€‚</li></ol><h4 id="ç½‘ç»œå±‚"><a href="#ç½‘ç»œå±‚" class="headerlink" title="ç½‘ç»œå±‚"></a>ç½‘ç»œå±‚</h4><p><strong>åœ¨ è®¡ç®—æœºç½‘ç»œä¸­è¿›è¡Œé€šä¿¡çš„ä¸¤ä¸ªè®¡ç®—æœºä¹‹é—´å¯èƒ½ä¼šç»è¿‡å¾ˆå¤šä¸ªæ•°æ®é“¾è·¯ï¼Œä¹Ÿå¯èƒ½è¿˜è¦ç»è¿‡å¾ˆå¤šé€šä¿¡å­ç½‘ã€‚ç½‘ç»œå±‚çš„ä»»åŠ¡å°±æ˜¯é€‰æ‹©åˆé€‚çš„ç½‘é—´è·¯ç”±å’Œäº¤æ¢ç»“ç‚¹ï¼Œ ç¡®ä¿æ•°æ®åŠæ—¶ä¼ é€ã€‚</strong> åœ¨å‘é€æ•°æ®æ—¶ï¼Œç½‘ç»œå±‚æŠŠè¿è¾“å±‚äº§ç”Ÿçš„æŠ¥æ–‡æ®µæˆ–ç”¨æˆ·æ•°æ®æŠ¥å°è£…æˆåˆ†ç»„å’ŒåŒ…è¿›è¡Œä¼ é€ã€‚åœ¨ TCP/IP ä½“ç³»ç»“æ„ä¸­ï¼Œç”±äºç½‘ç»œå±‚ä½¿ç”¨ <strong>IP åè®®</strong>ï¼Œå› æ­¤åˆ†ç»„ä¹Ÿå« <strong>IP æ•°æ®æŠ¥</strong> ï¼Œç®€ç§° <strong>æ•°æ®æŠ¥</strong>ã€‚</p><p>è¿™é‡Œè¦æ³¨æ„ï¼š<strong>ä¸è¦æŠŠè¿è¾“å±‚çš„â€œç”¨æˆ·æ•°æ®æŠ¥ UDP â€å’Œç½‘ç»œå±‚çš„â€œ IP æ•°æ®æŠ¥â€å¼„æ··</strong>ã€‚å¦å¤–ï¼Œæ— è®ºæ˜¯å“ªä¸€å±‚çš„æ•°æ®å•å…ƒï¼Œéƒ½å¯ç¬¼ç»Ÿåœ°ç”¨â€œåˆ†ç»„â€æ¥è¡¨ç¤ºã€‚</p><p>è¿™é‡Œå¼ºè°ƒæŒ‡å‡ºï¼Œç½‘ç»œå±‚ä¸­çš„â€œç½‘ç»œâ€äºŒå­—å·²ç»ä¸æ˜¯æˆ‘ä»¬é€šå¸¸è°ˆåˆ°çš„å…·ä½“ç½‘ç»œï¼Œè€Œæ˜¯æŒ‡è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„æ¨¡å‹ä¸­ç¬¬ä¸‰å±‚çš„åç§°.</p><p>äº’è”ç½‘æ˜¯ç”±å¤§é‡çš„å¼‚æ„ï¼ˆheterogeneousï¼‰ç½‘ç»œé€šè¿‡è·¯ç”±å™¨ï¼ˆrouterï¼‰ç›¸äº’è¿æ¥èµ·æ¥çš„ã€‚äº’è”ç½‘ä½¿ç”¨çš„ç½‘ç»œå±‚åè®®æ˜¯æ— è¿æ¥çš„ç½‘é™…åè®®ï¼ˆIntert Protocolï¼‰å’Œè®¸å¤šè·¯ç”±é€‰æ‹©åè®®ï¼Œå› æ­¤äº’è”ç½‘çš„ç½‘ç»œå±‚ä¹Ÿå«åš<strong>ç½‘é™…å±‚</strong>æˆ–<strong>IPå±‚</strong>ã€‚</p><h4 id="æ•°æ®é“¾è·¯å±‚"><a href="#æ•°æ®é“¾è·¯å±‚" class="headerlink" title="æ•°æ®é“¾è·¯å±‚"></a>æ•°æ®é“¾è·¯å±‚</h4><p><strong>æ•°æ®é“¾è·¯å±‚(data link layer)é€šå¸¸ç®€ç§°ä¸ºé“¾è·¯å±‚ã€‚ä¸¤å°ä¸»æœºä¹‹é—´çš„æ•°æ®ä¼ è¾“ï¼Œæ€»æ˜¯åœ¨ä¸€æ®µä¸€æ®µçš„é“¾è·¯ä¸Šä¼ é€çš„ï¼Œè¿™å°±éœ€è¦ä½¿ç”¨ä¸“é—¨çš„é“¾è·¯å±‚çš„åè®®ã€‚</strong> åœ¨ä¸¤ä¸ªç›¸é‚»èŠ‚ç‚¹ä¹‹é—´ä¼ é€æ•°æ®æ—¶ï¼Œ<strong>æ•°æ®é“¾è·¯å±‚å°†ç½‘ç»œå±‚äº¤ä¸‹æ¥çš„ IP æ•°æ®æŠ¥ç»„è£…ç¨‹å¸§</strong>ï¼Œåœ¨ä¸¤ä¸ªç›¸é‚»èŠ‚ç‚¹é—´çš„é“¾è·¯ä¸Šä¼ é€å¸§ã€‚æ¯ä¸€å¸§åŒ…æ‹¬æ•°æ®å’Œå¿…è¦çš„æ§åˆ¶ä¿¡æ¯ï¼ˆå¦‚åŒæ­¥ä¿¡æ¯ï¼Œåœ°å€ä¿¡æ¯ï¼Œå·®é”™æ§åˆ¶ç­‰ï¼‰ã€‚</p><p>åœ¨æ¥æ”¶æ•°æ®æ—¶ï¼Œæ§åˆ¶ä¿¡æ¯ä½¿æ¥æ”¶ç«¯èƒ½å¤ŸçŸ¥é“ä¸€ä¸ªå¸§ä»å“ªä¸ªæ¯”ç‰¹å¼€å§‹å’Œåˆ°å“ªä¸ªæ¯”ç‰¹ç»“æŸã€‚è¿™æ ·ï¼Œæ•°æ®é“¾è·¯å±‚åœ¨æ”¶åˆ°ä¸€ä¸ªå¸§åï¼Œå°±å¯ä»ä¸­æå‡ºæ•°æ®éƒ¨åˆ†ï¼Œä¸Šäº¤ç»™ç½‘ç»œå±‚ã€‚ æ§åˆ¶ä¿¡æ¯è¿˜ä½¿æ¥æ”¶ç«¯èƒ½å¤Ÿæ£€æµ‹åˆ°æ‰€æ”¶åˆ°çš„å¸§ä¸­æœ‰è¯¯å·®é”™ã€‚å¦‚æœå‘ç°å·®é”™ï¼Œæ•°æ®é“¾è·¯å±‚å°±ç®€å•åœ°ä¸¢å¼ƒè¿™ä¸ªå‡ºäº†å·®é”™çš„å¸§ï¼Œä»¥é¿å…ç»§ç»­åœ¨ç½‘ç»œä¸­ä¼ é€ä¸‹å»ç™½ç™½æµªè´¹ç½‘ç»œèµ„æºã€‚å¦‚æœéœ€è¦æ”¹æ­£æ•°æ®åœ¨é“¾è·¯å±‚ä¼ è¾“æ—¶å‡ºç°å·®é”™ï¼ˆè¿™å°±æ˜¯è¯´ï¼Œæ•°æ®é“¾è·¯å±‚ä¸ä»…è¦æ£€é”™ï¼Œè€Œä¸”è¿˜è¦çº é”™ï¼‰ï¼Œé‚£ä¹ˆå°±è¦é‡‡ç”¨å¯é æ€§ä¼ è¾“åè®®æ¥çº æ­£å‡ºç°çš„å·®é”™ã€‚è¿™ç§æ–¹æ³•ä¼šä½¿é“¾è·¯å±‚çš„åè®®å¤æ‚äº›ã€‚</p><h4 id="ç‰©ç†å±‚"><a href="#ç‰©ç†å±‚" class="headerlink" title="ç‰©ç†å±‚"></a>ç‰©ç†å±‚</h4><p>åœ¨ç‰©ç†å±‚ä¸Šæ‰€ä¼ é€çš„æ•°æ®å•ä½æ˜¯æ¯”ç‰¹ã€‚ <strong>ç‰©ç†å±‚(physical layer)çš„ä½œç”¨æ˜¯å®ç°ç›¸é‚»è®¡ç®—æœºèŠ‚ç‚¹ä¹‹é—´æ¯”ç‰¹æµçš„é€æ˜ä¼ é€ï¼Œå°½å¯èƒ½å±è”½æ‰å…·ä½“ä¼ è¾“ä»‹è´¨å’Œç‰©ç†è®¾å¤‡çš„å·®å¼‚ã€‚</strong> ä½¿å…¶ä¸Šé¢çš„æ•°æ®é“¾è·¯å±‚ä¸å¿…è€ƒè™‘ç½‘ç»œçš„å…·ä½“ä¼ è¾“ä»‹è´¨æ˜¯ä»€ä¹ˆã€‚â€œé€æ˜ä¼ é€æ¯”ç‰¹æµâ€è¡¨ç¤ºç»å®é™…ç”µè·¯ä¼ é€åçš„æ¯”ç‰¹æµæ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œå¯¹ä¼ é€çš„æ¯”ç‰¹æµæ¥è¯´ï¼Œè¿™ä¸ªç”µè·¯å¥½åƒæ˜¯çœ‹ä¸è§çš„ã€‚</p><p>åœ¨äº’è”ç½‘ä½¿ç”¨çš„å„ç§åä¸­æœ€é‡è¦å’Œæœ€è‘—åçš„å°±æ˜¯ TCP/IP ä¸¤ä¸ªåè®®ã€‚ç°åœ¨äººä»¬ç»å¸¸æåˆ°çš„TCP/IPå¹¶ä¸ä¸€å®šå•æŒ‡TCPå’ŒIPè¿™ä¸¤ä¸ªå…·ä½“çš„åè®®ï¼Œè€Œå¾€å¾€è¡¨ç¤ºäº’è”ç½‘æ‰€ä½¿ç”¨çš„æ•´ä¸ªTCP/IPåè®®æ—ã€‚</p><h4 id="æ€»ç»“ä¸€ä¸‹"><a href="#æ€»ç»“ä¸€ä¸‹" class="headerlink" title="æ€»ç»“ä¸€ä¸‹"></a>æ€»ç»“ä¸€ä¸‹</h4><p>ä¸Šé¢æˆ‘ä»¬å¯¹è®¡ç®—æœºç½‘ç»œçš„äº”å±‚ä½“ç³»ç»“æ„æœ‰äº†åˆæ­¥çš„äº†è§£ï¼Œä¸‹é¢é™„é€ä¸€å¼ ä¸ƒå±‚ä½“ç³»ç»“æ„å›¾æ€»ç»“ä¸€ä¸‹ã€‚å›¾ç‰‡æ¥æºï¼š<a href="https://blog.csdn.net/yaopeng_2005/article/details/7064869" target="_blank" rel="noopener">https://blog.csdn.net/yaopeng_2005/article/details/7064869</a></p><h3 id="TCP-ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹"><a href="#TCP-ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹" class="headerlink" title="TCP ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹"></a>TCP ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹</h3><p>ä¸ºäº†å‡†ç¡®æ— è¯¯åœ°æŠŠæ•°æ®é€è¾¾ç›®æ ‡å¤„ï¼ŒTCPåè®®é‡‡ç”¨äº†ä¸‰æ¬¡æ¡æ‰‹ç­–ç•¥ã€‚</p><ul><li>å®¢æˆ·ç«¯â€“å‘é€å¸¦æœ‰ SYN æ ‡å¿—çš„æ•°æ®åŒ…â€“ä¸€æ¬¡æ¡æ‰‹â€“æœåŠ¡ç«¯</li><li>æœåŠ¡ç«¯â€“å‘é€å¸¦æœ‰ SYN/ACK æ ‡å¿—çš„æ•°æ®åŒ…â€“äºŒæ¬¡æ¡æ‰‹â€“å®¢æˆ·ç«¯</li><li>å®¢æˆ·ç«¯â€“å‘é€å¸¦æœ‰å¸¦æœ‰ ACK æ ‡å¿—çš„æ•°æ®åŒ…â€“ä¸‰æ¬¡æ¡æ‰‹â€“æœåŠ¡ç«¯</li></ul><h4 id="ä¸ºä»€ä¹ˆè¦ä¸‰æ¬¡æ¡æ‰‹"><a href="#ä¸ºä»€ä¹ˆè¦ä¸‰æ¬¡æ¡æ‰‹" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ä¸‰æ¬¡æ¡æ‰‹"></a>ä¸ºä»€ä¹ˆè¦ä¸‰æ¬¡æ¡æ‰‹</h4><p><strong>ä¸‰æ¬¡æ¡æ‰‹çš„ç›®çš„æ˜¯å»ºç«‹å¯é çš„é€šä¿¡ä¿¡é“ï¼Œè¯´åˆ°é€šè®¯ï¼Œç®€å•æ¥è¯´å°±æ˜¯æ•°æ®çš„å‘é€ä¸æ¥æ”¶ï¼Œè€Œä¸‰æ¬¡æ¡æ‰‹æœ€ä¸»è¦çš„ç›®çš„å°±æ˜¯åŒæ–¹ç¡®è®¤è‡ªå·±ä¸å¯¹æ–¹çš„å‘é€ä¸æ¥æ”¶æ˜¯æ­£å¸¸çš„ã€‚</strong></p><p>ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼šClient ä»€ä¹ˆéƒ½ä¸èƒ½ç¡®è®¤ï¼›Server ç¡®è®¤äº†å¯¹æ–¹å‘é€æ­£å¸¸ï¼Œè‡ªå·±æ¥æ”¶æ­£å¸¸</p><p>ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼šClient ç¡®è®¤äº†ï¼šè‡ªå·±å‘é€ã€æ¥æ”¶æ­£å¸¸ï¼Œå¯¹æ–¹å‘é€ã€æ¥æ”¶æ­£å¸¸ï¼›Server ç¡®è®¤äº†ï¼šå¯¹æ–¹å‘é€æ­£å¸¸ï¼Œè‡ªå·±æ¥æ”¶æ­£å¸¸</p><p>ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼šClient ç¡®è®¤äº†ï¼šè‡ªå·±å‘é€ã€æ¥æ”¶æ­£å¸¸ï¼Œå¯¹æ–¹å‘é€ã€æ¥æ”¶æ­£å¸¸ï¼›Server ç¡®è®¤äº†ï¼šè‡ªå·±å‘é€ã€æ¥æ”¶æ­£å¸¸ï¼Œå¯¹æ–¹å‘é€ã€æ¥æ”¶æ­£å¸¸</p><p>æ‰€ä»¥ä¸‰æ¬¡æ¡æ‰‹å°±èƒ½ç¡®è®¤åŒå‘æ”¶å‘åŠŸèƒ½éƒ½æ­£å¸¸ï¼Œç¼ºä¸€ä¸å¯ã€‚</p><h4 id="ä¸ºä»€ä¹ˆè¦ä¼ å›-SYN"><a href="#ä¸ºä»€ä¹ˆè¦ä¼ å›-SYN" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ä¼ å› SYN"></a>ä¸ºä»€ä¹ˆè¦ä¼ å› SYN</h4><p>æ¥æ”¶ç«¯ä¼ å›å‘é€ç«¯æ‰€å‘é€çš„ SYN æ˜¯ä¸ºäº†å‘Šè¯‰å‘é€ç«¯ï¼Œæˆ‘æ¥æ”¶åˆ°çš„ä¿¡æ¯ç¡®å®å°±æ˜¯ä½ æ‰€å‘é€çš„ä¿¡å·äº†ã€‚</p><blockquote><p>SYN æ˜¯ TCP/IP å»ºç«‹è¿æ¥æ—¶ä½¿ç”¨çš„æ¡æ‰‹ä¿¡å·ã€‚åœ¨å®¢æˆ·æœºå’ŒæœåŠ¡å™¨ä¹‹é—´å»ºç«‹æ­£å¸¸çš„ TCP ç½‘ç»œè¿æ¥æ—¶ï¼Œå®¢æˆ·æœºé¦–å…ˆå‘å‡ºä¸€ä¸ª SYN æ¶ˆæ¯ï¼ŒæœåŠ¡å™¨ä½¿ç”¨ SYN-ACK åº”ç­”è¡¨ç¤ºæ¥æ”¶åˆ°äº†è¿™ä¸ªæ¶ˆæ¯ï¼Œæœ€åå®¢æˆ·æœºå†ä»¥ ACK(Acknowledgement[æ±‰è¯‘ï¼šç¡®è®¤å­—ç¬¦ ,åœ¨æ•°æ®é€šä¿¡ä¼ è¾“ä¸­ï¼Œæ¥æ”¶ç«™å‘ç»™å‘é€ç«™çš„ä¸€ç§ä¼ è¾“æ§åˆ¶å­—ç¬¦ã€‚å®ƒè¡¨ç¤ºç¡®è®¤å‘æ¥çš„æ•°æ®å·²ç»æ¥å—æ— è¯¯ã€‚ ]ï¼‰æ¶ˆæ¯å“åº”ã€‚è¿™æ ·åœ¨å®¢æˆ·æœºå’ŒæœåŠ¡å™¨ä¹‹é—´æ‰èƒ½å»ºç«‹èµ·å¯é çš„TCPè¿æ¥ï¼Œæ•°æ®æ‰å¯ä»¥åœ¨å®¢æˆ·æœºå’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ é€’ã€‚</p></blockquote><h4 id="ä¼ äº†-SYN-ä¸ºå•¥è¿˜è¦ä¼ -ACK"><a href="#ä¼ äº†-SYN-ä¸ºå•¥è¿˜è¦ä¼ -ACK" class="headerlink" title="ä¼ äº† SYN,ä¸ºå•¥è¿˜è¦ä¼  ACK"></a>ä¼ äº† SYN,ä¸ºå•¥è¿˜è¦ä¼  ACK</h4><p>åŒæ–¹é€šä¿¡æ— è¯¯å¿…é¡»æ˜¯ä¸¤è€…äº’ç›¸å‘é€ä¿¡æ¯éƒ½æ— è¯¯ã€‚ä¼ äº† SYNï¼Œè¯æ˜å‘é€æ–¹åˆ°æ¥æ”¶æ–¹çš„é€šé“æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯æ¥æ”¶æ–¹åˆ°å‘é€æ–¹çš„é€šé“è¿˜éœ€è¦ ACK ä¿¡å·æ¥è¿›è¡ŒéªŒè¯ã€‚</p><p>æ–­å¼€ä¸€ä¸ª TCP è¿æ¥åˆ™éœ€è¦â€œå››æ¬¡æŒ¥æ‰‹â€ï¼š</p><ul><li>å®¢æˆ·ç«¯-å‘é€ä¸€ä¸ª FINï¼Œç”¨æ¥å…³é—­å®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨çš„æ•°æ®ä¼ é€</li><li>æœåŠ¡å™¨-æ”¶åˆ°è¿™ä¸ª FINï¼Œå®ƒå‘å›ä¸€ ä¸ª ACKï¼Œç¡®è®¤åºå·ä¸ºæ”¶åˆ°çš„åºå·åŠ 1 ã€‚å’Œ SYN ä¸€æ ·ï¼Œä¸€ä¸ª FIN å°†å ç”¨ä¸€ä¸ªåºå·</li><li>æœåŠ¡å™¨-å…³é—­ä¸å®¢æˆ·ç«¯çš„è¿æ¥ï¼Œå‘é€ä¸€ä¸ªFINç»™å®¢æˆ·ç«¯</li><li>å®¢æˆ·ç«¯-å‘å› ACK æŠ¥æ–‡ç¡®è®¤ï¼Œå¹¶å°†ç¡®è®¤åºå·è®¾ç½®ä¸ºæ”¶åˆ°åºå·åŠ 1</li></ul><h4 id="ä¸ºä»€ä¹ˆè¦å››æ¬¡æŒ¥æ‰‹"><a href="#ä¸ºä»€ä¹ˆè¦å››æ¬¡æŒ¥æ‰‹" class="headerlink" title="ä¸ºä»€ä¹ˆè¦å››æ¬¡æŒ¥æ‰‹"></a>ä¸ºä»€ä¹ˆè¦å››æ¬¡æŒ¥æ‰‹</h4><p>ä»»ä½•ä¸€æ–¹éƒ½å¯ä»¥åœ¨æ•°æ®ä¼ é€ç»“æŸåå‘å‡ºè¿æ¥é‡Šæ”¾çš„é€šçŸ¥ï¼Œå¾…å¯¹æ–¹ç¡®è®¤åè¿›å…¥åŠå…³é—­çŠ¶æ€ã€‚å½“å¦ä¸€æ–¹ä¹Ÿæ²¡æœ‰æ•°æ®å†å‘é€çš„æ—¶å€™ï¼Œåˆ™å‘å‡ºè¿æ¥é‡Šæ”¾é€šçŸ¥ï¼Œå¯¹æ–¹ç¡®è®¤åå°±å®Œå…¨å…³é—­äº†TCPè¿æ¥ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼šA å’Œ B æ‰“ç”µè¯ï¼Œé€šè¯å³å°†ç»“æŸåï¼ŒA è¯´â€œæˆ‘æ²¡å•¥è¦è¯´çš„äº†â€ï¼ŒBå›ç­”â€œæˆ‘çŸ¥é“äº†â€ï¼Œä½†æ˜¯ B å¯èƒ½è¿˜ä¼šæœ‰è¦è¯´çš„è¯ï¼ŒA ä¸èƒ½è¦æ±‚ B è·Ÿç€è‡ªå·±çš„èŠ‚å¥ç»“æŸé€šè¯ï¼Œäºæ˜¯ B å¯èƒ½åˆå·´æ‹‰å·´æ‹‰è¯´äº†ä¸€é€šï¼Œæœ€å B è¯´â€œæˆ‘è¯´å®Œäº†â€ï¼ŒA å›ç­”â€œçŸ¥é“äº†â€ï¼Œè¿™æ ·é€šè¯æ‰ç®—ç»“æŸã€‚</p><p>ä¸Šé¢è®²çš„æ¯”è¾ƒæ¦‚æ‹¬ï¼Œæ¨èä¸€ç¯‡è®²çš„æ¯”è¾ƒç»†è‡´çš„æ–‡ç« ï¼š<a href="https://blog.csdn.net/qzcsu/article/details/72861891" target="_blank" rel="noopener">https://blog.csdn.net/qzcsu/article/details/72861891</a></p><h3 id="TCPã€UDP-åè®®çš„åŒºåˆ«"><a href="#TCPã€UDP-åè®®çš„åŒºåˆ«" class="headerlink" title="TCPã€UDP åè®®çš„åŒºåˆ«"></a>TCPã€UDP åè®®çš„åŒºåˆ«</h3><p><img src="http://m.qpic.cn/psb?/V11tv2Vw2h2WsJ/8Mtws13i04*MNhxm7c6NUQukdKULAlH2ajFaBni3uZc!/b/dDQBAAAAAAAA&bo=YQPbAGED2wADGTw!&rf=viewer_4" alt="TCPã€UDPåè®®çš„åŒºåˆ«"></p><p>UDP åœ¨ä¼ é€æ•°æ®ä¹‹å‰ä¸éœ€è¦å…ˆå»ºç«‹è¿æ¥ï¼Œè¿œåœ°ä¸»æœºåœ¨æ”¶åˆ° UDP æŠ¥æ–‡åï¼Œä¸éœ€è¦ç»™å‡ºä»»ä½•ç¡®è®¤ã€‚è™½ç„¶ UDP ä¸æä¾›å¯é äº¤ä»˜ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ UDP ç¡®æ˜¯ä¸€ç§æœ€æœ‰æ•ˆçš„å·¥ä½œæ–¹å¼ï¼ˆä¸€èˆ¬ç”¨äºå³æ—¶é€šä¿¡ï¼‰ï¼Œæ¯”å¦‚ï¼š QQ è¯­éŸ³ã€ QQ è§†é¢‘ ã€ç›´æ’­ç­‰ç­‰</p><p>TCP æä¾›é¢å‘è¿æ¥çš„æœåŠ¡ã€‚åœ¨ä¼ é€æ•°æ®ä¹‹å‰å¿…é¡»å…ˆå»ºç«‹è¿æ¥ï¼Œæ•°æ®ä¼ é€ç»“æŸåè¦é‡Šæ”¾è¿æ¥ã€‚ TCP ä¸æä¾›å¹¿æ’­æˆ–å¤šæ’­æœåŠ¡ã€‚ç”±äº TCP è¦æä¾›å¯é çš„ï¼Œé¢å‘è¿æ¥çš„ä¼ è¾“æœåŠ¡ï¼ˆTCPçš„å¯é ä½“ç°åœ¨TCPåœ¨ä¼ é€’æ•°æ®ä¹‹å‰ï¼Œä¼šæœ‰ä¸‰æ¬¡æ¡æ‰‹æ¥å»ºç«‹è¿æ¥ï¼Œè€Œä¸”åœ¨æ•°æ®ä¼ é€’æ—¶ï¼Œæœ‰ç¡®è®¤ã€çª—å£ã€é‡ä¼ ã€æ‹¥å¡æ§åˆ¶æœºåˆ¶ï¼Œåœ¨æ•°æ®ä¼ å®Œåï¼Œè¿˜ä¼šæ–­å¼€è¿æ¥ç”¨æ¥èŠ‚çº¦ç³»ç»Ÿèµ„æºï¼‰ï¼Œè¿™ä¸€éš¾ä»¥é¿å…å¢åŠ äº†è®¸å¤šå¼€é”€ï¼Œå¦‚ç¡®è®¤ï¼Œæµé‡æ§åˆ¶ï¼Œè®¡æ—¶å™¨ä»¥åŠè¿æ¥ç®¡ç†ç­‰ã€‚è¿™ä¸ä»…ä½¿åè®®æ•°æ®å•å…ƒçš„é¦–éƒ¨å¢å¤§å¾ˆå¤šï¼Œè¿˜è¦å ç”¨è®¸å¤šå¤„ç†æœºèµ„æºã€‚TCP ä¸€èˆ¬ç”¨äºæ–‡ä»¶ä¼ è¾“ã€å‘é€å’Œæ¥æ”¶é‚®ä»¶ã€è¿œç¨‹ç™»å½•ç­‰åœºæ™¯ã€‚</p><h3 id="TCP-åè®®å¦‚ä½•ä¿è¯å¯é ä¼ è¾“"><a href="#TCP-åè®®å¦‚ä½•ä¿è¯å¯é ä¼ è¾“" class="headerlink" title="TCP åè®®å¦‚ä½•ä¿è¯å¯é ä¼ è¾“"></a>TCP åè®®å¦‚ä½•ä¿è¯å¯é ä¼ è¾“</h3><ol><li>åº”ç”¨æ•°æ®è¢«åˆ†å‰²æˆ TCP è®¤ä¸ºæœ€é€‚åˆå‘é€çš„æ•°æ®å—ã€‚</li><li>TCP ç»™å‘é€çš„æ¯ä¸€ä¸ªåŒ…è¿›è¡Œç¼–å·ï¼Œæ¥æ”¶æ–¹å¯¹æ•°æ®åŒ…è¿›è¡Œæ’åºï¼ŒæŠŠæœ‰åºæ•°æ®ä¼ é€ç»™åº”ç”¨å±‚ã€‚</li><li><strong>æ ¡éªŒå’Œï¼š</strong> TCP å°†ä¿æŒå®ƒé¦–éƒ¨å’Œæ•°æ®çš„æ£€éªŒå’Œã€‚è¿™æ˜¯ä¸€ä¸ªç«¯åˆ°ç«¯çš„æ£€éªŒå’Œï¼Œç›®çš„æ˜¯æ£€æµ‹æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­çš„ä»»ä½•å˜åŒ–ã€‚å¦‚æœæ”¶åˆ°æ®µçš„æ£€éªŒå’Œæœ‰å·®é”™ï¼ŒTCP å°†ä¸¢å¼ƒè¿™ä¸ªæŠ¥æ–‡æ®µå’Œä¸ç¡®è®¤æ”¶åˆ°æ­¤æŠ¥æ–‡æ®µã€‚</li><li>TCP çš„æ¥æ”¶ç«¯ä¼šä¸¢å¼ƒé‡å¤çš„æ•°æ®ã€‚</li><li><strong>æµé‡æ§åˆ¶ï¼š</strong> TCP è¿æ¥çš„æ¯ä¸€æ–¹éƒ½æœ‰å›ºå®šå¤§å°çš„ç¼“å†²ç©ºé—´ï¼ŒTCPçš„æ¥æ”¶ç«¯åªå…è®¸å‘é€ç«¯å‘é€æ¥æ”¶ç«¯ç¼“å†²åŒºèƒ½æ¥çº³çš„æ•°æ®ã€‚å½“æ¥æ”¶æ–¹æ¥ä¸åŠå¤„ç†å‘é€æ–¹çš„æ•°æ®ï¼Œèƒ½æç¤ºå‘é€æ–¹é™ä½å‘é€çš„é€Ÿç‡ï¼Œé˜²æ­¢åŒ…ä¸¢å¤±ã€‚TCP ä½¿ç”¨çš„æµé‡æ§åˆ¶åè®®æ˜¯å¯å˜å¤§å°çš„æ»‘åŠ¨çª—å£åè®®ã€‚ ï¼ˆTCP åˆ©ç”¨æ»‘åŠ¨çª—å£å®ç°æµé‡æ§åˆ¶ï¼‰</li><li><strong>æ‹¥å¡æ§åˆ¶ï¼š</strong> å½“ç½‘ç»œæ‹¥å¡æ—¶ï¼Œå‡å°‘æ•°æ®çš„å‘é€ã€‚</li><li><strong>ARQåè®®ï¼š</strong> ä¹Ÿæ˜¯ä¸ºäº†å®ç°å¯é ä¼ è¾“çš„ï¼Œå®ƒçš„åŸºæœ¬åŸç†å°±æ˜¯æ¯å‘å®Œä¸€ä¸ªåˆ†ç»„å°±åœæ­¢å‘é€ï¼Œç­‰å¾…å¯¹æ–¹ç¡®è®¤ã€‚åœ¨æ”¶åˆ°ç¡®è®¤åå†å‘ä¸‹ä¸€ä¸ªåˆ†ç»„ã€‚</li><li><strong>è¶…æ—¶é‡ä¼ ï¼š</strong> å½“ TCP å‘å‡ºä¸€ä¸ªæ®µåï¼Œå®ƒå¯åŠ¨ä¸€ä¸ªå®šæ—¶å™¨ï¼Œç­‰å¾…ç›®çš„ç«¯ç¡®è®¤æ”¶åˆ°è¿™ä¸ªæŠ¥æ–‡æ®µã€‚å¦‚æœä¸èƒ½åŠæ—¶æ”¶åˆ°ä¸€ä¸ªç¡®è®¤ï¼Œå°†é‡å‘è¿™ä¸ªæŠ¥æ–‡æ®µã€‚</li></ol><h4 id="ARQåè®®"><a href="#ARQåè®®" class="headerlink" title="ARQåè®®"></a>ARQåè®®</h4><p><strong>è‡ªåŠ¨é‡ä¼ è¯·æ±‚</strong>ï¼ˆAutomatic Repeat-reQuestï¼ŒARQï¼‰æ˜¯OSIæ¨¡å‹ä¸­æ•°æ®é“¾è·¯å±‚å’Œä¼ è¾“å±‚çš„é”™è¯¯çº æ­£åè®®ä¹‹ä¸€ã€‚å®ƒé€šè¿‡ä½¿ç”¨ç¡®è®¤å’Œè¶…æ—¶è¿™ä¸¤ä¸ªæœºåˆ¶ï¼Œåœ¨ä¸å¯é æœåŠ¡çš„åŸºç¡€ä¸Šå®ç°å¯é çš„ä¿¡æ¯ä¼ è¾“ã€‚å¦‚æœå‘é€æ–¹åœ¨å‘é€åä¸€æ®µæ—¶é—´ä¹‹å†…æ²¡æœ‰æ”¶åˆ°ç¡®è®¤å¸§ï¼Œå®ƒé€šå¸¸ä¼šé‡æ–°å‘é€ã€‚ARQåŒ…æ‹¬åœæ­¢ç­‰å¾…ARQåè®®å’Œè¿ç»­ARQåè®®ã€‚</p><h4 id="åœæ­¢ç­‰å¾…ARQåè®®"><a href="#åœæ­¢ç­‰å¾…ARQåè®®" class="headerlink" title="åœæ­¢ç­‰å¾…ARQåè®®"></a>åœæ­¢ç­‰å¾…ARQåè®®</h4><ul><li>åœæ­¢ç­‰å¾…åè®®æ˜¯ä¸ºäº†å®ç°å¯é ä¼ è¾“çš„ï¼Œå®ƒçš„åŸºæœ¬åŸç†å°±æ˜¯æ¯å‘å®Œä¸€ä¸ªåˆ†ç»„å°±åœæ­¢å‘é€ï¼Œç­‰å¾…å¯¹æ–¹ç¡®è®¤ï¼ˆå›å¤ACKï¼‰ã€‚å¦‚æœè¿‡äº†ä¸€æ®µæ—¶é—´ï¼ˆè¶…æ—¶æ—¶é—´åï¼‰ï¼Œè¿˜æ˜¯æ²¡æœ‰æ”¶åˆ° ACK ç¡®è®¤ï¼Œè¯´æ˜æ²¡æœ‰å‘é€æˆåŠŸï¼Œéœ€è¦é‡æ–°å‘é€ï¼Œç›´åˆ°æ”¶åˆ°ç¡®è®¤åå†å‘ä¸‹ä¸€ä¸ªåˆ†ç»„ï¼›</li><li>åœ¨åœæ­¢ç­‰å¾…åè®®ä¸­ï¼Œè‹¥æ¥æ”¶æ–¹æ”¶åˆ°é‡å¤åˆ†ç»„ï¼Œå°±ä¸¢å¼ƒè¯¥åˆ†ç»„ï¼Œä½†åŒæ—¶è¿˜è¦å‘é€ç¡®è®¤ï¼›</li></ul><h4 id="æ»‘åŠ¨çª—å£å’Œæµé‡æ§åˆ¶"><a href="#æ»‘åŠ¨çª—å£å’Œæµé‡æ§åˆ¶" class="headerlink" title="æ»‘åŠ¨çª—å£å’Œæµé‡æ§åˆ¶"></a>æ»‘åŠ¨çª—å£å’Œæµé‡æ§åˆ¶</h4><p><strong>TCP åˆ©ç”¨æ»‘åŠ¨çª—å£å®ç°æµé‡æ§åˆ¶ã€‚æµé‡æ§åˆ¶æ˜¯ä¸ºäº†æ§åˆ¶å‘é€æ–¹å‘é€é€Ÿç‡ï¼Œä¿è¯æ¥æ”¶æ–¹æ¥å¾—åŠæ¥æ”¶ã€‚</strong> æ¥æ”¶æ–¹å‘é€çš„ç¡®è®¤æŠ¥æ–‡ä¸­çš„çª—å£å­—æ®µå¯ä»¥ç”¨æ¥æ§åˆ¶å‘é€æ–¹çª—å£å¤§å°ï¼Œä»è€Œå½±å“å‘é€æ–¹çš„å‘é€é€Ÿç‡ã€‚å°†çª—å£å­—æ®µè®¾ç½®ä¸º 0ï¼Œåˆ™å‘é€æ–¹ä¸èƒ½å‘é€æ•°æ®ã€‚</p><h4 id="æ‹¥å¡æ§åˆ¶"><a href="#æ‹¥å¡æ§åˆ¶" class="headerlink" title="æ‹¥å¡æ§åˆ¶"></a>æ‹¥å¡æ§åˆ¶</h4><p>åœ¨æŸæ®µæ—¶é—´ï¼Œè‹¥å¯¹ç½‘ç»œä¸­æŸä¸€èµ„æºçš„éœ€æ±‚è¶…è¿‡äº†è¯¥èµ„æºæ‰€èƒ½æä¾›çš„å¯ç”¨éƒ¨åˆ†ï¼Œç½‘ç»œçš„æ€§èƒ½å°±è¦å˜åã€‚è¿™ç§æƒ…å†µå°±å«æ‹¥å¡ã€‚æ‹¥å¡æ§åˆ¶å°±æ˜¯ä¸ºäº†é˜²æ­¢è¿‡å¤šçš„æ•°æ®æ³¨å…¥åˆ°ç½‘ç»œä¸­ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç½‘ç»œä¸­çš„è·¯ç”±å™¨æˆ–é“¾è·¯ä¸è‡´è¿‡è½½ã€‚æ‹¥å¡æ§åˆ¶æ‰€è¦åšçš„éƒ½æœ‰ä¸€ä¸ªå‰æï¼Œå°±æ˜¯ç½‘ç»œèƒ½å¤Ÿæ‰¿å—ç°æœ‰çš„ç½‘ç»œè´Ÿè·ã€‚æ‹¥å¡æ§åˆ¶æ˜¯ä¸€ä¸ªå…¨å±€æ€§çš„è¿‡ç¨‹ï¼Œæ¶‰åŠåˆ°æ‰€æœ‰çš„ä¸»æœºï¼Œæ‰€æœ‰çš„è·¯ç”±å™¨ï¼Œä»¥åŠä¸é™ä½ç½‘ç»œä¼ è¾“æ€§èƒ½æœ‰å…³çš„æ‰€æœ‰å› ç´ ã€‚ç›¸åï¼Œæµé‡æ§åˆ¶å¾€å¾€æ˜¯ç‚¹å¯¹ç‚¹é€šä¿¡é‡çš„æ§åˆ¶ï¼Œæ˜¯ä¸ªç«¯åˆ°ç«¯çš„é—®é¢˜ã€‚æµé‡æ§åˆ¶æ‰€è¦åšåˆ°çš„å°±æ˜¯æŠ‘åˆ¶å‘é€ç«¯å‘é€æ•°æ®çš„é€Ÿç‡ï¼Œä»¥ä¾¿ä½¿æ¥æ”¶ç«¯æ¥å¾—åŠæ¥æ”¶ã€‚</p><p>ä¸ºäº†è¿›è¡Œæ‹¥å¡æ§åˆ¶ï¼ŒTCP å‘é€æ–¹è¦ç»´æŒä¸€ä¸ª <strong>æ‹¥å¡çª—å£(cwnd)</strong> çš„çŠ¶æ€å˜é‡ã€‚æ‹¥å¡æ§åˆ¶çª—å£çš„å¤§å°å–å†³äºç½‘ç»œçš„æ‹¥å¡ç¨‹åº¦ï¼Œå¹¶ä¸”åŠ¨æ€å˜åŒ–ã€‚å‘é€æ–¹è®©è‡ªå·±çš„å‘é€çª—å£å–ä¸ºæ‹¥å¡çª—å£å’Œæ¥æ”¶æ–¹çš„æ¥å—çª—å£ä¸­è¾ƒå°çš„ä¸€ä¸ªã€‚</p><p>TCPçš„æ‹¥å¡æ§åˆ¶é‡‡ç”¨äº†å››ç§ç®—æ³•ï¼Œå³ <strong>æ…¢å¼€å§‹</strong> ã€ <strong>æ‹¥å¡é¿å…</strong> ã€<strong>å¿«é‡ä¼ </strong> å’Œ <strong>å¿«æ¢å¤</strong>ã€‚åœ¨ç½‘ç»œå±‚ä¹Ÿå¯ä»¥ä½¿è·¯ç”±å™¨é‡‡ç”¨é€‚å½“çš„åˆ†ç»„ä¸¢å¼ƒç­–ç•¥ï¼ˆå¦‚ä¸»åŠ¨é˜Ÿåˆ—ç®¡ç† AQMï¼‰ï¼Œä»¥å‡å°‘ç½‘ç»œæ‹¥å¡çš„å‘ç”Ÿã€‚</p><ul><li><strong>æ…¢å¼€å§‹ï¼š</strong> æ…¢å¼€å§‹ç®—æ³•çš„æ€è·¯æ˜¯å½“ä¸»æœºå¼€å§‹å‘é€æ•°æ®æ—¶ï¼Œå¦‚æœç«‹å³æŠŠå¤§é‡æ•°æ®å­—èŠ‚æ³¨å…¥åˆ°ç½‘ç»œï¼Œé‚£ä¹ˆå¯èƒ½ä¼šå¼•èµ·ç½‘ç»œé˜»å¡ï¼Œå› ä¸ºç°åœ¨è¿˜ä¸çŸ¥é“ç½‘ç»œçš„ç¬¦åˆæƒ…å†µã€‚ç»éªŒè¡¨æ˜ï¼Œè¾ƒå¥½çš„æ–¹æ³•æ˜¯å…ˆæ¢æµ‹ä¸€ä¸‹ï¼Œå³ç”±å°åˆ°å¤§é€æ¸å¢å¤§å‘é€çª—å£ï¼Œä¹Ÿå°±æ˜¯ç”±å°åˆ°å¤§é€æ¸å¢å¤§æ‹¥å¡çª—å£æ•°å€¼ã€‚cwndåˆå§‹å€¼ä¸º1ï¼Œæ¯ç»è¿‡ä¸€ä¸ªä¼ æ’­è½®æ¬¡ï¼ŒcwndåŠ å€ã€‚</li><li><strong>æ‹¥å¡é¿å…ï¼š</strong> æ‹¥å¡é¿å…ç®—æ³•çš„æ€è·¯æ˜¯è®©æ‹¥å¡çª—å£cwndç¼“æ…¢å¢å¤§ï¼Œå³æ¯ç»è¿‡ä¸€ä¸ªå¾€è¿”æ—¶é—´RTTå°±æŠŠå‘é€æ”¾çš„cwndåŠ 1.</li><li><strong>å¿«é‡ä¼ ä¸å¿«æ¢å¤ï¼š</strong> åœ¨ TCP/IP ä¸­ï¼Œå¿«é€Ÿé‡ä¼ å’Œæ¢å¤ï¼ˆfast retransmit and recoveryï¼ŒFRRï¼‰æ˜¯ä¸€ç§æ‹¥å¡æ§åˆ¶ç®—æ³•ï¼Œå®ƒèƒ½å¿«é€Ÿæ¢å¤ä¸¢å¤±çš„æ•°æ®åŒ…ã€‚æ²¡æœ‰ FRRï¼Œå¦‚æœæ•°æ®åŒ…ä¸¢å¤±äº†ï¼ŒTCP å°†ä¼šä½¿ç”¨å®šæ—¶å™¨æ¥è¦æ±‚ä¼ è¾“æš‚åœã€‚åœ¨æš‚åœçš„è¿™æ®µæ—¶é—´å†…ï¼Œæ²¡æœ‰æ–°çš„æˆ–å¤åˆ¶çš„æ•°æ®åŒ…è¢«å‘é€ã€‚æœ‰äº† FRRï¼Œå¦‚æœæ¥æ”¶æœºæ¥æ”¶åˆ°ä¸€ä¸ªä¸æŒ‰é¡ºåºçš„æ•°æ®æ®µï¼Œå®ƒä¼šç«‹å³ç»™å‘é€æœºå‘é€ä¸€ä¸ªé‡å¤ç¡®è®¤ã€‚å¦‚æœå‘é€æœºæ¥æ”¶åˆ°ä¸‰ä¸ªé‡å¤ç¡®è®¤ï¼Œå®ƒä¼šå‡å®šç¡®è®¤ä»¶æŒ‡å‡ºçš„æ•°æ®æ®µä¸¢å¤±äº†ï¼Œå¹¶ç«‹å³é‡ä¼ è¿™äº›ä¸¢å¤±çš„æ•°æ®æ®µã€‚æœ‰äº† FRRï¼Œå°±ä¸ä¼šå› ä¸ºé‡ä¼ æ—¶è¦æ±‚çš„æš‚åœè¢«è€½è¯¯ã€‚ ã€€å½“æœ‰å•ç‹¬çš„æ•°æ®åŒ…ä¸¢å¤±æ—¶ï¼Œå¿«é€Ÿé‡ä¼ å’Œæ¢å¤ï¼ˆFRRï¼‰èƒ½æœ€æœ‰æ•ˆåœ°å·¥ä½œã€‚å½“æœ‰å¤šä¸ªæ•°æ®ä¿¡æ¯åŒ…åœ¨æŸä¸€æ®µå¾ˆçŸ­çš„æ—¶é—´å†…ä¸¢å¤±æ—¶ï¼Œå®ƒåˆ™ä¸èƒ½å¾ˆæœ‰æ•ˆåœ°å·¥ä½œã€‚</li></ul><h3 id="URL-åˆ°ç½‘é¡µæ˜¾ç¤º"><a href="#URL-åˆ°ç½‘é¡µæ˜¾ç¤º" class="headerlink" title="URL åˆ°ç½‘é¡µæ˜¾ç¤º"></a>URL åˆ°ç½‘é¡µæ˜¾ç¤º</h3><p>å›¾è§£ï¼ˆå›¾ç‰‡æ¥æºï¼šã€Šå›¾è§£HTTPã€‹ï¼‰ï¼š</p><p><img src="http://m.qpic.cn/psb?/V11tv2Vw2h2WsJ/krh8m5lpufZU6OX9enXcVdQrVltJTku3irYOENXzFxM!/b/dFMBAAAAAAAA&bo=1AI.AtQCPgIDKQw!&rf=viewer_4" alt="çŠ¶æ€ç "></p><p>æ€»ä½“æ¥è¯´åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªè¿‡ç¨‹:</p><ol><li>DNSè§£æ</li><li>TCPè¿æ¥</li><li>å‘é€HTTPè¯·æ±‚</li><li>æœåŠ¡å™¨å¤„ç†è¯·æ±‚å¹¶è¿”å›HTTPæŠ¥æ–‡</li><li>æµè§ˆå™¨è§£ææ¸²æŸ“é¡µé¢</li><li>è¿æ¥ç»“æŸ</li></ol><h3 id="å„ç§åè®®ä¸HTTPåè®®"><a href="#å„ç§åè®®ä¸HTTPåè®®" class="headerlink" title="å„ç§åè®®ä¸HTTPåè®®"></a>å„ç§åè®®ä¸HTTPåè®®</h3><p><img src="http://m.qpic.cn/psb?/V11tv2Vw2h2WsJ/08ikSdkksqhIeEzyW6wrL6*jbSfpvdT2Kr.BKbEOhO4!/b/dDMBAAAAAAAA&bo=SQOpBEkDqQQDSWw!&rf=viewer_4" alt="å„ç§åè®®ä¸HTTPåè®®ä¹‹é—´çš„å…³ç³»"></p><h3 id="HTTPé•¿è¿æ¥ã€çŸ­è¿æ¥"><a href="#HTTPé•¿è¿æ¥ã€çŸ­è¿æ¥" class="headerlink" title="HTTPé•¿è¿æ¥ã€çŸ­è¿æ¥"></a>HTTPé•¿è¿æ¥ã€çŸ­è¿æ¥</h3><p>åœ¨HTTP/1.0ä¸­é»˜è®¤ä½¿ç”¨çŸ­è¿æ¥ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨æ¯è¿›è¡Œä¸€æ¬¡HTTPæ“ä½œï¼Œå°±å»ºç«‹ä¸€æ¬¡è¿æ¥ï¼Œä»»åŠ¡ç»“æŸå°±ä¸­æ–­è¿æ¥ã€‚å½“å®¢æˆ·ç«¯æµè§ˆå™¨è®¿é—®çš„æŸä¸ªHTMLæˆ–å…¶ä»–ç±»å‹çš„Webé¡µä¸­åŒ…å«æœ‰å…¶ä»–çš„Webèµ„æºï¼ˆå¦‚JavaScriptæ–‡ä»¶ã€å›¾åƒæ–‡ä»¶ã€CSSæ–‡ä»¶ç­‰ï¼‰ï¼Œæ¯é‡åˆ°è¿™æ ·ä¸€ä¸ªWebèµ„æºï¼Œæµè§ˆå™¨å°±ä¼šé‡æ–°å»ºç«‹ä¸€ä¸ªHTTPä¼šè¯ã€‚</p><p>è€Œä»HTTP/1.1èµ·ï¼Œé»˜è®¤ä½¿ç”¨é•¿è¿æ¥ï¼Œç”¨ä»¥ä¿æŒè¿æ¥ç‰¹æ€§ã€‚ä½¿ç”¨é•¿è¿æ¥çš„HTTPåè®®ï¼Œä¼šåœ¨å“åº”å¤´åŠ å…¥è¿™è¡Œä»£ç ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Connection:keep-alive</span><br></pre></td></tr></table></figure><p>åœ¨ä½¿ç”¨é•¿è¿æ¥çš„æƒ…å†µä¸‹ï¼Œå½“ä¸€ä¸ªç½‘é¡µæ‰“å¼€å®Œæˆåï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ç”¨äºä¼ è¾“HTTPæ•°æ®çš„TCPè¿æ¥ä¸ä¼šå…³é—­ï¼Œå®¢æˆ·ç«¯å†æ¬¡è®¿é—®è¿™ä¸ªæœåŠ¡å™¨æ—¶ï¼Œä¼šç»§ç»­ä½¿ç”¨è¿™ä¸€æ¡å·²ç»å»ºç«‹çš„è¿æ¥ã€‚Keep-Aliveä¸ä¼šæ°¸ä¹…ä¿æŒè¿æ¥ï¼Œå®ƒæœ‰ä¸€ä¸ªä¿æŒæ—¶é—´ï¼Œå¯ä»¥åœ¨ä¸åŒçš„æœåŠ¡å™¨è½¯ä»¶ï¼ˆå¦‚Apacheï¼‰ä¸­è®¾å®šè¿™ä¸ªæ—¶é—´ã€‚å®ç°é•¿è¿æ¥éœ€è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½æ”¯æŒé•¿è¿æ¥ã€‚</p><p><strong>HTTPåè®®çš„é•¿è¿æ¥å’ŒçŸ­è¿æ¥ï¼Œå®è´¨ä¸Šæ˜¯TCPåè®®çš„é•¿è¿æ¥å’ŒçŸ­è¿æ¥ã€‚</strong></p><p>â€”â€” <a href="https://www.cnblogs.com/gotodsp/p/6366163.html" target="_blank" rel="noopener">ã€ŠHTTPé•¿è¿æ¥ã€çŸ­è¿æ¥ç©¶ç«Ÿæ˜¯ä»€ä¹ˆï¼Ÿã€‹</a></p><h3 id="HTTPçŠ¶æ€ä¿å­˜æœºåˆ¶"><a href="#HTTPçŠ¶æ€ä¿å­˜æœºåˆ¶" class="headerlink" title="HTTPçŠ¶æ€ä¿å­˜æœºåˆ¶"></a>HTTPçŠ¶æ€ä¿å­˜æœºåˆ¶</h3><p>HTTP æ˜¯ä¸€ç§ä¸ä¿å­˜çŠ¶æ€ï¼Œå³æ— çŠ¶æ€ï¼ˆstatelessï¼‰åè®®ã€‚ä¹Ÿå°±æ˜¯è¯´ HTTP åè®®è‡ªèº«ä¸å¯¹è¯·æ±‚å’Œå“åº”ä¹‹é—´çš„é€šä¿¡çŠ¶æ€è¿›è¡Œä¿å­˜ã€‚é‚£ä¹ˆæˆ‘ä»¬ä¿å­˜ç”¨æˆ·çŠ¶æ€å‘¢ï¼ŸSession æœºåˆ¶çš„å­˜åœ¨å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒSession çš„ä¸»è¦ä½œç”¨å°±æ˜¯é€šè¿‡æœåŠ¡ç«¯è®°å½•ç”¨æˆ·çš„çŠ¶æ€ã€‚å…¸å‹çš„åœºæ™¯æ˜¯è´­ç‰©è½¦ï¼Œå½“ä½ è¦æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦çš„æ—¶å€™ï¼Œç³»ç»Ÿä¸çŸ¥é“æ˜¯å“ªä¸ªç”¨æˆ·æ“ä½œçš„ï¼Œå› ä¸º HTTP åè®®æ˜¯æ— çŠ¶æ€çš„ã€‚æœåŠ¡ç«¯ç»™ç‰¹å®šçš„ç”¨æˆ·åˆ›å»ºç‰¹å®šçš„ Session ä¹‹åå°±å¯ä»¥æ ‡è¯†è¿™ä¸ªç”¨æˆ·å¹¶ä¸”è·Ÿè¸ªè¿™ä¸ªç”¨æˆ·äº†ï¼ˆä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨ä¼šåœ¨ä¸€å®šæ—¶é—´å†…ä¿å­˜è¿™ä¸ª Sessionï¼Œè¿‡äº†æ—¶é—´é™åˆ¶ï¼Œå°±ä¼šé”€æ¯è¿™ä¸ªSessionï¼‰ã€‚</p><p>åœ¨æœåŠ¡ç«¯ä¿å­˜ Session çš„æ–¹æ³•å¾ˆå¤šï¼Œæœ€å¸¸ç”¨çš„å°±æ˜¯å†…å­˜å’Œæ•°æ®åº“(æ¯”å¦‚æ˜¯ä½¿ç”¨å†…å­˜æ•°æ®åº“redisä¿å­˜)ã€‚æ—¢ç„¶ Session å­˜æ”¾åœ¨æœåŠ¡å™¨ç«¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•å®ç° Session è·Ÿè¸ªå‘¢ï¼Ÿå¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½æ˜¯é€šè¿‡åœ¨ Cookie ä¸­é™„åŠ ä¸€ä¸ª Session ID æ¥æ–¹å¼æ¥è·Ÿè¸ªã€‚</p><p><strong>Cookie è¢«ç¦ç”¨æ€ä¹ˆåŠ?</strong></p><p>æœ€å¸¸ç”¨çš„å°±æ˜¯åˆ©ç”¨ URL é‡å†™æŠŠ Session ID ç›´æ¥é™„åŠ åœ¨URLè·¯å¾„çš„åé¢ã€‚</p><h3 id="Cookieã€Sessionçš„è§£æ"><a href="#Cookieã€Sessionçš„è§£æ" class="headerlink" title="Cookieã€Sessionçš„è§£æ"></a>Cookieã€Sessionçš„è§£æ</h3><p>Cookie å’Œ Sessionéƒ½æ˜¯ç”¨æ¥è·Ÿè¸ªæµè§ˆå™¨ç”¨æˆ·èº«ä»½çš„ä¼šè¯æ–¹å¼ï¼Œä½†æ˜¯ä¸¤è€…çš„åº”ç”¨åœºæ™¯ä¸å¤ªä¸€æ ·ã€‚</p><p><strong>Cookie ä¸€èˆ¬ç”¨æ¥ä¿å­˜ç”¨æˆ·ä¿¡æ¯</strong> æ¯”å¦‚â‘ æˆ‘ä»¬åœ¨ Cookie ä¸­ä¿å­˜å·²ç»ç™»å½•è¿‡å¾—ç”¨æˆ·ä¿¡æ¯ï¼Œä¸‹æ¬¡è®¿é—®ç½‘ç«™çš„æ—¶å€™é¡µé¢å¯ä»¥è‡ªåŠ¨å¸®ä½ ç™»å½•çš„ä¸€äº›åŸºæœ¬ä¿¡æ¯ç»™å¡«äº†ï¼›â‘¡ä¸€èˆ¬çš„ç½‘ç«™éƒ½ä¼šæœ‰ä¿æŒç™»å½•ä¹Ÿå°±æ˜¯è¯´ä¸‹æ¬¡ä½ å†è®¿é—®ç½‘ç«™çš„æ—¶å€™å°±ä¸éœ€è¦é‡æ–°ç™»å½•äº†ï¼Œè¿™æ˜¯å› ä¸ºç”¨æˆ·ç™»å½•çš„æ—¶å€™æˆ‘ä»¬å¯ä»¥å­˜æ”¾äº†ä¸€ä¸ª Token åœ¨ Cookie ä¸­ï¼Œä¸‹æ¬¡ç™»å½•çš„æ—¶å€™åªéœ€è¦æ ¹æ® Token å€¼æ¥æŸ¥æ‰¾ç”¨æˆ·å³å¯(ä¸ºäº†å®‰å…¨è€ƒè™‘ï¼Œé‡æ–°ç™»å½•ä¸€èˆ¬è¦å°† Token é‡å†™)ï¼›â‘¢ç™»å½•ä¸€æ¬¡ç½‘ç«™åè®¿é—®ç½‘ç«™å…¶ä»–é¡µé¢ä¸éœ€è¦é‡æ–°ç™»å½•ã€‚<strong>Session çš„ä¸»è¦ä½œç”¨å°±æ˜¯é€šè¿‡æœåŠ¡ç«¯è®°å½•ç”¨æˆ·çš„çŠ¶æ€ã€‚</strong> å…¸å‹çš„åœºæ™¯æ˜¯è´­ç‰©è½¦ï¼Œå½“ä½ è¦æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦çš„æ—¶å€™ï¼Œç³»ç»Ÿä¸çŸ¥é“æ˜¯å“ªä¸ªç”¨æˆ·æ“ä½œçš„ï¼Œå› ä¸º HTTP åè®®æ˜¯æ— çŠ¶æ€çš„ã€‚æœåŠ¡ç«¯ç»™ç‰¹å®šçš„ç”¨æˆ·åˆ›å»ºç‰¹å®šçš„ Session ä¹‹åå°±å¯ä»¥æ ‡è¯†è¿™ä¸ªç”¨æˆ·å¹¶ä¸”è·Ÿè¸ªè¿™ä¸ªç”¨æˆ·äº†ã€‚</p><p>Cookie æ•°æ®ä¿å­˜åœ¨å®¢æˆ·ç«¯(æµè§ˆå™¨ç«¯)ï¼ŒSession æ•°æ®ä¿å­˜åœ¨æœåŠ¡å™¨ç«¯ã€‚</p><p>Cookie å­˜å‚¨åœ¨å®¢æˆ·ç«¯ä¸­ï¼Œè€ŒSessionå­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šï¼Œç›¸å¯¹æ¥è¯´ Session å®‰å…¨æ€§æ›´é«˜ã€‚å¦‚æœä½¿ç”¨ Cookie çš„ä¸€äº›æ•æ„Ÿä¿¡æ¯ä¸è¦å†™å…¥ Cookie ä¸­ï¼Œæœ€å¥½èƒ½å°† Cookie ä¿¡æ¯åŠ å¯†ç„¶åä½¿ç”¨åˆ°çš„æ—¶å€™å†å»æœåŠ¡å™¨ç«¯è§£å¯†ã€‚</p><h4 id="æµè§ˆå™¨ç¦ç”¨-Cookie"><a href="#æµè§ˆå™¨ç¦ç”¨-Cookie" class="headerlink" title="æµè§ˆå™¨ç¦ç”¨ Cookie"></a>æµè§ˆå™¨ç¦ç”¨ Cookie</h4><p>æ­¤æ—¶æ— æ³•ä½¿ç”¨ Cookie æ¥ä¿å­˜ç”¨æˆ·ä¿¡æ¯ï¼Œåªèƒ½ä½¿ç”¨ Sessionã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä¸èƒ½å†å°† Session ID å­˜æ”¾åˆ° Cookie ä¸­ï¼Œè€Œæ˜¯ä½¿ç”¨ URL é‡å†™æŠ€æœ¯ï¼Œå°† Session ID ä½œä¸º URL çš„å‚æ•°è¿›è¡Œä¼ é€’ã€‚</p><h4 id="Cookie-ä¸-Session-é€‰æ‹©"><a href="#Cookie-ä¸-Session-é€‰æ‹©" class="headerlink" title="Cookie ä¸ Session é€‰æ‹©"></a>Cookie ä¸ Session é€‰æ‹©</h4><ul><li>Cookie åªèƒ½å­˜å‚¨ ASCII ç å­—ç¬¦ä¸²ï¼Œè€Œ Session åˆ™å¯ä»¥å­˜å‚¨ä»»ä½•ç±»å‹çš„æ•°æ®ï¼Œå› æ­¤åœ¨è€ƒè™‘æ•°æ®å¤æ‚æ€§æ—¶é¦–é€‰ Sessionï¼›</li><li>Cookie å­˜å‚¨åœ¨æµè§ˆå™¨ä¸­ï¼Œå®¹æ˜“è¢«æ¶æ„æŸ¥çœ‹ã€‚å¦‚æœéè¦å°†ä¸€äº›éšç§æ•°æ®å­˜åœ¨ Cookie ä¸­ï¼Œå¯ä»¥å°† Cookie å€¼è¿›è¡ŒåŠ å¯†ï¼Œç„¶ååœ¨æœåŠ¡å™¨è¿›è¡Œè§£å¯†ï¼›</li><li>å¯¹äºå¤§å‹ç½‘ç«™ï¼Œå¦‚æœç”¨æˆ·æ‰€æœ‰çš„ä¿¡æ¯éƒ½å­˜å‚¨åœ¨ Session ä¸­ï¼Œé‚£ä¹ˆå¼€é”€æ˜¯éå¸¸å¤§çš„ï¼Œå› æ­¤ä¸å»ºè®®å°†æ‰€æœ‰çš„ç”¨æˆ·ä¿¡æ¯éƒ½å­˜å‚¨åˆ° Session ä¸­ã€‚</li></ul><h3 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h3><p>HTTP åè®®æ˜¯æ— çŠ¶æ€çš„ï¼Œä¸»è¦æ˜¯ä¸ºäº†è®© HTTP åè®®å°½å¯èƒ½ç®€å•ï¼Œä½¿å¾—å®ƒèƒ½å¤Ÿå¤„ç†å¤§é‡äº‹åŠ¡ã€‚HTTP/1.1 å¼•å…¥ Cookie æ¥ä¿å­˜çŠ¶æ€ä¿¡æ¯ã€‚</p><p>Cookie æ˜¯æœåŠ¡å™¨å‘é€åˆ°ç”¨æˆ·æµè§ˆå™¨å¹¶ä¿å­˜åœ¨æœ¬åœ°çš„ä¸€å°å—æ•°æ®ï¼Œå®ƒä¼šåœ¨æµè§ˆå™¨ä¹‹åå‘åŒä¸€æœåŠ¡å™¨å†æ¬¡å‘èµ·è¯·æ±‚æ—¶è¢«æºå¸¦ä¸Šï¼Œç”¨äºå‘ŠçŸ¥æœåŠ¡ç«¯ä¸¤ä¸ªè¯·æ±‚æ˜¯å¦æ¥è‡ªåŒä¸€æµè§ˆå™¨ã€‚ç”±äºä¹‹åæ¯æ¬¡è¯·æ±‚éƒ½ä¼šéœ€è¦æºå¸¦ Cookie æ•°æ®ï¼Œå› æ­¤ä¼šå¸¦æ¥é¢å¤–çš„æ€§èƒ½å¼€é”€ï¼ˆå°¤å…¶æ˜¯åœ¨ç§»åŠ¨ç¯å¢ƒä¸‹ï¼‰ã€‚</p><p>Cookie æ›¾ä¸€åº¦ç”¨äºå®¢æˆ·ç«¯æ•°æ®çš„å­˜å‚¨ï¼Œå› ä¸ºå½“æ—¶å¹¶æ²¡æœ‰å…¶å®ƒåˆé€‚çš„å­˜å‚¨åŠæ³•è€Œä½œä¸ºå”¯ä¸€çš„å­˜å‚¨æ‰‹æ®µï¼Œä½†ç°åœ¨éšç€ç°ä»£æµè§ˆå™¨å¼€å§‹æ”¯æŒå„ç§å„æ ·çš„å­˜å‚¨æ–¹å¼ï¼ŒCookie æ¸æ¸è¢«æ·˜æ±°ã€‚æ–°çš„æµè§ˆå™¨ API å·²ç»å…è®¸å¼€å‘è€…ç›´æ¥å°†æ•°æ®å­˜å‚¨åˆ°æœ¬åœ°ï¼Œå¦‚ä½¿ç”¨ Web storage APIï¼ˆæœ¬åœ°å­˜å‚¨å’Œä¼šè¯å­˜å‚¨ï¼‰æˆ– IndexedDBã€‚</p><h4 id="ç”¨é€”"><a href="#ç”¨é€”" class="headerlink" title="ç”¨é€”"></a>ç”¨é€”</h4><ul><li>ä¼šè¯çŠ¶æ€ç®¡ç†ï¼ˆå¦‚ç”¨æˆ·ç™»å½•çŠ¶æ€ã€è´­ç‰©è½¦ã€æ¸¸æˆåˆ†æ•°æˆ–å…¶å®ƒéœ€è¦è®°å½•çš„ä¿¡æ¯ï¼‰</li><li>ä¸ªæ€§åŒ–è®¾ç½®ï¼ˆå¦‚ç”¨æˆ·è‡ªå®šä¹‰è®¾ç½®ã€ä¸»é¢˜ç­‰ï¼‰</li><li>æµè§ˆå™¨è¡Œä¸ºè·Ÿè¸ªï¼ˆå¦‚è·Ÿè¸ªåˆ†æç”¨æˆ·è¡Œä¸ºç­‰ï¼‰</li></ul><h4 id="åˆ›å»ºè¿‡ç¨‹"><a href="#åˆ›å»ºè¿‡ç¨‹" class="headerlink" title="åˆ›å»ºè¿‡ç¨‹"></a>åˆ›å»ºè¿‡ç¨‹</h4><p>æœåŠ¡å™¨å‘é€çš„å“åº”æŠ¥æ–‡åŒ…å« Set-Cookie é¦–éƒ¨å­—æ®µï¼Œå®¢æˆ·ç«¯å¾—åˆ°å“åº”æŠ¥æ–‡åæŠŠ Cookie å†…å®¹ä¿å­˜åˆ°æµè§ˆå™¨ä¸­ã€‚</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.0 <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Content-type</span>: text/html</span><br><span class="line"><span class="attribute">Set-Cookie</span>: yummy_cookie=choco</span><br><span class="line"><span class="attribute">Set-Cookie</span>: tasty_cookie=strawberry</span><br></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯ä¹‹åå¯¹åŒä¸€ä¸ªæœåŠ¡å™¨å‘é€è¯·æ±‚æ—¶ï¼Œä¼šä»æµè§ˆå™¨ä¸­å–å‡º Cookie ä¿¡æ¯å¹¶é€šè¿‡ Cookie è¯·æ±‚é¦–éƒ¨å­—æ®µå‘é€ç»™æœåŠ¡å™¨ã€‚</p><p>å®¢æˆ·ç«¯ä¹‹åå¯¹åŒä¸€ä¸ªæœåŠ¡å™¨å‘é€è¯·æ±‚æ—¶ï¼Œä¼šä»æµè§ˆå™¨ä¸­å–å‡º Cookie ä¿¡æ¯å¹¶é€šè¿‡ Cookie è¯·æ±‚é¦–éƒ¨å­—æ®µå‘é€ç»™æœåŠ¡å™¨ã€‚</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/sample_page.html</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: www.example.org</span><br><span class="line"><span class="attribute">Cookie</span>: yummy_cookie=choco; tasty_cookie=strawberry</span><br></pre></td></tr></table></figure><h4 id="åˆ†ç±»"><a href="#åˆ†ç±»" class="headerlink" title="åˆ†ç±»"></a>åˆ†ç±»</h4><ul><li>ä¼šè¯æœŸ Cookieï¼šæµè§ˆå™¨å…³é—­ä¹‹åå®ƒä¼šè¢«è‡ªåŠ¨åˆ é™¤ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä»…åœ¨ä¼šè¯æœŸå†…æœ‰æ•ˆã€‚</li><li>æŒä¹…æ€§ Cookieï¼šæŒ‡å®šè¿‡æœŸæ—¶é—´ï¼ˆExpiresï¼‰æˆ–æœ‰æ•ˆæœŸï¼ˆmax-ageï¼‰ä¹‹åå°±æˆä¸ºäº†æŒä¹…æ€§çš„ Cookieã€‚</li></ul><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Set-Cookie</span>: id=a3fWa; Expires=Wed, 21 Oct 2015 07:28:00 GMT;</span><br></pre></td></tr></table></figure><h4 id="ä½œç”¨åŸŸ"><a href="#ä½œç”¨åŸŸ" class="headerlink" title="ä½œç”¨åŸŸ"></a>ä½œç”¨åŸŸ</h4><p>Domain æ ‡è¯†æŒ‡å®šäº†å“ªäº›ä¸»æœºå¯ä»¥æ¥å— Cookieã€‚å¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤ä¸ºå½“å‰æ–‡æ¡£çš„ä¸»æœºï¼ˆä¸åŒ…å«å­åŸŸåï¼‰ã€‚å¦‚æœæŒ‡å®šäº† Domainï¼Œåˆ™ä¸€èˆ¬åŒ…å«å­åŸŸåã€‚ä¾‹å¦‚ï¼Œå¦‚æœè®¾ç½® Domain=mozilla.orgï¼Œåˆ™ Cookie ä¹ŸåŒ…å«åœ¨å­åŸŸåä¸­ï¼ˆå¦‚ developer.mozilla.orgï¼‰ã€‚</p><p>Path æ ‡è¯†æŒ‡å®šäº†ä¸»æœºä¸‹çš„å“ªäº›è·¯å¾„å¯ä»¥æ¥å— Cookieï¼ˆè¯¥ URL è·¯å¾„å¿…é¡»å­˜åœ¨äºè¯·æ±‚ URL ä¸­ï¼‰ã€‚ä»¥å­—ç¬¦ %x2F (â€œ/â€œ) ä½œä¸ºè·¯å¾„åˆ†éš”ç¬¦ï¼Œå­è·¯å¾„ä¹Ÿä¼šè¢«åŒ¹é…ã€‚ä¾‹å¦‚ï¼Œè®¾ç½® Path=/docsï¼Œåˆ™ä»¥ä¸‹åœ°å€éƒ½ä¼šåŒ¹é…ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/docs</span><br><span class="line">/docs/Web/</span><br><span class="line">/docs/Web/HTTP</span><br></pre></td></tr></table></figure><h3 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h3><p>é™¤äº†å¯ä»¥å°†ç”¨æˆ·ä¿¡æ¯é€šè¿‡ Cookie å­˜å‚¨åœ¨ç”¨æˆ·æµè§ˆå™¨ä¸­ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨ Session å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯ï¼Œå­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯çš„ä¿¡æ¯æ›´åŠ å®‰å…¨ã€‚</p><p>Session å¯ä»¥å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ã€æ•°æ®åº“æˆ–è€…å†…å­˜ä¸­ã€‚ä¹Ÿå¯ä»¥å°† Session å­˜å‚¨åœ¨ Redis è¿™ç§å†…å­˜å‹æ•°æ®åº“ä¸­ï¼Œæ•ˆç‡ä¼šæ›´é«˜ã€‚</p><p>ä½¿ç”¨ Session ç»´æŠ¤ç”¨æˆ·ç™»å½•çŠ¶æ€çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul><li>ç”¨æˆ·è¿›è¡Œç™»å½•æ—¶ï¼Œç”¨æˆ·æäº¤åŒ…å«ç”¨æˆ·åå’Œå¯†ç çš„è¡¨å•ï¼Œæ”¾å…¥ HTTP è¯·æ±‚æŠ¥æ–‡ä¸­ï¼›</li><li>æœåŠ¡å™¨éªŒè¯è¯¥ç”¨æˆ·åå’Œå¯†ç ï¼Œå¦‚æœæ­£ç¡®åˆ™æŠŠç”¨æˆ·ä¿¡æ¯å­˜å‚¨åˆ° Redis ä¸­ï¼Œå®ƒåœ¨ Redis ä¸­çš„ Key ç§°ä¸º Session IDï¼›</li><li>æœåŠ¡å™¨è¿”å›çš„å“åº”æŠ¥æ–‡çš„ Set-Cookie é¦–éƒ¨å­—æ®µåŒ…å«äº†è¿™ä¸ª Session IDï¼Œå®¢æˆ·ç«¯æ”¶åˆ°å“åº”æŠ¥æ–‡ä¹‹åå°†è¯¥ Cookie å€¼å­˜å…¥æµè§ˆå™¨ä¸­ï¼›</li><li>å®¢æˆ·ç«¯ä¹‹åå¯¹åŒä¸€ä¸ªæœåŠ¡å™¨è¿›è¡Œè¯·æ±‚æ—¶ä¼šåŒ…å«è¯¥ Cookie å€¼ï¼ŒæœåŠ¡å™¨æ”¶åˆ°ä¹‹åæå–å‡º Session IDï¼Œä» Redis ä¸­å–å‡ºç”¨æˆ·ä¿¡æ¯ï¼Œç»§ç»­ä¹‹å‰çš„ä¸šåŠ¡æ“ä½œã€‚</li></ul><p>åº”è¯¥æ³¨æ„ Session ID çš„å®‰å…¨æ€§é—®é¢˜ï¼Œä¸èƒ½è®©å®ƒè¢«æ¶æ„æ”»å‡»è€…è½»æ˜“è·å–ï¼Œé‚£ä¹ˆå°±ä¸èƒ½äº§ç”Ÿä¸€ä¸ªå®¹æ˜“è¢«çŒœåˆ°çš„ Session ID å€¼ã€‚æ­¤å¤–ï¼Œè¿˜éœ€è¦ç»å¸¸é‡æ–°ç”Ÿæˆ Session IDã€‚åœ¨å¯¹å®‰å…¨æ€§è¦æ±‚æé«˜çš„åœºæ™¯ä¸‹ï¼Œä¾‹å¦‚è½¬è´¦ç­‰æ“ä½œï¼Œé™¤äº†ä½¿ç”¨ Session ç®¡ç†ç”¨æˆ·çŠ¶æ€ä¹‹å¤–ï¼Œè¿˜éœ€è¦å¯¹ç”¨æˆ·è¿›è¡Œé‡æ–°éªŒè¯ï¼Œæ¯”å¦‚é‡æ–°è¾“å…¥å¯†ç ï¼Œæˆ–è€…ä½¿ç”¨çŸ­ä¿¡éªŒè¯ç ç­‰æ–¹å¼ã€‚</p><h3 id="HTTP-1-0ä¸HTTP-1-1"><a href="#HTTP-1-0ä¸HTTP-1-1" class="headerlink" title="HTTP 1.0ä¸HTTP 1.1"></a>HTTP 1.0ä¸HTTP 1.1</h3><blockquote><p>è¿™éƒ¨åˆ†å›ç­”å¼•ç”¨è¿™ç¯‡æ–‡ç«  <a href="https://mp.weixin.qq.com/s/GICbiyJpINrHZ41u_4zT-A" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/GICbiyJpINrHZ41u_4zT-A</a>? çš„ä¸€äº›å†…å®¹ã€‚</p></blockquote><p>HTTP1.0æœ€æ—©åœ¨ç½‘é¡µä¸­ä½¿ç”¨æ˜¯åœ¨1996å¹´ï¼Œé‚£ä¸ªæ—¶å€™åªæ˜¯ä½¿ç”¨ä¸€äº›è¾ƒä¸ºç®€å•çš„ç½‘é¡µä¸Šå’Œç½‘ç»œè¯·æ±‚ä¸Šï¼Œè€ŒHTTP1.1åˆ™åœ¨1999å¹´æ‰å¼€å§‹å¹¿æ³›åº”ç”¨äºç°åœ¨çš„å„å¤§æµè§ˆå™¨ç½‘ç»œè¯·æ±‚ä¸­ï¼ŒåŒæ—¶HTTP1.1ä¹Ÿæ˜¯å½“å‰ä½¿ç”¨æœ€ä¸ºå¹¿æ³›çš„HTTPåè®®ã€‚ ä¸»è¦åŒºåˆ«ä¸»è¦ä½“ç°åœ¨ï¼š</p><ol><li><strong>é•¿è¿æ¥</strong> : <strong>åœ¨HTTP/1.0ä¸­ï¼Œé»˜è®¤ä½¿ç”¨çš„æ˜¯çŸ­è¿æ¥</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯æ¬¡è¯·æ±‚éƒ½è¦é‡æ–°å»ºç«‹ä¸€æ¬¡è¿æ¥ã€‚HTTP æ˜¯åŸºäºTCP/IPåè®®çš„,æ¯ä¸€æ¬¡å»ºç«‹æˆ–è€…æ–­å¼€è¿æ¥éƒ½éœ€è¦ä¸‰æ¬¡æ¡æ‰‹å››æ¬¡æŒ¥æ‰‹çš„å¼€é”€ï¼Œå¦‚æœæ¯æ¬¡è¯·æ±‚éƒ½è¦è¿™æ ·çš„è¯ï¼Œå¼€é”€ä¼šæ¯”è¾ƒå¤§ã€‚å› æ­¤æœ€å¥½èƒ½ç»´æŒä¸€ä¸ªé•¿è¿æ¥ï¼Œå¯ä»¥ç”¨ä¸ªé•¿è¿æ¥æ¥å‘å¤šä¸ªè¯·æ±‚ã€‚<strong>HTTP 1.1èµ·ï¼Œé»˜è®¤ä½¿ç”¨é•¿è¿æ¥</strong> ,é»˜è®¤å¼€å¯Connectionï¼š keep-aliveã€‚ <strong>HTTP/1.1çš„æŒç»­è¿æ¥æœ‰éæµæ°´çº¿æ–¹å¼å’Œæµæ°´çº¿æ–¹å¼</strong> ã€‚æµæ°´çº¿æ–¹å¼æ˜¯å®¢æˆ·åœ¨æ”¶åˆ°HTTPçš„å“åº”æŠ¥æ–‡ä¹‹å‰å°±èƒ½æ¥ç€å‘é€æ–°çš„è¯·æ±‚æŠ¥æ–‡ã€‚ä¸ä¹‹ç›¸å¯¹åº”çš„éæµæ°´çº¿æ–¹å¼æ˜¯å®¢æˆ·åœ¨æ”¶åˆ°å‰ä¸€ä¸ªå“åº”åæ‰èƒ½å‘é€ä¸‹ä¸€ä¸ªè¯·æ±‚ã€‚</li><li><strong>é”™è¯¯çŠ¶æ€å“åº”ç </strong> :åœ¨HTTP1.1ä¸­æ–°å¢äº†24ä¸ªé”™è¯¯çŠ¶æ€å“åº”ç ï¼Œå¦‚409ï¼ˆConflictï¼‰è¡¨ç¤ºè¯·æ±‚çš„èµ„æºä¸èµ„æºçš„å½“å‰çŠ¶æ€å‘ç”Ÿå†²çªï¼›410ï¼ˆGoneï¼‰è¡¨ç¤ºæœåŠ¡å™¨ä¸Šçš„æŸä¸ªèµ„æºè¢«æ°¸ä¹…æ€§çš„åˆ é™¤ã€‚</li><li><strong>ç¼“å­˜å¤„ç†</strong> :åœ¨HTTP1.0ä¸­ä¸»è¦ä½¿ç”¨headeré‡Œçš„If-Modified-Since,Expiresæ¥åšä¸ºç¼“å­˜åˆ¤æ–­çš„æ ‡å‡†ï¼ŒHTTP1.1åˆ™å¼•å…¥äº†æ›´å¤šçš„ç¼“å­˜æ§åˆ¶ç­–ç•¥ä¾‹å¦‚Entity tagï¼ŒIf-Unmodified-Since, If-Match, If-None-Matchç­‰æ›´å¤šå¯ä¾›é€‰æ‹©çš„ç¼“å­˜å¤´æ¥æ§åˆ¶ç¼“å­˜ç­–ç•¥ã€‚</li><li><strong>å¸¦å®½ä¼˜åŒ–åŠç½‘ç»œè¿æ¥çš„ä½¿ç”¨</strong> :HTTP1.0ä¸­ï¼Œå­˜åœ¨ä¸€äº›æµªè´¹å¸¦å®½çš„ç°è±¡ï¼Œä¾‹å¦‚å®¢æˆ·ç«¯åªæ˜¯éœ€è¦æŸä¸ªå¯¹è±¡çš„ä¸€éƒ¨åˆ†ï¼Œè€ŒæœåŠ¡å™¨å´å°†æ•´ä¸ªå¯¹è±¡é€è¿‡æ¥äº†ï¼Œå¹¶ä¸”ä¸æ”¯æŒæ–­ç‚¹ç»­ä¼ åŠŸèƒ½ï¼ŒHTTP1.1åˆ™åœ¨è¯·æ±‚å¤´å¼•å…¥äº†rangeå¤´åŸŸï¼Œå®ƒå…è®¸åªè¯·æ±‚èµ„æºçš„æŸä¸ªéƒ¨åˆ†ï¼Œå³è¿”å›ç æ˜¯206ï¼ˆPartial Contentï¼‰ï¼Œè¿™æ ·å°±æ–¹ä¾¿äº†å¼€å‘è€…è‡ªç”±çš„é€‰æ‹©ä»¥ä¾¿äºå……åˆ†åˆ©ç”¨å¸¦å®½å’Œè¿æ¥ã€‚</li></ol><h3 id="è¯·æ±‚å’Œå“åº”æŠ¥æ–‡"><a href="#è¯·æ±‚å’Œå“åº”æŠ¥æ–‡" class="headerlink" title="è¯·æ±‚å’Œå“åº”æŠ¥æ–‡"></a>è¯·æ±‚å’Œå“åº”æŠ¥æ–‡</h3><h4 id="è¯·æ±‚æŠ¥æ–‡"><a href="#è¯·æ±‚æŠ¥æ–‡" class="headerlink" title="è¯·æ±‚æŠ¥æ–‡"></a>è¯·æ±‚æŠ¥æ–‡</h4><p><img src="http://m.qpic.cn/psb?/V11tv2Vw2h2WsJ/mkJaDOUBzk87ThnK15P3txuYPndh*ZE.fSG4NT7DD0c!/b/dL4AAAAAAAAA&bo=kALdAJAC3QADCSw!&rf=viewer_4" alt="img"></p><h4 id="å“åº”æŠ¥æ–‡"><a href="#å“åº”æŠ¥æ–‡" class="headerlink" title="å“åº”æŠ¥æ–‡"></a>å“åº”æŠ¥æ–‡</h4><p><img src="http://m.qpic.cn/psb?/V11tv2Vw2h2WsJ/zJyJco59whskn9W9AoddItbQ6kJgG.hSY470evBfB2A!/b/dL8AAAAAAAAA&bo=wAILAcACCwEDGTw!&rf=viewer_4" alt="img"></p><h3 id="HTTP-ä¸-HTTPS"><a href="#HTTP-ä¸-HTTPS" class="headerlink" title="HTTP ä¸ HTTPS"></a>HTTP ä¸ HTTPS</h3><ol><li><p><strong>ç«¯å£</strong> ï¼šHTTPçš„URLç”±â€œhttp://â€èµ·å§‹ä¸”é»˜è®¤ä½¿ç”¨ç«¯å£80ï¼Œè€ŒHTTPSçš„URLç”±â€œhttps://â€èµ·å§‹ä¸”é»˜è®¤ä½¿ç”¨ç«¯å£443ã€‚</p></li><li><p>å®‰å…¨æ€§å’Œèµ„æºæ¶ˆè€—ï¼š</p><p>HTTPåè®®è¿è¡Œåœ¨TCPä¹‹ä¸Šï¼Œæ‰€æœ‰ä¼ è¾“çš„å†…å®¹éƒ½æ˜¯æ˜æ–‡ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯éƒ½æ— æ³•éªŒè¯å¯¹æ–¹çš„èº«ä»½ã€‚HTTPSæ˜¯è¿è¡Œåœ¨SSL/TLSä¹‹ä¸Šçš„HTTPåè®®ï¼ŒSSL/TLS è¿è¡Œåœ¨TCPä¹‹ä¸Šã€‚æ‰€æœ‰ä¼ è¾“çš„å†…å®¹éƒ½ç»è¿‡åŠ å¯†ï¼ŒåŠ å¯†é‡‡ç”¨å¯¹ç§°åŠ å¯†ï¼Œä½†å¯¹ç§°åŠ å¯†çš„å¯†é’¥ç”¨æœåŠ¡å™¨æ–¹çš„è¯ä¹¦è¿›è¡Œäº†éå¯¹ç§°åŠ å¯†ã€‚æ‰€ä»¥è¯´ï¼ŒHTTP å®‰å…¨æ€§æ²¡æœ‰ HTTPSé«˜ï¼Œä½†æ˜¯ HTTPS æ¯”HTTPè€—è´¹æ›´å¤šæœåŠ¡å™¨èµ„æºã€‚</p><ul><li>å¯¹ç§°åŠ å¯†ï¼šå¯†é’¥åªæœ‰ä¸€ä¸ªï¼ŒåŠ å¯†è§£å¯†ä¸ºåŒä¸€ä¸ªå¯†ç ï¼Œä¸”åŠ è§£å¯†é€Ÿåº¦å¿«ï¼Œå…¸å‹çš„å¯¹ç§°åŠ å¯†ç®—æ³•æœ‰DESã€AESç­‰ï¼›</li><li>éå¯¹ç§°åŠ å¯†ï¼šå¯†é’¥æˆå¯¹å‡ºç°ï¼ˆä¸”æ ¹æ®å…¬é’¥æ— æ³•æ¨çŸ¥ç§é’¥ï¼Œæ ¹æ®ç§é’¥ä¹Ÿæ— æ³•æ¨çŸ¥å…¬é’¥ï¼‰ï¼ŒåŠ å¯†è§£å¯†ä½¿ç”¨ä¸åŒå¯†é’¥ï¼ˆå…¬é’¥åŠ å¯†éœ€è¦ç§é’¥è§£å¯†ï¼Œç§é’¥åŠ å¯†éœ€è¦å…¬é’¥è§£å¯†ï¼‰ï¼Œç›¸å¯¹å¯¹ç§°åŠ å¯†é€Ÿåº¦è¾ƒæ…¢ï¼Œå…¸å‹çš„éå¯¹ç§°åŠ å¯†ç®—æ³•æœ‰RSAã€DSAç­‰ã€‚</li></ul></li></ol><h3 id="GET-ä¸-POST"><a href="#GET-ä¸-POST" class="headerlink" title="GET ä¸ POST"></a>GET ä¸ POST</h3><h4 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h4><p>GET ç”¨äºè·å–èµ„æºï¼Œè€Œ POST ç”¨äºä¼ è¾“å®ä½“ä¸»ä½“ã€‚</p><h4 id="å‚æ•°"><a href="#å‚æ•°" class="headerlink" title="å‚æ•°"></a>å‚æ•°</h4><p>GET å’Œ POST çš„è¯·æ±‚éƒ½èƒ½ä½¿ç”¨é¢å¤–çš„å‚æ•°ï¼Œä½†æ˜¯ GET çš„å‚æ•°æ˜¯ä»¥æŸ¥è¯¢å­—ç¬¦ä¸²å‡ºç°åœ¨ URL ä¸­ï¼Œè€Œ POST çš„å‚æ•°å­˜å‚¨åœ¨å®ä½“ä¸»ä½“ä¸­ã€‚ä¸èƒ½å› ä¸º POST å‚æ•°å­˜å‚¨åœ¨å®ä½“ä¸»ä½“ä¸­å°±è®¤ä¸ºå®ƒçš„å®‰å…¨æ€§æ›´é«˜ï¼Œå› ä¸ºç…§æ ·å¯ä»¥é€šè¿‡ä¸€äº›æŠ“åŒ…å·¥å…·ï¼ˆFiddlerï¼‰æŸ¥çœ‹ã€‚</p><p>å› ä¸º URL åªæ”¯æŒ ASCII ç ï¼Œå› æ­¤ GET çš„å‚æ•°ä¸­å¦‚æœå­˜åœ¨ä¸­æ–‡ç­‰å­—ç¬¦å°±éœ€è¦å…ˆè¿›è¡Œç¼–ç ã€‚ä¾‹å¦‚ <code>ä¸­æ–‡</code> ä¼šè½¬æ¢ä¸º <code>%E4%B8%AD%E6%96%87</code>ï¼Œè€Œç©ºæ ¼ä¼šè½¬æ¢ä¸º <code>%20</code>ã€‚POST å‚æ•°æ”¯æŒæ ‡å‡†å­—ç¬¦é›†ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET /test/demo_form.asp?name1=value1&amp;name2=value2 HTTP/1.1Copy to clipboardErrorCopied</span><br><span class="line"><span class="keyword">POST</span> <span class="string">/test/demo_form.asp</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: w3schools.com</span><br><span class="line">name1=value1&amp;name2=value2</span><br></pre></td></tr></table></figure><h4 id="å®‰å…¨"><a href="#å®‰å…¨" class="headerlink" title="å®‰å…¨"></a>å®‰å…¨</h4><p>å®‰å…¨çš„ HTTP æ–¹æ³•ä¸ä¼šæ”¹å˜æœåŠ¡å™¨çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒåªæ˜¯å¯è¯»çš„ã€‚</p><p>GET æ–¹æ³•æ˜¯å®‰å…¨çš„ï¼Œè€Œ POST å´ä¸æ˜¯ï¼Œå› ä¸º POST çš„ç›®çš„æ˜¯ä¼ é€å®ä½“ä¸»ä½“å†…å®¹ï¼Œè¿™ä¸ªå†…å®¹å¯èƒ½æ˜¯ç”¨æˆ·ä¸Šä¼ çš„è¡¨å•æ•°æ®ï¼Œä¸Šä¼ æˆåŠŸä¹‹åï¼ŒæœåŠ¡å™¨å¯èƒ½æŠŠè¿™ä¸ªæ•°æ®å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ï¼Œå› æ­¤çŠ¶æ€ä¹Ÿå°±å‘ç”Ÿäº†æ”¹å˜ã€‚</p><p>å®‰å…¨çš„æ–¹æ³•é™¤äº† GET ä¹‹å¤–è¿˜æœ‰ï¼šHEADã€OPTIONSã€‚</p><p>ä¸å®‰å…¨çš„æ–¹æ³•é™¤äº† POST ä¹‹å¤–è¿˜æœ‰ PUTã€DELETEã€‚</p><h4 id="å¹‚ç­‰æ€§"><a href="#å¹‚ç­‰æ€§" class="headerlink" title="å¹‚ç­‰æ€§"></a>å¹‚ç­‰æ€§</h4><p>å¹‚ç­‰çš„ HTTP æ–¹æ³•ï¼ŒåŒæ ·çš„è¯·æ±‚è¢«æ‰§è¡Œä¸€æ¬¡ä¸è¿ç»­æ‰§è¡Œå¤šæ¬¡çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼ŒæœåŠ¡å™¨çš„çŠ¶æ€ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚æ¢å¥è¯è¯´å°±æ˜¯ï¼Œå¹‚ç­‰æ–¹æ³•ä¸åº”è¯¥å…·æœ‰å‰¯ä½œç”¨ï¼ˆç»Ÿè®¡ç”¨é€”é™¤å¤–ï¼‰ã€‚</p><p>æ‰€æœ‰çš„å®‰å…¨æ–¹æ³•ä¹Ÿéƒ½æ˜¯å¹‚ç­‰çš„ã€‚</p><p>åœ¨æ­£ç¡®å®ç°çš„æ¡ä»¶ä¸‹ï¼ŒGETï¼ŒHEADï¼ŒPUT å’Œ DELETE ç­‰æ–¹æ³•éƒ½æ˜¯å¹‚ç­‰çš„ï¼Œè€Œ POST æ–¹æ³•ä¸æ˜¯ã€‚</p><p>GET /pageX HTTP/1.1 æ˜¯å¹‚ç­‰çš„ï¼Œè¿ç»­è°ƒç”¨å¤šæ¬¡ï¼Œå®¢æˆ·ç«¯æ¥æ”¶åˆ°çš„ç»“æœéƒ½æ˜¯ä¸€æ ·çš„ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/pageX</span> HTTP/1.1</span><br><span class="line"><span class="keyword">GET</span> <span class="string">/pageX</span> HTTP/1.1</span><br><span class="line"><span class="keyword">GET</span> <span class="string">/pageX</span> HTTP/1.1</span><br><span class="line"><span class="keyword">GET</span> <span class="string">/pageX</span> HTTP/1.1</span><br></pre></td></tr></table></figure><p>POST /add_row HTTP/1.1 ä¸æ˜¯å¹‚ç­‰çš„ï¼Œå¦‚æœè°ƒç”¨å¤šæ¬¡ï¼Œå°±ä¼šå¢åŠ å¤šè¡Œè®°å½•ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">POST /add_row HTTP/1.1   -&gt; Adds a 1nd row</span><br><span class="line">POST /add_row HTTP/1.1   -&gt; Adds a 2nd row</span><br><span class="line">POST /add_row HTTP/1.1   -&gt; Adds a 3rd row</span><br></pre></td></tr></table></figure><p>DELETE /idX/delete HTTP/1.1 æ˜¯å¹‚ç­‰çš„ï¼Œå³ä½¿ä¸åŒçš„è¯·æ±‚æ¥æ”¶åˆ°çš„çŠ¶æ€ç ä¸ä¸€æ ·ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DELETE /idX/delete HTTP/1.1   -&gt; Returns 200 if idX exists</span><br><span class="line">DELETE /idX/delete HTTP/1.1   -&gt; Returns 404 as it just got deleted</span><br><span class="line">DELETE /idX/delete HTTP/1.1   -&gt; Returns 404</span><br></pre></td></tr></table></figure><h4 id="å¯ç¼“å­˜"><a href="#å¯ç¼“å­˜" class="headerlink" title="å¯ç¼“å­˜"></a>å¯ç¼“å­˜</h4><p>å¦‚æœè¦å¯¹å“åº”è¿›è¡Œç¼“å­˜ï¼Œéœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š</p><ul><li>è¯·æ±‚æŠ¥æ–‡çš„ HTTP æ–¹æ³•æœ¬èº«æ˜¯å¯ç¼“å­˜çš„ï¼ŒåŒ…æ‹¬ GET å’Œ HEADï¼Œä½†æ˜¯ PUT å’Œ DELETE ä¸å¯ç¼“å­˜ï¼ŒPOST åœ¨å¤šæ•°æƒ…å†µä¸‹ä¸å¯ç¼“å­˜çš„ã€‚</li><li>å“åº”æŠ¥æ–‡çš„çŠ¶æ€ç æ˜¯å¯ç¼“å­˜çš„ï¼ŒåŒ…æ‹¬ï¼š200, 203, 204, 206, 300, 301, 404, 405, 410, 414, and 501ã€‚</li><li>å“åº”æŠ¥æ–‡çš„ Cache-Control é¦–éƒ¨å­—æ®µæ²¡æœ‰æŒ‡å®šä¸è¿›è¡Œç¼“å­˜ã€‚</li></ul><h4 id="XMLHttpRequest"><a href="#XMLHttpRequest" class="headerlink" title="XMLHttpRequest"></a>XMLHttpRequest</h4><p>ä¸ºäº†é˜è¿° POST å’Œ GET çš„å¦ä¸€ä¸ªåŒºåˆ«ï¼Œéœ€è¦å…ˆäº†è§£ XMLHttpRequestï¼š</p><blockquote><p>XMLHttpRequest æ˜¯ä¸€ä¸ª APIï¼Œå®ƒä¸ºå®¢æˆ·ç«¯æä¾›äº†åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ è¾“æ•°æ®çš„åŠŸèƒ½ã€‚å®ƒæä¾›äº†ä¸€ä¸ªé€šè¿‡ URL æ¥è·å–æ•°æ®çš„ç®€å•æ–¹å¼ï¼Œå¹¶ä¸”ä¸ä¼šä½¿æ•´ä¸ªé¡µé¢åˆ·æ–°ã€‚è¿™ä½¿å¾—ç½‘é¡µåªæ›´æ–°ä¸€éƒ¨åˆ†é¡µé¢è€Œä¸ä¼šæ‰“æ‰°åˆ°ç”¨æˆ·ã€‚XMLHttpRequest åœ¨ AJAX ä¸­è¢«å¤§é‡ä½¿ç”¨ã€‚</p></blockquote><ul><li>åœ¨ä½¿ç”¨ XMLHttpRequest çš„ POST æ–¹æ³•æ—¶ï¼Œæµè§ˆå™¨ä¼šå…ˆå‘é€ Header å†å‘é€ Dataã€‚ä½†å¹¶ä¸æ˜¯æ‰€æœ‰æµè§ˆå™¨ä¼šè¿™ä¹ˆåšï¼Œä¾‹å¦‚ç«ç‹å°±ä¸ä¼šã€‚</li><li>è€Œ GET æ–¹æ³• Header å’Œ Data ä¼šä¸€èµ·å‘é€ã€‚</li></ul><h3 id="HTTPè¯·æ±‚çš„-7-ä¸ªæ­¥éª¤"><a href="#HTTPè¯·æ±‚çš„-7-ä¸ªæ­¥éª¤" class="headerlink" title="HTTPè¯·æ±‚çš„ 7 ä¸ªæ­¥éª¤"></a>HTTPè¯·æ±‚çš„ 7 ä¸ªæ­¥éª¤</h3><p>HTTPé€šä¿¡æœºåˆ¶æ˜¯åœ¨ä¸€æ¬¡å®Œæ•´çš„HTTPé€šä¿¡è¿‡ç¨‹ä¸­ï¼ŒWebæµè§ˆå™¨ä¸WebæœåŠ¡å™¨ä¹‹é—´å°†å®Œæˆä¸‹åˆ—7ä¸ªæ­¥éª¤ï¼š</p><p>å»ºç«‹TCPè¿æ¥-&gt;å‘é€è¯·æ±‚è¡Œ-&gt;å‘é€è¯·æ±‚å¤´-&gt;ï¼ˆåˆ°è¾¾æœåŠ¡å™¨ï¼‰å‘é€çŠ¶æ€è¡Œ-&gt;å‘é€å“åº”å¤´-&gt;å‘é€å“åº”æ•°æ®-&gt;æ–­TCPè¿æ¥</p>]]></content>
      
      
      <categories>
          
          <category> Interview Summary </category>
          
      </categories>
      
      
        <tags>
            
            <tag> computer network </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å‰‘æŒ‡Java</title>
      <link href="/2019/11/22/%E5%89%91%E6%8C%87Java/"/>
      <url>/2019/11/22/%E5%89%91%E6%8C%87Java/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
